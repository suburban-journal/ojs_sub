!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.substance={})}(this,function(e){"use strict";class t{constructor(e){this._changes=e||{}}getChanges(e,t,r,n){if("function"==typeof t?(n=t,t=0):"function"==typeof r&&(n=r,r=void 0),!(e&&t>=0&&n))throw new Error("Invalid arguments");let s=this._getVersion(e),i=this._getChanges(e);n(null,i=i.slice(t,r),s)}addChange(e,t,r){if(!e||!t)throw new Error("Invalid arguments");this._addChange(e,t),r(null,this._getVersion(e))}deleteChanges(e,t){t(null,this._deleteChanges(e).length)}getVersion(e,t){t(null,this._getVersion(e))}_deleteChanges(e){var t=this._getChanges(e);return delete this._changes[e],t}_getVersion(e){var t=this._changes[e];return t?t.length:0}_getChanges(e){return this._changes[e]||[]}_addChange(e,t){this._changes[e]||(this._changes[e]=[]),this._changes[e].push(t)}}function r(e,t){e&&(e.constructor.prototype.forEach?e.forEach(t):Object.keys(e).forEach(function(r){return t(e[r],r)}))}class n extends Error{constructor(e,t){super(e,t),this.name=e,this.message=t.message,this.info=t.info,this.errorCode=t.errorCode,this.cause=t.cause,Error.captureStackTrace&&Error.captureStackTrace(this,n)}inspect(){var e=[];return e.push(this.stack),this.info&&e.push(this.info+". "),this.cause&&(e.push("\nCaused by: "),this.cause.inspect?e.push(this.cause.inspect()):e.push(this.cause.toString())),e.join("")}}function s(e){const t=typeof e;return Boolean(e)&&("object"===t||"function"===t)}n.fromJSON=function(e){return e?new n(e.name,{message:e.message,info:e.info,errorCode:e.errorCode,cause:n.fromJSON(e.cause)}):null};const i=!1;let o=0;const a="%s listeners registered in the whole system.";class l{emit(e){if(e in this.__events__){for(var t=this.__events__[e].slice(),r=Array.prototype.slice.call(arguments,1),n=0,s=t.length;n<s;n++){var i=t[n];i.method.apply(i.context,r)}return!0}return!1}on(e,t,r){(function(e,t,r){var n;h(t,r),n=this.__events__.hasOwnProperty(e)?this.__events__[e]:this.__events__[e]=[];n.push({method:t,context:r||null}),i&&(o++,console.info("_on()",e,t.name,r,this),console.info(a,o));return this}).call(this,e,t,r)}off(e,t,n){1===arguments.length&&s(arguments[0])?function(e){return r(this.__events__,(t,r)=>{for(let n=t.length-1;n>=0;n--)t[n]&&t[n].context===e&&c.call(this,r,t[n].method,e)}),this}.call(this,arguments[0]):c.apply(this,arguments)}_debugEvents(){console.log("### EventEmitter: ",this),r(this.__events__,(e,t)=>{console.log("- %s listeners for %s: ",e.length,t,e)})}get __events__(){return this.___events___||(this.___events___={}),this.___events___}}function c(e,t,n){if(0===arguments.length)return i&&(r(this.__events__,e=>{e.forEach(e=>{console.info("_off()",e.method.name,e.context,this)}),o-=e.length}),console.info(a,o)),this.___events___={},this;if(1===arguments.length)return i&&(o-=(this.__events__[e]||[]).length,console.info(a,o)),delete this.__events__[e],this;if(h(t,n),!(e in this.__events__&&this.__events__[e].length))return i&&console.info("NO MATCHING BINDINGS"),this;arguments.length<3&&(n=null);let s=this.__events__[e];for(let e=s.length-1;e>=0;e--){const r=s[e];r.method===t&&r.context===n&&(s.splice(e,1),i&&o--)}return 0===s.length&&delete this.__events__[e],i&&console.info(a,o),this}function h(e,t){if("string"==typeof e){if(void 0===t||null===t)throw new Error('Method name "'+e+'" has no context.');if(!(e in t))throw new Error('Method not found: "'+e+'"');if("function"!=typeof t[e])throw new Error('Property "'+e+'" is not a function')}else if("function"!=typeof e)throw new Error("Invalid callback. Function or method name expected.")}function d(e,t){e&&"-"!==e[e.length-1]&&(e=e.concat("-"));var r,n,s="0123456789abcdefghijklmnopqrstuvwxyz".split(""),i=[];if(t=t||32)for(r=0;r<t;r++)i[r]=s[0|16*Math.random()];else for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;r<36;r++)i[r]||(n=0|16*Math.random(),i[r]=s[19===r?3&n|8:n]);return(e||"")+i.join("")}class u{constructor(e,t){this.message=e,this.ws=t,this.isAuthenticated=!1,this.isAuhorized=!1}setAuthenticated(e){this.isAuthenticated=!0,this.session=e}setAuthorized(e){this.isAuthorized=!0,this.authorizationData=e}setEnhanced(){this.isEnhanced=!0}}class p{constructor(){this.isReady=!1,this.isEnhanced=!1,this.isSent=!1,this.err=null,this.data=null}error(e){this.err=e,this.isReady=!0}send(e){this.data=e,this.isReady=!0}setEnhanced(){this.isEnhanced=!0}setSent(){this.isSent=!0}}class f extends l{constructor(e){super(),this.config=e,this._onConnection=this._onConnection.bind(this)}bind(e){if(this.wss)throw new Error("Server is already bound to a websocket");this.wss=e,this._connections=new WeakMap,this._collaborators={},this.wss.on("connection",this._onConnection);let t=this.config.heartbeat;t&&(this._heartbeat=setInterval(this._sendHeartbeat.bind(this),t)),this._bound=!0}unbind(){if(!this._bound)throw new Error("Server is not yet bound to a websocket.");this.wss.off("connection",this._onConnection)}onConnection(){}onDisconnect(){}authenticate(e,t){e.setAuthenticated(),this.next(e,t)}authorize(e,t){e.setAuthorized(),this.next(e,t)}enhanceRequest(e,t){e.setEnhanced(),this.next(e,t)}execute(){throw new Error("This method needs to be specified")}enhanceResponse(e,t){t.setEnhanced(),this.next(e,t)}_onConnection(e){let t=d(),r={collaboratorId:t};this._connections.set(e,r),this._collaborators[t]={connection:e},e.on("message",this._onMessage.bind(this,e)),e.on("close",this._onClose.bind(this,e))}_onClose(e){let t=this._connections.get(e).collaboratorId;this.onDisconnect(t),delete this._collaborators[t],this._connections.delete(e)}__initial(e,t){return!e.isAuthenticated&&!e.isAuthorized&&!t.isReady}__authenticated(e,t){return e.isAuthenticated&&!e.isAuthorized&&!t.isReady}__authorized(e,t){return e.isAuthenticated&&e.isAuthorized&&!e.isEnhanced&&!t.isReady}__requestEnhanced(e,t){return e.isAuthenticated&&e.isAuthorized&&e.isEnhanced&&!t.isReady}__executed(e,t){return e.isAuthenticated&&e.isAuthorized&&t.isReady&&t.data&&!t.isEnhanced}__enhanced(e,t){return t.isReady&&t.isEnhanced&&!t.isSent}__error(e,t){return t.err&&!t.isSent}__done(e,t){return t.isSent}next(e,t){this.__initial(e,t)?this.authenticate(e,t):this.__authenticated(e,t)?this.authorize(e,t):this.__authorized(e,t)?this.enhanceRequest(e,t):this.__requestEnhanced(e,t)?this.execute(e,t):this.__executed(e,t)?this.enhanceResponse(e,t):this.__enhanced(e,t)?this.sendResponse(e,t):this.__error(e,t)?this.sendError(e,t):this.__done(e,t)}sendError(e,t){let r=e.message.collaboratorId,n=t.err;this.send(r,n),t.setSent(),this.next(e,t)}_sendHeartbeat(){Object.keys(this._collaborators).forEach(function(e){this.send(e,{type:"highfive",scope:"_internal"})}.bind(this))}sendResponse(e,t){let r=e.message.collaboratorId;this.send(r,t.data),t.setSent(),this.next(e,t)}_isWebsocketOpen(e){return e&&1===e.readyState}send(e,t){!t.scope&&this.config.scope&&(t.scope=this.config.scope);let r=this._collaborators[e].connection;this._isWebsocketOpen(r)?r.send(this.serializeMessage(t)):console.error("Server#send: Websocket for collaborator",e,"is no longer open",t)}broadCast(e,t){e.forEach(function(e){this.send(e,t)}.bind(this))}_processRequest(e){let t=new p;this.next(e,t)}_onMessage(e,t){let r=this._connections.get(e);if((t=this.deserializeMessage(t)).scope===this.scope){t.collaboratorId=r.collaboratorId;let n=new u(t,e);this._processRequest(n)}}serializeMessage(e){return JSON.stringify(e)}deserializeMessage(e){return JSON.parse(e)}}function g(e,t){if(!e)return[];if(t||(t=function(e){return e}),Array.isArray(e))return e.map(t);if(e instanceof Map){let r=[];for(let[n,s]of e)r.push(t(s,n));return r}if(e instanceof Set){let r=[],n=0;return e.forEach(e=>{r.push(t(e,n++))}),r}return Object.keys(e).map(function(r){return t(e[r],r)})}function m(e){return Array.isArray(e)}function _(e){return m(e)?e.slice(0):s(e)?Object.assign({},e):e}const y={inBrowser:!1,inNodeJS:!1,inElectron:!1,isIE:!1,isFF:!1,isOpera:!1,isWebkit:!1,isChromium:!1,version:-1,isWindows:!1,isMac:!1,devtools:!1,_reset:w};function w(){if("undefined"!=typeof window){y.inBrowser=!0;const e=window.navigator.userAgent,t=window.navigator.vendor,r=e.indexOf("MSIE "),n=e.indexOf("Trident/"),s=e.indexOf("Edge/"),i=window.opr,o=window.chrome;r>0?(y.isIE=!0,y.version=10):n>0?(y.isIE=!0,y.version=11,y.isTrident=!0):s>0&&(y.isIE=!0,y.isEdge=!0,y.version=12,parseInt(e.substring(s+5,e.indexOf(".",s)),10)),y.isFF=window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,y.isWebkit=!y.isFF&&!y.isIE,y.isOpera=void 0!==i,y.isChromium=!!o&&"Google Inc."===t&&!y.isOpera&&!y.isEdge}else y.inBrowser=!1;y.inBrowser&&(y.isWindows=void 0!==window.navigator&&window.navigator.appVersion&&-1!==window.navigator.appVersion.indexOf("Win"),y.isMac=void 0!==window.navigator&&window.navigator.platform.indexOf("Mac")>=0),"undefined"!=typeof process&&(y.inBrowser?y.inElectron=!0:y.inNodeJS=!0)}function b(e){return m(e)?e.map(b):y.inBrowser&&e instanceof window.File?e:s(e)?function(e){let t={};return r(e,(e,r)=>{t[r]=b(e)}),t}(e):e}function v(e){return void 0===e._key&&Object.defineProperty(e,"_key",{value:e.join("."),writable:!1,enumerable:!1}),e._key}function C(e){return Boolean(e)&&e.constructor==={}.constructor}function S(e){return"string"==typeof e}function x(e){return"number"==typeof e}function E(e,t){if(e===t)return!0;if(m(e)&&m(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!E(e[r],t[r]))return!1;return!0}if(C(e)&&C(t)){let r=Object.keys(e).sort();if(!E(r,Object.keys(t).sort()))return!1;for(let n=0;n<r.length;n++){let s=r[n];if(!E(e[s],t[s]))return!1}return!0}return!1}function N(e){return null===e||void 0===e}w();var T="object"==typeof global&&global&&global.Object===Object&&global,P="object"==typeof self&&self&&self.Object===Object&&self,D=T||P||Function("return this")(),I=D.Symbol;function A(e,t){for(var r=-1,n=null==e?0:e.length,s=Array(n);++r<n;)s[r]=t(e[r],r,e);return s}var O=Array.isArray,k=Object.prototype,M=k.hasOwnProperty,L=k.toString,R=I?I.toStringTag:void 0;var q=Object.prototype.toString;var B="[object Null]",F="[object Undefined]",j=I?I.toStringTag:void 0;function H(e){return null==e?void 0===e?F:B:j&&j in Object(e)?function(e){var t=M.call(e,R),r=e[R];try{e[R]=void 0;var n=!0}catch(e){}var s=L.call(e);return n&&(t?e[R]=r:delete e[R]),s}(e):function(e){return q.call(e)}(e)}function U(e){return null!=e&&"object"==typeof e}var z="[object Symbol]";function V(e){return"symbol"==typeof e||U(e)&&H(e)==z}var G=1/0,J=I?I.prototype:void 0,K=J?J.toString:void 0;function $(e){if("string"==typeof e)return e;if(O(e))return A(e,$)+"";if(V(e))return K?K.call(e):"";var t=e+"";return"0"==t&&1/e==-G?"-0":t}function X(e){return null==e?"":$(e)}function W(e,t,r){var n=-1,s=e.length;t<0&&(t=-t>s?0:s+t),(r=r>s?s:r)<0&&(r+=s),s=t>r?0:r-t>>>0,t>>>=0;for(var i=Array(s);++n<s;)i[n]=e[n+t];return i}var Y=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");function Z(e){return Y.test(e)}var Q="[\\ud800-\\udfff]",ee="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",te="\\ud83c[\\udffb-\\udfff]",re="[^\\ud800-\\udfff]",ne="(?:\\ud83c[\\udde6-\\uddff]){2}",se="[\\ud800-\\udbff][\\udc00-\\udfff]",ie="(?:"+ee+"|"+te+")"+"?",oe="[\\ufe0e\\ufe0f]?"+ie+("(?:\\u200d(?:"+[re,ne,se].join("|")+")[\\ufe0e\\ufe0f]?"+ie+")*"),ae="(?:"+[re+ee+"?",ee,ne,se,Q].join("|")+")",le=RegExp(te+"(?="+te+")|"+ae+oe,"g");function ce(e){return Z(e)?function(e){return e.match(le)||[]}(e):function(e){return e.split("")}(e)}var he,de=(he="toUpperCase",function(e){var t,r,n,s,i=Z(e=X(e))?ce(e):void 0,o=i?i[0]:e.charAt(0),a=i?(t=i,r=1,s=t.length,n=void 0===n?s:n,!r&&n>=s?t:W(t,r,n)).join(""):e.slice(1);return o[he]()+a});function ue(e){return de(X(e).toLowerCase())}var pe,fe=(pe={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"},function(e){return null==pe?void 0:pe[e]}),ge=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,me=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var _e=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var ye=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var we="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",be="["+we+"]",ve="\\d+",Ce="[\\u2700-\\u27bf]",Se="[a-z\\xdf-\\xf6\\xf8-\\xff]",xe="[^\\ud800-\\udfff"+we+ve+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",Ee="(?:\\ud83c[\\udde6-\\uddff]){2}",Ne="[\\ud800-\\udbff][\\udc00-\\udfff]",Te="[A-Z\\xc0-\\xd6\\xd8-\\xde]",Pe="(?:"+Se+"|"+xe+")",De="(?:"+Te+"|"+xe+")",Ie="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",Ae="[\\ufe0e\\ufe0f]?"+Ie+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",Ee,Ne].join("|")+")[\\ufe0e\\ufe0f]?"+Ie+")*"),Oe="(?:"+[Ce,Ee,Ne].join("|")+")"+Ae,ke=RegExp([Te+"?"+Se+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[be,Te,"$"].join("|")+")",De+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[be,Te+Pe,"$"].join("|")+")",Te+"?"+Pe+"+(?:['’](?:d|ll|m|re|s|t|ve))?",Te+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ve,Oe].join("|"),"g");function Me(e,t,r){return e=X(e),void 0===(t=r?void 0:t)?function(e){return ye.test(e)}(e)?function(e){return e.match(ke)||[]}(e):function(e){return e.match(_e)||[]}(e):e.match(t)||[]}var Le=RegExp("['’]","g");var Re,qe=(Re=function(e,t,r){return t=t.toLowerCase(),e+(r?ue(t):t)},function(e){return function(e,t,r,n){var s=-1,i=null==e?0:e.length;for(n&&i&&(r=e[++s]);++s<i;)r=t(r,e[s],s,e);return r}(Me(function(e){return(e=X(e))&&e.replace(ge,fe).replace(me,"")}(e).replace(Le,"")),Re,"")});function Be(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var Fe=function(){return D.Date.now()},je=NaN,He=/^\s+|\s+$/g,Ue=/^[-+]0x[0-9a-f]+$/i,ze=/^0b[01]+$/i,Ve=/^0o[0-7]+$/i,Ge=parseInt;function Je(e){if("number"==typeof e)return e;if(V(e))return je;if(Be(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Be(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(He,"");var r=ze.test(e);return r||Ve.test(e)?Ge(e.slice(2),r?2:8):Ue.test(e)?je:+e}var Ke="Expected a function",$e=Math.max,Xe=Math.min;function We(e,t,r){var n,s,i,o,a,l,c=0,h=!1,d=!1,u=!0;if("function"!=typeof e)throw new TypeError(Ke);function p(t){var r=n,i=s;return n=s=void 0,c=t,o=e.apply(i,r)}function f(e){var r=e-l;return void 0===l||r>=t||r<0||d&&e-c>=i}function g(){var e=Fe();if(f(e))return m(e);a=setTimeout(g,function(e){var r=t-(e-l);return d?Xe(r,i-(e-c)):r}(e))}function m(e){return a=void 0,u&&n?p(e):(n=s=void 0,o)}function _(){var e=Fe(),r=f(e);if(n=arguments,s=this,l=e,r){if(void 0===a)return function(e){return c=e,a=setTimeout(g,t),h?p(e):o}(l);if(d)return a=setTimeout(g,t),p(l)}return void 0===a&&(a=setTimeout(g,t)),o}return t=Je(t)||0,Be(r)&&(h=!!r.leading,i=(d="maxWait"in r)?$e(Je(r.maxWait)||0,t):i,u="trailing"in r?!!r.trailing:u),_.cancel=function(){void 0!==a&&clearTimeout(a),c=0,n=l=s=a=void 0},_.flush=function(){return void 0===a?o:m(Fe())},_}var Ye=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ze=/^\w*$/;function Qe(e,t){if(O(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!V(e))||(Ze.test(e)||!Ye.test(e)||null!=t&&e in Object(t))}var et="[object AsyncFunction]",tt="[object Function]",rt="[object GeneratorFunction]",nt="[object Proxy]";function st(e){if(!Be(e))return!1;var t=H(e);return t==tt||t==rt||t==et||t==nt}var it,ot=D["__core-js_shared__"],at=(it=/[^.]+$/.exec(ot&&ot.keys&&ot.keys.IE_PROTO||""))?"Symbol(src)_1."+it:"";var lt=Function.prototype.toString;function ct(e){if(null!=e){try{return lt.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var ht=/^\[object .+?Constructor\]$/,dt=Function.prototype,ut=Object.prototype,pt=dt.toString,ft=ut.hasOwnProperty,gt=RegExp("^"+pt.call(ft).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function mt(e){return!(!Be(e)||at&&at in e)&&(st(e)?gt:ht).test(ct(e))}function _t(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return mt(r)?r:void 0}var yt=_t(Object,"create");var wt="__lodash_hash_undefined__",bt=Object.prototype.hasOwnProperty;var vt=Object.prototype.hasOwnProperty;var Ct="__lodash_hash_undefined__";function St(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function xt(e,t){return e===t||e!=e&&t!=t}function Et(e,t){for(var r=e.length;r--;)if(xt(e[r][0],t))return r;return-1}St.prototype.clear=function(){this.__data__=yt?yt(null):{},this.size=0},St.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},St.prototype.get=function(e){var t=this.__data__;if(yt){var r=t[e];return r===wt?void 0:r}return bt.call(t,e)?t[e]:void 0},St.prototype.has=function(e){var t=this.__data__;return yt?void 0!==t[e]:vt.call(t,e)},St.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=yt&&void 0===t?Ct:t,this};var Nt=Array.prototype.splice;function Tt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Tt.prototype.clear=function(){this.__data__=[],this.size=0},Tt.prototype.delete=function(e){var t=this.__data__,r=Et(t,e);return!(r<0||(r==t.length-1?t.pop():Nt.call(t,r,1),--this.size,0))},Tt.prototype.get=function(e){var t=this.__data__,r=Et(t,e);return r<0?void 0:t[r][1]},Tt.prototype.has=function(e){return Et(this.__data__,e)>-1},Tt.prototype.set=function(e,t){var r=this.__data__,n=Et(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};var Pt=_t(D,"Map");function Dt(e,t){var r,n,s=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?s["string"==typeof t?"string":"hash"]:s.map}function It(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}It.prototype.clear=function(){this.size=0,this.__data__={hash:new St,map:new(Pt||Tt),string:new St}},It.prototype.delete=function(e){var t=Dt(this,e).delete(e);return this.size-=t?1:0,t},It.prototype.get=function(e){return Dt(this,e).get(e)},It.prototype.has=function(e){return Dt(this,e).has(e)},It.prototype.set=function(e,t){var r=Dt(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};var At="Expected a function";function Ot(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(At);var r=function(){var n=arguments,s=t?t.apply(this,n):n[0],i=r.cache;if(i.has(s))return i.get(s);var o=e.apply(this,n);return r.cache=i.set(s,o)||i,o};return r.cache=new(Ot.Cache||It),r}Ot.Cache=It;var kt=500;var Mt,Lt,Rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,qt=/\\(\\)?/g,Bt=(Mt=Ot(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Rt,function(e,r,n,s){t.push(n?s.replace(qt,"$1"):r||e)}),t},function(e){return Lt.size===kt&&Lt.clear(),e}),Lt=Mt.cache,Mt);function Ft(e,t){return O(e)?e:Qe(e,t)?[e]:Bt(X(e))}var jt=1/0;function Ht(e){if("string"==typeof e||V(e))return e;var t=e+"";return"0"==t&&1/e==-jt?"-0":t}function Ut(e,t){for(var r=0,n=(t=Ft(t,e)).length;null!=e&&r<n;)e=e[Ht(t[r++])];return r&&r==n?e:void 0}function zt(e,t,r){var n=null==e?void 0:Ut(e,t);return void 0===n?r:n}var Vt=200;function Gt(e){var t=this.__data__=new Tt(e);this.size=t.size}Gt.prototype.clear=function(){this.__data__=new Tt,this.size=0},Gt.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Gt.prototype.get=function(e){return this.__data__.get(e)},Gt.prototype.has=function(e){return this.__data__.has(e)},Gt.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Tt){var n=r.__data__;if(!Pt||n.length<Vt-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new It(n)}return r.set(e,t),this.size=r.size,this};var Jt="__lodash_hash_undefined__";function Kt(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new It;++t<r;)this.add(e[t])}function $t(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function Xt(e,t){return e.has(t)}Kt.prototype.add=Kt.prototype.push=function(e){return this.__data__.set(e,Jt),this},Kt.prototype.has=function(e){return this.__data__.has(e)};var Wt=1,Yt=2;function Zt(e,t,r,n,s,i){var o=r&Wt,a=e.length,l=t.length;if(a!=l&&!(o&&l>a))return!1;var c=i.get(e);if(c&&i.get(t))return c==t;var h=-1,d=!0,u=r&Yt?new Kt:void 0;for(i.set(e,t),i.set(t,e);++h<a;){var p=e[h],f=t[h];if(n)var g=o?n(f,p,h,t,e,i):n(p,f,h,e,t,i);if(void 0!==g){if(g)continue;d=!1;break}if(u){if(!$t(t,function(e,t){if(!Xt(u,t)&&(p===e||s(p,e,r,n,i)))return u.push(t)})){d=!1;break}}else if(p!==f&&!s(p,f,r,n,i)){d=!1;break}}return i.delete(e),i.delete(t),d}var Qt=D.Uint8Array;function er(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function tr(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var rr=1,nr=2,sr="[object Boolean]",ir="[object Date]",or="[object Error]",ar="[object Map]",lr="[object Number]",cr="[object RegExp]",hr="[object Set]",dr="[object String]",ur="[object Symbol]",pr="[object ArrayBuffer]",fr="[object DataView]",gr=I?I.prototype:void 0,mr=gr?gr.valueOf:void 0;function _r(e,t){for(var r=-1,n=t.length,s=e.length;++r<n;)e[s+r]=t[r];return e}var yr=Object.prototype.propertyIsEnumerable,wr=Object.getOwnPropertySymbols,br=wr?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,n=null==e?0:e.length,s=0,i=[];++r<n;){var o=e[r];t(o,r,e)&&(i[s++]=o)}return i}(wr(e),function(t){return yr.call(e,t)}))}:function(){return[]};var vr="[object Arguments]";function Cr(e){return U(e)&&H(e)==vr}var Sr=Object.prototype,xr=Sr.hasOwnProperty,Er=Sr.propertyIsEnumerable,Nr=Cr(function(){return arguments}())?Cr:function(e){return U(e)&&xr.call(e,"callee")&&!Er.call(e,"callee")};var Tr="object"==typeof e&&e&&!e.nodeType&&e,Pr=Tr&&"object"==typeof module&&module&&!module.nodeType&&module,Dr=Pr&&Pr.exports===Tr?D.Buffer:void 0,Ir=(Dr?Dr.isBuffer:void 0)||function(){return!1},Ar=9007199254740991,Or=/^(?:0|[1-9]\d*)$/;function kr(e,t){var r=typeof e;return!!(t=null==t?Ar:t)&&("number"==r||"symbol"!=r&&Or.test(e))&&e>-1&&e%1==0&&e<t}var Mr=9007199254740991;function Lr(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Mr}var Rr={};function qr(e){return function(t){return e(t)}}Rr["[object Float32Array]"]=Rr["[object Float64Array]"]=Rr["[object Int8Array]"]=Rr["[object Int16Array]"]=Rr["[object Int32Array]"]=Rr["[object Uint8Array]"]=Rr["[object Uint8ClampedArray]"]=Rr["[object Uint16Array]"]=Rr["[object Uint32Array]"]=!0,Rr["[object Arguments]"]=Rr["[object Array]"]=Rr["[object ArrayBuffer]"]=Rr["[object Boolean]"]=Rr["[object DataView]"]=Rr["[object Date]"]=Rr["[object Error]"]=Rr["[object Function]"]=Rr["[object Map]"]=Rr["[object Number]"]=Rr["[object Object]"]=Rr["[object RegExp]"]=Rr["[object Set]"]=Rr["[object String]"]=Rr["[object WeakMap]"]=!1;var Br="object"==typeof e&&e&&!e.nodeType&&e,Fr=Br&&"object"==typeof module&&module&&!module.nodeType&&module,jr=Fr&&Fr.exports===Br&&T.process,Hr=function(){try{var e=Fr&&Fr.require&&Fr.require("util").types;return e||jr&&jr.binding&&jr.binding("util")}catch(e){}}(),Ur=Hr&&Hr.isTypedArray,zr=Ur?qr(Ur):function(e){return U(e)&&Lr(e.length)&&!!Rr[H(e)]},Vr=Object.prototype.hasOwnProperty;function Gr(e,t){var r=O(e),n=!r&&Nr(e),s=!r&&!n&&Ir(e),i=!r&&!n&&!s&&zr(e),o=r||n||s||i,a=o?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],l=a.length;for(var c in e)!t&&!Vr.call(e,c)||o&&("length"==c||s&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||kr(c,l))||a.push(c);return a}var Jr=Object.prototype;function Kr(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Jr)}function $r(e,t){return function(r){return e(t(r))}}var Xr=$r(Object.keys,Object),Wr=Object.prototype.hasOwnProperty;function Yr(e){return null!=e&&Lr(e.length)&&!st(e)}function Zr(e){return Yr(e)?Gr(e):function(e){if(!Kr(e))return Xr(e);var t=[];for(var r in Object(e))Wr.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}function Qr(e){return function(e,t,r){var n=t(e);return O(e)?n:_r(n,r(e))}(e,Zr,br)}var en=1,tn=Object.prototype.hasOwnProperty;var rn=_t(D,"DataView"),nn=_t(D,"Promise"),sn=_t(D,"Set"),on=_t(D,"WeakMap"),an=ct(rn),ln=ct(Pt),cn=ct(nn),hn=ct(sn),dn=ct(on),un=H;(rn&&"[object DataView]"!=un(new rn(new ArrayBuffer(1)))||Pt&&"[object Map]"!=un(new Pt)||nn&&"[object Promise]"!=un(nn.resolve())||sn&&"[object Set]"!=un(new sn)||on&&"[object WeakMap]"!=un(new on))&&(un=function(e){var t=H(e),r="[object Object]"==t?e.constructor:void 0,n=r?ct(r):"";if(n)switch(n){case an:return"[object DataView]";case ln:return"[object Map]";case cn:return"[object Promise]";case hn:return"[object Set]";case dn:return"[object WeakMap]"}return t});var pn=un,fn=1,gn="[object Arguments]",mn="[object Array]",_n="[object Object]",yn=Object.prototype.hasOwnProperty;function wn(e,t,r,n,s,i){var o=O(e),a=O(t),l=o?mn:pn(e),c=a?mn:pn(t),h=(l=l==gn?_n:l)==_n,d=(c=c==gn?_n:c)==_n,u=l==c;if(u&&Ir(e)){if(!Ir(t))return!1;o=!0,h=!1}if(u&&!h)return i||(i=new Gt),o||zr(e)?Zt(e,t,r,n,s,i):function(e,t,r,n,s,i,o){switch(r){case fr:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case pr:return!(e.byteLength!=t.byteLength||!i(new Qt(e),new Qt(t)));case sr:case ir:case lr:return xt(+e,+t);case or:return e.name==t.name&&e.message==t.message;case cr:case dr:return e==t+"";case ar:var a=er;case hr:var l=n&rr;if(a||(a=tr),e.size!=t.size&&!l)return!1;var c=o.get(e);if(c)return c==t;n|=nr,o.set(e,t);var h=Zt(a(e),a(t),n,s,i,o);return o.delete(e),h;case ur:if(mr)return mr.call(e)==mr.call(t)}return!1}(e,t,l,r,n,s,i);if(!(r&fn)){var p=h&&yn.call(e,"__wrapped__"),f=d&&yn.call(t,"__wrapped__");if(p||f){var g=p?e.value():e,m=f?t.value():t;return i||(i=new Gt),s(g,m,r,n,i)}}return!!u&&(i||(i=new Gt),function(e,t,r,n,s,i){var o=r&en,a=Qr(e),l=a.length;if(l!=Qr(t).length&&!o)return!1;for(var c=l;c--;){var h=a[c];if(!(o?h in t:tn.call(t,h)))return!1}var d=i.get(e);if(d&&i.get(t))return d==t;var u=!0;i.set(e,t),i.set(t,e);for(var p=o;++c<l;){var f=e[h=a[c]],g=t[h];if(n)var m=o?n(g,f,h,t,e,i):n(f,g,h,e,t,i);if(!(void 0===m?f===g||s(f,g,r,n,i):m)){u=!1;break}p||(p="constructor"==h)}if(u&&!p){var _=e.constructor,y=t.constructor;_!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof _&&_ instanceof _&&"function"==typeof y&&y instanceof y)&&(u=!1)}return i.delete(e),i.delete(t),u}(e,t,r,n,s,i))}function bn(e,t,r,n,s){return e===t||(null==e||null==t||!U(e)&&!U(t)?e!=e&&t!=t:wn(e,t,r,n,bn,s))}var vn=1,Cn=2;function Sn(e,t,r,n){var s=r.length,i=s,o=!n;if(null==e)return!i;for(e=Object(e);s--;){var a=r[s];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++s<i;){var l=(a=r[s])[0],c=e[l],h=a[1];if(o&&a[2]){if(void 0===c&&!(l in e))return!1}else{var d=new Gt;if(n)var u=n(c,h,l,e,t,d);if(!(void 0===u?bn(h,c,vn|Cn,n,d):u))return!1}}return!0}function xn(e){return e==e&&!Be(e)}function En(e){for(var t=Zr(e),r=t.length;r--;){var n=t[r],s=e[n];t[r]=[n,s,xn(s)]}return t}function Nn(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}}function Tn(e,t){return null!=e&&t in Object(e)}function Pn(e,t){return null!=e&&function(e,t,r){for(var n=-1,s=(t=Ft(t,e)).length,i=!1;++n<s;){var o=Ht(t[n]);if(!(i=null!=e&&r(e,o)))break;e=e[o]}return i||++n!=s?i:!!(s=null==e?0:e.length)&&Lr(s)&&kr(o,s)&&(O(e)||Nr(e))}(e,t,Tn)}var Dn=1,In=2;function An(e){return e}function On(e){return Qe(e)?(t=Ht(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return Ut(t,e)}}(e);var t}function kn(e){return"function"==typeof e?e:null==e?An:"object"==typeof e?O(e)?(n=e[0],s=e[1],Qe(n)&&xn(s)?Nn(Ht(n),s):function(e){var t=zt(e,n);return void 0===t&&t===s?Pn(e,n):bn(s,t,Dn|In)}):1==(r=En(t=e)).length&&r[0][2]?Nn(r[0][0],r[0][1]):function(e){return e===t||Sn(e,t,r)}:On(e);var t,r,n,s}function Mn(e,t,r,n){for(var s=e.length,i=r+(n?1:-1);n?i--:++i<s;)if(t(e[i],i,e))return i;return-1}var Ln=1/0,Rn=1.7976931348623157e308;function qn(e){var t=function(e){return e?(e=Je(e))===Ln||e===-Ln?(e<0?-1:1)*Rn:e==e?e:0:0===e?e:0}(e),r=t%1;return t==t?r?t-r:t:0}var Bn=Math.max;var Fn,jn=(Fn=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var s=null==r?0:qn(r);return s<0&&(s=Bn(n+s,0)),Mn(e,kn(t),s)},function(e,t,r){var n=Object(e);if(!Yr(e)){var s=kn(t);e=Zr(e),t=function(e){return s(n[e],e,n)}}var i=Fn(e,t,r);return i>-1?n[s?e[i]:i]:void 0});function Hn(e,t){return e===t||Sn(e,t,En(t))}var Un=function(){try{var e=_t(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();function zn(e,t,r){"__proto__"==t&&Un?Un(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function Vn(e,t,r){(void 0===r||xt(e[t],r))&&(void 0!==r||t in e)||zn(e,t,r)}var Gn,Jn=function(e,t,r){for(var n=-1,s=Object(e),i=r(e),o=i.length;o--;){var a=i[Gn?o:++n];if(!1===t(s[a],a,s))break}return e},Kn="object"==typeof e&&e&&!e.nodeType&&e,$n=Kn&&"object"==typeof module&&module&&!module.nodeType&&module,Xn=$n&&$n.exports===Kn?D.Buffer:void 0,Wn=Xn?Xn.allocUnsafe:void 0;function Yn(e,t){var r,n,s=t?(r=e.buffer,n=new r.constructor(r.byteLength),new Qt(n).set(new Qt(r)),n):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}var Zn=Object.create,Qn=function(){function e(){}return function(t){if(!Be(t))return{};if(Zn)return Zn(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),es=$r(Object.getPrototypeOf,Object);function ts(e){return U(e)&&Yr(e)}var rs="[object Object]",ns=Function.prototype,ss=Object.prototype,is=ns.toString,os=ss.hasOwnProperty,as=is.call(Object);function ls(e,t){return"__proto__"==t?void 0:e[t]}var cs=Object.prototype.hasOwnProperty;function hs(e,t,r){var n=e[t];cs.call(e,t)&&xt(n,r)&&(void 0!==r||t in e)||zn(e,t,r)}var ds=Object.prototype.hasOwnProperty;function us(e){if(!Be(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=Kr(e),r=[];for(var n in e)("constructor"!=n||!t&&ds.call(e,n))&&r.push(n);return r}function ps(e){return Yr(e)?Gr(e,!0):us(e)}function fs(e){return function(e,t,r,n){var s=!r;r||(r={});for(var i=-1,o=t.length;++i<o;){var a=t[i],l=n?n(r[a],e[a],a,r,e):void 0;void 0===l&&(l=e[a]),s?zn(r,a,l):hs(r,a,l)}return r}(e,ps(e))}function gs(e,t,r,n,s,i,o){var a=ls(e,r),l=ls(t,r),c=o.get(l);if(c)Vn(e,r,c);else{var h=i?i(a,l,r+"",e,t,o):void 0,d=void 0===h;if(d){var u=O(l),p=!u&&Ir(l),f=!u&&!p&&zr(l);h=l,u||p||f?O(a)?h=a:ts(a)?h=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}(a):p?(d=!1,h=function(e,t){if(t)return e.slice();var r=e.length,n=Wn?Wn(r):new e.constructor(r);return e.copy(n),n}(l,!0)):f?(d=!1,h=Yn(l,!0)):h=[]:function(e){if(!U(e)||H(e)!=rs)return!1;var t=es(e);if(null===t)return!0;var r=os.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&is.call(r)==as}(l)||Nr(l)?(h=a,Nr(a)?h=fs(a):(!Be(a)||n&&st(a))&&(h=function(e){return"function"!=typeof e.constructor||Kr(e)?{}:Qn(es(e))}(l))):d=!1}d&&(o.set(l,h),s(h,l,n,i,o),o.delete(l)),Vn(e,r,h)}}function ms(e,t,r,n,s){e!==t&&Jn(t,function(i,o){if(Be(i))s||(s=new Gt),gs(e,t,o,r,ms,n,s);else{var a=n?n(ls(e,o),i,o+"",e,t,s):void 0;void 0===a&&(a=i),Vn(e,o,a)}},ps)}var _s=Math.max;function ys(e,t,r){return t=_s(void 0===t?e.length-1:t,0),function(){for(var n=arguments,s=-1,i=_s(n.length-t,0),o=Array(i);++s<i;)o[s]=n[t+s];s=-1;for(var a=Array(t+1);++s<t;)a[s]=n[s];return a[t]=r(o),function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}(e,this,a)}}var ws=Un?function(e,t){return Un(e,"toString",{configurable:!0,enumerable:!1,value:(r=t,function(){return r}),writable:!0});var r}:An,bs=800,vs=16,Cs=Date.now;var Ss=function(e){var t=0,r=0;return function(){var n=Cs(),s=vs-(n-r);if(r=n,s>0){if(++t>=bs)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(ws);function xs(e,t){return Ss(ys(e,t,An),e+"")}function Es(e){return xs(function(t,r){var n=-1,s=r.length,i=s>1?r[s-1]:void 0,o=s>2?r[2]:void 0;for(i=e.length>3&&"function"==typeof i?(s--,i):void 0,o&&function(e,t,r){if(!Be(r))return!1;var n=typeof t;return!!("number"==n?Yr(r)&&kr(t,r.length):"string"==n&&t in r)&&xt(r[t],e)}(r[0],r[1],o)&&(i=s<3?void 0:i,s=1),t=Object(t);++n<s;){var a=r[n];a&&e(t,a,n,i)}return t})}var Ns=Es(function(e,t,r){ms(e,t,r)}),Ts=Es(function(e,t,r,n){ms(e,t,r,n)});function Ps(e,t,r,n){if(!Be(e))return e;for(var s=-1,i=(t=Ft(t,e)).length,o=i-1,a=e;null!=a&&++s<i;){var l=Ht(t[s]),c=r;if(s!=o){var h=a[l];void 0===(c=n?n(h,l,a):void 0)&&(c=Be(h)?h:kr(t[s+1])?[]:{})}hs(a,l,c),a=a[l]}return e}function Ds(e,t){return function(e,t,r){for(var n=-1,s=t.length,i={};++n<s;){var o=t[n],a=Ut(e,o);r(a,o)&&Ps(i,Ft(o,e),a)}return i}(e,t,function(t,r){return Pn(e,r)})}var Is=I?I.isConcatSpreadable:void 0;function As(e){return O(e)||Nr(e)||!!(Is&&e&&e[Is])}function Os(e){return(null==e?0:e.length)?function e(t,r,n,s,i){var o=-1,a=t.length;for(n||(n=As),i||(i=[]);++o<a;){var l=t[o];r>0&&n(l)?r>1?e(l,r-1,n,s,i):_r(i,l):s||(i[i.length]=l)}return i}(e,1):[]}var ks=function(e){return Ss(ys(e,void 0,Os),e+"")}(function(e,t){return null==e?{}:Ds(e,t)});function Ms(e,t,r,n){return n="function"==typeof n?n:void 0,null==e?e:Ps(e,t,r,n)}function Ls(e){return e!=e}function Rs(e,t){return!!(null==e?0:e.length)&&function(e,t,r){return t==t?function(e,t,r){for(var n=r-1,s=e.length;++n<s;)if(e[n]===t)return n;return-1}(e,t,r):Mn(e,Ls,r)}(e,t,0)>-1}function qs(e,t,r){for(var n=-1,s=null==e?0:e.length;++n<s;)if(r(t,e[n]))return!0;return!1}var Bs=sn&&1/tr(new sn([,-0]))[1]==1/0?function(e){return new sn(e)}:function(){},Fs=200;function js(e,t){return null==(e=function(e,t){return t.length<2?e:Ut(e,W(t,0,-1))}(e,t=Ft(t,e)))||delete e[Ht((r=t,n=null==r?0:r.length,n?r[n-1]:void 0))];var r,n}var Hs=200;var Us=xs(function(e,t){return ts(e)?function(e,t,r,n){var s=-1,i=Rs,o=!0,a=e.length,l=[],c=t.length;if(!a)return l;r&&(t=A(t,qr(r))),n?(i=qs,o=!1):t.length>=Hs&&(i=Xt,o=!1,t=new Kt(t));e:for(;++s<a;){var h=e[s],d=null==r?h:r(h);if(h=n||0!==h?h:0,o&&d==d){for(var u=c;u--;)if(t[u]===d)continue e;l.push(h)}else i(t,d,n)||l.push(h)}return l}(e,t):[]});var zs=function(e,t){return function(r,n){if(null==r)return r;if(!Yr(r))return e(r,n);for(var s=r.length,i=t?s:-1,o=Object(r);(t?i--:++i<s)&&!1!==n(o[i],i,o););return r}}(function(e,t){return e&&Jn(e,t,Zr)});function Vs(e,t){if(e!==t){var r=void 0!==e,n=null===e,s=e==e,i=V(e),o=void 0!==t,a=null===t,l=t==t,c=V(t);if(!a&&!c&&!i&&e>t||i&&o&&l&&!a&&!c||n&&o&&l||!r&&l||!s)return 1;if(!n&&!i&&!c&&e<t||c&&r&&s&&!n&&!i||a&&r&&s||!o&&s||!l)return-1}return 0}function Gs(e,t,r){var n=-1;return t=A(t.length?t:[An],qr(kn)),function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}(function(e,t){var r=-1,n=Yr(e)?Array(e.length):[];return zs(e,function(e,s,i){n[++r]=t(e,s,i)}),n}(e,function(e,r,s){return{criteria:A(t,function(t){return t(e)}),index:++n,value:e}}),function(e,t){return function(e,t,r){for(var n=-1,s=e.criteria,i=t.criteria,o=s.length,a=r.length;++n<o;){var l=Vs(s[n],i[n]);if(l)return n>=a?l:l*("desc"==r[n]?-1:1)}return e.index-t.index}(e,t,r)})}function Js(e,t,r,n){return null==e?[]:(O(t)||(t=null==t?[]:[t]),O(r=n?void 0:r)||(r=null==r?[]:[r]),Gs(e,t,r))}class Ks{constructor(e){e&&(this.__root__=e)}contains(e){return Boolean(this.getRoot()[e])}getRoot(){return this.__root__?this.__root__:this}get(e){if(e){if(S(e)){let t=e;return this.getRoot()[t]}if(arguments.length>1&&(e=Array.prototype.slice(arguments,0)),!m(e))throw new Error("Illegal argument for PathObject.get()");return zt(this.getRoot(),e)}}set(e,t){if(!e)throw new Error("Illegal argument: PathObject.set(>path<, value) - path is mandatory.");if(S(e)){let r=e;this.getRoot()[r]=t}else Ms(this.getRoot(),e,t)}delete(e){if(S(e)){let t=e;delete this.getRoot()[t]}else if(1===e.length)delete this.getRoot()[e[0]];else{if(!function(e,t){return null==e||js(e,t)}(this.getRoot(),e))throw new Error("Could not delete property at path"+e)}}clear(){var e=this.getRoot();for(var t in e)e.hasOwnProperty(t)&&delete e[t]}}Ks.prototype._isPathObject=!0;class $s extends Error{constructor(e,t){super("Conflict: "+JSON.stringify(e)+" vs "+JSON.stringify(t)),this.a=e,this.b=t}}const Xs="insert",Ws="delete";class Ys{constructor(e){if(!e||void 0===e.type||void 0===e.pos||void 0===e.str)throw new Error("Illegal argument: insufficient data.");if(this.type=e.type,this.pos=e.pos,this.str=e.str,!this.isInsert()&&!this.isDelete())throw new Error("Illegal type.");if(!S(this.str))throw new Error("Illegal argument: expecting string.");if(!x(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}apply(e){if(this.isEmpty())return e;if(this.type===Xs){if(e.length<this.pos)throw new Error("Provided string is too short.");return e.splice?e.splice(this.pos,0,this.str):e.slice(0,this.pos).concat(this.str).concat(e.slice(this.pos))}if(e.length<this.pos+this.str.length)throw new Error("Provided string is too short.");return e.splice?e.splice(this.pos,this.str.length):e.slice(0,this.pos).concat(e.slice(this.pos+this.str.length))}clone(){return new Ys(this)}isNOP(){return"NOP"===this.type||0===this.str.length}isInsert(){return this.type===Xs}isDelete(){return this.type===Ws}getLength(){return this.str.length}invert(){var e={type:this.isInsert()?Ws:Xs,pos:this.pos,str:this.str};return new Ys(e)}hasConflict(e){return Zs(this,e)}isEmpty(){return 0===this.str.length}toJSON(){return{type:this.type,pos:this.pos,str:this.str}}toString(){return["(",this.isInsert()?Xs:Ws,",",this.pos,",'",this.str,"')"].join("")}get _isOperation(){return!0}get _isTextOperation(){return!0}static transform(e,t,r){return function(e,t,r){if((r=r||{})["no-conflict"]&&Zs(e,t))throw new $s(e,t);e.type===Xs&&t.type===Xs?function(e,t){e.pos===t.pos?t.pos+=e.str.length:e.pos<t.pos?t.pos+=e.str.length:e.pos+=t.str.length}(e,t):e.type===Ws&&t.type===Ws?function e(t,r,n){if(t.pos>r.pos)return e(r,t,!n);if(t.pos===r.pos&&t.str.length>r.str.length)return e(r,t,!n);if(r.pos<t.pos+t.str.length){var s=r.pos-t.pos,i=t.str.length-s,o=s+r.str.length;t.str=t.str.slice(0,s)+t.str.slice(o),r.str=r.str.slice(i),r.pos-=s}else r.pos-=t.str.length}(e,t,!0):function e(t,r){if(t.type===Ws)return e(r,t);if(t.pos<=r.pos)r.pos+=t.str.length;else if(t.pos>=r.pos+r.str.length)t.pos-=r.str.length;else{var n=t.pos-r.pos;r.str=r.str.slice(0,n)+t.str+r.str.slice(n),t.str=""}}(e,t);return[e,t]}(e,t,r)}static hasConflict(e,t){return Zs(e,t)}static Insert(e,t){return new Ys({type:Xs,pos:e,str:t})}static Delete(e,t){return new Ys({type:Ws,pos:e,str:t})}static fromJSON(e){return new Ys(e)}static get INSERT(){return Xs}static get DELETE(){return Ws}}function Zs(e,t){return e.type===Xs&&t.type===Xs?e.pos===t.pos:e.type===Ws&&t.type===Ws?!(e.pos>=t.pos+t.str.length||t.pos>=e.pos+e.str.length):(e.type===Ws?(r=e,n=t):(r=t,n=e),n.pos>=r.pos&&n.pos<r.pos+r.str.length);var r,n}const Qs="NOP",ei="delete",ti="insert";class ri{constructor(e){if(!e||!e.type)throw new Error("Illegal argument: insufficient data.");if(this.type=e.type,this.type!==Qs){if(this.type!==ti&&this.type!==ei)throw new Error("Illegal type.");if(this.pos=e.pos,this.val=e.val,!x(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}}apply(e){if(this.type===Qs)return e;if(this.type===ti){if(e.length<this.pos)throw new Error("Provided array is too small.");return e.splice(this.pos,0,this.val),e}if(e.length<this.pos)throw new Error("Provided array is too small.");if(!E(e[this.pos],this.val))throw Error("Unexpected value at position "+this.pos+". Expected "+this.val+", found "+e[this.pos]);return e.splice(this.pos,1),e}clone(){var e={type:this.type,pos:this.pos,val:b(this.val)};return new ri(e)}invert(){var e=this.toJSON();return this.type===Qs?e.type=Qs:this.type===ti?e.type=ei:e.type=ti,new ri(e)}hasConflict(e){return ri.hasConflict(this,e)}toJSON(){var e={type:this.type};return this.type===Qs?e:(e.pos=this.pos,e.val=b(this.val),e)}isInsert(){return this.type===ti}isDelete(){return this.type===ei}getOffset(){return this.pos}getValue(){return this.val}isNOP(){return this.type===Qs}toString(){return["(",this.isInsert()?ti:ei,",",this.getOffset(),",'",this.getValue(),"')"].join("")}get _isOperation(){return!0}get _isArrayOperation(){return!0}static transform(e,t,r){return si(e,t,r)}static hasConflict(e,t){return ni(e,t)}static Insert(e,t){return new ri({type:ti,pos:e,val:t})}static Delete(e,t){return new ri({type:ei,pos:e,val:t})}static Nop(){return new ri({type:Qs})}static fromJSON(e){return new ri(e)}static get NOP(){return Qs}static get DELETE(){return ei}static get INSERT(){return ti}}function ni(e,t){return e.type!==Qs&&t.type!==Qs&&(e.type===ti&&t.type===ti&&e.pos===t.pos)}var si=function(e,t,r={}){if(r["no-conflict"]&&ni(e,t))throw new $s(e,t);return e.type===Qs||t.type===Qs||(e.type===ti&&t.type===ti?function(e,t){e.pos===t.pos?t.pos+=1:e.pos<t.pos?t.pos+=1:e.pos+=1}(e,t):e.type===ei&&t.type===ei?function(e,t,r={}){e.pos===t.pos?(e.val!==t.val&&console.error("FIXME: transforming array delete-delete at the same position but with different values."),r.rebase||(t.type=Qs,e.type=Qs)):e.pos<t.pos?t.pos-=1:e.pos-=1}(e,t,r):function(e,t,r={}){e.type===ei&&([e,t]=[t,e]),r.rebase?e.pos<t.pos?t.pos+=1:e.pos>t.pos&&(e.pos-=1):e.pos<=t.pos?t.pos+=1:e.pos-=1}(e,t,r)),[e,t]};const ii="shift";class oi{constructor(e){if(!e||void 0===e.type)throw new Error("Illegal argument: insufficient data.");if(this.type=e.type,this.val=e.val,!this.isShift())throw new Error("Illegal type.");if(!x(this.val))throw new Error("Illegal argument: expecting number as shift value.")}apply(e){return e.offset=e.offset+this.val,e}isShift(){return this.type===ii}isNOP(){switch(this.type){case ii:return 0===this.val;default:return!1}}clone(){return new oi(this)}invert(){let e;switch(this.type){case ii:e={type:ii,val:-this.val};break;default:throw new Error("Invalid type.")}return new oi(e)}hasConflict(){return!1}toJSON(){return{type:this.type,val:this.val}}toString(){return["(",this.type,",",this.val,"')"].join("")}get _isOperation(){return!0}get _isCoordinateOperation(){return!0}static transform(e,t,r){return function(e,t,r={}){if(e.type!==ii||t.type!==ii)throw new Error("Illegal type");!function(e,t,r){r.rebase||(e.val+=t.val,t.val+=e.val)}(e,t,r);return[e,t]}(e,t,r)}static fromJSON(e){return new oi(e)}static Shift(e){return new oi({type:ii,val:e})}static get SHIFT(){return ii}}const ai="NOP",li="create",ci="delete",hi="update",di="set";class ui{constructor(e){if(!e)throw new Error("Data of ObjectOperation is missing.");if(!e.type)throw new Error("Invalid data: type is mandatory.");if(this.type=e.type,e.type!==ai){if(this.path=e.path,!e.path)throw new Error("Invalid data: path is mandatory.");if(this.type===li||this.type===ci){if(!e.val)throw new Error("Invalid data: value is missing.");this.val=e.val}else if(this.type===hi){if(!e.diff)throw new Error("Invalid data: diff is mandatory for update operation.");if(this.diff=e.diff,e.diff._isTextOperation)this.propertyType="string";else if(e.diff._isArrayOperation)this.propertyType="array";else{if(!e.diff._isCoordinateOperation)throw new Error("Invalid data: unsupported operation type for incremental update.");this.propertyType="coordinate"}}else{if(this.type!==di)throw new Error("Invalid type: "+e.type);this.val=e.val,this.original=e.original}}}apply(e){if(this.type===ai)return e;var t;if(t=e._isPathObject?e:new Ks(e),this.type===li)return t.set(this.path,b(this.val)),e;if(this.type===ci)t.delete(this.path,"strict");else if(this.type===hi){var r=this.diff;switch(this.propertyType){case"array":{let e=t.get(this.path);r.apply(e);break}case"string":{let e=t.get(this.path);N(e)&&(e=""),e=r.apply(e),t.set(this.path,e);break}case"coordinate":{let e=t.get(this.path);if(!e)throw new Error("No coordinate with path "+this.path);r.apply(e);break}default:throw new Error("Unsupported property type for incremental update: "+this.propertyType)}}else{if(this.type!==di)throw new Error("Invalid type.");t.set(this.path,b(this.val))}return e}clone(){var e={type:this.type,path:this.path};return this.val&&(e.val=b(this.val)),this.diff&&(e.diff=this.diff.clone()),new ui(e)}isNOP(){return this.type===ai||(this.type===hi?this.diff.isNOP():void 0)}isCreate(){return this.type===li}isDelete(){return this.type===ci}isUpdate(e){return e?this.type===hi&&this.propertyType===e:this.type===hi}isSet(){return this.type===di}invert(){if(this.type===ai)return new ui({type:ai});var e=new ui(this);return this.type===li?e.type=ci:this.type===ci?e.type=li:this.type===hi?e.diff=this.diff.clone().invert():(e.val=this.original,e.original=this.val),e}hasConflict(e){return ui.hasConflict(this,e)}toJSON(){if(this.type===ai)return{type:ai};var e={type:this.type,path:this.path};if(this.type===li||this.type===ci)e.val=this.val;else if(this.type===hi){if(this.diff._isTextOperation)e.propertyType="string";else if(this.diff._isArrayOperation)e.propertyType="array";else{if(!this.diff._isCoordinateOperation)throw new Error("Invalid property type.");e.propertyType="coordinate"}e.diff=this.diff.toJSON()}else e.val=this.val,e.original=this.original;return e}getType(){return this.type}getPath(){return this.path}getValue(){return this.val}getOldValue(){return this.original}getValueOp(){return this.diff}toString(){switch(this.type){case li:return["(+,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case ci:return["(-,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case hi:return["(>>,",JSON.stringify(this.path),this.propertyType,this.diff.toString(),")"].join("");case di:return["(=,",JSON.stringify(this.path),this.val,this.original,")"].join("");case ai:return"NOP";default:throw new Error("Invalid type")}}static transform(e,t,r){return function(e,t,r={}){if(r["no-conflict"]&&pi(e,t))throw new $s(e,t);if(e.isNOP()||t.isNOP())return[e,t];E(e.path,t.path)&&Ni[Ei[e.type]|Ei[t.type]](e,t,r);return[e,t]}(e,t,r)}static hasConflict(e,t){return pi(e,t)}static Create(e,t){var r;return r=S(e)?[e]:e,new ui({type:li,path:r,val:t})}static Delete(e,t){var r;return r=S(e)?[e]:e,new ui({type:ci,path:r,val:t})}static Update(e,t){return new ui({type:hi,path:e,diff:t})}static Set(e,t,r){return new ui({type:di,path:e,val:b(r),original:b(t)})}static fromJSON(e){return"update"===(e=b(e)).type&&(e.diff=bi(e.propertyType,e.diff)),new ui(e)}static get NOP(){return ai}static get CREATE(){return li}static get DELETE(){return ci}static get UPDATE(){return hi}static get SET(){return di}get _isOperation(){return!0}get _isObjectOperation(){return!0}}function pi(e,t){return e.type!==ai&&t.type!==ai&&E(e.path,t.path)}function fi(e,t,r={}){r.rebase||(e.type=ai,t.type=ai)}function gi(e,t,r={}){if(!r.rebase)throw new Error("Can not transform two concurring creates of the same property")}function mi(e,t,r={}){if(!r.rebase)throw new Error("Illegal state: can not create and delete a value at the same time.")}function _i(e,t,r={}){return function e(t,r,n,s={}){if(!s.rebase){if(t.type!==ci)return e(r,t,!0,s);let i=bi(r.propertyType,r.diff);n?(t.val=i.apply(t.val),r.type=ai):(t.type=ai,r.type=li,r.val=i.apply(t.val))}}(e,t,!1,r)}function yi(){throw new Error("Can not transform a concurring create and update of the same property")}function wi(e,t,r={}){let n,s=bi(e.propertyType,e.diff),i=bi(t.propertyType,t.diff);switch(t.propertyType){case"string":n=Ys.transform(s,i,r);break;case"array":n=ri.transform(s,i,r);break;case"coordinate":n=oi.transform(s,i,r);break;default:throw new Error("Unsupported property type for incremental update")}e.diff=n[0],t.diff=n[1]}function bi(e,t){if(t._isOperation)return t;switch(e){case"string":return Ys.fromJSON(t);case"array":return ri.fromJSON(t);case"coordinate":return oi.fromJSON(t);default:throw new Error("Unsupported property type for incremental update.")}}function vi(e,t,r={}){if(!r.rebase)throw new Error("Illegal state: can not create and set a value at the same time.")}function Ci(e,t,r={}){return function e(t,r,n,s={}){if(t.type!==ci)return e(r,t,!0,s);s.rebase||(n?(t.val=r.val,r.type=ai):(t.type=ai,r.type=li,r.original=void 0))}(e,t,!1,r)}function Si(e,t,r={}){if(!r.rebase)throw new Error("Unresolvable conflict: update + set.")}function xi(e,t,r={}){r.rebase||(e.type=ai,t.original=e.val)}const Ei=(()=>{const e={};return e[ai]=0,e[li]=1,e[ci]=2,e[hi]=4,e[di]=8,e})(),Ni=(()=>{const e={};return e[2]=fi,e[3]=mi,e[6]=_i,e[1]=gi,e[5]=yi,e[4]=wi,e[9]=vi,e[10]=Ci,e[12]=Si,e[8]=xi,e})();class Ti{constructor(){this.SEPARATOR="\t"}serialize(e){var t=[];switch(e.type){case"create":t.push("c"),t.push(e.val.id),t.push(e.val);break;case"delete":t.push("d"),t.push(e.val.id),t.push(e.val);break;case"set":t.push("s"),t.push(e.path.join(".")),t.push(e.val),t.push(e.original);break;case"update":t.push("u"),t.push(e.path.join(".")),Array.prototype.push.apply(t,this.serializePrimitiveOp(e.diff));break;default:throw new Error("Unsupported operation type.")}return t}serializePrimitiveOp(e){var t=[];if(e._isTextOperation)e.isInsert()?t.push("t+"):e.isDelete()&&t.push("t-"),t.push(e.pos),t.push(e.str);else if(e._isArrayOperation)e.isInsert()?t.push("a+"):e.isDelete()&&t.push("a-"),t.push(e.pos),t.push(e.val);else{if(!e._isCoordinateOperation)throw new Error("Unsupported operation type.");if(!e.isShift())throw new Error("Unsupported CoordinateOperation type.");t.push("c>>"),t.push(e.pos),t.push(e.val)}return t}deserialize(e,t){t||(t=new Pi(e,this.SEPARATOR));var r,n,s,i,o,a=t.getString();switch(a){case"c":n=t.getPath(),s=t.getObject(),r=ui.Create(n,s);break;case"d":n=t.getPath(),s=t.getObject(),r=ui.Delete(n,s);break;case"s":n=t.getPath(),s=t.getAny(),i=t.getAny(),r=ui.Set(n,i,s);break;case"u":n=t.getPath(),o=this.deserializePrimitiveOp(e,t),r=ui.Update(n,o);break;default:throw new Error("Illegal type for ObjectOperation: "+a)}return r}deserializePrimitiveOp(e,t){t||(t=new Pi(e,this.SEPARATOR));var r,n,s,i=t.getString();switch(i){case"t+":n=t.getNumber(),s=t.getString(),r=Ys.Insert(n,s);break;case"t-":n=t.getNumber(),s=t.getString(),r=Ys.Delete(n,s);break;case"a+":n=t.getNumber(),s=t.getAny(),r=ri.Insert(n,s);break;case"a-":n=t.getNumber(),s=t.getAny(),r=ri.Delete(n,s);break;case"c>>":s=t.getNumber(),r=oi.Shift(s);break;default:throw new Error("Unsupported operation type: "+i)}return r}}class Pi{constructor(e,t){m(arguments[0])?this.tokens=arguments[0]:this.tokens=e.split(t),this.pos=-1}error(e){throw new Error("Parsing error: "+e+"\n"+this.tokens[this.pos])}getString(){this.pos++;var e=this.tokens[this.pos];return'"'===e[0]&&(e=e.slice(1,-1)),e}getNumber(){this.pos++;var e=this.tokens[this.pos];try{return x(e)?e:parseInt(this.tokens[this.pos],10)}catch(e){this.error("expected number")}}getObject(){this.pos++;var e=this.tokens[this.pos];try{return s(e)?e:JSON.parse(this.tokens[this.pos])}catch(e){this.error("expected object")}}getAny(){return this.pos++,this.tokens[this.pos]}getPath(){return this.getString().split(".")}}function Di(e){return e[e.length-1]}Ti.Tokenizer=Pi;class Ii{constructor(){var e={};Object.defineProperty(this,"_internal",{enumerable:!1,value:e}),e.doc=null}clone(){var e=this._clone();return this._internal.doc&&e.attach(this._internal.doc),e}getDocument(){var e=this._internal.doc;if(!e)throw new Error("Selection is not attached to a document.");return e}isAttached(){return Boolean(this._internal.doc)}attach(e){return this._internal.doc=e,this}isNull(){return!1}isPropertySelection(){return!1}isContainerSelection(){return!1}isNodeSelection(){return!1}isCustomSelection(){return!1}isCollapsed(){return!0}isReverse(){return!1}getType(){throw new Error("Selection.getType() is abstract.")}get type(){return this.getType()}equals(e){return this===e||!!e&&(this.isNull()===e.isNull()&&this.getType()===e.getType())}toString(){return"null"}toJSON(){throw new Error("This method is abstract.")}createWith(e){let t=this.constructor,r=this.toJSON();return Object.assign(r,e),t.fromJSON(r)}get _isSelection(){return!0}static get nullSelection(){return Ai}}const Ai=Object.freeze(new class extends Ii{isNull(){return!0}getType(){return"null"}toJSON(){return null}clone(){return this}});function Oi(e,t){if(e===t)return!0;if(!m(e)||!m(t))return!1;if(e.length!==t.length)return!1;let r=e.length;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}class ki{constructor(e,t){if("SKIP"!==arguments[0]){if(1===arguments.length){let e=arguments[0];this.path=e.path,this.offset=e.offset}else this.path=e,this.offset=t;if(!m(this.path))throw new Error("Invalid arguments: path should be an array.");if(!x(this.offset)||this.offset<0)throw new Error("Invalid arguments: offset must be a positive number.")}}equals(e){return e===this||Oi(e.path,this.path)&&e.offset===this.offset}withCharPos(e){return new ki(this.path,e)}getNodeId(){return this.path[0]}getPath(){return this.path}getOffset(){return this.offset}toJSON(){return{path:this.path.slice(),offset:this.offset}}clone(){return new ki(this.toJSON())}toString(){return"("+this.path.join(".")+", "+this.offset+")"}isPropertyCoordinate(){return this.path.length>1}isNodeCoordinate(){return 1===this.path.length}hasSamePath(e){return Oi(this.path,e.path)}isEqual(e){return!!e&&(this.offset===e.offset&&this.hasSamePath(e))}get _isCoordinate(){return!0}}class Mi extends Ii{constructor(e,t,r,n,s,i){if(super(),1===arguments.length){let o=arguments[0];e=o.path,t=o.startOffset,r=o.endOffset,n=o.reverse,s=o.containerPath,i=o.surfaceId}if(!e||!x(t))throw new Error("Invalid arguments: `path` and `startOffset` are mandatory");this.start=new ki(e,t),this.end=new ki(e,x(r)?r:t),this.reverse=Boolean(n),this.containerPath=s,this.surfaceId=i}get path(){return this.start.path}get startOffset(){return this.start.offset}get endOffset(){return this.end.offset}toJSON(){return{type:"property",path:this.start.path,startOffset:this.start.offset,endOffset:this.end.offset,reverse:this.reverse,containerPath:this.containerPath,surfaceId:this.surfaceId}}isPropertySelection(){return!0}getType(){return"property"}isNull(){return!1}isCollapsed(){return this.start.offset===this.end.offset}isReverse(){return this.reverse}equals(e){return Ii.prototype.equals.call(this,e)&&this.start.equals(e.start)&&this.end.equals(e.end)}toString(){return["PropertySelection(",JSON.stringify(this.path),", ",this.start.offset," -> ",this.end.offset,this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")}collapse(e){var t;return t="left"===e?this.start.offset:this.end.offset,this.createWithNewRange(t,t)}getPath(){return this.start.path}getNodeId(){return this.start.path[0]}isInsideOf(e,t){return!e.isNull()&&(e.isContainerSelection()?e.contains(this,t):t?Oi(this.path,e.path)&&this.start.offset>e.start.offset&&this.end.offset<e.end.offset:Oi(this.path,e.path)&&this.start.offset>=e.start.offset&&this.end.offset<=e.end.offset)}contains(e,t){return!e.isNull()&&e.isInsideOf(this,t)}overlaps(e,t){return!e.isNull()&&(e.isContainerSelection()?e.overlaps(this):!!Oi(this.path,e.path)&&(t?!(this.start.offset>=e.end.offset||this.end.offset<=e.start.offset):!(this.start.offset>e.end.offset||this.end.offset<e.start.offset)))}isRightAlignedWith(e){return!e.isNull()&&(e.isContainerSelection()?e.isRightAlignedWith(this):Oi(this.path,e.path)&&this.end.offset===e.end.offset)}isLeftAlignedWith(e){return!e.isNull()&&(e.isContainerSelection()?e.isLeftAlignedWith(this):Oi(this.path,e.path)&&this.start.offset===e.start.offset)}expand(e){if(e.isNull())return this;if(e.isContainerSelection())return e.expand(this);if(!Oi(this.path,e.path))throw new Error("Can not expand PropertySelection to a different property.");var t=Math.min(this.start.offset,e.start.offset),r=Math.max(this.end.offset,e.end.offset);return this.createWithNewRange(t,r)}truncateWith(e){if(e.isNull())return this;if(e.isInsideOf(this,"strict"))throw new Error("Can not truncate with a contained selections");if(!this.overlaps(e))return this;let t,r,n,s;if(e.isPropertySelection())t=e.start.offset,r=e.end.offset;else{if(!e.isContainerSelection())return this;t=Oi(e.start.path,this.start.path)?e.start.offset:this.start.offset,r=Oi(e.end.path,this.start.path)?e.end.offset:this.end.offset}if(this.start.offset>t&&this.end.offset>r)n=r,s=this.end.offset;else if(this.start.offset<t&&this.end.offset<r)n=this.start.offset,s=t;else if(this.start.offset===t){if(this.end.offset<=r)return Ii.nullSelection;n=r,s=this.end.offset}else{if(this.end.offset!==r){if(e.contains(this))return Ii.nullSelection;throw new Error("Illegal state.")}if(this.start.offset>=t)return Ii.nullSelection;n=this.start.offset,s=t}return this.createWithNewRange(n,s)}createWithNewRange(e,t){var r=new Mi(this.path,e,t,!1,this.containerPath,this.surfaceId),n=this._internal.doc;return n&&r.attach(n),r}_clone(){return new Mi(this.start.path,this.start.offset,this.end.offset,this.reverse,this.containerPath,this.surfaceId)}}function Li(e,t,r,n){if(r.hasSamePath(n))return Math.sign(r.offset-n.offset);{let s=Ri(e,t,r),i=Ri(e,t,n),o=Math.min(s.length,i.length);for(let e=0;e<o;e++){let t=s[e],r=i[e];if(t<r)return-1;if(t>r)return 1}return s.length===i.length?Math.sign(r.offset-n.offset):(console.error("FIXME: unexpected case in compareCoordinates()"),0)}}function Ri(e,t,r){let n=t[0],s=r.path[0],i=e.get(s).getXpath(),o=[];for(;i;){if(i.id===n)return o;o.unshift(i.pos||0),i=i.prev}}function qi(e,t,r,n,s){let i=Li(e,t,r,n);return s?i<0:i<=0}Mi.fromJSON=function(e){return new Mi(e)};class Bi extends Ii{constructor(e,t,r,n,s,i,o){if(super(),1===arguments.length){let a=arguments[0];e=a.containerPath,t=a.startPath,r=a.startOffset,n=a.endPath,s=a.endOffset,i=a.reverse,o=a.surfaceId}if(this.containerPath=e,!this.containerPath)throw new Error("Invalid arguments: `containerPath` is mandatory");this.start=new ki(t,r),this.end=new ki(N(n)?t:n,N(s)?r:s),this.reverse=Boolean(i),this.surfaceId=o}get startPath(){return console.warn("DEPRECATED: use sel.start.path instead."),this.start.path}get startOffset(){return console.warn("DEPRECATED: use sel.start.offset instead."),this.start.offset}get endPath(){return console.warn("DEPRECATED: use sel.end.path instead."),this.end.path}get endOffset(){return console.warn("DEPRECATED: use sel.end.offset instead."),this.end.offset}toJSON(){return{type:"container",containerPath:this.containerPath,startPath:this.start.path,startOffset:this.start.offset,endPath:this.end.path,endOffset:this.end.offset,reverse:this.reverse,surfaceId:this.surfaceId}}isContainerSelection(){return!0}getType(){return"container"}isNull(){return!1}isCollapsed(){return this.start.equals(this.end)}isReverse(){return this.reverse}equals(e){return Ii.prototype.equals.call(this,e)&&Oi(this.containerPath,e.containerPath)&&this.start.equals(e.start)&&this.end.equals(e.end)}toString(){return["ContainerSelection(",this.containerPath,", ",JSON.stringify(this.start.path),", ",this.start.offset," -> ",JSON.stringify(this.end.path),", ",this.end.offset,this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")}isInsideOf(e,t){return!e.isNull()&&(this._isCoordinateBefore(e.start,this.start,t)&&this._isCoordinateBefore(this.end,e.end,t))}contains(e,t){return!e.isNull()&&(this._isCoordinateBefore(this.start,e.start,t)&&this._isCoordinateBefore(e.end,this.end,t))}containsNode(e){let t=this.containerPath,r=this.getDocument(),n=new ki([e],0),s=Li(r,t,n,this.start),i=Li(r,t,n,this.end);return s>=0&&i<0}overlaps(e){return!this._isCoordinateBefore(this.end,e.start,!1)||this._isCoordinateBefore(e.end,this.start,!1)}isLeftAlignedWith(e){return this.start.isEqual(e.start)}isRightAlignedWith(e){return this.end.isEqual(e.end)}collapse(e){let t;return Fi(this,t="left"===e?this.start:this.end,t)}expand(e){let t,r;return Fi(this,t=this.start.isEqual(e.start)?new ki(this.start.path,Math.min(this.start.offset,e.start.offset)):this._isCoordinateBefore(e.start,this.start,!1)?new ki(e.start.path,e.start.offset):this.start,r=this.end.isEqual(e.end)?new ki(this.end.path,Math.max(this.end.offset,e.end.offset)):this._isCoordinateBefore(this.end,e.end,!1)?new ki(e.end.path,e.end.offset):this.end)}truncateWith(e){if(e.isInsideOf(this,"strict"))throw new Error("Can not truncate with a contained selections");if(!this.overlaps(e))return this;let t,r;if(this._isCoordinateBefore(e.start,this.start,"strict")&&this._isCoordinateBefore(e.end,this.end,"strict"))t=e.end,r=this.end;else if(this._isCoordinateBefore(this.start,e.start,"strict")&&this._isCoordinateBefore(this.end,e.end,"strict"))t=this.start,r=e.start;else if(this.start.isEqual(e.start)){if(!this._isCoordinateBefore(e.end,this.end,"strict"))return Ii.nullSelection;t=e.end,r=this.end}else{if(!this.end.isEqual(e.end)){if(this.isInsideOf(e))return Ii.nullSelection;throw new Error("Could not determine coordinates for truncate. Check input")}if(!this._isCoordinateBefore(this.start,e.start,"strict"))return Ii.nullSelection;t=this.start,r=e.start}return Fi(this,t,r)}splitIntoPropertySelections(){return this.getFragments().filter(e=>e instanceof Ii.Fragment).map(e=>new Mi(e.path,e.startOffset,e.endOffset,!1,this.containerPath,this.surfaceId))}_getContainerContent(){return this.getDocument().get(this.containerPath)}_clone(){return new Bi(this)}_isCoordinateBefore(e,t,r){return qi(this.getDocument(),this.containerPath,e,t,r)}get path(){throw new Error("ContainerSelection has no path property. Use startPath and endPath instead")}get _isContainerSelection(){return!0}static fromJSON(e){return new Bi(e)}}function Fi(e,t,r){let n;n=t===r?new Mi({path:t.path,startOffset:t.offset,endOffset:t.offset,containerPath:e.containerPath,surfaceId:e.surfaceId}):new Bi(e.containerPath,t.path,t.offset,r.path,r.offset,!1,e.surfaceId);const s=e._internal.doc;return s&&n.attach(s),n}class ji extends Ii{constructor(e,t,r,n,s){if(super(),1===arguments.length){let i=arguments[0];e=i.containerPath,t=i.nodeId,r=i.mode,n=i.reverse,s=i.surfaceId}if(!m(e))throw new Error("'containerPath' is mandatory.");if(!S(t))throw new Error("'nodeId' is mandatory.");r=r||"full",this.containerPath=e,this.nodeId=t,this.mode=r,this.reverse=Boolean(n),this.surfaceId=s,this.start=new ki([t],0),this.end=new ki([t],1)}equals(e){return super.equals(e)&&this.nodeId===e.nodeId&&this.mode===e.mode}isNodeSelection(){return!0}getType(){return"node"}getNodeId(){return this.nodeId}isFull(){return"full"===this.mode}isBefore(){return"before"===this.mode}isAfter(){return"after"===this.mode}isCollapsed(){return"full"!==this.mode}toJSON(){return{type:"node",nodeId:this.nodeId,mode:this.mode,reverse:this.reverse,containerPath:this.containerPath,surfaceId:this.surfaceId}}toString(){return["NodeSelection(",this.containerPath,".",this.nodeId,", ",this.mode,", ",this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")}collapse(e){if("left"===e)return this.isBefore()?this:new ji(this.containerPath,this.nodeId,"before",this.reverse,this.surfaceId);if("right"===e)return this.isAfter()?this:new ji(this.containerPath,this.nodeId,"after",this.reverse,this.surfaceId);throw new Error("'direction' must be either 'left' or 'right'")}_getCoordinate(){return"before"===this.mode?new ki([this.nodeId],0):"after"===this.mode?new ki([this.nodeId],1):void 0}_clone(){return new ji(this)}static fromJSON(e){return new ji(e)}get _isNodeSelection(){return!0}}class Hi extends Ii{constructor(e,t,r,n){if(super(),1===arguments.length){let s=arguments[0];e=s.customType,t=s.data,r=s.nodeId,n=s.surfaceId}if(!e)throw new Error("'customType' is required");if(!r)throw new Error("'nodeId' is required");this.customType=e,this.data=t||{},this.nodeId=r,this.surfaceId=n}isCustomSelection(){return!0}getType(){return"custom"}getCustomType(){return this.customType}getNodeId(){return this.nodeId}toJSON(){let e={type:"custom",customType:this.customType,nodeId:this.nodeId,data:b(this.data)};return this.surfaceId&&(e.surfaceId=this.surfaceId),e}toString(){return["CustomSelection(",this.customType,", ",JSON.stringify(this.data),")"].join("")}equals(e){return Ii.prototype.equals.call(this,e)&&e.isCustomSelection()&&E(this.data,e.data)}_clone(){return new Hi(this)}get _isCustomSelection(){return!0}static fromJSON(e){return new Hi(e)}}function Ui(e,t,r){let n=e.get(r),s=t[0];for(;n;){let e=n.getParent();if(e&&e.id===s)return n;n=e}}function zi(e,t,r){return Ui(e,t,r).getPosition()}function Vi(e){if(!e)return Ii.nullSelection;switch(e.type){case"property":return Mi.fromJSON(e);case"container":return Bi.fromJSON(e);case"node":return ji.fromJSON(e);case"custom":return Hi.fromJSON(e);default:return Ii.nullSelection}}function Gi(e,t,r){if(r.isNodeCoordinate())return 0===r.offset;let n=Ui(e,t,r.path[0]);if(n.isText())return 0===r.offset;if(n.isList()){let e=r.path[0];return n.items[0]===e&&0===r.offset}return!1}function Ji(e,t,r){if(r.isNodeCoordinate())return r.offset>0;let n=Ui(e,t,r.path[0]);if(n.isText())return r.offset>=n.getLength();if(n.isList()){let t=r.path[0],s=e.get(t);return Di(n.items)===t&&r.offset===s.getLength()}return!1}function Ki(e,t,r,n){let{isEntirelySelected:s}=function(e,t,r,n){let s=!0,i=!0;(t.isText()||t.isListItem())&&(r&&0!==r.offset&&(s=!1),n&&n.offset<t.getLength()&&(i=!1));return{isFirst:s,isLast:i,isEntirelySelected:s&&i}}(0,t,r,n);return s}function $i(e,t,r,n){if(t.isText()){let s=0;if("after"===n){s=t.getText().length}e.setSelection({type:"property",path:t.getPath(),startOffset:s,containerPath:r})}else if(t.isList()){let s,i;"after"===n?i=(s=t.getLastItem()).getLength():(s=t.getFirstItem(),i=0),e.setSelection({type:"property",path:s.getPath(),startOffset:i,containerPath:r})}else e.setSelection({type:"node",containerPath:r,nodeId:t.id})}function Xi(e,t,r){e.setSelection(Wi({doc:e,nodeId:t,containerPath:r}))}function Wi({doc:e,nodeId:t,containerPath:r,mode:n,reverse:s,surfaceId:i}){let o=e.get(t);if(!o)return Ii.nullSelection;if((o=Ui(e,r,t)).isText())return new Mi({path:o.getPath(),startOffset:"after"===n?o.getLength():0,endOffset:"before"===n?0:o.getLength(),reverse:s,containerPath:r,surfaceId:i});if(o.isList()&&o.getLength()>0){let e=o.getFirstItem(),t=o.getLastItem(),a={path:e.getPath(),offset:0},l={path:t.getPath(),offset:t.getLength()};return"after"===n?a=l:"before"===n&&(l=a),new Bi({startPath:a.path,startOffset:a.offset,endPath:l.path,endOffset:l.offset,reverse:s,containerPath:r,surfaceId:i})}return new ji({nodeId:t,mode:n,reverse:s,containerPath:r,surfaceId:i})}function Yi(e,t){if(t.grabFocus())return!0;let r=t.find(".sc-surface");if(r){if(r._isTextPropertyEditor){const t=e.getDocument(),n=r.getPath(),s=t.get(n,"strict");return e.setSelection({type:"property",path:n,startOffset:s.length,surfaceId:r.id}),!0}if(r._isContainerEditor){let t=e.getDocument(),n=r.getContainerPath(),s=t.get();if(s.length>0){$i(e,t.get(s[0]),n,"after")}return!0}}return!1}function Zi(e,t){return e&&t&&!e.surfaceId&&!t.isNull()&&(e.containerPath=e.containerPath||t.containerPath,e.surfaceId=e.surfaceId||t.surfaceId),e}function Qi(e,t){let r=t.containerPath,n=zi(e,r,t.start.path[0]),s=zi(e,r,t.end.path[0]);return e.get(r).slice(n,s+1)}var eo=Object.freeze({fromJSON:Vi,isFirst:Gi,isLast:Ji,isEntirelySelected:Ki,setCursor:$i,selectNode:Xi,createNodeSelection:Wi,stepIntoIsolatedNode:Yi,augmentSelection:Zi,getNodeIdsCoveredByContainerSelection:Qi}),to={insertedText:function(e,t,r){if(!r)return;var n=e.getIndex("annotations").get(t.path);for(let c=0;c<n.length;c++){let h=n[c];var s=t.offset,i=h.start.offset,o=h.end.offset,a=i,l=o;(s<i||s===i)&&(a+=r),(s<o||s===o&&!h.isInlineNode())&&(l+=r),a!==i&&e.set([h.id,"start","offset"],a),l!==o&&e.set([h.id,"end","offset"],l)}},deletedText:function(e,t,r,n){if(r===n)return;var s=e.getIndex("annotations").get(t),i=n-r;for(let t=0;t<s.length;t++){let u=s[t];var o=r,a=n,l=u.start.offset,c=u.end.offset,h=l,d=c;a<=l?(h-=i,d-=i,e.set([u.id,"start","offset"],h),e.set([u.id,"end","offset"],d)):(o<=l&&(h=l-Math.min(a-o,l-o)),o<=c&&(d=c-Math.min(a-o,c-o)),l!==c&&h===d?e.delete(u.id):(l!==h&&e.set([u.id,"start","offset"],h),c!==d&&e.set([u.id,"end","offset"],d)))}},transferAnnotations:function(e,t,r,n,s){var i=e.getIndex("annotations").get(t,r);for(let t=0;t<i.length;t++){let c=i[t];var o=r>c.start.offset&&r<c.end.offset,a=c.start.offset,l=c.end.offset;if(o){if(c.canSplit()){let t=c.toJSON();t.id=d(c.type+"_"),t.start.path=n,t.start.offset=s,t.end.path=n,t.end.offset=s+c.end.offset-r,e.create(t)}let t=c.start.offset,i=r;i===t?e.delete(c.id):(t!==a&&e.set([c.id,"start","offset"],t),i!==l&&e.set([c.id,"end","offset"],i))}else c.start.offset>=r&&(e.set([c.id,"start","path"],n),e.set([c.id,"start","offset"],s+c.start.offset-r),e.set([c.id,"end","path"],n),e.set([c.id,"end","offset"],s+c.end.offset-r))}},expandAnnotation:ro,fuseAnnotation:function(e,t){if(!m(t)||t.length<2)throw new Error("fuseAnnotation(): at least two annotations are necessary.");let r,n;t.forEach(function(e,t){if(0===t)r=e.getSelection(),n=e.type;else{if(e.type!==n)throw new Error("fuseAnnotation(): all annotations must be of the same type.");r=r.expand(e.getSelection())}});for(var s=1;s<t.length;s++)e.delete(t[s].id);ro(e,t[0],r),e.setSelection(r)},truncateAnnotation:function(e,t,r){if(!r||!r._isSelection)throw new Error('Argument "selection" is required.');if(!t||!t.isAnnotation())throw new Error('Argument "anno" is required and must be an annotation.');let n=t.getSelection().truncateWith(r);return t._updateRange(e,n),t}};function ro(e,t,r){if(!r||!r._isSelection)throw new Error('Argument "selection" is required.');if(!t||!t.isAnnotation())throw new Error('Argument "anno" is required and must be an annotation.');let n=t.getSelection().expand(r);return t._updateRange(e,n),t}class no{select(e){throw new Error("This method is abstract.")}clear(){throw new Error("This method is abstract")}create(e){throw new Error("This method is abstract.")}delete(e){throw new Error("This method is abstract.")}set(e,t,r,n){this.update(e,t,r,n)}update(e,t,r,n){throw new Error("This method is abstract.")}reset(e){this.clear(),this._initialize(e)}clone(){return new(0,this.constructor)}_initialize(e){r(e.getNodes(),function(e){this.select(e)&&this.create(e)}.bind(this))}}no.create=function(e){var t=Object.assign(new no,e);return t.clone=function(){return no.create(e)},t},no.filterByType=function(e){return function(t){return t.isInstanceOf(e)}};class so extends no{}function io(e){return"function"==typeof e}function oo(e,t){if(!e)return[];if(e.constructor.prototype.filter&&io(e.constructor.prototype.filter))return e.filter(t);let n=[];return r(e,(e,r)=>{t(e,r)&&n.push(e)}),n}function ao(e){return Array.prototype.concat.apply([],e)}function lo(e,t){if(!(t>0))throw new Error("'max' must be a positive number");let r=e.length;e=ao(e);let n=1;for(;n<t&&r<e.length;)r=e.length,e=ao(e),n++;return e}function co(e,t,r){if(r=r||{},!t.isPropertySelection())return[];let n=t.getPath(),s=e.getIndex("annotations").get(n,t.start.offset,t.end.offset);return r.type&&(s=oo(s,so.filterByType(r.type))),s}function ho(e,t,r,n){if(!r)throw new Error("'containerPath' is required.");n=n||{};let s=e.getIndex("container-annotations"),i=[];return s&&(i=oo(i=s.get(r,n.type),function(e){return t.overlaps(e.getSelection())})),i}function uo(e,t){if(!t||t.isNull())return"";if(t.isPropertySelection()){return e.get(t.start.path).substring(t.start.offset,t.end.offset)}if(t.isContainerSelection()){let r=[],n=Qi(e,t),s=n.length;for(let i=0;i<s;i++){let o=n[i],a=e.get(o);if(a.isText()){let e=a.getText();i===s-1&&(e=e.slice(0,t.end.offset)),0===i&&(e=e.slice(t.start.offset)),r.push(e)}}return r.join("\n")}}function po(e,t){if(!t||!t.isPropertySelection())return[];const r=t.getPath();return oo(e.getIndex("markers").get(r),function(e){return e.containsSelection(t)})}function fo(e,t){if(!t)return void console.warn("Invalid arguments");if(S(t)&&(t=e.get(t)),t.isText()){let r=e.getIndex("annotations").get(t.id);for(let t=0;t<r.length;t++)e.delete(r[t].id)}let r=t.getSchema();e.delete(t.id),r.getOwnedProperties().forEach(r=>{let n=t[r.name];if(r.isArray()){let t=n;t.length>0&&(m(t[0])&&(t=lo(t,2)),t.forEach(t=>{fo(e,e.get(t))}))}else fo(e,e.get(n))})}function go(e){let t=[],n=e.getDocument(),s=e.getSchema();for(let r of s)if(r.isReference()&&r.isOwned()||"file"===r.type){let n=e[r.name];t.push(i(n))}return t.push(e.toJSON()),r(e.getDocument().getIndex("annotations").get([e.id]),function(e){t.push(e.toJSON())}),ao(t).filter(Boolean);function i(e){if(!e)return null;if(m(e))return ao(e.map(i));{let t=e;if(!t)return null;let r=n.get(t);if(!r)return;return go(r)}}}function mo(e,t,r){t||(t={path:r.path,offset:0});let n=t.path,s=e.get(n);if(r||(r={path:t.path,offset:s.length}),!Oi(t.path,r.path))throw new Error("start and end must be on one property");let i=t.offset;if(i<0)throw new Error("start offset must be >= 0");let o=r.offset;if(o>s.length)throw new Error("end offset must be smaller than the text length");e.update(n,{type:"delete",start:i,end:o}),e.getAnnotations(n).forEach(function(t){let r=t.start.offset,n=t.end.offset;n<=i||(r>=o?(e.update([t.id,"start"],{type:"shift",value:i-o}),e.update([t.id,"end"],{type:"shift",value:i-o})):r>=i&&n<=o?e.delete(t.id):r>=i&&n>=o?(r>i&&e.update([t.id,"start"],{type:"shift",value:i-r}),e.update([t.id,"end"],{type:"shift",value:i-o})):r<=i&&n<=o?e.update([t.id,"end"],{type:"shift",value:i-n}):r<i&&n>=o?e.update([t.id,"end"],{type:"shift",value:i-o}):console.warn("TODO: handle annotation update case."))})}function _o(e,t,r,n,s={}){let i,o;e!==t.getDocument()&&(t=e.get(t.id)),r?i=e.get(r.path[0]):r={path:(i=t.getItemAt(0)).getPath(),offset:0},n?o=e.get(n.path[0]):n={path:(o=t.getLastItem()).getPath(),offset:o.getLength()};let a=t.getItemPosition(i),l=t.getItemPosition(o);if(a===l)return void mo(e,r,n);a>l&&([r,n]=[n,r],[a,l]=[l,a],[i,o]=[o,i]);let c=Ki(0,i,r,null),h=Ki(0,o,null,n);h?(t.removeItemAt(l),fo(e,o)):mo(e,null,n);let d=t.getItems();for(let r=l-1;r>a;r--){let n=d[r];t.removeItemAt(r),fo(e,n)}c&&s.deleteEmptyFirstItem?(t.removeItemAt(a),fo(e,i)):mo(e,r,null),c||h||wo(e,t.id,a)}function yo(e,t,r){return e.get(t).length>0&&mo(e,{path:t,offset:0}),e.update(t,{type:"insert",start:0,text:r}),this}function wo(e,t,r){let n=e.get(t),s=n.getItemAt(r),i=s.getPath(),o=s.getLength(),a=n.getItemAt(r+1),l=a.getPath();n.removeItemAt(r+1),e.update(i,{type:"insert",start:o,text:a.getText()}),to.transferAnnotations(e,l,0,i,o),fo(e,a)}const bo="snippet",vo="text-snippet";function Co(e,t,r,n){e.update(t,{type:"insert",pos:r,value:n})}function So(e,t,r){Co(e,t,e.get(t).length,r)}function xo(e,t,r){let n=e.update(t,{type:"delete",pos:r});if(n&&n.diff)return n.diff.val}function Eo(e,t){return t.map(t=>e.get(t,"strict"))}function No(e,t,r){let n=e.get(t);return e.get(n[r])}function To(e,t,r){if(r>0)return No(e,t,r-1)}function Po(e,t,r){return No(e,t,r+1)}function Do(e){const t=e.getDocument(),n=e.id,s=e.getSchema();let i=[];for(let o of s){const s=o.name;if(o.isText()){r(t.getAnnotations([n,s]),e=>i.push(e))}else if(o.isReference()&&o.isOwned()){let r=e[s];r&&(o.isArray()?i=i.concat(r.map(e=>t.get(e))):i.push(t.get(r)))}}return i}function Io(e){if(e._isAnnotation){let t=e,r=t.start.path[0];return t.getDocument().get(r)}return e.getParent()}var Ao=Object.freeze({getPropertyAnnotationsForSelection:co,getContainerAnnotationsForSelection:ho,isContainerAnnotation:function(e,t){return e.getSchema().isInstanceOf(t,"@container-annotation")},getTextForSelection:uo,getMarkersForSelection:po,deleteNode:function(e,t){return console.error("DEPRECATED: use documentHelpers.deepDeleteNode() instead"),fo(e,t)},deepDeleteNode:fo,copyNode:go,deleteTextRange:mo,deleteListRange:_o,setText:yo,mergeListItems:wo,SNIPPET_ID:bo,TEXT_SNIPPET_ID:vo,insertAt:Co,append:So,removeAt:xo,remove:function(e,t,r){let n=e.get(t).indexOf(r);return n>=0&&xo(e,t,n)},getNodesForPath:function(e,t){return Eo(e,e.get(t))},getNodesForIds:Eo,getNodeAt:No,getPreviousNode:To,getNextNode:Po,getChildren:Do,getParent:Io,createNodeFromJson:function e(t,r){if(!r)throw new Error("'data' is mandatory");if(!r.type)throw new Error("'data.type' is mandatory");if(!io(t.create))throw new Error("First argument must be document or tx");let n=r.type,s=t.getSchema().getNodeSchema(n),i={type:n,id:r.id};for(let n of s){const s=n.name;if(!r.hasOwnProperty(s))continue;let o=r[s];if(n.isReference())if(n.isArray())i[s]=o.map(r=>e(t,r).id);else{let r=e(t,o);i[s]=r.id}else i[n.name]=o}return t.create(i)},compareCoordinates:Li,isCoordinateBefore:qi,getContainerRoot:Ui,getContainerPosition:zi});class Oo{constructor(e,t,r){if(1===arguments.length&&C(arguments[0])){let e=arguments[0];this.sha=e.sha,this.timestamp=e.timestamp,this.before=e.before||{},this.ops=e.ops,this.info=e.info,this.after=e.after||{}}else{if(3!==arguments.length)throw new Error("Illegal arguments.");this.sha=d(),this.info={},this.timestamp=Date.now(),this.ops=e.slice(0),this.before=t||{},this.after=r||{}}this.updated=null,this.created=null,this.deleted=null}_extractInformation(e){if(this._extracted)return;let t=this.ops,n={},s={},i={},o=[];function a(t){switch(t.type){case"create":case"delete":{let e=t.val;e.hasOwnProperty("start")&&e.start.path&&(i[v(e.start.path)]=!0),e.hasOwnProperty("end")&&e.end.path&&(i[v(e.end.path)]=!0);break}case"update":case"set":{let r=e.get(t.path[0]);r&&(r.isPropertyAnnotation()?i[v(r.start.path)]=!0:r.isContainerAnnotation()&&o.push(r));break}}}for(let e=0;e<t.length;e++){let r=t[e];"create"===r.type&&(n[r.val.id]=r.val,delete s[r.val.id]),"delete"===r.type&&(delete n[r.val.id],s[r.val.id]=r.val),"set"!==r.type&&"update"!==r.type||(i[v(r.path)]=!0,i[r.path[0]]=!0),a(r)}o.forEach(t=>{let r=zi(e,t.containerPath,t.start.path[0]),n=zi(e,t.containerPath,t.end.path[0]),o=e.get(t.containerPath);for(let t=r;t<=n;t++){let r,n=e.get(o[t]);r=n.isText()?n.getPath():[n.id],s[n.id]||(i[v(r)]=!0)}}),Object.keys(s).length>0&&r(i,function(e,t){let r=t.split(".")[0];s[r]&&delete i[t]}),this.created=n,this.deleted=s,this.updated=i,this._extracted=!0}invert(){let e=this.toJSON();e.ops=[];let t=e.before;e.before=e.after,e.after=t;let r=Oo.fromJSON(e),n=[];for(let e=this.ops.length-1;e>=0;e--)n.push(this.ops[e].invert());return r.ops=n,r}hasUpdated(e){let t;return t=S(e)?e:v(e),this.updated[t]}hasDeleted(e){return this.deleted[e]}serialize(){let e=new Ti,t=this.toJSON();return t.ops=this.ops.map(function(t){return e.serialize(t)}),JSON.stringify(t)}clone(){return Oo.fromJSON(this.toJSON())}toJSON(){let e={sha:this.sha,before:_(this.before),ops:g(this.ops,function(e){return e.toJSON()}),info:this.info,after:_(this.after)};e.after.selection=void 0,e.before.selection=void 0;let t=this.before.selection;return t&&t._isSelection&&(e.before.selection=t.toJSON()),(t=this.after.selection)&&t._isSelection&&(e.after.selection=t.toJSON()),e}}function ko(e,t,r={}){!function(e,t,r={}){m(e)||(e=[e]);m(t)||(t=[t]);for(let n=0;n<e.length;n++){let s=e[n];for(let e=0;e<t.length;e++){let n=t[e];Lo(s,n,r)}}}(e,t,r)}function Mo(e,t,r){let n=e.clone();return Ro(n,t,r)?n:e}function Lo(e,t,r={}){let n=r.immutableLeft,s=r.immutableRight;for(let i=0;i<e.ops.length;i++)for(let o=0;o<t.ops.length;o++){let a=e.ops[i],l=t.ops[o];n&&(a=a.clone()),s&&(l=l.clone()),ui.transform(a,l,r)}n||(e.before&&Ro(e.before.selection,t,r),e.after&&Ro(e.after.selection,t,r)),s||(t.before&&Ro(t.before.selection,e,r),t.after&&Ro(t.after.selection,e,r))}function Ro(e,t,r={}){if(!e||!e.isPropertySelection()&&!e.isContainerSelection())return!1;let n=t.ops,s=!1,i=e.isCollapsed();for(let t=0;t<n.length;t++){let o=n[t];s|=qo(e.start,o,r),i?(e.isContainerSelection()&&(e.end.path=e.start.path),e.end.offset=e.start.offset):s|=qo(e.end,o,r)}return s}function qo(e,t,r){if(!E(t.path,e.path))return!1;let n=!1;if("update"===t.type&&"string"===t.propertyType){let r,s=t.diff;s.isInsert()&&s.pos<=e.offset?(r=e.offset+s.str.length,e.offset=r,n=!0):s.isDelete()&&s.pos<=e.offset&&(r=Math.max(s.pos,e.offset-s.str.length),e.offset=r,n=!0)}return n}Oo.deserialize=function(e){let t=new Ti,r=JSON.parse(e);return r.ops=r.ops.map(function(e){return t.deserialize(e)}),r.before.selection&&(r.before.selection=Vi(r.before.selection)),r.after.selection&&(r.after.selection=Vi(r.after.selection)),new Oo(r)},Oo.fromJSON=function(e){let t=b(e);return t.ops=e.ops.map(function(e){return ui.fromJSON(e)}),t.before.selection=Vi(e.before.selection),t.after.selection=Vi(e.after.selection),new Oo(t)};var Bo=Object.freeze({transformDocumentChange:ko,transformSelection:Mo});class Fo extends l{constructor(e){super(),this.documentEngine=e,this._collaborators={}}_register(e,t,r){let n=this._collaborators[e];n||(n=this._collaborators[e]={collaboratorId:e,documents:{}}),n.info=r,n.documents[t]={}}_unregister(e,t){let r=this._collaborators[e];delete r.documents[t],0===Object.keys(r.documents).length&&delete this._collaborators[e]}getDocumentIds(e){let t=this._collaborators[e];return t?Object.keys(t.documents):[]}getCollaborators(e,t){let n={};return r(this._collaborators,function(r){if(r.documents[e]&&r.collaboratorId!==t){let e={collaboratorId:r.collaboratorId};e=Object.assign({},r.info,e),n[r.collaboratorId]=e}}),n}getCollaboratorIds(e,t){return g(this.getCollaborators(e,t),function(e){return e.collaboratorId})}sync({documentId:e,version:t,change:r,collaboratorId:n},s){this._sync({documentId:e,version:t,change:r},function(t,r){if(t)return s(t);this._register(n,e),s(null,r)}.bind(this))}_sync({documentId:e,version:t,change:r},s){this.documentEngine.getVersion(e,(i,o)=>{if(i)return s(i);t>o?s(new n("InvalidVersionError",{message:"Client version greater than server version"})):r&&o===t?this._syncFF({documentId:e,version:t,change:r},s):r&&o>t?this._syncRB({documentId:e,version:t,change:r},s):r?console.warn("Unhandled case"):this._syncPullOnly({documentId:e,version:t,change:r},s)})}_syncPullOnly({documentId:e,version:t,change:r},n){this.documentEngine.getChanges(e,t,(e,s)=>{if(e)return n(e);let i;if(s.length>0){let e=[];s.forEach(t=>{e=e.concat(t.ops)}),i=new Oo(e,{},{}),i=this.serializeChange(i)}n(null,{serverChange:i,change:r,version:t})})}_syncFF({documentId:e,change:t},r){this.documentEngine.addChange(e,t,(e,n)=>{if(e)return r(e);r(null,{change:t,serverChange:null,version:n})})}_syncRB({documentId:e,change:t,version:r},n){this._rebaseChange({documentId:e,change:t,version:r},function(r,s){if(r)return n(r);this.documentEngine.addChange(e,t,function(e,t){if(e)return n(e);n(null,{change:s.change,serverChange:s.serverChange,version:t})})}.bind(this))}_rebaseChange({documentId:e,change:t,version:r},n){this.documentEngine.getChanges(e,r,function(e,r,s){if(e)return n(e);let i=r.map(this.deserializeChange),o=this.deserializeChange(t);ko(o,i);let a=i.reduce(function(e,t){return e.concat(t.ops)},[]),l=new Oo(a,{},{});n(null,{change:this.serializeChange(o),serverChange:this.serializeChange(l),version:s})}.bind(this))}disconnect(e){this._unregister(e.collaboratorId,e.documentId)}serializeChange(e){return e.toJSON()}deserializeChange(e){return Oo.fromJSON(e)}}function jo(e,t,r,n){var s=new XMLHttpRequest;s.open(e,t,!0),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.onload=function(){if(!(s.status>=200&&s.status<400))return n(new Error("Request failed. Returned status: "+s.status));var e=s.responseText;(function(e){try{JSON.parse(e)}catch(e){return!1}return!0})(e)&&(e=JSON.parse(e)),n(null,e)},r?s.send(JSON.stringify(r)):s.send()}class Ho extends l{constructor(e){super(),this.config=e,this._onMessage=this._onMessage.bind(this),this._onConnectionOpen=this._onConnectionOpen.bind(this),this._onConnectionClose=this._onConnectionClose.bind(this),this._connect()}_createWebSocket(){throw n("AbstractMethodError")}_connect(){this.ws=this._createWebSocket(),this.ws.addEventListener("open",this._onConnectionOpen),this.ws.addEventListener("close",this._onConnectionClose),this.ws.addEventListener("message",this._onMessage)}_disconnect(){this.ws.removeEventListener("message",this._onMessage),this.ws.removeEventListener("open",this._onConnectionOpen),this.ws.removeEventListener("close",this._onConnectionClose),this.ws=null}_onConnectionOpen(){this.emit("open")}_onConnectionClose(){this._disconnect(),this.emit("close"),console.info("websocket connection closed. Attempting to reconnect in 5s."),setTimeout(function(){this._connect()}.bind(this),5e3)}_onMessage(e){e=this.deserializeMessage(e.data),this.emit("message",e)}send(e){this.isOpen()?this.ws.send(this.serializeMessage(e)):console.warn("Message could not be sent. Connection is not open.",e)}isOpen(){return this.ws&&1===this.ws.readyState}serializeMessage(e){return JSON.stringify(e)}deserializeMessage(e){return JSON.parse(e)}}function Uo(e,t){let r=(e=b(e)).nodes;return t.forEach(e=>{e.ops.forEach(e=>{try{ui.fromJSON(e).apply(r)}catch(t){console.error(t,e)}})}),e}const zo={nodes:{}};class Vo{constructor(e){this.changeStore=e.changeStore,this.snapshotStore=e.snapshotStore}getSnapshot(e,t,r){let n=zo;this._getClosestSnapshot(e,t,(s,i,o)=>{if(s)return r(s);if(i&&t===o)return r(null,i,t);let a;a=i?o:0,i&&(n=i),this.changeStore.getChanges(e,a,t,(e,s)=>e?r(e):s.length<t-a?r(new Error("Changes missing for reconstructing version "+t)):(n=Uo(n,s),void r(null,n,t)))})}createSnapshot(e,t,r){this.getSnapshot(e,t,(n,s)=>{if(n)return r(n);this.snapshotStore.saveSnapshot(e,t,s,r)})}_getClosestSnapshot(e,t,r){let n;this.snapshotStore.getVersions(e,(s,i)=>{if(s)return r(s);if(0===i.length)return r(null,void 0);if(i.indexOf(t)>=0)n=t;else{let e=i.filter(function(e){return parseInt(e,10)<t});n=Math.max.apply(null,e)}if(!n)return r(null,void 0);this.snapshotStore.getSnapshot(e,n,r)})}}class Go extends l{constructor(e){super(),this.changeStore=e.changeStore,this.snapshotStore=e.snapshotStore,this.snapshotFrequency=e.snapshotFrequency||1,this.snapshotEngine=new Vo({changeStore:this.changeStore,snapshotStore:this.snapshotStore})}createDocument(e,t,r){this.addChange(e,t,r)}getDocument(e,t,r){if("function"==typeof t&&(r=t,t=void 0),!e)throw new Error("Invalid Arguments");void 0===t?this.getVersion(e,(t,n)=>{if(t)return r(t);this.snapshotEngine.getSnapshot(e,n,r)}):this.snapshotEngine.getSnapshot(e,t,r)}deleteDocument(e,t){this.changeStore.deleteChanges(e,e=>{if(e)return t(new Error("Deleting changes failed"))})}documentExists(e,t){this.getVersion(e,(e,r)=>{if(e)return t(e);t(null,r>=0)})}getChanges(e,t,r,n){this.changeStore.getChanges(e,t,r,n)}getVersion(e,t){this.changeStore.getVersion(e,t)}requestSnapshot(e,t,r){t%this.snapshotFrequency==0?this.snapshotEngine.createSnapshot(e,t,r):r(null)}addChange(e,t,r){this.changeStore.addChange(e,t,(t,n)=>{if(t)return r(t);this.requestSnapshot(e,n,()=>{r(null,n)})})}}class Jo{constructor(e){this._snapshots=e||{}}getVersions(e,t){t(null,this._getVersions(e))}getSnapshot(e,t,r){if(3===!arguments.length)throw new Error("Invalid Arguments");let n=this._snapshots[e];if(!n)return r(null,void 0);let s=n[t];s?r(null,s,t):r(null,void 0)}saveSnapshot(e,t,r,n){if(!e||!t||!r)throw new Error("Invalid arguments");let s=this._snapshots[e];s||(s=this._snapshots[e]={}),s[t]=r,n(null,s[t])}deleteSnapshot(e,t,r){let n=this._snapshots[e];if(!n||!n[t])return r(new Error("Snapshot does not exist and can not be deleted"));let s=this._snapshots[e][t];delete this._snapshots[e][t],r(null,s)}_getVersions(e){let t=this._snapshots[e];return t?Object.keys(t):[]}}var Ko={name:"collab-server",configure:function(e){e.setChangeStore(new t),e.setSnapshotStore(new Jo)}};function $o(...e){return Object.assign(...e)}class Xo{constructor(e){this.arr=e,this.pos=-1}get _isArrayIterator(){return!0}hasNext(){return this.pos<this.arr.length-1}next(){return this.pos+=1,this.arr[this.pos]}back(){return this.pos>=0&&(this.pos-=1),this}peek(){return this.arr[this.pos+1]}}function Wo(e,t){if(!io(t))return e.indexOf(t);for(let r=0;r<e.length;r++)if(t(e[r]))return r;return-1}class Yo{constructor(e,t,r){if(!S(e)||!io(t))throw new Error("Illegal arguments: 'eventName' must be a String, and 'handler' must be a Function.");var n=t,s=(r=r||{}).context,i=Boolean(r.capture);s&&(t=t.bind(s)),!0===r.once&&(t=function(e,t){return function(r){t(r),e._el.removeEventListener(e)}}(this,t)),this.eventName=e,this.originalHandler=n,this.handler=t,this.capture=i,this.context=s,this.options=r,this._el=null}get _isDOMEventListener(){return!0}static findIndex(e,t,r){return arguments[1]._isDOMEventListener?e.indexOf(arguments[1]):Wo(e,function(e,t){return e.eventName===t.eventName&&e.originalHandler===t.originalHandler}.bind(null,{eventName:t,originalHandler:r}))}}const Zo="This method is not implemented.";class Qo{getNativeElement(){throw new Error(Zo)}isTextNode(){return!1}isElementNode(){return!1}isCommentNode(){return!1}isDocumentNode(){return!1}getTagName(){throw new Error(Zo)}setTagName(e){throw new Error(Zo)}getId(){return this.getAttribute("id")}setId(e){return this.setAttribute("id",e),this}hasClass(e){throw new Error(Zo)}addClass(e){throw new Error(Zo)}removeClass(e){throw new Error(Zo)}hasAttribute(e){return Boolean(this.getAttribute(e))}attr(){if(1===arguments.length){if(S(arguments[0]))return this.getAttribute(arguments[0]);s(arguments[0])&&r(arguments[0],function(e,t){this.setAttribute(t,e)}.bind(this))}else 2===arguments.length&&this.setAttribute(arguments[0],arguments[1]);return this}removeAttr(e){var t=e.split(/\s+/);return 1===t.length?this.removeAttribute(e):t.forEach(function(e){this.removeAttribute(e)}.bind(this)),this}getAttribute(e){throw new Error(Zo)}setAttribute(e,t){throw new Error(Zo)}removeAttribute(e){throw new Error(Zo)}getAttributes(){throw new Error(Zo)}htmlProp(){if(1===arguments.length){if(S(arguments[0]))return this.getProperty(arguments[0]);s(arguments[0])&&r(arguments[0],function(e,t){this.setProperty(t,e)}.bind(this))}else 2===arguments.length&&this.setProperty(arguments[0],arguments[1]);return this}getProperty(e){throw new Error(Zo)}setProperty(e,t){throw new Error(Zo)}val(e){return 0===arguments.length?this.getValue():(this.setValue(e),this)}getValue(){return this.getProperty("value")}setValue(e){return this.setProperty("value",e),this}css(){if(1===arguments.length){if(S(arguments[0]))return this.getStyle(arguments[0]);if(!s(arguments[0]))throw new Error("Illegal arguments.");r(arguments[0],function(e,t){this.setStyle(t,e)}.bind(this))}else{if(2!==arguments.length)throw new Error("Illegal arguments.");this.setStyle(arguments[0],arguments[1])}return this}getStyle(e){throw new Error(Zo)}setStyle(e,t){throw new Error(Zo)}text(e){return 0===arguments.length?this.getTextContent():(this.setTextContent(e),this)}getTextContent(){throw new Error(Zo)}setTextContent(e){throw new Error(Zo)}html(e){return 0===arguments.length?this.getInnerHTML():(this.setInnerHTML(e),this)}getInnerHTML(){throw new Error(Zo)}getInnerXML(){return this.getInnerHTML()}setInnerHTML(e){throw new Error(Zo)}setInnerXML(e){return this.setInnerHTML(e)}getOuterHTML(){throw new Error(Zo)}getOuterXML(){return this.getOuterHTML()}on(e,t,r,n){if(!S(e))throw new Error('Illegal argument: "event" must be a String.');if(n=n||{},r&&(n.context=r),!t||!io(t))throw new Error("Illegal argument: invalid handler function for event "+e);return this.addEventListener(e,t,n),this}off(e,t){if(1!==arguments.length||S(e))this.removeEventListener(e,t);else{let e=arguments[0];this.getEventListeners().filter(function(t){return t.context===e}).forEach(function(e){this.removeEventListener(e)}.bind(this))}return this}addEventListener(e,t,r={}){let n;return n=1===arguments.length&&arguments[0]?arguments[0]:this._createEventListener(e,t,r),this.eventListeners||(this.eventListeners=[]),n._el=this,this.eventListeners.push(n),this._addEventListenerNative(n),this}_createEventListener(e,t,r){return new Yo(e,t,r)}_addEventListenerNative(e){}removeEventListener(e,t){if(!this.eventListeners)return;let r=null,n=Yo.findIndex(this.eventListeners,e,t);return r=this.eventListeners[n],n>-1&&(this.eventListeners.splice(n,1),r._el=null,this._removeEventListenerNative(r)),this}_removeEventListenerNative(e){}removeAllEventListeners(){if(this.eventListeners){for(let e=0;e<this.eventListeners.length;e++){let t=this.eventListeners[e];t._el=null,this._removeEventListenerNative(t)}delete this.eventListeners}}getEventListeners(){return this.eventListeners||[]}getNodeType(){throw new Error(Zo)}getContentType(){throw new Error(Zo)}getChildCount(){throw new Error(Zo)}getChildNodes(){throw new Error(Zo)}getChildren(){throw new Error(Zo)}getChildAt(e){throw new Error(Zo)}getChildIndex(e){throw new Error(Zo)}getChildNodeIterator(){return new Xo(this.getChildNodes())}getLastChild(){throw new Error(Zo)}getFirstChild(){throw new Error(Zo)}getNextSibling(){throw new Error(Zo)}getPreviousSibling(){throw new Error(Zo)}clone(e){throw new Error(Zo)}createElement(e){throw new Error(Zo)}createTextNode(e){throw new Error(Zo)}createComment(e){throw new Error(Zo)}createProcessingInstruction(e,t){throw new Error(Zo)}createCDATASection(e){throw new Error(Zo)}is(e){throw new Error(Zo)}getParent(){throw new Error(Zo)}getOwnerDocument(){throw new Error(Zo)}getDoctype(){throw new Error("NOT_IMPLEMENTED")}setDoctype(e,t,r){throw new Error("NOT_IMPLEMENTED")}setDocType(...e){return console.error("DEPRECATED: use setDoctype() instead"),this.setDoctype(...e)}find(e){throw new Error(Zo)}findAll(e){throw new Error(Zo)}append(e){if(1===arguments.length){if(!m(e)){let t=e;return this.appendChild(t)}e=e.slice()}else e=arguments;return e&&Array.prototype.forEach.call(e,this.appendChild.bind(this)),this}appendChild(e){throw new Error(Zo)}insertAt(e,t){throw new Error(Zo)}insertBefore(e,t){throw new Error(Zo)}removeAt(e){throw new Error(Zo)}removeChild(e){throw new Error(Zo)}replaceChild(e,t){throw new Error(Zo)}remove(){var e=this.getParent();e&&e.removeChild(this)}empty(){throw new Error(Zo)}serialize(){return this.getOuterHTML()}isInDocument(){let e=this;for(;e;){if(e.isDocumentNode())return!0;e=e.getParent()}}focus(){return this}select(){return this}blur(){return this}click(){return this}getWidth(){return 0}getHeight(){return 0}getOuterHeight(e){return 0}getOffset(){return{top:0,left:0}}getPosition(){return{top:0,left:0}}getElementFactory(){return this.createElement.bind(this)}emit(e,t){throw new Error(Zo)}get id(){return this.getId()}set id(e){this.setId(e)}get tagName(){return this.getTagName()}set tagName(e){this.setTagName(e)}get nodeName(){return this.getTagName()}get nodeType(){return this.getNodeType()}get className(){return this.getAttribute("class")}set className(e){this.setAttribute("class",e)}get textContent(){return this.getTextContent()}set textContent(e){this.setTextContent(e)}get innerHTML(){return this.getInnerHTML()}set innerHTML(e){this.setInnerHTML(e)}get outerHTML(){return this.getOuterHTML()}get firstChild(){return this.getFirstChild()}get lastChild(){return this.getLastChild()}get nextSibling(){return this.getNextSibling()}get previousSibling(){return this.getPreviousSibling()}get parentNode(){return this.getParent()}get height(){return this.getHeight()}get width(){return this.getWidth()}get value(){return this.getValue()}set value(e){return this.setValue(e)}get _isDOMElement(){return!0}static get pxStyles(){return ea}static get EMPTY_HTML(){return ta}}const ea={top:!0,bottom:!0,left:!0,right:!0,height:!0,width:!0},ta="<html><head></head><body></body></html>",ra=d("_BrowserDOMElement");function na(e,t){if(!t._isBrowserDOMElement)throw new Error("Invalid argument");if(e.hasOwnProperty(ra))throw new Error("Already attached");e[ra]=t}function sa(e){delete e[ra]}function ia(e){return e[ra]}class oa extends Qo{constructor(e){super(),console.assert(e instanceof window.Node,"Expecting native DOM node."),this.el=e,na(e,this)}getNativeElement(){return this.el}getNodeType(){switch(this.el.nodeType){case window.Node.TEXT_NODE:return"text";case window.Node.ELEMENT_NODE:return"element";case window.Node.DOCUMENT_NODE:return"document";case window.Node.COMMENT_NODE:return"comment";case window.Node.PROCESSING_INSTRUCTION_NODE:return"directive";case window.Node.CDATA_SECTION_NODE:return"cdata"}}getDoctype(){return this.isDocumentNode()?this.el.doctype:this.getOwnerDocument().getDoctype()}setDoctype(e,t,r){let n=this._getNativeOwnerDocument(),s=n.doctype,i=n.implementation.createDocumentType(e,t,r);s?s.parentNode.replaceChild(i,s):n.insertBefore(i,n.firstChild)}isTextNode(){return this.el.nodeType===window.Node.TEXT_NODE}isElementNode(){return this.el.nodeType===window.Node.ELEMENT_NODE}isCommentNode(){return this.el.nodeType===window.Node.COMMENT_NODE}isDocumentNode(){return this.el.nodeType===window.Node.DOCUMENT_NODE}hasClass(e){return this.el.classList.contains(e)}addClass(e){return this.el.classList.add(e),this}removeClass(e){return this.el.classList.remove(e),this}hasAttribute(e){return this.el.hasAttribute(e)}getAttribute(e){if(this.el.hasAttribute(e))return this.el.getAttribute(e)}setAttribute(e,t){return this.el.setAttribute(e,String(t)),this}removeAttribute(e){return this.el.removeAttribute(e),this}getAttributes(){return this.el.attributes._mapAdapter||(this.el.attributes._mapAdapter=new la(this.el.attributes)),this.el.attributes._mapAdapter}getProperty(e){return this.el[e]}setProperty(e,t){if(this._isXML())throw new Error("setProperty() is only supported for HTML elements.");return this.el[e]=t,this}getTagName(){return this._isXML()?this.el.tagName:this.el.tagName?this.el.tagName.toLowerCase():void 0}setTagName(e){let t,r=this.createElement(e),n=this.el.attributes,s=n.length;for(t=0;t<s;t++){let e=n.item(t);r.setAttribute(e.name,e.value)}return this.eventListeners&&this.eventListeners.forEach(function(e){r.addEventListener(e.eventName,e.handler,e.capture)}),r.append(this.getChildNodes()),this._replaceNativeEl(r.getNativeElement()),this}getId(){return this.el.id}setId(e){return this.el.id=e,this}getStyle(e){let t=this.el.style[e];if(!t){t=this.getComputedStyle()[e]}return t}getComputedStyle(){return window.getComputedStyle(this.el)}setStyle(e,t){return Qo.pxStyles[e]&&x(t)&&(t+="px"),this.el.style[e]=t,this}getTextContent(){return this.el.textContent}setTextContent(e){return this.el.textContent=e,this}getInnerHTML(){if(this._isXML()){let e=new window.XMLSerializer;return Array.prototype.map.call(this.el.childNodes,t=>e.serializeToString(t)).join("")}return this.el.innerHTML}setInnerHTML(e){return this.el.innerHTML=e,this}getOuterHTML(){if(this._isXML()){return(new window.XMLSerializer).serializeToString(this.el)}return this.el.outerHTML}_addEventListenerNative(e){this.el.addEventListener(e.eventName,e.handler,e.capture)}_removeEventListenerNative(e){this.el.removeEventListener(e.eventName,e.handler)}getEventListeners(){return this.eventListeners||[]}getChildCount(){return this.el.childNodes.length}getChildNodes(){let e=[];for(let t=this.el.firstChild;t;t=t.nextSibling)e.push(oa.wrap(t));return e}getChildNodeIterator(){return new ca(this.el)}get childNodes(){return this.getChildNodes()}getChildren(){let e=[];for(let t=this.el.firstChild;t;t=t.nextSibling)t.nodeType===window.Node.ELEMENT_NODE&&e.push(oa.wrap(t));return e}get children(){return this.getChildren()}getChildAt(e){return oa.wrap(this.el.childNodes[e])}getChildIndex(e){if(!e._isBrowserDOMElement)throw new Error("Expecting a BrowserDOMElement instance.");return Array.prototype.indexOf.call(this.el.childNodes,e.el)}getFirstChild(){let e=this.el.firstChild;return e?oa.wrap(e):null}getLastChild(){var e=this.el.lastChild;return e?oa.wrap(e):null}getNextSibling(){let e=this.el.nextSibling;return e?oa.wrap(e):null}getPreviousSibling(){let e=this.el.previousSibling;return e?oa.wrap(e):null}clone(e){let t=this.el.cloneNode(e);return oa.wrap(t)}createDocument(e,t){return oa.createDocument(e,t)}createElement(e){let t=this._getNativeOwnerDocument().createElement(e);return oa.wrap(t)}createTextNode(e){let t=this._getNativeOwnerDocument().createTextNode(e);return oa.wrap(t)}createComment(e){let t=this._getNativeOwnerDocument().createComment(e);return oa.wrap(t)}createProcessingInstruction(e,t){let r=this._getNativeOwnerDocument().createProcessingInstruction(e,t);return oa.wrap(r)}createCDATASection(e){let t=this._getNativeOwnerDocument().createCDATASection(e);return oa.wrap(t)}is(e){let t=this.el;return!!this.isElementNode()&&function(e,t){let r=window.Element.prototype;return(r.matches||r.matchesSelector||r.msMatchesSelector||r.webkitMatchesSelector).call(e,t)}(t,e)}getParent(){let e=this.el.parentNode;return e?oa.wrap(e):null}getOwnerDocument(){return oa.wrap(this._getNativeOwnerDocument())}get ownerDocument(){return this.getOwnerDocument()}_getNativeOwnerDocument(){return this.isDocumentNode()?this.el:this.el.ownerDocument}find(e){let t=null;return this.el.querySelector&&(t=this.el.querySelector(e)),t?oa.wrap(t):null}findAll(e){let t=[];return this.el.querySelectorAll&&(t=this.el.querySelectorAll(e)),Array.prototype.map.call(t,function(e){return oa.wrap(e)})}_normalizeChild(e){if(N(e))return e;if(e instanceof window.Node?e=oa.wrap(e):!e._isBrowserDOMElement||e instanceof oa?(S(e)||x(e))&&(e=this.createTextNode(e)):e=oa.wrap(e),!e||!e._isBrowserDOMElement)throw new Error("Illegal child type.");return console.assert(ia(e.el)===e,"The backlink to the wrapper should be consistent"),e.getNativeElement()}appendChild(e){let t=this._normalizeChild(e);return t&&this.el.appendChild(t),this}insertAt(e,t){let r=this._normalizeChild(t),n=this.el.childNodes;return e>=n.length?this.el.appendChild(r):this.el.insertBefore(r,n[e]),this}insertBefore(e,t){if(N(t))return this.appendChild(e);if(!t._isBrowserDOMElement)throw new Error('insertBefore(): Illegal arguments. "before" must be a BrowserDOMElement instance.');var r=this._normalizeChild(e);return r&&this.el.insertBefore(r,t.el),this}removeAt(e){return this.el.removeChild(this.el.childNodes[e]),this}removeChild(e){if(!e||!e._isBrowserDOMElement)throw new Error("removeChild(): Illegal arguments. Expecting a BrowserDOMElement instance.");return this.el.removeChild(e.el),this}replaceChild(e,t){if(!(t&&e&&t._isBrowserDOMElement&&e._isBrowserDOMElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");return this.el.replaceChild(t.el,e.el),this}empty(){let e=this.el;for(;e.lastChild;)e.removeChild(e.lastChild);return this}remove(){return this.el.parentNode&&this.el.parentNode.removeChild(this.el),this}serialize(){let e=this.el.outerHTML;if(S(e))return e;return(new window.XMLSerializer).serializeToString(this.el)}isInDocument(){let e=this.el;for(;e;){if(e.nodeType===window.Node.DOCUMENT_NODE)return!0;e=e.parentNode}}_replaceNativeEl(e){console.assert(e instanceof window.Node,"Expecting a native element.");let t=this.el,r=t.parentNode;r&&r.replaceChild(e,t),this.el=e,sa(t),sa(e),na(e,this)}_getChildNodeCount(){return this.el.childNodes.length}focus(e){return this.el.focus(e),this}select(){return this.el.select(),this}blur(){return this.el.blur(),this}click(){return this.el.click(),!0}getWidth(){let e=this.el.getClientRects()[0];return e?e.width:0}getHeight(){let e=this.el.getClientRects()[0];return e?e.height:0}getOffset(){let e=this.el.getBoundingClientRect();return{top:e.top+document.body.scrollTop,left:e.left+document.body.scrollLeft}}getPosition(){return{left:this.el.offsetLeft,top:this.el.offsetTop}}getOuterHeight(e){let t=this.el.offsetHeight;if(e){let e=this.getComputedStyle();t+=parseInt(e.marginTop,10)+parseInt(e.marginBottom,10)}return t}getContentType(){return this._getNativeOwnerDocument().contentType}_isXML(){return"application/xml"===this.getContentType()}emit(e,t){let r;r=t?new window.CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0}):new window.Event(e,{bubbles:!0,cancelable:!0}),this.el.dispatchEvent(r)}}oa.prototype._isBrowserDOMElement=!0,oa.createDocument=function(e,t={}){let r;if("xml"===e){let e,n=[];t.version&&n.push(`version="${t.version}"`),t.encoding&&n.push(`encoding="${t.encoding}"`),e=n.length>0?`<?xml ${n.join(" ")}?><dummy/>`:"<dummy/>",(r=(new window.DOMParser).parseFromString(e,"application/xml")).removeChild(r.firstChild)}else r=(new window.DOMParser).parseFromString(Qo.EMPTY_HTML,"text/html");return oa.wrap(r)},oa.parseMarkup=function(e,t,r={}){if(!e)return oa.createDocument(t);let n;r.snippet&&(e=`<div id='__snippet__'>${e}</div>`);let s=new window.DOMParser;if("html"===t?n=oa.wrap(i(s.parseFromString(e,"text/html"))):"xml"===t&&(n=oa.wrap(i(s.parseFromString(e,"application/xml")))),r.snippet){let e=n.find("#__snippet__").childNodes;return 1===e.length?e[0]:e}return n;function i(e){if(e){let t=e.querySelector("parsererror");if(t)throw new Error("ParserError: "+oa.wrap(t).outerHTML)}return e}},oa.wrap=oa.wrapNativeElement=function(e){if(!e)return null;{let t=ia(e);if(t)return t;if(e instanceof window.Node)return new oa(e);if(e._isBrowserDOMElement)return e;if(e===window)return oa.getBrowserWindow()}},oa.unwrap=function(e){return ia(e)};class aa{constructor(){this.el=window,na(window,this)}get _isBrowserDOMElement(){return!0}}aa.prototype.getNativeElement=oa.prototype.getNativeElement,aa.prototype.on=oa.prototype.on,aa.prototype.off=oa.prototype.off,aa.prototype.addEventListener=oa.prototype.addEventListener,aa.prototype.removeEventListener=oa.prototype.removeEventListener,aa.prototype._createEventListener=oa.prototype._createEventListener,aa.prototype._addEventListenerNative=oa.prototype._addEventListenerNative,aa.prototype._removeEventListenerNative=oa.prototype._removeEventListenerNative,aa.prototype.getEventListeners=oa.prototype.getEventListeners,oa.getBrowserWindow=function(){return window[ra]?window[ra]:new aa(window)},oa.isReverse=function(e,t,r,n){if(r&&e){oa.isReverse._r1||(oa.isReverse._r1=window.document.createRange(),oa.isReverse._r2=window.document.createRange());const s=oa.isReverse._r1,i=oa.isReverse._r2;if(s.setStart(e.getNativeElement(),t),i.setStart(r.getNativeElement(),n),1===s.compareBoundaryPoints(window.Range.START_TO_START,i))return!0}return!1},oa.getWindowSelection=function(){let e=window.getSelection();return{anchorNode:oa.wrap(e.anchorNode),anchorOffset:e.anchorOffset,focusNode:oa.wrap(e.focusNode),focusOffset:e.focusOffset}};class la{constructor(e){this.attributes=e}get size(){return this.attributes.length}get(e){let t=this.attributes.getNamedItem(e);if(t)return t.value}set(e,t){this.attributes.setNamedItem(e,t)}forEach(e){const t=this.size;for(let r=0;r<t;r++){const t=this.attributes.item(r);e(t.value,t.name)}}map(e){let t=[];return this.forEach((r,n)=>{t.push(e(r,n))}),t}keys(){return this.map((e,t)=>t)}values(){return this.map(e=>e)}entries(){return this.map((e,t)=>[t,e])}}class ca{constructor(e){this._next=e.firstChild,this._curr=null}hasNext(){return Boolean(this._next)}next(){let e=this._next;return this._curr=e,this._next=e.nextSibling,oa.wrap(e)}back(){this._next=this._curr,this._curr=this._curr.previousSibling}peek(){return oa.wrap(this._curr)}}var ha=y.inBrowser,da={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata",Doctype:"doctype",isTag:function(e){return"tag"===e.type||"script"===e.type||"style"===e.type}},ua=function(){return!0},pa=function(){return!1},fa=function(e){if("even"===(e=e.trim().toLowerCase()))return[2,0];if("odd"===e)return[2,1];var t,r=e.match(ga);if(!r)throw new SyntaxError("n-th rule couldn't be parsed ('"+e+"')");return r[1]?(t=parseInt(r[1],10),isNaN(t)&&(t="-"===r[1].charAt(0)?-1:1)):t=0,[t,r[3]?parseInt((r[2]||"")+r[3],10):0]},ga=/^([+\-]?\d*n)?\s*(?:([+\-]?)\s*(\d+))?$/;var ma=function(e){var t=e[0],r=e[1]-1;if(r<0&&t<=0)return ya;if(-1===t)return function(e){return e<=r};if(0===t)return function(e){return e===r};if(1===t)return r<0?_a:function(e){return e>=r};var n=r%t;n<0&&(n+=t);if(t>1)return function(e){return e>=r&&e%t===n};return t*=-1,function(e){return e<=r&&e%t===n}},_a=ua,ya=pa;var wa=function(e){return ma(fa(e))},ba=fa,va=ma;wa.parse=ba,wa.compile=va;var Ca=function(e,t){var r=[];if(""!==(e=function e(t,r,n){var s,i,o,a,l=[],c=!1;function h(){var e=r.match(Sa)[0];return r=r.substr(e.length),ka(e)}function d(e){for(;Ma(r.charAt(e));)e++;r=r.substr(e)}for(d(0);""!==r;)if(Ma(i=r.charAt(0)))c=!0,d(1);else if(i in Ta)l.push({type:Ta[i]}),c=!1,d(1);else if(","===i){if(0===l.length)throw new SyntaxError("empty sub-selector");t.push(l),l=[],c=!1,d(1)}else if(c&&(l.length>0&&l.push({type:"descendant"}),c=!1),"*"===i)r=r.substr(1),l.push({type:"universal"});else if(i in Pa)r=r.substr(1),l.push({type:"attribute",name:Pa[i][0],action:Pa[i][1],value:h(),ignoreCase:!1});else if("["===i){if(r=r.substr(1),!(s=r.match(Ea)))throw new SyntaxError("Malformed attribute selector: "+r);r=r.substr(s[0].length),o=ka(s[1]),n&&("lowerCaseAttributeNames"in n?!n.lowerCaseAttributeNames:n.xmlMode)||(o=o.toLowerCase()),l.push({type:"attribute",name:o,action:Na[s[2]],value:ka(s[4]||s[5]||""),ignoreCase:!!s[6]})}else if(":"===i){if(":"===r.charAt(1)){r=r.substr(2),l.push({type:"pseudo-element",name:h().toLowerCase()});continue}if(r=r.substr(1),o=h().toLowerCase(),s=null,"("===r.charAt(0))if(o in Da){var u=(a=r.charAt(1))in Aa;if(r=r.substr(u+1),r=e(s=[],r,n),u){if(r.charAt(0)!==a)throw new SyntaxError("unmatched quotes in :"+o);r=r.substr(1)}if(")"!==r.charAt(0))throw new SyntaxError("missing closing parenthesis in :"+o+" "+r);r=r.substr(1)}else{for(var p=1,f=1;f>0&&p<r.length;p++)"("===r.charAt(p)?f++:")"===r.charAt(p)&&f--;if(f)throw new SyntaxError("parenthesis not matched");s=r.substr(1,p-2),r=r.substr(p),o in Ia&&((a=s.charAt(0))===s.slice(-1)&&a in Aa&&(s=s.slice(1,-1)),s=ka(s))}l.push({type:"pseudo",name:o,data:s})}else{if(!Sa.test(r))return l.length&&"descendant"===l[l.length-1].type&&l.pop(),La(t,l),r;o=h(),n&&("lowerCaseTags"in n?!n.lowerCaseTags:n.xmlMode)||(o=o.toLowerCase()),l.push({type:"tag",name:o})}return La(t,l),r}(r,e+"",t)))throw new SyntaxError("Unmatched selector: "+e);return r},Sa=/^(?:\\.|[\w\-\u00c0-\uFFFF])+/,xa=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,Ea=/^\s*((?:\\.|[\w\u00c0-\uFFFF\-])+)\s*(?:(\S?)=\s*(?:(['"])(.*?)\3|(#?(?:\\.|[\w\u00c0-\uFFFF\-])*)|)|)\s*(i)?\]/,Na={__proto__:null,undefined:"exists","":"equals","~":"element","^":"start",$:"end","*":"any","!":"not","|":"hyphen"},Ta={__proto__:null,">":"child","<":"parent","~":"sibling","+":"adjacent"},Pa={__proto__:null,"#":["id","equals"],".":["class","element"]},Da={__proto__:null,has:!0,not:!0,matches:!0},Ia={__proto__:null,contains:!0,icontains:!0},Aa={__proto__:null,'"':!0,"'":!0};function Oa(e,t,r){var n="0x"+t-65536;return n!=n||r?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)}function ka(e){return e.replace(xa,Oa)}function Ma(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function La(e,t){if(e.length>0&&0===t.length)throw new SyntaxError("empty sub-selector");e.push(t)}const Ra=(e=>{let t=Ba({amp:"&",gt:">",lt:"<"});return Va(t,Fa(t))})(),qa=(e=>{let t=Ba({quot:'"'});return Va(t,Fa(t))})();function Ba(e){return Object.keys(e).sort().reduce(function(t,r){return t[e[r]]="&"+r+";",t},{})}function Fa(e){let t=[],r=[];return Object.keys(e).forEach(function(e){1===e.length?t.push("\\"+e):r.push(e)}),r.unshift("["+t.join("")+"]"),new RegExp(r.join("|"),"g")}const ja=/[^\0-\x7F]/g,Ha=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;function Ua(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"}function za(e){return"&#x"+(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)-56320+65536).toString(16).toUpperCase()+";"}function Va(e,t){function r(t){return e[t]}return function(e){return e.replace(t,r).replace(Ha,za).replace(ja,Ua)}}const Ga={__proto__:null,allowfullscreen:!0,async:!0,autofocus:!0,autoplay:!0,checked:!0,controls:!0,default:!0,defer:!0,disabled:!0,hidden:!0,ismap:!0,loop:!0,multiple:!0,muted:!0,open:!0,readonly:!0,required:!0,reversed:!0,scoped:!0,seamless:!0,selected:!0,typemustmatch:!0},Ja={__proto__:null,style:!0,script:!0,xmp:!0,iframe:!0,noembed:!0,noframes:!0,plaintext:!0,noscript:!0},Ka={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};class $a{isTag(e){return da.isTag(e)}removeElement(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){var t=e.parent.childNodes;let r=t.lastIndexOf(e);if(r<0)throw new Error("Invalid state");t.splice(r,1),e.parent=null}}replaceElement(e,t){t.parent&&this.removeElement(t);var r=t.prev=e.prev;r&&(r.next=t);var n=t.next=e.next;n&&(n.prev=t);var s=t.parent=e.parent;if(s){var i=s.childNodes;let r=i.lastIndexOf(e);if(r<0)throw new Error("Invalid state");i[r]=t}}appendChild(e,t){if(t.parent&&this.removeElement(t),t.parent=e,1!==e.childNodes.push(t)){var r=e.childNodes[e.childNodes.length-2];r.next=t,t.prev=r,t.next=null}}append(e,t){t.parent&&this.removeElement(t);let r=e.parent,n=e.next;if(t.next=n,t.prev=e,e.next=t,t.parent=r,n){if(n.prev=t,r){var s=r.childNodes;let e=s.lastIndexOf(n);if(e<0)throw new Error("Invalid state");s.splice(e,0,t)}}else r&&r.childNodes.push(t)}prepend(e,t){t.parent&&this.removeElement(t);var r=e.parent;if(r){var n=r.childNodes;let s=n.lastIndexOf(e);if(s<0)throw new Error("Invalid state");n.splice(s,0,t)}e.prev&&(e.prev.next=t),t.parent=r,t.prev=e.prev,t.next=e,e.prev=t}filter(e,t,r,n){return Array.isArray(t)||(t=[t]),"number"==typeof n&&isFinite(n)||(n=1/0),this.find(e,t,!1!==r,n)}find(e,t,r,n){let s,i=[];for(var o=0,a=t.length;o<a&&!(e(t[o])&&(i.push(t[o]),--n<=0))&&(s=this.getChildren(t[o]),!(r&&s&&s.length>0&&(s=this.find(e,s,r,n),i=i.concat(s),(n-=s.length)<=0)));o++);return i}findOneChild(e,t){for(var r=0,n=t.length;r<n;r++)if(e(t[r]))return t[r];return null}findOne(e,t){for(var r=null,n=0,s=t.length;n<s&&!r;n++){const s=t[n];if(this.isTag(s))if(e(s))r=s;else{const t=this.getChildren(s);t.length>0&&(r=this.findOne(e,t))}}return r}existsOne(e,t){for(var r=0,n=t.length;r<n;r++){const n=t[r];if(!this.isTag(n))continue;if(e(n))return!0;const s=this.getChildren(n);if(s.length>0&&this.existsOne(e,s))return!0}return!1}findAll(e,t){for(var r=[],n=0,s=t.length;n<s;n++){const s=t[n];if(!this.isTag(s))continue;e(s)&&r.push(s);const i=this.getChildren(s);i.length>0&&(r=r.concat(this.findAll(e,i)))}return r}getAttributes(e){let t=e.getAttributes();if(t instanceof Map)return Array.from(t);if(t&&t.forEach){let e=[];return t.forEach((t,r)=>{e.push([r,t])}),e}return[]}formatAttribs(e,t={}){let r=[];return this.getAttributes(e).forEach(([e,n])=>{!n&&Ga[e]?r.push(e):r.push(e+'="'+(t.decodeEntities?qa(n):n)+'"')}),r.join(" ")}render(e,t){Array.isArray(e)||(e=[e]),t=t||{};let r=[];for(var n=0;n<e.length;n++){let s=e[n];switch(s.type){case"root":case"document":s._xmlInstruction&&r.push(this.render(s._xmlInstruction,t)),r.push(this.render(this.getChildren(s),t));break;case da.Tag:case da.Script:case da.Style:r.push(this.renderTag(s,t));break;case da.CDATA:r.push(this.renderCdata(s));break;case da.Comment:r.push(this.renderComment(s));break;case da.Directive:r.push(this.renderDirective(s));break;case da.Doctype:r.push(this.renderDoctype(s));break;case da.Text:r.push(this.renderText(s,t));break;default:throw new Error("Not implement yet: render of element type "+s.type)}}return r.join("")}renderTag(e,t){const r=this.getName(e);"svg"===r&&(t={decodeEntities:t.decodeEntities,xmlMode:!0});let n="<"+r,s=this.formatAttribs(e,t);s&&(n+=" "+s);const i=this.getChildren(e);return t.xmlMode&&0===i.length?n+="/>":(n+=">",i.length>0&&(n+=this.render(i,t)),Ka[r]&&!t.xmlMode||(n+="</"+r+">")),n}renderDirective(e){return"<?"+this.getName(e)+" "+this.getData(e)+"?>"}renderDoctype(e){const{name:t,publicId:r,systemId:n}=this.getData(e);let s=["DOCTYPE",t];return r&&(s.push("PUBLIC"),s.push('"'+r+'"'),n&&s.push('"'+n+'"')),"<!"+s.join(" ")+">"}renderText(e,t){let r=this.getText(e);if(t.decodeEntities){const t=this.getParent(e);t&&this.getName(t)in Ja||(r=Ra(r))}return r}renderCdata(e){return"<![CDATA["+this.getData(e)+"]]>"}renderComment(e){return"\x3c!--"+this.getData(e)+"--\x3e"}getInnerHTML(e,t){return this.getChildren(e).map(e=>this.render(e,t)).join("")}getOuterHTML(e,t){return this.render(e,t)}getData(e){return e.data}getText(e,t){if(Array.isArray(e))return e.map(e=>this.getText(e,t)).join("");switch(e.type){case da.Tag:case da.Script:case da.Style:return this.getText(this.getChildren(e),!0);case da.Text:case da.CDATA:return e.data;case da.Comment:return t?"":e.data;default:return""}}getChildren(e){return e.childNodes}getParent(e){return e.parent}getSiblings(e){var t=this.getParent(e);return t?this.getChildren(t):[e]}getAttributeValue(e,t){return e.getAttribute(t)}hasAttrib(e,t){return e.hasAttribute(t)}getName(e){return e.name}getNameWithoutNS(e){return e.nameWithoutNS}}const Xa=new $a;Xa.DomUtils=$a;var Wa={universal:50,tag:30,attribute:1,pseudo:0,descendant:-1,child:-1,parent:-1,sibling:-1,adjacent:-1},Ya=Object.freeze({universal:50,tag:30,attribute:1,pseudo:0,descendant:-1,child:-1,parent:-1,sibling:-1,adjacent:-1,default:Wa}),Za=Ya&&Wa||Ya,Qa=function(e){for(var t=e.map(tl),r=1;r<e.length;r++){var n=t[r];if(!(n<0))for(var s=r-1;s>=0&&n<t[s];s--){var i=e[s+1];e[s+1]=e[s],e[s]=i,t[s+1]=t[s],t[s]=n}}},el={__proto__:null,exists:10,equals:8,not:7,start:6,end:6,any:5,hyphen:4,element:4};function tl(e){var t=Za[e.type];if(t===Za.attribute)(t=el[e.action])===el.equals&&"id"===e.name&&(t=9),e.ignoreCase&&(t>>=1);else if(t===Za.pseudo)if(e.data)if("has"===e.name||"contains"===e.name)t=0;else if("matches"===e.name||"not"===e.name){t=0;for(var r=0;r<e.data.length;r++)if(1===e.data[r].length){var n=tl(e.data[r][0]);if(0===n){t=0;break}n>t&&(t=n)}e.data.length>1&&t>0&&(t-=1)}else t=1;else t=3;return t}var rl=pa,nl=/[-[\]{}()*+?.,\\^$|#\s]/g;var sl=function(e){var t={__proto__:null,equals:function(t,r){var n=r.name,s=r.value;return r.ignoreCase?(s=s.toLowerCase(),function(r){var i=e.getAttributeValue(r,n);return null!=i&&i.toLowerCase()===s&&t(r)}):function(r){return e.getAttributeValue(r,n)===s&&t(r)}},hyphen:function(t,r){var n=r.name,s=r.value,i=s.length;return r.ignoreCase?(s=s.toLowerCase(),function(r){var o=e.getAttributeValue(r,n);return null!=o&&(o.length===i||"-"===o.charAt(i))&&o.substr(0,i).toLowerCase()===s&&t(r)}):function(r){var o=e.getAttributeValue(r,n);return null!=o&&o.substr(0,i)===s&&(o.length===i||"-"===o.charAt(i))&&t(r)}},element:function(t,r){var n=r.name,s=r.value;if("class"===r.name){let e=r.value;return/\s/.test(e)?function(){return!1}:function(r){let n=r.classes;return n&&n.has(e)&&t(r)}}if(/\s/.test(s))return rl;var i="(?:^|\\s)"+(s=s.replace(nl,"\\$&"))+"(?:$|\\s)",o=r.ignoreCase?"i":"",a=new RegExp(i,o);return function(r){var s=e.getAttributeValue(r,n);return null!=s&&a.test(s)&&t(r)}},exists:function(t,r){var n=r.name;return function(r){return e.hasAttrib(r,n)&&t(r)}},start:function(t,r){var n=r.name,s=r.value,i=s.length;return 0===i?rl:r.ignoreCase?(s=s.toLowerCase(),function(r){var o=e.getAttributeValue(r,n);return null!=o&&o.substr(0,i).toLowerCase()===s&&t(r)}):function(r){var o=e.getAttributeValue(r,n);return null!=o&&o.substr(0,i)===s&&t(r)}},end:function(t,r){var n=r.name,s=r.value,i=-s.length;return 0===i?rl:r.ignoreCase?(s=s.toLowerCase(),function(r){var o=e.getAttributeValue(r,n);return null!=o&&o.substr(i).toLowerCase()===s&&t(r)}):function(r){var o=e.getAttributeValue(r,n);return null!=o&&o.substr(i)===s&&t(r)}},any:function(t,r){var n=r.name,s=r.value;if(""===s)return rl;if(r.ignoreCase){var i=new RegExp(s.replace(nl,"\\$&"),"i");return function(r){var s=e.getAttributeValue(r,n);return null!=s&&i.test(s)&&t(r)}}return function(r){var i=e.getAttributeValue(r,n);return null!=i&&i.indexOf(s)>=0&&t(r)}},not:function(t,r){var n=r.name,s=r.value;return""===s?function(r){return!!e.getAttributeValue(r,n)&&t(r)}:r.ignoreCase?(s=s.toLowerCase(),function(r){var i=e.getAttributeValue(r,n);return null!=i&&i.toLowerCase()!==s&&t(r)}):function(r){return e.getAttributeValue(r,n)!==s&&t(r)}}};return{compile:function(e,r,n){if(n&&n.strict&&(r.ignoreCase||"not"===r.action))throw new Error("Unsupported attribute selector");return t[r.action](e,r)},rules:t}};var il=function(e,t){return{__proto__:null,attribute:sl(e).compile,pseudo:t.compile,tag:function(t,r){var n=r.name;return function(r){return e.getNameWithoutNS(r)===n&&t(r)}},descendant:function(t){return function(r){for(var n=!1;!n&&(r=e.getParent(r));)n=t(r);return n}},_flexibleDescendant:function(t){return function(r){for(var n=t(r);!n&&(r=e.getParent(r));)n=t(r);return n}},parent:function(t,r,n){if(n&&n.strict)throw new Error("Parent selector isn't part of CSS3");return function(t){return e.getChildren(t).some(s)};function s(r){return e.isTag(r)&&t(r)}},child:function(t){return function(r){var n=e.getParent(r);return!!n&&t(n)}},sibling:function(t){return function(r){for(var n=e.getSiblings(r),s=0;s<n.length;s++)if(e.isTag(n[s])){if(n[s]===r)break;if(t(n[s]))return!0}return!1}},adjacent:function(t){return function(r){for(var n,s=e.getSiblings(r),i=0;i<s.length;i++)if(e.isTag(s[i])){if(s[i]===r)break;n=s[i]}return!!n&&t(n)}},universal:function(e){return e}}},ol=ua,al=pa;function ll(e){var t=sl(e).rules.equals;function r(e,r){var n={name:e,value:r};return function(e){return t(e,n)}}function n(t){return function(r){return!!e.getParent(r)&&t(r)}}var s={contains:function(t,r){return function(n){return t(n)&&e.getText(n).indexOf(r)>=0}},icontains:function(t,r){var n=r.toLowerCase();return function(r){return t(r)&&e.getText(r).toLowerCase().indexOf(n)>=0}},"nth-child":function(t,r){var s=wa(r);return s===al?s:s===ol?n(t):function(r){for(var n=e.getSiblings(r),i=0,o=0;i<n.length;i++)if(e.isTag(n[i])){if(n[i]===r)break;o++}return s(o)&&t(r)}},"nth-last-child":function(t,r){var s=wa(r);return s===al?s:s===ol?n(t):function(r){for(var n=e.getSiblings(r),i=0,o=n.length-1;o>=0;o--)if(e.isTag(n[o])){if(n[o]===r)break;i++}return s(i)&&t(r)}},"nth-of-type":function(t,r){var s=wa(r);return s===al?s:s===ol?n(t):function(r){for(var n=e.getSiblings(r),i=0,o=0;o<n.length;o++)if(e.isTag(n[o])){if(n[o]===r)break;e.getName(n[o])===e.getName(r)&&i++}return s(i)&&t(r)}},"nth-last-of-type":function(t,r){var s=wa(r);return s===al?s:s===ol?n(t):function(r){for(var n=e.getSiblings(r),i=0,o=n.length-1;o>=0;o--)if(e.isTag(n[o])){if(n[o]===r)break;e.getName(n[o])===e.getName(r)&&i++}return s(i)&&t(r)}},root:function(t){return function(r){return!e.getParent(r)&&t(r)}},scope:function(t,r,n,i){return i&&0!==i.length?1===i.length?function(r){return n=i[0],s=r,("function"==typeof e.equals?e.equals(n,s):n===s)&&t(r);var n,s}:function(e){return i.indexOf(e)>=0&&t(e)}:s.root(t)},checkbox:r("type","checkbox"),file:r("type","file"),password:r("type","password"),radio:r("type","radio"),reset:r("type","reset"),image:r("type","image"),submit:r("type","submit")};return s}function cl(e){var t={empty:function(t){return!e.getChildren(t).some(function(t){return e.isTag(t)||"text"===t.type})},"first-child":function(t){return function(t){for(var r=0;t&&r<t.length;r++)if(e.isTag(t[r]))return t[r]}(e.getSiblings(t))===t},"last-child":function(t){for(var r=e.getSiblings(t),n=r.length-1;n>=0;n--){if(r[n]===t)return!0;if(e.isTag(r[n]))break}return!1},"first-of-type":function(t){for(var r=e.getSiblings(t),n=0;n<r.length;n++)if(e.isTag(r[n])){if(r[n]===t)return!0;if(e.getName(r[n])===e.getName(t))break}return!1},"last-of-type":function(t){for(var r=e.getSiblings(t),n=r.length-1;n>=0;n--)if(e.isTag(r[n])){if(r[n]===t)return!0;if(e.getName(r[n])===e.getName(t))break}return!1},"only-of-type":function(t){for(var r=e.getSiblings(t),n=0,s=r.length;n<s;n++)if(e.isTag(r[n])){if(r[n]===t)continue;if(e.getName(r[n])===e.getName(t))return!1}return!0},"only-child":function(t){for(var r=e.getSiblings(t),n=0;n<r.length;n++)if(e.isTag(r[n])&&r[n]!==t)return!1;return!0},link:function(t){return e.hasAttrib(t,"href")},visited:al,selected:function(t){if(e.hasAttrib(t,"selected"))return!0;if("option"!==e.getName(t))return!1;var r=e.getParent(t);if(!r||"select"!==e.getName(r)||e.hasAttrib(r,"multiple"))return!1;for(var n=e.getChildren(r),s=!1,i=0;i<n.length;i++)if(e.isTag(n[i]))if(n[i]===t)s=!0;else{if(!s)return!1;if(e.hasAttrib(n[i],"selected"))return!1}return s},disabled:function(t){return e.hasAttrib(t,"disabled")},enabled:function(t){return!e.hasAttrib(t,"disabled")},checked:function(r){return e.hasAttrib(r,"checked")||t.selected(r)},required:function(t){return e.hasAttrib(t,"required")},optional:function(t){return!e.hasAttrib(t,"required")},parent:function(e){return!t.empty(e)},header:function(t){var r=e.getName(t);return"h1"===r||"h2"===r||"h3"===r||"h4"===r||"h5"===r||"h6"===r},button:function(t){var r=e.getName(t);return"button"===r||"input"===r&&"button"===e.getAttributeValue(t,"type")},input:function(t){var r=e.getName(t);return"input"===r||"textarea"===r||"select"===r||"button"===r},text:function(t){var r;return"input"===e.getName(t)&&(!(r=e.getAttributeValue(t,"type"))||"text"===r.toLowerCase())}};return t}function hl(e,t,r){if(null===r){if(e.length>1&&"scope"!==t)throw new Error("pseudo-selector :"+t+" requires an argument")}else if(1===e.length)throw new Error("pseudo-selector :"+t+" doesn't have any arguments")}var dl=/^(?:(?:nth|last|first|only)-(?:child|of-type)|root|empty|(?:en|dis)abled|checked|not)$/;var ul=function(e){var t=cl(e),r=ll(e);return{compile:function(e,n,s,i){var o=n.name,a=n.data;if(s&&s.strict&&!dl.test(o))throw new Error(":"+o+" isn't part of CSS3");if("function"==typeof r[o])return hl(r[o],o,a),r[o](e,a,s,i);if("function"==typeof t[o]){var l=t[o];return hl(l,o,a),e===ol?l:function(t){return l(t,a)&&e(t)}}throw new Error("unmatched pseudo-class :"+o)},filters:r,pseudos:t}},pl=function(e){var t=ul(e),r=t.filters,n=il(e,t);function s(e,t,r){var n=o(e,t,r);return i(n)}function i(t){return function(r){return e.isTag(r)&&t(r)}}function o(e,t,r){var n=Ca(e,t);return u(n,t,r)}function a(e){return"pseudo"===e.type&&("scope"===e.name||Array.isArray(e.data)&&e.data.some(function(e){return e.some(a)}))}var l={type:"descendant"},c={type:"_flexibleDescendant"},h={type:"pseudo",name:"scope"},d={};function u(t,r,s){(t=t.filter(function(e){return e.length>0})).forEach(Qa);var i=Array.isArray(s);(s=r&&r.context||s)&&!i&&(s=[s]),function(t,r){var n=!!r&&!!r.length&&r.every(function(t){return t===d||!!e.getParent(t)});t.forEach(function(e){if(e.length>0&&p(e[0])&&"descendant"!==e[0].type);else{if(!n||a(e))return;e.unshift(l)}e.unshift(h)})}(t,s);var o=!1,u=t.map(function(e){if(e[0]&&e[1]&&"scope"===e[0].name){var t=e[1].type;i&&"descendant"===t?e[1]=c:"adjacent"!==t&&"sibling"!==t||(o=!0)}return function(e,t,r){return e.reduce(function(e,s){return e===gl?e:n[s.type](e,s,t,r)},t&&t.rootFunc||fl)}(e,r,s)}).reduce(f,gl);return u.shouldTestNextSiblings=o,u}function p(e){return Za[e.type]<0}function f(e,t){return t===gl||e===fl?e:e===gl||t===fl?t:function(r){return e(r)||t(r)}}function g(e){return e.some(p)}return r.not=function(e,t,r,n){var s={xmlMode:!(!r||!r.xmlMode),strict:!(!r||!r.strict)};if(s.strict&&(t.length>1||t.some(g)))throw new Error("complex selectors in :not aren't allowed in strict mode");var i=u(t,s,n);return i===gl?e:i===fl?gl:function(t){return!i(t)&&e(t)}},r.has=function(t,r,n){var s={xmlMode:!(!n||!n.xmlMode),strict:!(!n||!n.strict)},o=r.some(g)?[d]:null,a=u(r,s,o);return a===gl?gl:a===fl?function(r){return e.getChildren(r).some(e.isTag)&&t(r)}:(a=i(a),o?function(r){return t(r)&&(o[0]=r,e.existsOne(a,e.getChildren(r)))}:function(r){return t(r)&&e.existsOne(a,e.getChildren(r))})},r.matches=function(e,t,r,n){return u(t,{xmlMode:!(!r||!r.xmlMode),strict:!(!r||!r.strict),rootFunc:e},n)},s.compileToken=u,s.compileUnsafe=o,s.Pseudos=t,s},fl=ua,gl=pa;var ml=xl,_l=pa,yl=pl(Xa);function wl(e){return e.__compile__||(e.__compile__=pl(e)),e.__compile__}function bl(e){return function(t,r,n){(n=n||{}).adapter=n.adapter||Xa;var s=wl(n.adapter);return"function"!=typeof t&&(t=s.compileUnsafe(t,n,r)),t.shouldTestNextSiblings&&(r=function(e,t){Array.isArray(e)||(e=[e]);for(var r=e.slice(0),n=0,s=e.length;n<s;n++){var i=vl(r[n],t);r.push.apply(r,i)}return r}(n&&n.context||r,n.adapter)),r=Array.isArray(r)?n.adapter.removeSubsets(r):n.adapter.getChildren(r),e(t,r,n)}}function vl(e,t){var r=t.getSiblings(e);if(!Array.isArray(r))return[];for(r=r.slice(0);r.shift()!==e;);return r}var Cl=bl(function(e,t,r){return e!==_l&&t&&0!==t.length?r.adapter.findAll(e,t):[]}),Sl=bl(function(e,t,r){return e!==_l&&t&&0!==t.length?r.adapter.findOne(e,t):null});function xl(e,t,r){return Cl(e,t,r)}xl.compile=yl,xl.filters=yl.Pseudos.filters,xl.pseudos=yl.Pseudos.pseudos,xl.selectAll=Cl,xl.selectOne=Sl,xl.is=function(e,t,r){(r=r||{}).adapter=r.adapter||Xa;var n=wl(r.adapter);return("function"==typeof t?t:n(t,r))(e)},xl.parse=yl,xl.iterate=Cl,xl._compileUnsafe=yl.compileUnsafe,xl._compileToken=yl.compileToken;var El={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'},Nl=Object.freeze({amp:"&",apos:"'",gt:">",lt:"<",quot:'"',default:El}),Tl={Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",amp:"&",AMP:"&",andand:"⩕",And:"⩓",and:"∧",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angmsd:"∡",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",apacir:"⩯",ap:"≈",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",barwed:"⌅",Barwed:"⌆",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",because:"∵",Because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxdl:"┐",boxdL:"╕",boxDl:"╖",boxDL:"╗",boxdr:"┌",boxdR:"╒",boxDr:"╓",boxDR:"╔",boxh:"─",boxH:"═",boxhd:"┬",boxHd:"╤",boxhD:"╥",boxHD:"╦",boxhu:"┴",boxHu:"╧",boxhU:"╨",boxHU:"╩",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxul:"┘",boxuL:"╛",boxUl:"╜",boxUL:"╝",boxur:"└",boxuR:"╘",boxUr:"╙",boxUR:"╚",boxv:"│",boxV:"║",boxvh:"┼",boxvH:"╪",boxVh:"╫",boxVH:"╬",boxvl:"┤",boxvL:"╡",boxVl:"╢",boxVL:"╣",boxvr:"├",boxvR:"╞",boxVr:"╟",boxVR:"╠",bprime:"‵",breve:"˘",Breve:"˘",brvbar:"¦",bscr:"𝒷",Bscr:"ℬ",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsolb:"⧅",bsol:"\\",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",capand:"⩄",capbrcup:"⩉",capcap:"⩋",cap:"∩",Cap:"⋒",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",centerdot:"·",CenterDot:"·",cfr:"𝔠",Cfr:"ℭ",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cir:"○",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",colon:":",Colon:"∷",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",conint:"∮",Conint:"∯",ContourIntegral:"∮",copf:"𝕔",Copf:"ℂ",coprod:"∐",Coproduct:"∐",copy:"©",COPY:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",cross:"✗",Cross:"⨯",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",cupbrcap:"⩈",cupcap:"⩆",CupCap:"≍",cup:"∪",Cup:"⋓",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",dagger:"†",Dagger:"‡",daleth:"ℸ",darr:"↓",Darr:"↡",dArr:"⇓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",ddagger:"‡",ddarr:"⇊",DD:"ⅅ",dd:"ⅆ",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",diamond:"⋄",Diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrowBar:"⤓",downarrow:"↓",DownArrow:"↓",Downarrow:"⇓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVectorBar:"⥖",DownLeftVector:"↽",DownRightTeeVector:"⥟",DownRightVectorBar:"⥗",DownRightVector:"⇁",DownTeeArrow:"↧",DownTee:"⊤",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",Ecirc:"Ê",ecirc:"ê",ecir:"≖",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",edot:"ė",eDot:"≑",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp13:" ",emsp14:" ",emsp:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",escr:"ℯ",Escr:"ℰ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",exponentiale:"ⅇ",ExponentialE:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",forall:"∀",ForAll:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",fscr:"𝒻",Fscr:"ℱ",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",ge:"≥",gE:"≧",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",gescc:"⪩",ges:"⩾",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",gg:"≫",Gg:"⋙",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gla:"⪥",gl:"≷",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gne:"⪈",gnE:"≩",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",gtcc:"⪧",gtcir:"⩺",gt:">",GT:">",Gt:"≫",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",harrcir:"⥈",harr:"↔",hArr:"⇔",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",hfr:"𝔥",Hfr:"ℌ",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",hopf:"𝕙",Hopf:"ℍ",horbar:"―",HorizontalLine:"─",hscr:"𝒽",Hscr:"ℋ",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",ifr:"𝔦",Ifr:"ℑ",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",Im:"ℑ",imof:"⊷",imped:"Ƶ",Implies:"⇒",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",intcal:"⊺",int:"∫",Int:"∬",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",iscr:"𝒾",Iscr:"ℐ",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",lang:"⟨",Lang:"⟪",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",larrb:"⇤",larrbfs:"⤟",larr:"←",Larr:"↞",lArr:"⇐",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",latail:"⤙",lAtail:"⤛",lat:"⪫",late:"⪭",lates:"⪭︀",lbarr:"⤌",lBarr:"⤎",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",le:"≤",lE:"≦",LeftAngleBracket:"⟨",LeftArrowBar:"⇤",leftarrow:"←",LeftArrow:"←",Leftarrow:"⇐",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVectorBar:"⥙",LeftDownVector:"⇃",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",leftrightarrow:"↔",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTeeArrow:"↤",LeftTee:"⊣",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangleBar:"⧏",LeftTriangle:"⊲",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVectorBar:"⥘",LeftUpVector:"↿",LeftVectorBar:"⥒",LeftVector:"↼",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",lescc:"⪨",les:"⩽",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",llarr:"⇇",ll:"≪",Ll:"⋘",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoustache:"⎰",lmoust:"⎰",lnap:"⪉",lnapprox:"⪉",lne:"⪇",lnE:"≨",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",longleftarrow:"⟵",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftrightarrow:"⟷",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longmapsto:"⟼",longrightarrow:"⟶",LongRightArrow:"⟶",Longrightarrow:"⟹",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",lscr:"𝓁",Lscr:"ℒ",lsh:"↰",Lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",ltcc:"⪦",ltcir:"⩹",lt:"<",LT:"<",Lt:"≪",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",midast:"*",midcir:"⫰",mid:"∣",middot:"·",minusb:"⊟",minus:"−",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",mscr:"𝓂",Mscr:"ℳ",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natural:"♮",naturals:"ℕ",natur:"♮",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",nearhk:"⤤",nearr:"↗",neArr:"⇗",nearrow:"↗",ne:"≠",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nharr:"↮",nhArr:"⇎",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlarr:"↚",nlArr:"⇍",nldr:"‥",nlE:"≦̸",nle:"≰",nleftarrow:"↚",nLeftarrow:"⇍",nleftrightarrow:"↮",nLeftrightarrow:"⇎",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",nopf:"𝕟",Nopf:"ℕ",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangleBar:"⧏̸",NotLeftTriangle:"⋪",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangleBar:"⧐̸",NotRightTriangle:"⋫",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",nparallel:"∦",npar:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",nprec:"⊀",npreceq:"⪯̸",npre:"⪯̸",nrarrc:"⤳̸",nrarr:"↛",nrArr:"⇏",nrarrw:"↝̸",nrightarrow:"↛",nRightarrow:"⇏",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwarr:"↖",nwArr:"⇖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",Ocirc:"Ô",ocirc:"ô",ocir:"⊚",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",orarr:"↻",Or:"⩔",or:"∨",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",otimesas:"⨶",Otimes:"⨷",otimes:"⊗",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",para:"¶",parallel:"∥",par:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plus:"+",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",popf:"𝕡",Popf:"ℙ",pound:"£",prap:"⪷",Pr:"⪻",pr:"≺",prcue:"≼",precapprox:"⪷",prec:"≺",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",pre:"⪯",prE:"⪳",precsim:"≾",prime:"′",Prime:"″",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportional:"∝",Proportion:"∷",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",qopf:"𝕢",Qopf:"ℚ",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",quot:'"',QUOT:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",rang:"⟩",Rang:"⟫",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarr:"→",Rarr:"↠",rArr:"⇒",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",ratail:"⤚",rAtail:"⤜",ratio:"∶",rationals:"ℚ",rbarr:"⤍",rBarr:"⤏",RBarr:"⤐",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",Re:"ℜ",rect:"▭",reg:"®",REG:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",rfr:"𝔯",Rfr:"ℜ",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrowBar:"⇥",rightarrow:"→",RightArrow:"→",Rightarrow:"⇒",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVectorBar:"⥕",RightDownVector:"⇂",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTeeArrow:"↦",RightTee:"⊢",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangleBar:"⧐",RightTriangle:"⊳",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVectorBar:"⥔",RightUpVector:"↾",RightVectorBar:"⥓",RightVector:"⇀",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoustache:"⎱",rmoust:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",ropf:"𝕣",Ropf:"ℝ",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",rscr:"𝓇",Rscr:"ℛ",rsh:"↱",Rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",scap:"⪸",Scaron:"Š",scaron:"š",Sc:"⪼",sc:"≻",sccue:"≽",sce:"⪰",scE:"⪴",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdotb:"⊡",sdot:"⋅",sdote:"⩦",searhk:"⤥",searr:"↘",seArr:"⇘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",solbar:"⌿",solb:"⧄",sol:"/",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",square:"□",Square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squ:"□",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",sub:"⊂",Sub:"⋐",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",subset:"⊂",Subset:"⋐",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succapprox:"⪸",succ:"≻",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",sum:"∑",Sum:"∑",sung:"♪",sup1:"¹",sup2:"²",sup3:"³",sup:"⊃",Sup:"⋑",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",supset:"⊃",Supset:"⋑",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swarr:"↙",swArr:"⇙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"\t",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",therefore:"∴",Therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",ThinSpace:" ",thinsp:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",tilde:"˜",Tilde:"∼",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",timesbar:"⨱",timesb:"⊠",times:"×",timesd:"⨰",tint:"∭",toea:"⤨",topbot:"⌶",topcir:"⫱",top:"⊤",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",trade:"™",TRADE:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",uarr:"↑",Uarr:"↟",uArr:"⇑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrowBar:"⤒",uparrow:"↑",UpArrow:"↑",Uparrow:"⇑",UpArrowDownArrow:"⇅",updownarrow:"↕",UpDownArrow:"↕",Updownarrow:"⇕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",upsi:"υ",Upsi:"ϒ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTeeArrow:"↥",UpTee:"⊥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",varr:"↕",vArr:"⇕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",vBar:"⫨",Vbar:"⫫",vBarv:"⫩",Vcy:"В",vcy:"в",vdash:"⊢",vDash:"⊨",Vdash:"⊩",VDash:"⊫",Vdashl:"⫦",veebar:"⊻",vee:"∨",Vee:"⋁",veeeq:"≚",vellip:"⋮",verbar:"|",Verbar:"‖",vert:"|",Vert:"‖",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",wedge:"∧",Wedge:"⋀",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xharr:"⟷",xhArr:"⟺",Xi:"Ξ",xi:"ξ",xlarr:"⟵",xlArr:"⟸",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrarr:"⟶",xrArr:"⟹",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",yuml:"ÿ",Yuml:"Ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",zfr:"𝔷",Zfr:"ℨ",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",zopf:"𝕫",Zopf:"ℤ",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌",in:"∈",Map:"⤅"},Pl=Object.freeze({Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",amp:"&",AMP:"&",andand:"⩕",And:"⩓",and:"∧",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angmsd:"∡",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",apacir:"⩯",ap:"≈",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",barwed:"⌅",Barwed:"⌆",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",because:"∵",Because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxdl:"┐",boxdL:"╕",boxDl:"╖",boxDL:"╗",boxdr:"┌",boxdR:"╒",boxDr:"╓",boxDR:"╔",boxh:"─",boxH:"═",boxhd:"┬",boxHd:"╤",boxhD:"╥",boxHD:"╦",boxhu:"┴",boxHu:"╧",boxhU:"╨",boxHU:"╩",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxul:"┘",boxuL:"╛",boxUl:"╜",boxUL:"╝",boxur:"└",boxuR:"╘",boxUr:"╙",boxUR:"╚",boxv:"│",boxV:"║",boxvh:"┼",boxvH:"╪",boxVh:"╫",boxVH:"╬",boxvl:"┤",boxvL:"╡",boxVl:"╢",boxVL:"╣",boxvr:"├",boxvR:"╞",boxVr:"╟",boxVR:"╠",bprime:"‵",breve:"˘",Breve:"˘",brvbar:"¦",bscr:"𝒷",Bscr:"ℬ",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsolb:"⧅",bsol:"\\",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",capand:"⩄",capbrcup:"⩉",capcap:"⩋",cap:"∩",Cap:"⋒",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",centerdot:"·",CenterDot:"·",cfr:"𝔠",Cfr:"ℭ",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cir:"○",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",colon:":",Colon:"∷",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",conint:"∮",Conint:"∯",ContourIntegral:"∮",copf:"𝕔",Copf:"ℂ",coprod:"∐",Coproduct:"∐",copy:"©",COPY:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",cross:"✗",Cross:"⨯",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",cupbrcap:"⩈",cupcap:"⩆",CupCap:"≍",cup:"∪",Cup:"⋓",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",dagger:"†",Dagger:"‡",daleth:"ℸ",darr:"↓",Darr:"↡",dArr:"⇓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",ddagger:"‡",ddarr:"⇊",DD:"ⅅ",dd:"ⅆ",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",diamond:"⋄",Diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrowBar:"⤓",downarrow:"↓",DownArrow:"↓",Downarrow:"⇓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVectorBar:"⥖",DownLeftVector:"↽",DownRightTeeVector:"⥟",DownRightVectorBar:"⥗",DownRightVector:"⇁",DownTeeArrow:"↧",DownTee:"⊤",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",Ecirc:"Ê",ecirc:"ê",ecir:"≖",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",edot:"ė",eDot:"≑",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp13:" ",emsp14:" ",emsp:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",escr:"ℯ",Escr:"ℰ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",exponentiale:"ⅇ",ExponentialE:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",forall:"∀",ForAll:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",fscr:"𝒻",Fscr:"ℱ",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",ge:"≥",gE:"≧",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",gescc:"⪩",ges:"⩾",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",gg:"≫",Gg:"⋙",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gla:"⪥",gl:"≷",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gne:"⪈",gnE:"≩",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",gtcc:"⪧",gtcir:"⩺",gt:">",GT:">",Gt:"≫",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",harrcir:"⥈",harr:"↔",hArr:"⇔",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",hfr:"𝔥",Hfr:"ℌ",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",hopf:"𝕙",Hopf:"ℍ",horbar:"―",HorizontalLine:"─",hscr:"𝒽",Hscr:"ℋ",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",ifr:"𝔦",Ifr:"ℑ",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",Im:"ℑ",imof:"⊷",imped:"Ƶ",Implies:"⇒",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",intcal:"⊺",int:"∫",Int:"∬",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",iscr:"𝒾",Iscr:"ℐ",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",lang:"⟨",Lang:"⟪",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",larrb:"⇤",larrbfs:"⤟",larr:"←",Larr:"↞",lArr:"⇐",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",latail:"⤙",lAtail:"⤛",lat:"⪫",late:"⪭",lates:"⪭︀",lbarr:"⤌",lBarr:"⤎",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",le:"≤",lE:"≦",LeftAngleBracket:"⟨",LeftArrowBar:"⇤",leftarrow:"←",LeftArrow:"←",Leftarrow:"⇐",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVectorBar:"⥙",LeftDownVector:"⇃",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",leftrightarrow:"↔",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTeeArrow:"↤",LeftTee:"⊣",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangleBar:"⧏",LeftTriangle:"⊲",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVectorBar:"⥘",LeftUpVector:"↿",LeftVectorBar:"⥒",LeftVector:"↼",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",lescc:"⪨",les:"⩽",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",llarr:"⇇",ll:"≪",Ll:"⋘",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoustache:"⎰",lmoust:"⎰",lnap:"⪉",lnapprox:"⪉",lne:"⪇",lnE:"≨",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",longleftarrow:"⟵",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftrightarrow:"⟷",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longmapsto:"⟼",longrightarrow:"⟶",LongRightArrow:"⟶",Longrightarrow:"⟹",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",lscr:"𝓁",Lscr:"ℒ",lsh:"↰",Lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",ltcc:"⪦",ltcir:"⩹",lt:"<",LT:"<",Lt:"≪",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",midast:"*",midcir:"⫰",mid:"∣",middot:"·",minusb:"⊟",minus:"−",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",mscr:"𝓂",Mscr:"ℳ",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natural:"♮",naturals:"ℕ",natur:"♮",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",nearhk:"⤤",nearr:"↗",neArr:"⇗",nearrow:"↗",ne:"≠",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nharr:"↮",nhArr:"⇎",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlarr:"↚",nlArr:"⇍",nldr:"‥",nlE:"≦̸",nle:"≰",nleftarrow:"↚",nLeftarrow:"⇍",nleftrightarrow:"↮",nLeftrightarrow:"⇎",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",nopf:"𝕟",Nopf:"ℕ",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangleBar:"⧏̸",NotLeftTriangle:"⋪",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangleBar:"⧐̸",NotRightTriangle:"⋫",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",nparallel:"∦",npar:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",nprec:"⊀",npreceq:"⪯̸",npre:"⪯̸",nrarrc:"⤳̸",nrarr:"↛",nrArr:"⇏",nrarrw:"↝̸",nrightarrow:"↛",nRightarrow:"⇏",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwarr:"↖",nwArr:"⇖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",Ocirc:"Ô",ocirc:"ô",ocir:"⊚",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",orarr:"↻",Or:"⩔",or:"∨",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",otimesas:"⨶",Otimes:"⨷",otimes:"⊗",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",para:"¶",parallel:"∥",par:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plus:"+",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",popf:"𝕡",Popf:"ℙ",pound:"£",prap:"⪷",Pr:"⪻",pr:"≺",prcue:"≼",precapprox:"⪷",prec:"≺",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",pre:"⪯",prE:"⪳",precsim:"≾",prime:"′",Prime:"″",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportional:"∝",Proportion:"∷",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",qopf:"𝕢",Qopf:"ℚ",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",quot:'"',QUOT:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",rang:"⟩",Rang:"⟫",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarr:"→",Rarr:"↠",rArr:"⇒",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",ratail:"⤚",rAtail:"⤜",ratio:"∶",rationals:"ℚ",rbarr:"⤍",rBarr:"⤏",RBarr:"⤐",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",Re:"ℜ",rect:"▭",reg:"®",REG:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",rfr:"𝔯",Rfr:"ℜ",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrowBar:"⇥",rightarrow:"→",RightArrow:"→",Rightarrow:"⇒",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVectorBar:"⥕",RightDownVector:"⇂",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTeeArrow:"↦",RightTee:"⊢",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangleBar:"⧐",RightTriangle:"⊳",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVectorBar:"⥔",RightUpVector:"↾",RightVectorBar:"⥓",RightVector:"⇀",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoustache:"⎱",rmoust:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",ropf:"𝕣",Ropf:"ℝ",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",rscr:"𝓇",Rscr:"ℛ",rsh:"↱",Rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",scap:"⪸",Scaron:"Š",scaron:"š",Sc:"⪼",sc:"≻",sccue:"≽",sce:"⪰",scE:"⪴",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdotb:"⊡",sdot:"⋅",sdote:"⩦",searhk:"⤥",searr:"↘",seArr:"⇘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",solbar:"⌿",solb:"⧄",sol:"/",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",square:"□",Square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squ:"□",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",sub:"⊂",Sub:"⋐",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",subset:"⊂",Subset:"⋐",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succapprox:"⪸",succ:"≻",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",sum:"∑",Sum:"∑",sung:"♪",sup1:"¹",sup2:"²",sup3:"³",sup:"⊃",Sup:"⋑",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",supset:"⊃",Supset:"⋑",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swarr:"↙",swArr:"⇙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"\t",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",therefore:"∴",Therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",ThinSpace:" ",thinsp:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",tilde:"˜",Tilde:"∼",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",timesbar:"⨱",timesb:"⊠",times:"×",timesd:"⨰",tint:"∭",toea:"⤨",topbot:"⌶",topcir:"⫱",top:"⊤",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",trade:"™",TRADE:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",uarr:"↑",Uarr:"↟",uArr:"⇑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrowBar:"⤒",uparrow:"↑",UpArrow:"↑",Uparrow:"⇑",UpArrowDownArrow:"⇅",updownarrow:"↕",UpDownArrow:"↕",Updownarrow:"⇕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",upsi:"υ",Upsi:"ϒ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTeeArrow:"↥",UpTee:"⊥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",varr:"↕",vArr:"⇕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",vBar:"⫨",Vbar:"⫫",vBarv:"⫩",Vcy:"В",vcy:"в",vdash:"⊢",vDash:"⊨",Vdash:"⊩",VDash:"⊫",Vdashl:"⫦",veebar:"⊻",vee:"∨",Vee:"⋁",veeeq:"≚",vellip:"⋮",verbar:"|",Verbar:"‖",vert:"|",Vert:"‖",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",wedge:"∧",Wedge:"⋀",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xharr:"⟷",xhArr:"⟺",Xi:"Ξ",xi:"ξ",xlarr:"⟵",xlArr:"⟸",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrarr:"⟶",xrArr:"⟹",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",yuml:"ÿ",Yuml:"Ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",zfr:"𝔷",Zfr:"ℨ",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",zopf:"𝕫",Zopf:"ℤ",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌",default:Tl}),Dl=Pl&&Tl||Pl,Il=Ml(Nl&&El||Nl),Al=jl(Il,Ll(Il)),Ol=Ml(Dl),kl=jl(Ol,Ll(Ol));function Ml(e){return Object.keys(e).sort().reduce(function(t,r){return t[e[r]]="&"+r+";",t},{})}function Ll(e){var t=[],r=[];return Object.keys(e).forEach(function(e){1===e.length?t.push("\\"+e):r.push(e)}),r.unshift("["+t.join("")+"]"),new RegExp(r.join("|"),"g")}var Rl=/[^\0-\x7F]/g,ql=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;function Bl(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"}function Fl(e){return"&#x"+(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)-56320+65536).toString(16).toUpperCase()+";"}function jl(e,t){function r(t){return e[t]}return function(e){return e.replace(t,r).replace(ql,Fl).replace(Rl,Bl)}}var Hl=Ll(Il);var Ul={XML:Al,HTML:kl,escape:function(e){return e.replace(Hl,Bl).replace(ql,Fl).replace(Rl,Bl)}},zl={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376},Vl=Object.freeze({default:zl}),Gl=Vl&&zl||Vl;var Jl,Kl,$l={encodeXML:Ul.XML,decodeCodepoint:function(e){if(e>=55296&&e<=57343||e>1114111)return"�";e in Gl&&(e=Gl[e]);var t="";e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e);return t+=String.fromCharCode(e)},entitiesJSON:Tl,legacyJSON:{Aacute:"Á",aacute:"á",Acirc:"Â",acirc:"â",acute:"´",AElig:"Æ",aelig:"æ",Agrave:"À",agrave:"à",amp:"&",AMP:"&",Aring:"Å",aring:"å",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",brvbar:"¦",Ccedil:"Ç",ccedil:"ç",cedil:"¸",cent:"¢",copy:"©",COPY:"©",curren:"¤",deg:"°",divide:"÷",Eacute:"É",eacute:"é",Ecirc:"Ê",ecirc:"ê",Egrave:"È",egrave:"è",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",frac12:"½",frac14:"¼",frac34:"¾",gt:">",GT:">",Iacute:"Í",iacute:"í",Icirc:"Î",icirc:"î",iexcl:"¡",Igrave:"Ì",igrave:"ì",iquest:"¿",Iuml:"Ï",iuml:"ï",laquo:"«",lt:"<",LT:"<",macr:"¯",micro:"µ",middot:"·",nbsp:" ",not:"¬",Ntilde:"Ñ",ntilde:"ñ",Oacute:"Ó",oacute:"ó",Ocirc:"Ô",ocirc:"ô",Ograve:"Ò",ograve:"ò",ordf:"ª",ordm:"º",Oslash:"Ø",oslash:"ø",Otilde:"Õ",otilde:"õ",Ouml:"Ö",ouml:"ö",para:"¶",plusmn:"±",pound:"£",quot:'"',QUOT:'"',raquo:"»",reg:"®",REG:"®",sect:"§",shy:"­",sup1:"¹",sup2:"²",sup3:"³",szlig:"ß",THORN:"Þ",thorn:"þ",times:"×",Uacute:"Ú",uacute:"ú",Ucirc:"Û",ucirc:"û",Ugrave:"Ù",ugrave:"ù",uml:"¨",Uuml:"Ü",uuml:"ü",Yacute:"Ý",yacute:"ý",yen:"¥",yuml:"ÿ"},xmlJSON:El},Xl=$l.decodeCodepoint,Wl=Object.freeze({default:Xl}),Yl=$l.entitiesJSON,Zl=Object.freeze({default:Yl}),Ql=$l.legacyJSON,ec=Object.freeze({default:Ql}),tc=$l.xmlJSON,rc=Object.freeze({default:tc}),nc=Wl&&Xl||Wl,sc=Zl&&Yl||Zl,ic=ec&&Ql||ec,oc=rc&&tc||rc,ac=_h,lc=0,cc=lc++,hc=lc++,dc=lc++,uc=lc++,pc=lc++,fc=lc++,gc=lc++,mc=lc++,_c=lc++,yc=lc++,wc=lc++,bc=lc++,vc=lc++,Cc=lc++,Sc=lc++,xc=lc++,Ec=lc++,Nc=lc++,Tc=lc++,Pc=lc++,Dc=lc++,Ic=lc++,Ac=lc++,Oc=lc++,kc=lc++,Mc=lc++,Lc=lc++,Rc=lc++,qc=lc++,Bc=lc++,Fc=lc++,jc=lc++,Hc=lc++,Uc=lc++,zc=lc++,Vc=lc++,Gc=lc++,Jc=lc++,Kc=lc++,$c=lc++,Xc=lc++,Wc=lc++,Yc=lc++,Zc=lc++,Qc=lc++,eh=lc++,th=lc++,rh=lc++,nh=lc++,sh=lc++,ih=lc++,oh=lc++,ah=lc++,lh=lc++,ch=lc++,hh=0,dh=hh++,uh=hh++,ph=hh++;function fh(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function gh(e,t,r){var n=e.toLowerCase();return e===n?function(e){e===n?this._state=t:(this._state=r,this._index--)}:function(s){s===n||s===e?this._state=t:(this._state=r,this._index--)}}function mh(e,t){var r=e.toLowerCase();return function(n){n===r||n===e?this._state=t:(this._state=dc,this._index--)}}function _h(e,t){this._state=cc,this._buffer="",this._sectionStart=0,this._index=0,this._bufferOffset=0,this._baseState=cc,this._special=dh,this._cbs=t,this._running=!0,this._ended=!1,this._xmlMode=!(!e||!e.xmlMode),this._decodeEntities=!(!e||!e.decodeEntities)}_h.prototype._stateText=function(e){"<"===e?(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._state=hc,this._sectionStart=this._index):this._decodeEntities&&this._special===dh&&"&"===e&&(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._baseState=cc,this._state=ih,this._sectionStart=this._index)},_h.prototype._stateBeforeTagName=function(e){"/"===e?this._state=pc:"<"===e?(this._cbs.ontext(this._getSection()),this._sectionStart=this._index):">"===e||this._special!==dh||fh(e)?this._state=cc:"!"===e?(this._state=Sc,this._sectionStart=this._index+1):"?"===e?(this._state=Ec,this._sectionStart=this._index+1):(this._state=this._xmlMode||"s"!==e&&"S"!==e?dc:Fc,this._sectionStart=this._index)},_h.prototype._stateInTagName=function(e){("/"===e||">"===e||fh(e))&&(this._emitToken("onopentagname"),this._state=mc,this._index--)},_h.prototype._stateBeforeCloseingTagName=function(e){fh(e)||(">"===e?this._state=cc:this._special!==dh?"s"===e||"S"===e?this._state=jc:(this._state=cc,this._index--):(this._state=fc,this._sectionStart=this._index))},_h.prototype._stateInCloseingTagName=function(e){(">"===e||fh(e))&&(this._emitToken("onclosetag"),this._state=gc,this._index--)},_h.prototype._stateAfterCloseingTagName=function(e){">"===e&&(this._state=cc,this._sectionStart=this._index+1)},_h.prototype._stateBeforeAttributeName=function(e){">"===e?(this._cbs.onopentagend(),this._state=cc,this._sectionStart=this._index+1):"/"===e?this._state=uc:fh(e)||(this._state=_c,this._sectionStart=this._index)},_h.prototype._stateInSelfClosingTag=function(e){">"===e?(this._cbs.onselfclosingtag(),this._state=cc,this._sectionStart=this._index+1):fh(e)||(this._state=mc,this._index--)},_h.prototype._stateInAttributeName=function(e){("="===e||"/"===e||">"===e||fh(e))&&(this._cbs.onattribname(this._getSection()),this._sectionStart=-1,this._state=yc,this._index--)},_h.prototype._stateAfterAttributeName=function(e){"="===e?this._state=wc:"/"===e||">"===e?(this._cbs.onattribend(),this._state=mc,this._index--):fh(e)||(this._cbs.onattribend(),this._state=_c,this._sectionStart=this._index)},_h.prototype._stateBeforeAttributeValue=function(e){'"'===e?(this._state=bc,this._sectionStart=this._index+1):"'"===e?(this._state=vc,this._sectionStart=this._index+1):fh(e)||(this._state=Cc,this._sectionStart=this._index,this._index--)},_h.prototype._stateInAttributeValueDoubleQuotes=function(e){'"'===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=mc):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=ih,this._sectionStart=this._index)},_h.prototype._stateInAttributeValueSingleQuotes=function(e){"'"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=mc):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=ih,this._sectionStart=this._index)},_h.prototype._stateInAttributeValueNoQuotes=function(e){fh(e)||">"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=mc,this._index--):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=ih,this._sectionStart=this._index)},_h.prototype._stateBeforeDeclaration=function(e){this._state="["===e?Ic:"-"===e?Nc:xc},_h.prototype._stateInDeclaration=function(e){">"===e&&(this._cbs.ondeclaration(this._getSection()),this._state=cc,this._sectionStart=this._index+1)},_h.prototype._stateInProcessingInstruction=function(e){">"===e&&(this._cbs.onprocessinginstruction(this._getSection()),this._state=cc,this._sectionStart=this._index+1)},_h.prototype._stateBeforeComment=function(e){"-"===e?(this._state=Tc,this._sectionStart=this._index+1):this._state=xc},_h.prototype._stateInComment=function(e){"-"===e&&(this._state=Pc)},_h.prototype._stateAfterComment1=function(e){this._state="-"===e?Dc:Tc},_h.prototype._stateAfterComment2=function(e){">"===e?(this._cbs.oncomment(this._buffer.substring(this._sectionStart,this._index-2)),this._state=cc,this._sectionStart=this._index+1):"-"!==e&&(this._state=Tc)},_h.prototype._stateBeforeCdata1=gh("C",Ac,xc),_h.prototype._stateBeforeCdata2=gh("D",Oc,xc),_h.prototype._stateBeforeCdata3=gh("A",kc,xc),_h.prototype._stateBeforeCdata4=gh("T",Mc,xc),_h.prototype._stateBeforeCdata5=gh("A",Lc,xc),_h.prototype._stateBeforeCdata6=function(e){"["===e?(this._state=Rc,this._sectionStart=this._index+1):(this._state=xc,this._index--)},_h.prototype._stateInCdata=function(e){"]"===e&&(this._state=qc)},_h.prototype._stateAfterCdata1=(Jl="]",Kl=Bc,function(e){e===Jl&&(this._state=Kl)}),_h.prototype._stateAfterCdata2=function(e){">"===e?(this._cbs.oncdata(this._buffer.substring(this._sectionStart,this._index-2)),this._state=cc,this._sectionStart=this._index+1):"]"!==e&&(this._state=Rc)},_h.prototype._stateBeforeSpecial=function(e){"c"===e||"C"===e?this._state=Hc:"t"===e||"T"===e?this._state=Yc:(this._state=dc,this._index--)},_h.prototype._stateBeforeSpecialEnd=function(e){this._special!==uh||"c"!==e&&"C"!==e?this._special!==ph||"t"!==e&&"T"!==e?this._state=cc:this._state=th:this._state=Jc},_h.prototype._stateBeforeScript1=mh("R",Uc),_h.prototype._stateBeforeScript2=mh("I",zc),_h.prototype._stateBeforeScript3=mh("P",Vc),_h.prototype._stateBeforeScript4=mh("T",Gc),_h.prototype._stateBeforeScript5=function(e){("/"===e||">"===e||fh(e))&&(this._special=uh),this._state=dc,this._index--},_h.prototype._stateAfterScript1=gh("R",Kc,cc),_h.prototype._stateAfterScript2=gh("I",$c,cc),_h.prototype._stateAfterScript3=gh("P",Xc,cc),_h.prototype._stateAfterScript4=gh("T",Wc,cc),_h.prototype._stateAfterScript5=function(e){">"===e||fh(e)?(this._special=dh,this._state=fc,this._sectionStart=this._index-6,this._index--):this._state=cc},_h.prototype._stateBeforeStyle1=mh("Y",Zc),_h.prototype._stateBeforeStyle2=mh("L",Qc),_h.prototype._stateBeforeStyle3=mh("E",eh),_h.prototype._stateBeforeStyle4=function(e){("/"===e||">"===e||fh(e))&&(this._special=ph),this._state=dc,this._index--},_h.prototype._stateAfterStyle1=gh("Y",rh,cc),_h.prototype._stateAfterStyle2=gh("L",nh,cc),_h.prototype._stateAfterStyle3=gh("E",sh,cc),_h.prototype._stateAfterStyle4=function(e){">"===e||fh(e)?(this._special=dh,this._state=fc,this._sectionStart=this._index-5,this._index--):this._state=cc},_h.prototype._stateBeforeEntity=gh("#",oh,ah),_h.prototype._stateBeforeNumericEntity=gh("X",ch,lh),_h.prototype._parseNamedEntityStrict=function(){if(this._sectionStart+1<this._index){var e=this._buffer.substring(this._sectionStart+1,this._index),t=this._xmlMode?oc:sc;t.hasOwnProperty(e)&&(this._emitPartial(t[e]),this._sectionStart=this._index+1)}},_h.prototype._parseLegacyEntity=function(){var e=this._sectionStart+1,t=this._index-e;for(t>6&&(t=6);t>=2;){var r=this._buffer.substr(e,t);if(ic.hasOwnProperty(r))return this._emitPartial(ic[r]),void(this._sectionStart+=t+1);t--}},_h.prototype._stateInNamedEntity=function(e){";"===e?(this._parseNamedEntityStrict(),this._sectionStart+1<this._index&&!this._xmlMode&&this._parseLegacyEntity(),this._state=this._baseState):(e<"a"||e>"z")&&(e<"A"||e>"Z")&&(e<"0"||e>"9")&&(this._xmlMode||this._sectionStart+1===this._index||(this._baseState!==cc?"="!==e&&this._parseNamedEntityStrict():this._parseLegacyEntity()),this._state=this._baseState,this._index--)},_h.prototype._decodeNumericEntity=function(e,t){var r=this._sectionStart+e;if(r!==this._index){var n=this._buffer.substring(r,this._index),s=parseInt(n,t);this._emitPartial(nc(s)),this._sectionStart=this._index}else this._sectionStart--;this._state=this._baseState},_h.prototype._stateInNumericEntity=function(e){";"===e?(this._decodeNumericEntity(2,10),this._sectionStart++):(e<"0"||e>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(2,10),this._index--)},_h.prototype._stateInHexEntity=function(e){";"===e?(this._decodeNumericEntity(3,16),this._sectionStart++):(e<"a"||e>"f")&&(e<"A"||e>"F")&&(e<"0"||e>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(3,16),this._index--)},_h.prototype._cleanup=function(){this._sectionStart<0?(this._buffer="",this._bufferOffset+=this._index,this._index=0):this._running&&(this._state===cc?(this._sectionStart!==this._index&&this._cbs.ontext(this._buffer.substr(this._sectionStart)),this._buffer="",this._bufferOffset+=this._index,this._index=0):this._sectionStart===this._index?(this._buffer="",this._bufferOffset+=this._index,this._index=0):(this._buffer=this._buffer.substr(this._sectionStart),this._index-=this._sectionStart,this._bufferOffset+=this._sectionStart),this._sectionStart=0)},_h.prototype.write=function(e){this._ended&&this._cbs.onerror(Error(".write() after done!")),this._buffer+=e,this._parse()},_h.prototype._parse=function(){for(;this._index<this._buffer.length&&this._running;){var e=this._buffer.charAt(this._index);this._state===cc?this._stateText(e):this._state===hc?this._stateBeforeTagName(e):this._state===dc?this._stateInTagName(e):this._state===pc?this._stateBeforeCloseingTagName(e):this._state===fc?this._stateInCloseingTagName(e):this._state===gc?this._stateAfterCloseingTagName(e):this._state===uc?this._stateInSelfClosingTag(e):this._state===mc?this._stateBeforeAttributeName(e):this._state===_c?this._stateInAttributeName(e):this._state===yc?this._stateAfterAttributeName(e):this._state===wc?this._stateBeforeAttributeValue(e):this._state===bc?this._stateInAttributeValueDoubleQuotes(e):this._state===vc?this._stateInAttributeValueSingleQuotes(e):this._state===Cc?this._stateInAttributeValueNoQuotes(e):this._state===Sc?this._stateBeforeDeclaration(e):this._state===xc?this._stateInDeclaration(e):this._state===Ec?this._stateInProcessingInstruction(e):this._state===Nc?this._stateBeforeComment(e):this._state===Tc?this._stateInComment(e):this._state===Pc?this._stateAfterComment1(e):this._state===Dc?this._stateAfterComment2(e):this._state===Ic?this._stateBeforeCdata1(e):this._state===Ac?this._stateBeforeCdata2(e):this._state===Oc?this._stateBeforeCdata3(e):this._state===kc?this._stateBeforeCdata4(e):this._state===Mc?this._stateBeforeCdata5(e):this._state===Lc?this._stateBeforeCdata6(e):this._state===Rc?this._stateInCdata(e):this._state===qc?this._stateAfterCdata1(e):this._state===Bc?this._stateAfterCdata2(e):this._state===Fc?this._stateBeforeSpecial(e):this._state===jc?this._stateBeforeSpecialEnd(e):this._state===Hc?this._stateBeforeScript1(e):this._state===Uc?this._stateBeforeScript2(e):this._state===zc?this._stateBeforeScript3(e):this._state===Vc?this._stateBeforeScript4(e):this._state===Gc?this._stateBeforeScript5(e):this._state===Jc?this._stateAfterScript1(e):this._state===Kc?this._stateAfterScript2(e):this._state===$c?this._stateAfterScript3(e):this._state===Xc?this._stateAfterScript4(e):this._state===Wc?this._stateAfterScript5(e):this._state===Yc?this._stateBeforeStyle1(e):this._state===Zc?this._stateBeforeStyle2(e):this._state===Qc?this._stateBeforeStyle3(e):this._state===eh?this._stateBeforeStyle4(e):this._state===th?this._stateAfterStyle1(e):this._state===rh?this._stateAfterStyle2(e):this._state===nh?this._stateAfterStyle3(e):this._state===sh?this._stateAfterStyle4(e):this._state===ih?this._stateBeforeEntity(e):this._state===oh?this._stateBeforeNumericEntity(e):this._state===ah?this._stateInNamedEntity(e):this._state===lh?this._stateInNumericEntity(e):this._state===ch?this._stateInHexEntity(e):this._cbs.onerror(Error("unknown _state"),this._state),this._index++}this._cleanup()},_h.prototype.pause=function(){this._running=!1},_h.prototype.resume=function(){this._running=!0,this._index<this._buffer.length&&this._parse(),this._ended&&this._finish()},_h.prototype.end=function(e){this._ended&&this._cbs.onerror(Error(".end() after done!")),e&&this.write(e),this._ended=!0,this._running&&this._finish()},_h.prototype._finish=function(){this._sectionStart<this._index&&this._handleTrailingData(),this._cbs.onend()},_h.prototype._handleTrailingData=function(){var e=this._buffer.substr(this._sectionStart);this._state===Rc||this._state===qc||this._state===Bc?this._cbs.oncdata(e):this._state===Tc||this._state===Pc||this._state===Dc?this._cbs.oncomment(e):this._state!==ah||this._xmlMode?this._state!==lh||this._xmlMode?this._state!==ch||this._xmlMode?this._state!==dc&&this._state!==mc&&this._state!==wc&&this._state!==yc&&this._state!==_c&&this._state!==vc&&this._state!==bc&&this._state!==Cc&&this._state!==fc&&this._cbs.ontext(e):(this._decodeNumericEntity(3,16),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._decodeNumericEntity(2,10),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._parseLegacyEntity(),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData()))},_h.prototype.reset=function(){_h.call(this,{xmlMode:this._xmlMode,decodeEntities:this._decodeEntities},this._cbs)},_h.prototype.getAbsoluteIndex=function(){return this._bufferOffset+this._index},_h.prototype._getSection=function(){return this._buffer.substring(this._sectionStart,this._index)},_h.prototype._emitToken=function(e){this._cbs[e](this._getSection()),this._sectionStart=-1},_h.prototype._emitPartial=function(e){this._baseState!==cc?this._cbs.onattribdata(e):this._cbs.ontext(e)};var yh=function(){},wh=Object.freeze({default:yh}),bh={},vh=Object.freeze({default:bh}),Ch=ac,Sh={input:!0,option:!0,optgroup:!0,select:!0,button:!0,datalist:!0,textarea:!0},xh={tr:{tr:!0,th:!0,td:!0},th:{th:!0},td:{thead:!0,th:!0,td:!0},body:{head:!0,link:!0,script:!0},li:{li:!0},p:{p:!0},h1:{p:!0},h2:{p:!0},h3:{p:!0},h4:{p:!0},h5:{p:!0},h6:{p:!0},select:Sh,input:Sh,output:Sh,button:Sh,datalist:Sh,textarea:Sh,option:{option:!0},optgroup:{optgroup:!0}},Eh={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,path:!0,circle:!0,ellipse:!0,line:!0,rect:!0,use:!0,stop:!0,polyline:!0,polygon:!0},Nh=/\s|\//;function Th(e,t){this._options=t||{},this._cbs=e||{},this._tagname="",this._attribname="",this._attribvalue="",this._attribs=null,this._stack=[],this.startIndex=0,this.endIndex=null,this._lowerCaseTagNames="lowerCaseTags"in this._options?!!this._options.lowerCaseTags:!this._options.xmlMode,this._lowerCaseAttributeNames="lowerCaseAttributeNames"in this._options?!!this._options.lowerCaseAttributeNames:!this._options.xmlMode,this._options.Tokenizer&&(Ch=this._options.Tokenizer),this._tokenizer=new Ch(this._options,this),this._cbs.onparserinit&&this._cbs.onparserinit(this)}(wh&&yh||wh)(Th,(vh&&bh||vh).EventEmitter),Th.prototype._updatePosition=function(e){null===this.endIndex?this._tokenizer._sectionStart<=e?this.startIndex=0:this.startIndex=this._tokenizer._sectionStart-e:this.startIndex=this.endIndex+1,this.endIndex=this._tokenizer.getAbsoluteIndex()},Th.prototype.ontext=function(e){this._updatePosition(1),this.endIndex--,this._cbs.ontext&&this._cbs.ontext(e)},Th.prototype.onopentagname=function(e){if(this._lowerCaseTagNames&&(e=e.toLowerCase()),this._tagname=e,!this._options.xmlMode&&e in xh)for(var t;(t=this._stack[this._stack.length-1])in xh[e];this.onclosetag(t));!this._options.xmlMode&&e in Eh||this._stack.push(e),this._cbs.onopentagname&&this._cbs.onopentagname(e),this._cbs.onopentag&&(this._attribs={})},Th.prototype.onopentagend=function(){this._updatePosition(1),this._attribs&&(this._cbs.onopentag&&this._cbs.onopentag(this._tagname,this._attribs),this._attribs=null),!this._options.xmlMode&&this._cbs.onclosetag&&this._tagname in Eh&&this._cbs.onclosetag(this._tagname),this._tagname=""},Th.prototype.onclosetag=function(e){if(this._updatePosition(1),this._lowerCaseTagNames&&(e=e.toLowerCase()),this._options.xmlMode){const t=this._stack;let r=t.pop();for(;r!==e;)this._cbs.onerror&&this._cbs.onerror("Unclosed tag <"+r+">"),r=t.pop();this.onopentagend(),this._cbs.onclosetag&&this._cbs.onclosetag(r)}else if(!this._stack.length||e in Eh)"br"!==e&&"p"!==e||(this.onopentagname(e),this._closeCurrentTag());else{let t=this._stack.lastIndexOf(e);if(-1!==t)if(this._cbs.onclosetag)for(t=this._stack.length-t;t--;)this._cbs.onclosetag(this._stack.pop());else this._stack.length=t;else"p"===e&&(this.onopentagname(e),this._closeCurrentTag())}},Th.prototype.onselfclosingtag=function(){this._options.xmlMode||this._options.recognizeSelfClosing?this._closeCurrentTag():this.onopentagend()},Th.prototype._closeCurrentTag=function(){var e=this._tagname;this.onopentagend(),this._stack[this._stack.length-1]===e&&(this._cbs.onclosetag&&this._cbs.onclosetag(e),this._stack.pop())},Th.prototype.onattribname=function(e){this._lowerCaseAttributeNames&&(e=e.toLowerCase()),this._attribname=e},Th.prototype.onattribdata=function(e){this._attribvalue+=e},Th.prototype.onattribend=function(){this._cbs.onattribute&&this._cbs.onattribute(this._attribname,this._attribvalue),this._attribs&&!Object.prototype.hasOwnProperty.call(this._attribs,this._attribname)&&(this._attribs[this._attribname]=this._attribvalue),this._attribname="",this._attribvalue=""},Th.prototype._getInstructionName=function(e){var t=e.search(Nh),r=t<0?e:e.substr(0,t);return this._lowerCaseTagNames&&(r=r.toLowerCase()),r},Th.prototype.ondeclaration=function(e){if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("!"+t,"!"+e)}},Th.prototype.onprocessinginstruction=function(e){if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("?"+t,"?"+e)}},Th.prototype.oncomment=function(e){this._updatePosition(4),this._cbs.oncomment&&this._cbs.oncomment(e),this._cbs.oncommentend&&this._cbs.oncommentend()},Th.prototype.oncdata=function(e){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(),this._cbs.ontext&&this._cbs.ontext(e),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+e+"]]")},Th.prototype.onerror=function(e){this._cbs.onerror&&this._cbs.onerror(e)},Th.prototype.onend=function(){if(this._cbs.onclosetag)for(var e=this._stack.length;e>0;this._cbs.onclosetag(this._stack[--e]));this._cbs.onend&&this._cbs.onend()},Th.prototype.reset=function(){this._cbs.onreset&&this._cbs.onreset(),this._tokenizer.reset(),this._tagname="",this._attribname="",this._attribs=null,this._stack=[],this._cbs.onparserinit&&this._cbs.onparserinit(this)},Th.prototype.parseComplete=function(e){this.reset(),this.end(e)},Th.prototype.write=function(e){this._tokenizer.write(e)},Th.prototype.end=function(e){this._tokenizer.end(e)},Th.prototype.pause=function(){this._tokenizer.pause()},Th.prototype.resume=function(){this._tokenizer.resume()},Th.prototype.parseChunk=Th.prototype.write,Th.prototype.done=Th.prototype.end;var Ph=Th;function Dh(e,t){let r=t.ownerDocument?t.ownerDocument.format:t.format;if(!r)throw new Error("Either 'ownerDocument' or 'format' must be set.");let n=Object.assign({},t,{xmlMode:"xml"===r}),s=new Oh({format:r,elementFactory:t.elementFactory});return new Ph(s,n).end(e),s.document}Ph.prototype.ondeclaration=function(e){if(this._cbs.ondeclaration)this._cbs.ondeclaration(e);else if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("!"+t,"!"+e)}},Ph.prototype.oncdata=function(e){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(e),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+e+"]]")};const Ih=/\s+/g,Ah=/^DOCTYPE\s+([^\s]+)(?:\s+PUBLIC\s+["]([^"]+)["](?:\s+["]([^"]+)["])?)\s*$/;class Oh{constructor(e={}){if(this.elementFactory=e.elementFactory,!this.elementFactory)throw new Error("'elementFactory' is required");this.options=e,this.document=null,this._tagStack=[]}onparserinit(){this.document=this.elementFactory("document",{format:this.options.format}),this._tagStack=[this.document]}onend(){if(this._tagStack.length>1)throw new Error("Unexpected EOF. Tag was opened but not closed.")}onerror(e){throw new Error(e)}onclosetag(){this._tagStack.pop()}_addDomElement(e){let t=this._tagStack[this._tagStack.length-1];t.childNodes||(t.childNodes=[]);let r=t.childNodes,n=r[r.length-1];e.next=null,n?(e.prev=n,n.next=e):e.prev=null,r.push(e),e.parent=t||null}onopentag(e,t){let n=this.document.createElement(e);r(t,(e,t)=>{n.setAttribute(t,e)}),this._addDomElement(n),this._tagStack.push(n)}ontext(e){let t;this.options.normalizeWhitespace&&(e=e.replace(Ih," "));let r=this._tagStack[this._tagStack.length-1];if(r&&r.childNodes&&(t=r.childNodes[r.childNodes.length-1]),t&&t.type===da.Text)t.data+=e;else{let t=this.document.createTextNode(e);this._addDomElement(t)}}oncomment(e){var t=this._tagStack[this._tagStack.length-1];if(t&&t.type===da.Comment)t.data+=e;else{let t=this.document.createComment(e);this._addDomElement(t),this._tagStack.push(t)}}oncommentend(){this._tagStack.pop()}oncdatastart(e){let t=this.document.createCDATASection(e);this._addDomElement(t),this._tagStack.push(t)}oncdataend(){this._tagStack.pop()}onprocessinginstruction(e,t){t=t.slice(e.length,-1).trim(),e=e.slice(1);let r=this.document.createProcessingInstruction(e,t);"xml"===e?this.document._xmlInstruction=r:this._addDomElement(r)}ondeclaration(e){if(!e.startsWith("DOCTYPE"))throw new Error("Not implemented: parse declaration "+e);{let t=Ah.exec(e);if(!t)throw new Error("Could not parse DOCTYPE element: "+e);this.document.setDoctype(t[1],t[2],t[3])}}}let kh;class Mh extends Qo{constructor(e,t={}){if(super(),this.type=e,!e)throw new Error("'type' is mandatory");if(this.ownerDocument=t.ownerDocument,"document"!==e&&!this.ownerDocument)throw new Error("'ownerDocument' is mandatory");switch(e){case da.Tag:if(!t.name)throw new Error("'name' is mandatory.");this.name=this._normalizeName(t.name),this.nameWithoutNS=Vh(this.name),this.properties=new Map,this.attributes=new Map,this.classes=new Set,this.styles=new Map,this.eventListeners=[],this.childNodes=t.children||t.childNodes||[],this._assign(t);break;case da.Text:case da.Comment:case da.CDATA:this.data=t.data||"";break;case da.Directive:if(!t.name)throw new Error("'name' is mandatory.");this.name=this._normalizeName(t.name),this.nameWithoutNS=Vh(this.name),this.data=t.data;break;case da.Doctype:this.data=t.data;break;case"document":{let e=t.format;if(this.format=e,!e)throw new Error("'format' is mandatory.");switch(this.childNodes=t.children||t.childNodes||[],e){case"xml":this.contentType="application/xml";break;case"html":this.contentType="text/html";break;default:throw new Error("Unsupported format "+e)}break}default:this.name=null,this.properties=new Map,this.attributes=new Map,this.classes=new Set,this.styles=new Map,this.eventListeners=[],this.childNodes=t.children||t.childNodes||[]}}getNativeElement(){return this}getNodeType(){switch(this.type){case da.Tag:case da.Script:case da.Style:return"element";default:return this.type}}isTextNode(){return"text"===this.type}isElementNode(){return"tag"===this.type||"script"===this.type}isCommentNode(){return"comment"===this.type}isDocumentNode(){return"document"===this.type}isComponentNode(){return"component"===this.type}clone(e){let t=new Mh(this.type,this);return this.childNodes&&(t.childNodes.length=0,e&&this.childNodes.forEach(r=>{t.appendChild(r.clone(e))})),t}get tagName(){return this.getTagName()}set tagName(e){this.setTagName(e)}getTagName(){return this.name}setTagName(e){return this._isXML()?this.name=String(e):this.name=String(e).toLowerCase(),this.nameWithoutNS=Vh(this.name),this}hasAttribute(e){if(this.attributes)return this.attributes.has(e)}getAttribute(e){if(this.attributes)return this.attributes.get(e)}setAttribute(e,t){if(this.attributes){switch(t=String(t),e){case"class":this.classes=new Set,qh(this.classes,t);break;case"style":this.styles=new Map,Fh(this.styles,t)}this.attributes.set(e,t),this._isHTML()&&function(e,t,r){const n=Gh[e.tagName];if(n){let s=n[t];!0===s?e.setProperty(t,r):s&&s(e,t,r)}}(this,e,t)}return this}removeAttribute(e){if(this.attributes){switch(e){case"class":this.classes=new Set;break;case"style":this.styles=new Map}this.attributes.delete(e)}return this}getAttributes(){return this.attributes}getProperty(e){if(this.properties)return this.properties.get(e)}setProperty(e,t){if(this.properties){if(this._isXML())throw new Error("setProperty() is only be used on HTML elements");!function(e,t,r){const n=Jh[e.tagName];if(n){let s=n[t];if(s)return void s(e,t,r)}Kh(e,t,r)}(this,e,t)}return this}hasClass(e){if(this.classes)return this.classes.has(e)}addClass(e){return this.classes&&(this.classes.add(e),this.attributes.set("class",Bh(this.classes))),this}removeClass(e){return this.classes&&this.classes.has(e)&&(this.classes.delete(e),this.attributes.set("class",Bh(this.classes))),this}getContentType(){return this.getOwnerDocument().contentType}getDoctype(){return this.isDocumentNode()?$h(this):this.getOwnerDocument().getDoctype()}setDoctype(e,t,r){let n=this.getOwnerDocument(),s=$h(n),i=this.createDocumentType(e,t,r);s?n.replaceChild(i,s):n.insertBefore(i,n.getChildren()[0]),n.doctype=i}getInnerHTML(){let e=this._isXML();return Xa.getInnerHTML(this,{xmlMode:e,decodeEntities:!e})}setInnerHTML(e){if(this.childNodes){let t=this._isXML(),r=Dh(e,{ownerDocument:this.getOwnerDocument(),format:t?"xml":"html",decodeEntities:!t,elementFactory:Lh});this.empty(),r.childNodes.slice(0).forEach(e=>{this.appendChild(e)})}return this}getOuterHTML(){let e=this._isXML();return Xa.getOuterHTML(this,{xmlMode:e,decodeEntities:!e})}getTextContent(){return Xa.getText(this)}setTextContent(e){switch(this.type){case da.Text:case da.Comment:case da.CDATA:this.data=e;break;default:if(this.childNodes){let t=this.createTextNode(e);this.empty(),this.appendChild(t)}}return this}getStyle(e){if(this.styles)return this.styles.get(e)}setStyle(e,t){return this.styles&&(Qo.pxStyles[e]&&x(t)&&(t+="px"),this.styles.set(e,t),this.attributes.set("style",function(e){if(!e)return"";let t=Object.keys(e).map(t=>t+":"+e[t]).join(";");t.length>0&&(t+=";");return t}(this.styles))),this}is(e){return ml.is(this,e,{xmlMode:this._isXML()})}find(e){return ml.selectOne(e,this,{xmlMode:this._isXML()})}findAll(e){return ml.selectAll(e,this,{xmlMode:this._isXML()})}getChildCount(){return this.childNodes?this.childNodes.length:0}getChildNodes(){return this.childNodes.slice(0)}getChildren(){return this.childNodes.filter(function(e){return"tag"===e.type})}get children(){return this.getChildren()}getChildAt(e){if(this.childNodes)return this.childNodes[e]}getChildIndex(e){if(this.childNodes)return this.childNodes.indexOf(e)}getLastChild(){if(this.childNodes)return Di(this.childNodes)}getFirstChild(){if(this.childNodes)return this.childNodes[0]}getNextSibling(){return this.next}getPreviousSibling(){return this.prev}getParent(){return this.parent}getOwnerDocument(){return"document"===this.type?this:this.ownerDocument}getFormat(){return this.getOwnerDocument().format}createDocument(e){return Mh.createDocument(e)}createElement(e){return new Mh(da.Tag,{name:e,ownerDocument:this.getOwnerDocument()})}createTextNode(e){return new Mh(da.Text,{data:e,ownerDocument:this.getOwnerDocument()})}createComment(e){return new Mh(da.Comment,{data:e,ownerDocument:this.getOwnerDocument()})}createProcessingInstruction(e,t){return new Mh(da.Directive,{name:e,data:t,ownerDocument:this.getOwnerDocument()})}createDocumentType(e,t,r){return new Rh(da.Doctype,{data:{name:e,publicId:t,systemId:r},ownerDocument:this.getOwnerDocument()})}createCDATASection(e){return new Mh(da.CDATA,{data:e,ownerDocument:this.getOwnerDocument()})}appendChild(e){if(this.childNodes&&!N(e)){if(!(e=this._normalizeChild(e)))return this;Xa.appendChild(this,e),e.ownerDocument=this.getOwnerDocument()}return this}removeChild(e){e.parentNode===this&&e.remove()}insertAt(e,t){if(!(t=this._normalizeChild(t)))return this;let r=this.childNodes;return r&&(e>=r.length?Xa.appendChild(this,t):Xa.prepend(r[e],t),t.ownerDocument=this.getOwnerDocument()),this}insertBefore(e,t){if(N(t))return this.appendChild(e);if(this.childNodes){if(!(this.childNodes.indexOf(t)>-1))throw new Error("insertBefore(): reference node is not a child of this element.");Xa.prepend(t,e),e.ownerDocument=this.getOwnerDocument()}return this}removeAt(e){let t=this.childNodes;if(t){t[e].remove()}return this}empty(){let e=this.childNodes;return e&&(e.forEach(e=>{e.next=e.prev=e.parent=null}),e.length=0),this}remove(){return Xa.removeElement(this),this}replaceChild(e,t){return e.parent===this&&e.replaceWith(t),this}replaceWith(e){return e=this._normalizeChild(e),Xa.replaceElement(this,e),e.ownerDocument=this.getOwnerDocument(),this}getEventListeners(){return this.eventListeners||[]}click(){return this.emit("click",{target:this,currentTarget:this}),!0}emit(e,t){this._propagateEvent(new Hh(e,this,t))}getBoundingClientRect(){return{top:0,left:0,height:0,width:0}}getClientRects(){return[{top:0,left:0,height:0,width:0}]}_propagateEvent(e){let t=this.eventListeners;if(t){if(t.forEach(t=>{t.eventName===e.type&&t.handler(e)}),e.stopped)return;let r=this.parentNode;r&&r._propagateEvent(e)}}removeAllEventListeners(){return this.eventListeners=[],this}_assign(e){e.name&&(this.name=e.name),this.classes&&e.classes&&e.classes.forEach(e=>{this.classes.add(e)}),this.styles&&e.styles&&r(e.styles,(e,t)=>{this.styles.set(t,e)});let t=e.attributes||e.attribs;this.attributes&&t&&r(t,(e,t)=>{switch(t){case"class":qh(this.classes,e);break;case"style":Fh(this.styles,e)}this.attributes.set(t,e)}),this.eventListeners&&e.eventListeners&&(this.eventListeners=this.eventListeners.concat(e.eventListeners))}_normalizeChild(e){if(!N(e)){if(S(e)&&(e=this.createTextNode(e)),!e||!e._isMemoryDOMElement)throw new Error("Illegal argument: only String and MemoryDOMElement instances are valid.");return e}}_normalizeName(e){return this._isXML()?e:e.toLowerCase()}_isHTML(){return"html"===this.getFormat()}_isXML(){return"xml"===this.getFormat()}get _isMemoryDOMElement(){return!0}static createDocument(e,t={}){if("xml"===e){let r=new Mh("document",{format:e}),n=[];return t.version&&n.push(`version="${t.version}"`),t.encoding&&n.push(`encoding="${t.encoding}"`),n.length>0&&(r._xmlInstruction=r.createProcessingInstruction("xml",n.join(" "))),r}return Mh.parseMarkup(Qo.EMPTY_HTML,"html")}static parseMarkup(e,t,r={}){if(!e)return Mh.createDocument(t);let n,s="html"===t,i=Object.assign({format:t,decodeEntities:s,elementFactory:Lh},r);if(r.raw)return Dh(e,i);if(r.snippet&&(e=`<__snippet__>${e}</__snippet__>`),"html"===t?function(e){let t=e.find("html");if(!t){let r=e.find("head"),n=e.find("title"),s=e.findAll("meta"),i=e.find("body");r&&r.remove(),n&&n.remove(),s.forEach(e=>e.remove()),i&&i.remove();let o=e.childNodes.slice();o.forEach(e=>{e.parent=null}),e.childNodes.length=0,t=e.createElement("html"),r||((r=e.createElement("head")).appendChild(n),r.append(s),t.appendChild(r)),i||(i=e.createElement("body")).append(o),t.appendChild(i),e.append(t)}}(n=Dh(e,i)):"xml"===t&&(n=Dh(e,i)),r.snippet){let e=n.find("__snippet__").childNodes;return 1===e.length?e[0]:e}return n}static wrapNativeElement(e){if(ha){if(e===window||e===window.document)return new Uh;e instanceof window.Node||e._isBrowserDOMElement}if(!e._isMemoryDOMElement)throw new Error("Illegal argument: expected MemoryDOMElement instance");return e}static wrap(e){return Mh.wrapNativeElement(e)}static unwrap(e){if(!e._isMemoryDOMElement)throw new Error("Illegal argument: expected MemoryDOMElement instance");return e}static isReverse(){return!1}static getBrowserWindow(){return kh||(kh=new zh),kh}}function Lh(e,t){return new Mh(e,t)}class Rh extends Mh{get name(){return this.data.name}get publicId(){return this.data.publicId}get systemId(){return this.data.systemId}}function qh(e,t){t.split(/\s+/).forEach(t=>{e.add(t)})}function Bh(e){return Array.from(e).join(" ")}function Fh(e,t){(t=(t||"").trim())&&t.split(";").forEach(t=>{let r=t.indexOf(":");if(r<1||r===t.length-1)return;let n=t.slice(0,r).trim(),s=t.slice(r+1).trim();e.set(n,s)})}const jh=["keydown","keyup","keypress","mousedown","mouseup","mouseover","click","dblclick"].reduce((e,t)=>(e[t]=!0,e),{});class Hh{constructor(e,t,r){this.type=e,this.timeStamp=Date.now(),this.target=t,jh[e]?r&&Object.assign(this,r):this.detail=r}stopPropagation(){this.stopped=!0}preventDefault(){this.defaultPrevented=!0}}class Uh{on(){}off(){}}class zh extends Mh{constructor(){super("window",{ownerDocument:Mh.createDocument("html")});let e={href:"",hash:""};function t(t){let r=t.indexOf("#");e.href=t,r>=0&&(e.hash=t.slice(r))}let r={replaceState(e,r,n){t(n)},pushState(e,r,n){t(n)}};this.location=e,this.history=r}}function Vh(e){const t=e.indexOf(":");return t>0?e.slice(t+1):e}const Gh={input:{value:!0,checked:(e,t,r)=>{const n="off"!==r;e.setProperty("checked",n)}}};const Jh={input:{checked:(e,t,r)=>{!0===r?(e.properties.set(t,!0),e.properties.set("value","on")):(e.properties.set(t,!1),e.properties.set("value","off"))},value:(e,t,r)=>{switch(e.getAttribute("type")){case"checkbox":"on"===r?(e.properties.set(t,!0),e.properties.set("value","on")):(e.properties.set(t,!1),e.properties.set("value","off"));break;default:Kh(e,t,r)}}}};function Kh(e,t,r){void 0===r?e.properties.delete(t):e.properties.set(t,String(r))}function $h(e){if(e.doctype)return e.doctype;const t=e.childNodes;for(let r=0;r<t.length;r++){let n=t[r];if(n.type===da.Doctype)return e.doctype=n,n}}let Xh={};function Wh(){return Xh._forceMemoryDOM?Mh:y.inBrowser||y.inElectron?oa:Mh}Xh.createDocument=function(e,t){return Wh().createDocument(e,t)},Xh.createElement=function(e){return console.error("DEPRECATED: every element should have an ownerDocument. Use DefaultDOMElement.createDocument() to create a document first"),Xh.createDocument("html").createElement(e)},Xh.createTextNode=function(e){return console.error("DEPRECATED: every element should have a ownerDocument. Use DefaultDOMElement.createDocument() to create a document first"),Xh.createDocument("html").createTextNode(e)},Xh.getBrowserWindow=function(){return Wh().getBrowserWindow()},Xh.parseHTML=function(e,t){return Wh().parseMarkup(e,"html",t)},Xh.parseXML=function(e,t){return Wh().parseMarkup(e,"xml",t)},Xh.parseSnippet=function(e,t){return Wh().parseMarkup(e,t,{snippet:!0})},Xh.wrap=Xh.wrapNativeElement=function(e){if(!e)throw new Error("Illegal argument");return Wh().wrap(e)},Xh.unwrap=function(e){if(!e)throw new Error("Illegal argument");return Wh().unwrap(e)},Xh.isReverse=function(e,t,r,n){return Wh().isReverse(e,t,r,n)},Xh._forceMemoryDOM=!1;const Yh="undefined"!=typeof global?global:window,Zh=Yh.hasOwnProperty("Substance")?Yh.Substance:Yh.Substance={DEBUG_RENDERING:!1};function Qh(e,t){if(e)for(var r=0;r<e.length;r++)e[r]===t&&(e.splice(r,1),r--)}function ed(e){return!0===e||!1===e||e&&e.constructor===Boolean}class td extends Qo{constructor(e){super(),this.parent=null,this._owner=e,this._ref=null}getParent(){return this.parent}get childNodes(){return this.getChildNodes()}getChildCount(){return this.children.length}getChildAt(e){return this.children[e]}getComponent(){return this._comp}ref(e){if(!e)throw new Error("Illegal argument");if(this._ref)throw new Error("A VirtualElement can only be referenced once.");if(this._ref=e,this._context){const t=this._context.refs;if(t.has(e))throw new Error('An item with reference "'+e+'" already exists.');t.set(e,this)}return this}isInDocument(){return!1}get _isVirtualElement(){return!0}}class rd extends td{constructor(e){super(),this._tagName=e,this.classNames=null,this.attributes=null,this.htmlProps=null,this.style=null,this.eventListeners=null,this.children=[]}getTagName(){return this._tagName}setTagName(e){return this._tagName=e,this}hasClass(e){return!!this.classNames&&this.classNames.indexOf(e)>-1}addClass(e){return this.classNames||(this.classNames=[]),this.classNames.push(e),this}removeClass(e){return this.classNames&&(this.classNames=Us(this.classNames,e)),this}removeAttribute(e){return this.attributes&&this.attributes.delete(e),this}getAttribute(e){if(this.attributes)return this.attributes.get(e)}setAttribute(e,t){return this.attributes||(this.attributes=new Map),this.attributes.set(e,t),this}getAttributes(){let e=[];return this.attributes&&(e=Array.from(this.attributes)),this.classNames&&e.push(["class",this.classNames.join(" ")]),this.style&&e.push(["style",g(this.style,function(e,t){return t+":"+e}).join(";")]),new Map(e)}getId(){return this.getAttribute("id")}setId(e){return this.setAttribute("id",e),this}setTextContent(e){return e=String(e||""),this.empty(),this.appendChild(e),this}setInnerHTML(e){return e=e||"",this.empty(),this._innerHTMLString=e,this}getInnerHTML(){if(this.hasOwnProperty("_innerHTMLString"))return this._innerHTMLString;throw new Error("Not supported.")}getValue(){return this.htmlProp("value")}setValue(e){return this.htmlProp("value",e),this}getChildNodes(){return this.children}getChildren(){return this.children.filter(function(e){return"text"!==e.getNodeType()})}isTextNode(){return!1}isElementNode(){return!0}isCommentNode(){return!1}isDocumentNode(){return!1}append(){if(this._innerHTMLString)throw Error("It is not possible to mix $$.html() with $$.append(). You can call $$.empty() to reset this virtual element.");return this._append(this.children,arguments),this}appendChild(e){if(this._innerHTMLString)throw Error("It is not possible to mix $$.html() with $$.append(). You can call $$.empty() to reset this virtual element.");return this._appendChild(this.children,e),this}insertAt(e,t){if(!(t=this._normalizeChild(t)))throw new Error("Illegal child: "+t);if(!t._isVirtualElement)throw new Error("Illegal argument for $$.insertAt():"+t);if(e<0||e>this.children.length)throw new Error("insertAt(): index out of bounds.");return this._insertAt(this.children,e,t),this}insertBefore(e,t){var r=this.children.indexOf(t);if(!(r>-1))throw new Error("insertBefore(): reference node is not a child of this element.");return this.insertAt(r,e),this}removeAt(e){if(e<0||e>=this.children.length)throw new Error("removeAt(): Index out of bounds.");return this._removeAt(e),this}removeChild(e){if(!e||!e._isVirtualElement)throw new Error("removeChild(): Illegal arguments. Expecting a CheerioDOMElement instance.");var t=this.children.indexOf(e);if(t<0)throw new Error("removeChild(): element is not a child.");return this.removeAt(t),this}replaceChild(e,t){if(!(t&&e&&t._isVirtualElement&&e._isVirtualElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");var r=this.children.indexOf(e);if(r<0)throw new Error("replaceChild(): element is not a child.");return this.removeAt(r),this.insertAt(r,t),this}empty(){for(var e=this.children;e.length;){e.pop().parent=null}return delete this._innerHTMLString,this}getProperty(e){if(this.htmlProps)return this.htmlProps.get(e)}setProperty(e,t){return this.htmlProps||(this.htmlProps=new Map),this.htmlProps.set(e,t),this}removeProperty(e){return this.htmlProps&&this.htmlProps.delete(e),this}getStyle(e){if(this.style)return this.style.get(e)}setStyle(e,t){return this.style||(this.style=new Map),Qo.pxStyles[e]&&x(t)&&(t+="px"),this.style.set(e,t),this}_createEventListener(e,t,r){return r.context=r.context||this._owner._comp,super._createEventListener(e,t,r)}getNodeType(){return"element"}hasInnerHTML(){return Boolean(this._innerHTMLString)}_normalizeChild(e){if(!N(e)){if(e._isVirtualElement)return e;if(S(e)||ed(e)||x(e))return new id(String(e));throw new Error("Unsupported child type")}}_append(e,t){if(1!==t.length||m(t[0])){var r;if(m(t[0]))r=t[0];else{if(!(arguments.length>1))return;r=Array.prototype.slice.call(t,0)}r.forEach(this._appendChild.bind(this,e))}else this._appendChild(e,t[0])}_appendChild(e,t){if(t=this._normalizeChild(t))return e.push(t),this._attach(t),t}_insertAt(e,t,r){r&&(e.splice(t,0,r),this._attach(r))}_removeAt(e,t){var r=e[t];e.splice(t,1),this._detach(r)}_attach(e){e.parent=this,this._context&&(e._owner!==this._owner&&e._isVirtualComponent&&this._context.injectedComponents.push(e),e._owner!==this._owner&&e._ref&&(this._context.foreignRefs[e._ref]=e))}_detach(e){e.parent=null,this._context&&(e._isVirtualComponent&&Qh(this._context.injectedComponents,e),e._owner!==this._owner&&e._ref&&this._context.foreignRefs.delete(e._ref))}_copy(){if(this.classNames||this.attributes||this.eventListeners||this.htmlProps||this.style){let e={};return this.classNames&&(e.classNames=this.classNames.slice()),this.attributes&&(e.attributes=new Map(this.attributes)),this.eventListeners&&(e.eventListeners=this.eventListeners.slice()),this.htmlProps&&(e.htmlProps=new Map(this.htmlProps)),this.style&&(e.style=new Map(this.style)),e}}_clear(){this.classNames=null,this.attributes=null,this.htmlProps=null,this.style=null,this.eventListeners=null}_merge(e){if(!e)return;const t=["classNames","eventListeners"];for(let r of t){let t=e[r];if(t){let e=this[r];this[r]=e?e.concat(t):t.slice()}}const r=["attributes","htmlProps","style"];for(let t of r){let r=e[t];if(r){let e=this[t];this[t]=e?new Map([...e,...r]):new Map(r)}}}get _isVirtualHTMLElement(){return!0}}class nd extends rd{constructor(e,t){super(),t=t||{},this.ComponentClass=e,this.props=t,t.children||(t.children=[]),this.children=t.children}getComponent(){return this._comp}getChildren(){return this.props.children}getNodeType(){return"component"}outlet(e){return new sd(this,e)}setInnerHTML(){throw new Error("Can not set innerHTML of a Component")}_attach(e){e._preliminaryParent=this}_detach(e){e._preliminaryParent=null}get _isVirtualHTMLElement(){return!1}get _isVirtualComponent(){return!0}}class sd{constructor(e,t){this.virtualEl=e,this.name=t,Object.freeze(this)}_getOutlet(){var e=this.virtualEl.props[this.name];return e||(e=[],this.virtualEl.props[this.name]=e),e}append(){var e=this._getOutlet();return this.virtualEl._append(e,arguments),this}empty(){var e=this.virtualEl.props[this.name];return e.forEach(function(e){this._detach(e)}.bind(this)),e.splice(0,e.length),this}}class id extends td{constructor(e){super(),this.text=e}get _isVirtualTextNode(){return!0}}td.Component=nd,td.TextNode=id,td.createElement=function(){var e,t,r=arguments[0],n=arguments[1];if(S(r))t="element";else{if(!io(r)||!r.prototype._isComponent)throw N(r)?new Error("$$(null): provided argument was null or undefined."):new Error("Illegal usage of $$()");t="component"}var s,i,o={};for(var a in n)if(n.hasOwnProperty(a)){var l=n[a];switch(a){case"class":s=l;break;case"ref":i=l;break;default:o[a]=l}}return"element"===t?(e=new rd(r)).attr(o):e=new nd(r,o),e._owner=this.owner,s&&e.addClass(s),i&&e.ref(i),[].forEach(function(t){if(io(t.handler))e.on(t.name,t.handler);else{if(!C(t.handler))throw new Error("Illegal arguments for $$(_,{ on"+t.name+"})");var r=t.handler;e.on(t.name,r.handler,r.context,r)}}),arguments.length>2&&e.append(lo(Array.prototype.slice.call(arguments,2),3)),e},td.Context=class{constructor(e){this.owner=e,this.refs=new Map,this.foreignRefs=new Map,this.elements=[],this.components=[],this.injectedComponents=[],this.$$=this._createComponent.bind(this),this.$$.capturing=!0}_createComponent(){let e=td.createElement.apply(this,arguments);return e._context=this,e._owner=this.owner,e._isVirtualComponent&&this.components.push(e),this.elements.push(e),e}};const od=Symbol("TOP_LEVEL_ELEMENT");class ad{constructor(e={}){if(this.componentFactory=e.componentFactory,!this.componentFactory)throw new Error("'componentFactory' is mandatory");if(this.elementFactory=e.elementFactory||Xh.createDocument("html"),!this.elementFactory)throw new Error("'elementFactory' is mandatory")}_render(e,t,r){Zh.VERBOSE_RENDERING_ENGINE&&(console.group("RenderingEngine"),e.el?console.log("Rendering Engine: re-render of %s",e.constructor.name):console.log("Rendering Engine: initial render of %s",e.constructor.name),console.time("rendering (total)"));let n=Id(e),s=this._createState();t&&s.set(Rd,n,t),r&&s.set(qd,n,r);try{Zh.VERBOSE_RENDERING_ENGINE&&console.time("capturing"),ld(s,n,od),Zh.VERBOSE_RENDERING_ENGINE&&console.timeEnd("capturing"),Zh.VERBOSE_RENDERING_ENGINE&&console.time("updating"),yd(s,n),Zh.VERBOSE_RENDERING_ENGINE&&console.timeEnd("updating"),function e(t,r){r._isVirtualComponent?(t.is(jd,r)||r.children.forEach(e.bind(null,t)),t.is(Hd,r)&&r._comp.didUpdate(t.get(Rd,r),t.get(qd,r))):r._isVirtualHTMLElement&&r.children.forEach(e.bind(null,t))}(s,n)}finally{Zh.VERBOSE_RENDERING_ENGINE&&(console.timeEnd("rendering (total)"),console.groupEnd("RenderingEngine")),s.dispose()}}_renderChild(e,t){let r=this._createState();t.parent={_comp:e,_isFake:!0};try{return ld(r,t),yd(r,t),t._comp}finally{r.dispose()}}_createState(){return new Ud(this.componentFactory,this.elementFactory)}static createContext(e){let t=Id(e);return new td.Context(t)}}function ld(e,t,r){if(e.is(Ad,t))return t;let n=t._comp;if(n||(n=cd(e,t),e.set(Ld,t)),t._isVirtualComponent){let s;if(r===od){s=!0,console.assert(t._comp===n,"top-level element and component should be linked already"),e.set(Md,t),e.set(Md,n),e.set(kd,t),e.set(kd,n);let r=wd(n);t.elementProps=r.elementProps}else s=!n.el||n.shouldRerender(t.props,n.state),t.elementProps=t._copy(),t._clear(),e.set(Rd,t,n.props),e.set(qd,t,n.state),n._setProps(t.props),e.is(Ld,t)||e.set(Hd,t);if(s){let r=new td.Context(t),s=n.render(r.$$);if(!s)throw new Error("Component.render() returned nil.");if(s._isVirtualComponent)t._forwardedEl=s,t._isForwarding=!0,s._isForwarded=!0,s.parent=t,t.children=[s];else{if(!s._isVirtualHTMLElement)throw new Error("render() must return a plain element or a Component");t.tagName=s.tagName,t._merge(s),s.hasInnerHTML()?(t._innerHTMLString=s._innerHTMLString,t.children=[]):(t.children=s.children,t.children.forEach(e=>{e.parent=t}))}if(t._context=s._context,t.elementProps&&(t._merge(t.elementProps),t._isForwarding&&t._forwardedEl._merge(t)),!e.is(Ld,t)&&n.isMounted()&&e.set(Hd,t),hd(e,n,t,dd),Zh.DEBUG_RENDERING){let s=t.children.slice(0);for(;s.length;){let t=s.shift();e.is(Ad,t)||(t._isVirtualComponent||(t._comp||cd(e,t),t._isVirtualHTMLElement&&t.children.length>0&&(s=s.concat(t.children)),e.set(Ad,t)))}let i=new Dd(e,r);for(;i.hasPendingCaptures();)i.reset(),n.render(i.$$);for(let t of r.injectedComponents)ld(e,t);t._forwardedEl&&ld(e,t._forwardedEl)}else if(t._forwardedEl)ld(e,t._forwardedEl);else for(let r of t.children)ld(e,r);hd(e,n,t,md)}else e.set(jd,t)}else if(t._isVirtualHTMLElement)for(let r of t.children)ld(e,r);return e.set(Ad,t),t}function cd(e,t){let r=t._comp;console.assert(!r,"Component instance should not exist when this method is used.");let n=t.parent._comp;if(n||(n=cd(e,t.parent)),t._isVirtualComponent){if(console.assert(n,"A Component should have a parent."),r=e.componentFactory.createComponent(t.ComponentClass,n,t.props),t.props=r.props,t._forwardedEl){let n=t._forwardedEl,s=e.componentFactory.createComponent(n.ComponentClass,r,n.props);n.props=s.props,r._forwardedComp=s}}else t._isVirtualHTMLElement?r=e.componentFactory.createElementComponent(n,t):t._isVirtualTextNode&&(r=e.componentFactory.createTextNodeComponent(n,t));return t._ref&&(r._ref=t._ref),t._owner&&(r._owner=t._owner._comp),t._comp=r,r}function hd(e,t,r,n){if(console.assert(r._isVirtualComponent,"this method is intended for VirtualComponents only"),!r.__components__){let e=r._context;console.assert(e,"there should be a capturing context on the VirtualComponent");let n=e.refs,s=e.foreignRefs;e.internalRefs||(e.internalRefs=function(e,t){let r=new Map,n=new Map;for(let s of e.components){if(s._ref)continue;let e=bd(s,t);if(r.has(e)){let t=r.get(e)+1;r.set(e,t),e=e+"@"+t}else r.set(e,1);n.set(e,s)}return n}(e,r));let i=e.internalRefs,o=[],a=wd(t),l=a.refs,c=a.foreignRefs,h=a.internalRefs||new Map,d=(e,t)=>{for(let[r,n]of e){let e,s=t.get(r);s&&(e=s._comp),o.push({vc:n,comp:e})}};n.size>0&&d(n,l),s.size>0&&d(s,c),i.size>0&&d(i,h),r.__components__=o}if(r.__components__.length>0)for(let t of r.__components__)n(e,t.comp,t.vc)}function dd(e,t,r){t?fd(e,t,r)||gd(e,t,r)||(_d(t,r)?ud(e,t,r):pd(e,t,r)):pd(e,t,r)}function ud(e,t,r){r._comp=t,e.set(Md,r),e.set(Md,t),e.set(kd,r),e.set(kd,t)}function pd(e,t,r){r._comp=null,e.set(Md,r),t&&e.set(Md,t)}function fd(e,t,r){const n=e.is(Md,r),s=e.is(Md,t);return!(!n&&!s)}function gd(e,t,r){let n=e.is(kd,t),s=e.is(kd,r);return r._comp===t&&(s||(console.error("FIXME: comp is linked, but not virtual component"),e.set(kd,r)),n||(console.error("FIXME: virtual comp is linked, but not component"),e.set(kd,r)),!0)}function md(e,t,r,n){if(!r)return console.error("DOCUMENT WHY THIS IS NEEDED"),!1;if(!t)return!1;if(n&&fd(e,t,r))return gd(e,t,r);if(!r._isVirtualComponent){if(!_d(t,r))return pd(e,t,r),!1;ud(e,t,r)}let s=!1,i=t.getParent();if(r.parent)s=md(e,i,r.parent,!0);else if(r._preliminaryParent){for(;i&&i._isElementComponent;)i=i.getParent();s=md(e,i,r._preliminaryParent,!0)}return r._isVirtualComponent&&!s&&(Zh.VERBOSE_RENDERING_ENGINE&&console.info("Component has been relocated: "+t.constructor.name),e.set(Bd,r),e.set(Bd,t)),s}function _d(e,t){return e._isElementComponent&&t._isVirtualHTMLElement||e._isComponent&&t._isVirtualComponent&&e.constructor===t.ComponentClass||e._isTextNodeComponent&&t._isVirtualTextNode}function yd(e,t){if(e.is(jd,t))return;let r=t._comp;if(r||t._ref&&t._preliminaryParent!==t._owner&&ld(e,t),console.assert(r&&r._isComponent,"A captured VirtualElement must have a component instance attached."),t._isForwarding)yd(e,t._forwardedEl);else{if(r.el){let e=r.el;console.assert(e,"Component's element should exist at this point."),Nd(e,t)}else r.el=function(e,t){let r;r=t._isVirtualTextNode?e.elementFactory.createTextNode(t.text):e.elementFactory.createElement(t.tagName);t._comp&&(r._comp=t._comp);return Nd(r,t),r}(e,t);if((t._isVirtualComponent||t._isVirtualHTMLElement)&&!t.hasInnerHTML()){let n=t.children,s=r.el.getChildNodes().map(t=>{let n=t._comp;return n._isForwarded()&&(n=function(e,t){let r=t.getParent();for(;r;){let t=r.getParent();if(t===e)return r;r=t}}(r,n)),!n||e.is(Bd,n)?(r.el.removeChild(t),null):n}).filter(Boolean),i=0,o=0;for(;i<s.length||o<n.length;){let t;do{t=s[i++]}while(t&&e.is(Od,t));let a=n[o++];if(t&&!a){for(;t;)xd(e,r,t),t=s[i++];break}if(t&&t.el.isTextNode()&&a&&a._isVirtualTextNode&&t.el.textContent===a.text)continue;if(t&&t._isElementComponent&&a._isVirtualHTMLElement&&!e.is(Md,t)&&!e.is(Md,a)&&t.tagName===a.tagName){a._comp=t,e.set(kd,a),e.set(kd,t),yd(e,a);continue}e.is(Fd,a)||yd(e,a);let l=a._comp;l!==t&&(e.is(Bd,l)&&l._setParent(r),console.assert(l,"Component instance should now be available."),!a||t?e.is(kd,a)?e.is(kd,t)?(e.set(Od,t),xd(e,r,t),o--):(xd(e,r,t),o--):e.is(kd,t)?(Sd(e,r,l,t),i--):Cd(e,r,t,l):vd(e,r,l))}}}if(t._isVirtualComponent&&(function(e,t){let r=t._context,n=wd(e);n.elementProps=t.elementProps,n.refs=r.refs,n.foreignRefs=r.foreignRefs,n.internalRefs=r.internalRefs,e.refs=Array.from(r.refs).reduce((e,[t,r])=>{let n=r._comp;return n?e[t]=r._comp:console.warn(`Warning: component with reference '${t}' has not been used`),e},{})}(r,t),t._forwardedEl)){let e=t._forwardedEl._comp;if(r.el){let t=r.el._comp;t!==e&&(t.triggerDispose(),r.el.parentNode.replaceChild(r.el,e.el),r.el=e.el,e.triggerDidMount())}else r.el=e.el}e.set(Fd,t),e.set(Fd,r)}function wd(e){return e.__internal__||(e.__internal__=new zd),e.__internal__}function bd(e,t){let r=[e.ComponentClass.name];if(!e._isForwarded){let n=e.getParent();for(;n&&n!==t&&!n._isFake;)console.assert(n._isVirtualHTMLElement),r.unshift(n.tagName),n=n.parent}return r.join("/")}function vd(e,t,r){t.el.appendChild(r.el),Ed(e,t,r)}function Cd(e,t,r,n){t.el.replaceChild(r.el,n.el),e.is(Od,r)||r.triggerDispose(),Ed(e,t,n)}function Sd(e,t,r,n){t.el.insertBefore(r.el,n.el),Ed(e,t,r)}function xd(e,t,r){t.el.removeChild(r.el),e.is(Od,r)||r.triggerDispose()}function Ed(e,t,r){e.is(Od,r)||!t.isMounted()||r.isMounted()||r.triggerDidMount(!0)}function Nd(e,t){if(t._isVirtualTextNode)return void e.setTextContent(t.text);let r=e.getTagName();if(t.tagName.toLowerCase()!==r&&e.setTagName(t.tagName),Pd({oldHash:e.getAttributes(),newHash:t.getAttributes(),update:function(t,r){e.setAttribute(t,r)},remove:function(t){e.removeAttribute(t)}}),Pd({oldHash:e.htmlProps,newHash:t.htmlProps,update:function(t,r){e.setProperty(t,r)},remove:function(t){e.removeProperty(t)}}),function(e){let t=e.el,r=e.newListeners||[];t.removeAllEventListeners();for(let e=0;e<r.length;e++)t.addEventListener(r[e])}({el:e,oldListeners:e.getEventListeners(),newListeners:t.getEventListeners()}),t.hasInnerHTML()){if(e._hasInnerHTML){let r=e.getInnerHTML(),n=t.getInnerHTML();r!==n&&e.setInnerHTML(n)}else e.empty(),e.setInnerHTML(t.getInnerHTML());e._hasInnerHTML=!0}}function Td(e,t){return e instanceof Map?e.get(t):e[t]}function Pd({newHash:e,oldHash:t,update:r,remove:n}){if(!e&&!t)return;e||(e=new Map),t||(t=new Map);let s={};for(let n of e.keys()){let i=Td(t,n),o=Td(e,n);s[n]=!0,i!==o&&r(n,o)}if(io(t.keys)&&t.size>0){Array.from(t.keys()).forEach(e=>{s[e]||n(e)})}else for(let e in t)t.hasOwnProperty(e)&&!s[e]&&n(e)}class Dd{constructor(e,t){this.state=e,this.owner=t.owner,this.refs=new Map,this.foreignRefs=new Map,this.internalRefs=null,this.elements=t.elements,this.pos=0,this.updates=t.components.length,this.remaining=this.updates,this.injectedComponents=t.injectedComponents,this.$$=this._$$.bind(this)}_$$(){let e=this.state,t=this.elements[this.pos++];if(!e.is(Ad,t)&&t._isVirtualComponent){let r=t.parent;r&&(r===this.owner||e.is(Ad,t.parent))&&(ld(e,t),this.updates++,this.remaining--)}return(t=td.createElement.apply(this,arguments))._context=this,t._owner=this.owner,t._attach=function(){},t._detach=function(){},t}hasPendingCaptures(){return this.updates>0&&this.remaining>0}reset(){this.pos=0,this.updates=0,this.refs.clear()}}function Id(e){let t=new td.Component(e.constructor);return t._comp=e,t}const Ad=Symbol("CAPTURED"),Od=Symbol("DETACHED"),kd=Symbol("LINKED"),Md=Symbol("MAPPED"),Ld=Symbol("NEW"),Rd=Symbol("OLDPROPS"),qd=Symbol("OLDSTATE"),Bd=Symbol("RELOCATED"),Fd=Symbol("RENDERED"),jd=Symbol("SKIPPED"),Hd=Symbol("UPDATED");class Ud{constructor(e,t){this.componentFactory=e,this.elementFactory=t,this.polluted=[],this.id="__"+d()}dispose(){let e=this.id;this.polluted.forEach(function(t){delete t[e]})}set(e,t,r=!0){let n=t[this.id];n||(n={},t[this.id]=n,this.polluted.push(t)),n[e]=r}get(e,t){let r=t[this.id];if(r)return r[e]}is(e,t){return Boolean(this.get(e,t))}}class zd{constructor(){this.refs=new Map,this.foreignRefs=new Map,this.internalRefs=new Map,this.elementProps=null}}ad._INTERNAL_API={_capture:ld,_wrap:Id,_update:yd,CAPTURED:Ad,DETACHED:Od,LINKED:kd,MAPPED:Md,NEW:Ld,RELOCATED:Bd,RENDERED:Fd,SKIPPED:jd,TOP_LEVEL_ELEMENT:od,UPDATED:Hd};const Vd={createComponent:(e,t,r)=>new e(t,r),createElementComponent:(e,t)=>new Xd(e,t),createTextNodeComponent:(e,t)=>new Wd(e,t)};class Gd extends l{constructor(e,t={},r={}){let n;super(),this.parent=e&&e._isComponent?e:null,this.el=r.el,n=io(this.defineContext)?this.defineContext(t,e):r.context||this._getContext(),this.context=n||{},this.renderingEngine=e&&e.renderingEngine||r.renderingEngine||new ad({componentFactory:Vd}),this._SKIP_COMPONENT_INIT||(this.__id__=d(),this.refs={},this.__foreignRefs__={},this._actionHandlers=this.getActionHandlers(),this.props=t,this.state=this.getInitialState()||{})}getId(){return this.__id__}setId(){throw new Error("'id' is readonly")}getActionHandlers(){return{}}getChildContext(){return{}}getInitialState(){return{}}getParent(){return this.parent}getRoot(){let e=this,t=e;for(;t;)t=(e=t).getParent();return e}getElement(){return this.el}getNativeElement(){return this.el.getNativeElement()}getLabel(e,...t){let r=this.getLabelProvider();if(!r)throw new Error("Missing labelProvider.");return r.getLabel(e,...t)}getLabelProvider(){return this.context.labelProvider}getComponent(e,t){let r=this.getComponentRegistry();if(!r)throw new Error("Missing componentRegistry.");const n=r.get(e);if(!t&&!n)throw new Error("No Component registered with name "+e);return n}getComponentRegistry(){return this.context.componentRegistry}render(e){return e("div")}mount(e){if(!e)throw new Error("Element is required.");return e=Xh.wrap(e),this.el=null,this.renderingEngine=Gd.createRenderingEngine(e.getOwnerDocument()),this._render(),e.appendChild(this.el),e.isInDocument()&&this.triggerDidMount(!0),this}shouldRerender(e,t){return!0}rerender(){this._rerender(this.props,this.state)}_rerender(e,t){this._render(e,t),this.isMounted()||this.didUpdate(e,t)}_render(e,t){if(this.__isRendering__)throw new Error("Component is rendering already.");this.__isRendering__=!0;try{this.renderingEngine._render(this,e,t)}finally{delete this.__isRendering__}}triggerDidMount(){this._isForwarded()&&this.getParent().triggerDidMount(),this.__isMounted__||(this.__isMounted__=!0,this.didMount());const e=this.getChildren();for(let t of e)t.triggerDidMount(!0)}triggerDispose(){this._isForwarding()?this.el._comp.triggerDispose():this.getChildren().forEach(function(e){e.triggerDispose()}),this.dispose(),this.__isMounted__=!1}didMount(){}didUpdate(){}isMounted(){return this.__isMounted__}dispose(){}_isForwarding(){return!!this.el&&this.el._comp!==this}_isForwarded(){let e=this.getParent();return e&&e._isForwarding()}_getForwardedComponent(){if(this.el)return this.el._comp}_setParent(e){this.parent=e,this.context=this._getContext()||{},Object.freeze(this.context)}send(e){let t=this;for(;t;){if(t._actionHandlers&&t._actionHandlers[e])return t._actionHandlers[e].apply(t,Array.prototype.slice.call(arguments,1)),!0;t=t.getParent()}return console.warn("Action",e,"was not handled."),!1}handleActions(e){return r(e,function(e,t){this.handleAction(t,e)}.bind(this)),this}handleAction(e,t){if(!e||!t||!io(t))throw new Error("Illegal arguments.");t=t.bind(this),this._actionHandlers[e]=t}getState(){return this.state}setState(e){let t=this.props,r=this.state,n=!this.__isSettingProps__&&this.shouldRerender(this.getProps(),e);this.willUpdateState(e),this.state=e||{},Object.freeze(this.state),n?this._rerender(t,r):this.__isSettingProps__||this.didUpdate(t,r)}extendState(e){e=$o({},this.state,e),this.setState(e)}willUpdateState(e){}getProps(){return this.props}setProps(e){let t=this.props,r=this.state,n=this.shouldRerender(e,this.state);this._setProps(e),n?this._rerender(t,r):this.didUpdate(t,r)}_setProps(e){e=e||{},this.__isSettingProps__=!0;try{this.willReceiveProps(e),this.props=e||{},Object.freeze(e)}finally{delete this.__isSettingProps__}}extendProps(e){let t=$o({},this.props,e);this.setProps(t)}willReceiveProps(e){}getTextContent(){if(this.el)return this.el.textContent}get textContent(){return this.getTextContent()}getInnerHTML(){if(this.el)return this.el.getInnerHTML()}get innerHTML(){return this.getInnerHTML()}getOuterHTML(){if(this.el)return this.el.getOuterHTML()}get outerHTML(){return this.getOuterHTML()}getAttribute(e){if(this.el)return this.el.getAttribute(e)}setAttribute(e,t){return this.el&&this.el.setAttribute(e,t),this}getProperty(e){if(this.el)return this.el.getProperty(e)}setProperty(e,t){return this.el&&this.el.setProperty(e,t),this}get tagName(){if(this.el)return this.el.tagName}hasClass(e){if(this.el)return this.el.hasClass(e)}addClass(e){return this.el&&this.el.addClass(e),this}removeClass(e){return this.el&&this.el.removeClass(e),this}getStyle(e){if(this.el)return this.el.getStyle(e)}setStyle(e,t){return this.el?this.el.setStyle(e,t):this}getValue(){if(this.el)return this.el.getValue()}setValue(e){return this.el&&this.el.setValue(e),this}getChildCount(){return this.el?this.el.getChildCount():0}get childNodes(){return this.getChildNodes()}getChildNodes(){if(!this.el)return[];let e=this.el.getChildNodes();return e=e.map(Kd).filter(Boolean)}getChildren(){if(!this.el)return[];let e=this.el.getChildren();return e=e.map(Kd).filter(Boolean)}getChildAt(e){let t=this.el.getChildAt(e);if(t)return $d(t)}find(e){return Kd(this.el.find(e))}findAll(e){return this.el.findAll(e).map(Kd).filter(Boolean)}appendChild(e){this.insertAt(this.getChildCount(),e)}insertAt(e,t){if(S(t)&&(t=new td.TextNode(t)),!t._isVirtualElement)throw new Error('Invalid argument: "child" must be a VirtualElement.');let r=this.renderingEngine._renderChild(this,t);this.el.insertAt(e,r.el),function(e,t){e.isMounted()&&t.triggerDidMount(!0);t._owner&&t._ref&&(t._owner.refs[t._ref]=t)}(this,r)}removeAt(e){let t=this.el.getChildAt(e);if(t){Jd($d(t)),this.el.removeAt(e)}}removeChild(e){if(!e||!e._isComponent)throw new Error("removeChild(): Illegal arguments. Expecting a Component instance.");Jd(e),this.el.removeChild(e.el)}replaceChild(e,t){if(!(t&&e&&t._isComponent&&e._isComponent))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");Jd(e),this.el.replaceChild(t.el,e.el),this.isMounted()&&t.triggerDidMount(!0)}empty(){return this._clear(),this}_clear(){let e=this.el;e&&(this.getChildNodes().forEach(function(e){Jd(e)}),e.empty()),this.refs={},this.__foreignRefs__={}}remove(){Jd(this),this.el.remove()}addEventListener(){throw new Error("Not supported.")}removeEventListener(){throw new Error("Not supported.")}insertBefore(){throw new Error("Not supported.")}click(){return!!this.el&&this.el.click()}getComponentPath(){let e=[],t=this;for(;t;)e.unshift(t),t=t.getParent();return e}_getContext(){let e={},t=this.getParent();return t&&(e=$o(e,t.context),t.getChildContext)?$o(e,t.getChildContext()):e}get _isComponent(){return!0}attr(){return Qo.prototype.attr.apply(this,arguments)}htmlProp(){return Qo.prototype.htmlProp.apply(this,arguments)}val(){return Qo.prototype.val.apply(this,arguments)}css(){return Qo.prototype.css.apply(this,arguments)}text(){return Qo.prototype.text.apply(this,arguments)}append(){return Qo.prototype.append.apply(this,arguments)}static unwrap(){return Kd.apply(this,arguments)}static render(e){let t=new this(null,e=e||{});return t._render(),t}static mount(e,t){if(1===arguments.length&&(t=e,e={}),!t)throw new Error("'el' is required.");if(S(t)){let e=t;if(!y.inBrowser)throw new Error("This selector is not supported on server side.");t=window.document.querySelector(e)}t=Xh.wrap(t);let r=new this(null,e);return r.mount(t),r}static getComponentForDOMElement(e){return Kd(e)}static unwrapDOMElement(e){return console.warn("DEPRECATED: Use Component.getComponentForDOMElement"),Gd.getComponentForDOMElement(e)}static getComponentFromNativeElement(e){return Kd(Xh.wrap(e))}static createRenderingEngine(e){return new ad({componentFactory:Vd,elementFactory:e})}static get Element(){return Xd}static get TextNode(){return Wd}}function Jd(e){e.triggerDispose(),e._owner&&e._ref&&(console.assert(e._owner.refs[e._ref]===e,"Owner's ref should point to this child instance."),delete e._owner.refs[e._ref])}function Kd(e){if(e&&(e._isDOMElement||(e=Xh.unwrap(e)),e))return e._comp}function $d(e){let t=Kd(e);if(!t)throw new Error("Expecting a back-link to the component instance.");return t}class Xd extends Gd{get _isElementComponent(){return!0}get _SKIP_COMPONENT_INIT(){return!0}}class Wd extends Gd{setTextContent(e){if(!this.el)throw new Error("Component must be rendered first.");this.el.textContent!==e&&(this.el.textContent=e)}getChildNodes(){return[]}getChildren(){return[]}get _isTextNodeComponent(){return!0}get _SKIP_COMPONENT_INIT(){return!0}}class Yd{constructor(e,t,r,n,s){if("SKIP"!==arguments[0])if(1===arguments.length&&C(arguments[0])){let e=arguments[0];this.start=e.start,this.end=e.end,this.reverse=Boolean(e.reverse),this.containerPath=e.containerPath,this.surfaceId=e.surfaceId}else this.start=e,this.end=t,this.reverse=Boolean(r),this.containerPath=n,this.surfaceId=s}isCollapsed(){return this.start.equals(this.end)}equals(e){return this===e||Oi(this.containerPath,e.containerPath)&&this.start.equals(e.start)&&this.end.equals(e.end)}isReverse(){return this.reverse}toString(){let e=[this.start.toString(),"->",this.end.toString()];return this.isReverse()&&e.push("[reverse]"),this.containerPath&&e.push("[container="+this.containerPath+"]"),this.surfaceId&&e.push("[surface="+this.surfaceId+"]"),e.join("")}get _isRange(){return!0}}const Zd=1,Qd=-1,eu=-2;class tu{constructor(e){Object.assign(this,e)}start(e,t,r){if(!S(t))throw new Error("Illegal argument: 'text' must be a String, but was "+t);this._start(e,t,r)}onText(e,t,r){}onEnter(e,t){return null}onExit(e,t,r){}_enter(e,t){return e.counter++,this.onEnter(e,t)}_exit(e,t,r){this.onExit(e,t,r)}_createText(e,t,r){this.onText(e,t,r)}_start(e,t,n){for(var s=function(e){let t=[],n=[];r(e,function(e){let r=e.isAnchor();if(r)t.push({mode:eu,pos:e.offset,id:e.id,level:tu.ALWAYS_ON_TOP,type:"anchor",node:e,counter:-1,length:0});else{var s=tu.NORMAL,i=e.isInlineNode();i?s=Number.MAX_VALUE:e.constructor.hasOwnProperty("fragmentation")?s=e.constructor.fragmentation:e.hasOwnProperty("fragmentationHint")&&(s=e.fragmentationHint);var o=Math.min(e.start.offset,e.end.offset),a=Math.max(e.start.offset,e.end.offset),l={pos:o,mode:Zd,level:s,id:e.id,type:e.type,node:e,length:0,counter:-1};t.push(l),n.push({pos:a,mode:Qd,level:s,id:e.id,type:e.type,node:e,opener:l})}}),t.sort(ru);for(var s=t.length-1;s>=0;s--)t[s].idx=s;n.sort(nu);var i=new Array(t.length+n.length),o=0,a=0,l=0,c=t[a],h=n[l];for(;c||h;)c&&h?h.pos<=c.pos&&h.opener!==c?(i[o]=h,l++):(i[o]=c,a++):c?(i[o]=c,a++):h&&(i[o]=h,l++),c=t[a],h=n[l],o++;return i}.call(this,n),i=[{context:e,entry:null}],o=0,a=0;a<s.length;a++){var l,c,h,d=s[a],u=t.substring(o,d.pos);if(u&&this._createText(i[i.length-1].context,u,d),o=d.pos,d.mode===Zd||d.mode===eu){for(l=1;l<i.length&&!(d.level<i[l].entry.level);l++);for(c=i.length-1;c>=l;c--)(h=i[c].entry).length=o-h.pos,this._exit(h,i[c].context,i[c-1].context);for(i.splice(l,0,{entry:d}),c=l;c<i.length;c++)(h=i[c].entry).pos=o,i[c].context=this._enter(h,i[c-1].context)}if(d.mode===Qd||d.mode===eu){for(l=1;l<i.length&&i[l].entry.node!==d.node;l++);for(c=i.length-1;c>=l;c--)(h=i[c].entry).length=o-h.pos,this._exit(h,i[c].context,i[c-1].context);for(i.splice(l,1),c=l;c<i.length;c++)(h=i[c].entry).pos=o,i[c].context=this._enter(h,i[c-1].context)}}var p=t.substring(o);p&&this._createText(e,p)}}function ru(e,t){if(e.pos<t.pos)return-1;if(e.pos>t.pos)return 1;if(e.mode<t.mode)return-1;if(e.mode>t.mode)return 1;if(e.mode===t.mode){if(e.level<t.level)return-1;if(e.level>t.level)return 1}return 0}function nu(e,t){return e.pos<t.pos?-1:e.pos>t.pos?1:e.pos===e.opener.pos&&t.pos===t.opener.pos?e.opener.idx<t.opener.idx?-1:1:e.opener.idx>t.opener.idx?-1:e.opener.idx<t.opener.idx?1:0}tu.SHOULD_NOT_SPLIT=0,tu.NORMAL=10,tu.ANY=100,tu.ALWAYS_ON_TOP=Number.MAX_VALUE;class su extends Gd{render(e){return this._renderContent(e).addClass("sc-annotated-text").css({whiteSpace:"pre-wrap"})}getPath(){return this.props.path}getText(){return this.getDocument().get(this.props.path)||""}isEmpty(){return!this.getText()}getAnnotations(){return this.getDocument().getIndex("annotations").get(this.props.path)}getDocument(){return this.props.doc||this.context.doc}_getTagName(){return this.props.tagName}_onDocumentChange(e){e.change&&e.change.hasUpdated(this.getPath())&&this.rerender()}_renderContent(e){let t=this.getText(),r=this.getAnnotations(),n=e(this._getTagName()||"span");if(r&&r.length>0){new tu({onText:this._renderTextNode.bind(this),onEnter:this._renderFragment.bind(this,e),onExit:this._finishFragment.bind(this)}).start(n,t,r)}else n.append(t);return n}_renderTextNode(e,t){t&&t.length>0&&e.append(t)}_renderFragment(e,t){let r=t.node;return e(this._getFragmentComponentClass(r),this._getFragmentProps(r))}_getFragmentComponentClass(e,t){let r=this.getComponent(e.type,"not-strict");return!e.isInlineNode()||r.prototype._isInlineNodeComponent||r.isCustom||(r=this.getComponent("inline-node")),r||t||(r=this._getUnsupportedInlineNodeComponentClass()),r}_getUnsupportedInlineNodeComponentClass(){return this.getComponent("annotation")}_getFragmentProps(e){return{node:e}}_finishFragment(e,t,r){r.append(t)}}class iu extends Gd{render(e){let t=e("span").addClass("se-selection-fragment");if(this.props.collaborator){let e=this.props.collaborator.colorIndex;t.addClass("sm-collaborator-"+e)}else t.addClass("sm-local-user");return t.append(this.props.children),t}}class ou extends su{getInitialState(){const e=this.context.markersManager;let t,r=this.getPath();if(e)t=e.getMarkers(r,{surfaceId:this.getSurfaceId(),containerPath:this.getContainerPath()});else{t=this.getDocument().getAnnotations(r)}return{markers:t}}didMount(){const e=this.context.markersManager;e&&e.register(this)}dispose(){const e=this.context.markersManager;e&&e.deregister(this)}render(e){let t=this.getPath(),r=this._renderContent(e).addClass("sc-text-property").attr({"data-path":t.join(".")}).css({"white-space":"pre-wrap"});return this.isEmpty()&&(r.addClass("sm-empty"),this.props.placeholder&&r.append(e("span").addClass("se-placeholder").append(this.props.placeholder))),this.props.withoutBreak||r.append(e("br")),r}getAnnotations(){return this.props.markers?this.state.markers.concat(this.props.markers):this.state.markers}_renderFragment(e,t){let r,n=t.node,s=n.id;return"selection-fragment"===n.type?r=e(iu,{collaborator:n.collaborator}):(r=super._renderFragment.apply(this,arguments),s&&r.ref(s+"@"+t.counter)),r.attr("data-offset",t.pos),r}getSurface(){return this.props.surface||this.context.surface}getSurfaceId(){let e=this.getSurface();return e?e.id:null}getContainerPath(){let e=this.getSurface();return e?e.getContainerPath():null}isEditable(){const e=this.getSurface();return!!e&&e.isEditable()}isReadonly(){const e=this.getSurface();return!e||e.isReadonly()}getDOMCoordinate(e){return this._getDOMCoordinate(this.el,e)}_finishFragment(e,t,r){t.attr("data-length",e.length),r.append(t)}_getDOMCoordinate(e,t){let r,n=0;if(0===t)return{container:e.getNativeElement(),offset:0};for(let s=e.getFirstChild();s;s=s.getNextSibling(),n++)if(s.isTextNode()){if((r=s.textContent.length)>=t)return{container:s.getNativeElement(),offset:t};t-=r}else if(s.isElementNode()){let i=s.getAttribute("data-length");if(!i)return console.error("FIXME: Can not map to DOM coordinates."),null;if((r=parseInt(i,10))>=t){if(s.attr("data-inline")){let t=s.getNextSibling();return t&&t.isTextNode()?{container:t.getNativeElement(),offset:0}:{container:e.getNativeElement(),offset:e.getChildIndex(s)+1}}return this._getDOMCoordinate(s,t,n)}t-=r}}get _isTextPropertyComponent(){return!0}static getCoordinate(e,t,r){let n,s=function(e,t,r){let n={comp:null,el:null,path:null,node:t,offset:r};for(;t&&t!==e;){if(t.isElementNode()){let e=Gd.unwrap(t);if(e&&e._isTextPropertyComponent)return n.comp=e,n.el=t,n.path=e.getPath(),n;t.getAttribute("data-inline")&&(n.node=t,r>0&&(n.offset=1))}t=t.getParent()}return null}(e,t,r);if(!s)return null;if(x(n=t.parentNode&&t.parentNode.is(".se-placeholder")?0:function e(t,r){let n=r;let s,i;s=t.getParent();if(t.isTextNode())if(t===s.firstChild){let t=s.getAttribute("data-path"),i=s.getAttribute("data-offset");n=t?r:i?parseInt(i,10)+r:e(s,0)+r}else i=s.getChildIndex(t),n=e(s,i)+r;else{if(!t.isElementNode())return null;{let o=t.getAttribute("data-path"),a=t.getAttribute("data-offset");o?n=au(t,r):a?(i=s.getChildIndex(t),n=parseInt(a,10)+au(t,r)):(i=s.getChildIndex(t),n=e(s,i)+au(t,r))}}return n}(s.node,s.offset))){let e=new ki(s.path,n);return e._comp=s.comp,e}return null}}function au(e,t){let r=0;if(e.getAttribute("data-inline"))return 0===t?0:1;let n=e.getChildCount();1===arguments.length&&(t=n),t=Math.min(n,t);for(let n=0,s=e.getFirstChild();n<t;s=s.getNextSibling(),n++)if(s.isTextNode())r+=s.getTextContent().length;else if(s.isElementNode()){let e=s.getAttribute("data-length");s.getAttribute("data-inline")?r+=1:r+=e?parseInt(e,10):au(s)}return r}let lu={UNDEFINED:0,BACKSPACE:8,DELETE:46,INSERT:45,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,RETURN:13,END:35,HOME:36,TAB:9,PAGEUP:33,PAGEDOWN:34,ESCAPE:27,ESC:27,SHIFT:16,SPACE:32,PLUS:171,VOLUMEUP:183,VOLUMEDOWN:182,VOLUMEMUTE:181,PRINTSCREEN:44};for(let e=1;e<=24;e++)lu["F"+e]=111+e;class cu extends Gd{constructor(...e){super(...e),this.name=this.props.node.id,this._state={selectionFragment:null},this.handleAction("escape",this.escape),this.ContentClass=this._getContentClass();let t=y.isFF||!this.ContentClass.noBlocker;this.blockingMode=t?"closed":"open"}getInitialState(){let e=this.getEditorSession().getSelection(),t=this.getEditorSession().getSelectionState();return this._deriveStateFromSelectionState(e,t)}getChildContext(){return{parentSurfaceId:this.getId(),isolatedNodeComponent:this,surface:void 0}}didMount(){super.didMount(),this.getEditorSession().onRender("selection",this._onSelectionChanged,this)}dispose(){super.dispose.call(this),this.getEditorSession().off(this)}renderContent(e,t,r={}){let n=this.ContentClass;if(n){return e(n,Object.assign(this._getContentProps(),r))}return console.error("Could not resolve a component for type: "+t.type),e(this.__elementTag)}getId(){return this._id||(this._id=this.context.parentSurfaceId+"/"+this.name),this._id}get id(){return this.getId()}getMode(){return this.state.mode}escape(){this.selectNode()}isOpen(){return"open"===this.blockingMode}isClosed(){return"closed"===this.blockingMode}isNotSelected(){return!this.state.mode}isSelected(){return"selected"===this.state.mode}isCoSelected(){return"co-selected"===this.state.mode}isFocused(){return"focused"===this.state.mode}isCoFocused(){return"co-focused"===this.state.mode}getParentSurface(){return this.context.surface}getEditorSession(){return this.context.editorSession}getSurfaceManager(){return this.context.surfaceManager}_onSelectionChanged(){const e=this.getEditorSession(),t=e.getSelection(),r=e.getSelectionState(),n=this._deriveStateFromSelectionState(t,r);!n&&this.state.mode?this.extendState({mode:null}):n&&n.mode!==this.state.mode&&this.extendState(n)}onKeydown(e){e.keyCode===lu.ESCAPE&&"focused"===this.state.mode&&(e.stopPropagation(),e.preventDefault(),this.escape())}_getContentClass(){const e=this.props.node;let t;return(t=this.getComponent(e.type,!0))||(t=Gd),t}_getContentProps(){return{disabled:this.props.disabled,node:this.props.node,isolatedNodeState:this.state.mode,focused:"focused"===this.state.mode}}_getSurfaceForSelection(e,t){let r=t.surface;if(!r){if(e&&e.surfaceId){r=this.getSurfaceManager().getSurface(e.surfaceId)}else r=null;t.surface=r}return r}_getIsolatedNodes(e,t){let r=t.isolatedNodes;if(!r){if(r=[],e&&e.surfaceId){let t=this.getSurfaceManager().getSurface(e.surfaceId);t&&(r=t.getComponentPath().filter(e=>e._isAbstractIsolatedNodeComponent))}t.isolatedNodes=r}return r}_shouldConsumeEvent(e){let t=Gd.unwrap(e.currentTarget);return this._getIsolatedNode(t)===this}_getIsolatedNode(e){return e._isAbstractIsolatedNodeComponent?this:e.context.isolatedNodeComponent?e.context.isolatedNodeComponent:e.context.surface?e.context.surface.context.isolatedNodeComponent:void 0}get _isAbstractIsolatedNodeComponent(){return!0}}const hu="X",du="/".charCodeAt(0);class uu extends cu{render(e){const t=this.props.node,r=this.ContentClass,n=this.props.disabled;let s=e("div");s.addClass(this.getClassNames()).addClass("sc-isolated-node").addClass("sm-"+this.props.node.type).attr("data-id",t.id),n&&s.addClass("sm-disabled"),this.state.mode&&s.addClass("sm-"+this.state.mode),r.noStyle||s.addClass("sm-default-style"),s.on("keydown",this.onKeydown);const i="closed"===this.blockingMode&&!this.state.unblocked;s.append(e("div").addClass("se-bracket sm-left").ref("left").append(hu));let o=this.renderContent(e,t,{disabled:this.props.disabled||i}).ref("content");return o.attr("contenteditable",!1),s.append(o),s.append(e(pu).ref("blocker")),s.append(e("div").addClass("se-bracket sm-right").ref("right").append(hu)),i||(s.addClass("sm-no-blocker"),s.on("click",this.onClick).on("dblclick",this.onDblClick)),s.on("mousedown",this._reserveMousedown,this),s}getClassNames(){return""}getContent(){return this.refs.content}selectNode(){const e=this.getEditorSession();let t={type:"node",nodeId:this.props.node.id};const r=this.getParentSurface();r&&Object.assign(t,{containerPath:r.getContainerPath(),surfaceId:r.id}),e.setSelection(t)}onClick(e){e.stopPropagation()}onDblClick(e){e.stopPropagation()}grabFocus(e){let t=this.refs.content;if(t.grabFocus)return t.grabFocus(e),!0}_reserveMousedown(e){e.__reserved__||(e.__reserved__=this)}_deriveStateFromSelectionState(e,t){const r=this._getSurfaceForSelection(e,t),n=this.getParentSurface();let s={mode:null,unblocked:null};if(!r)return s;if(r===n){let t=this.props.node.id;e.isNodeSelection()&&e.getNodeId()===t&&(e.isFull()?(s.mode="selected",s.unblocked=!0):e.isBefore()?(s.mode="cursor",s.position="before"):e.isAfter()&&(s.mode="cursor",s.position="after")),e.isContainerSelection()&&e.containsNode(t)&&(s.mode="co-selected")}else{let t=e.surfaceId,r=this.getId();if(r.length<t.length&&t.startsWith(r)&&t.charCodeAt(r.length)===du){t.slice(r.length+1).indexOf("/")>0?(s.mode="co-focused",s.unblocked=!0):(s.mode="focused",s.unblocked=!0)}}return s}get _isIsolatedNodeComponent(){return!0}static getDOMCoordinate(e,t){let{start:r,end:n}=uu.getDOMCoordinates(e);return 0===t.offset?r:n}static getDOMCoordinates(e){const t=e.refs.left,r=e.refs.right;return{start:{container:t.getNativeElement(),offset:0},end:{container:r.getNativeElement(),offset:r.getChildCount()}}}static getCoordinate(e,t){let r,n=Gd.unwrap(e,"strict").context.isolatedNodeComponent,s=null;return"left"===t.direction||e===n.refs.left.el?s=0:"right"!==t.direction&&e!==n.refs.right.el||(s=1),null!==s&&((r=new ki([n.props.node.id],s))._comp=n),r}}class pu extends Gd{render(e){return e("div").addClass("sc-isolated-node-blocker").attr("draggable",!0).attr("contenteditable",!1).on("click",this.onClick).on("dblclick",this.onDblClick)}onClick(e){if(e.target!==this.getNativeElement())return;e.stopPropagation();const t=this._getIsolatedNodeComponent();t.extendState({mode:"selected",unblocked:!0}),t.selectNode()}onDblClick(e){e.stopPropagation()}_getIsolatedNodeComponent(){return this.context.isolatedNodeComponent}}const fu=!1;class gu{constructor(e){this.editor=e,y.inBrowser&&(this.wRange=window.document.createRange()),this.state={dom:null,model:null}}getSelection(e){if(!y.inBrowser)return;let t=this.mapDOMSelection(e);return this.editor.getDocument()._createSelectionFromRange(t)}getSelectionForDOMRange(e){let t=this.mapDOMRange(e);return this.editor.getDocument()._createSelectionFromRange(t)}mapDOMSelection(e){let t,r=window.getSelection(),n=this.state;if(fu&&console.info("DOM->Model: ",r.anchorNode,r.anchorOffset,r.focusNode,r.focusOffset),0===r.rangeCount)return i();let s=Xh.wrapNativeElement(r.anchorNode);if(r.isCollapsed){let n=this._getCoordinate(s,r.anchorOffset,e);if(!n)return i();t=mu({start:n,end:n})}else{let n=Xh.wrapNativeElement(r.focusNode);t=this._getRange(s,r.anchorOffset,n,r.focusOffset,e)}return fu&&console.info("DOM->Model: range ",t?t.toString():null),n.model=t,t;function i(){return n.dom=null,n.model=null,null}}setSelection(e){if(!y.inBrowser)return;let t=this.state,r=window.getSelection(),n=this.wRange;if(!e||e.isNull())return this.clear();let{start:s,end:i}=this.mapModelToDOMCoordinates(e);if(!s)return this.clear();e.isReverse()&&([s,i]=[i,s]),t.dom={anchorNode:s.container,anchorOffset:s.offset,focusNode:i.container,focusOffset:i.offset},function({anchorNode:e,anchorOffset:t,focusNode:s,focusOffset:i}){r.removeAllRanges(),n.setStart(e,t),n.setEnd(e,t),r.addRange(n),(s!==t||i!==t)&&r.extend(s,i)}(t.dom)}mapModelToDOMCoordinates(e){let t;fu&&console.info("Model->DOM: sel =",e.toString());let r,n,s=this.editor.getSurfaceManager().getSurface(e.surfaceId);if(s?t=s.el:(console.warn("No surface:",e.surfaceId),t=this.editor.getElement()),e.isNull()||e.isCustomSelection())return{};if(e.isPropertySelection()||e.isContainerSelection()){if(!(r=this._getDOMCoordinate(t,e.start)))return console.warn("FIXME: selection seems to be invalid."),{};if(e.isCollapsed())n=r;else if(!(n=this._getDOMCoordinate(t,e.end)))return console.warn("FIXME: selection seems to be invalid."),{}}else if(e.isNodeSelection()){let s=Gd.unwrap(t.find('*[data-id="'+e.getNodeId()+'"]'));if(!s)return console.error("Could not find component with id",e.getNodeId()),{};if(s._isIsolatedNodeComponent){let t=uu.getDOMCoordinates(s,e);r=t.start,n=t.end}else{let e=s.el;r={container:e.getNativeElement(),offset:0},n={container:e.getNativeElement(),offset:e.getChildCount()}}}return fu&&console.info("Model->DOM:",r.container,r.offset,n.container,n.offset,"isReverse?",e.isReverse()),{start:r,end:n}}_getDOMCoordinate(e,t){let r,n=null;if(t.isNodeCoordinate()){if(r=Gd.unwrap(e.find('*[data-id="'+t.getNodeId()+'"]')))if(r._isIsolatedNodeComponent)n=uu.getDOMCoordinate(r,t);else{let e=0;t.offset>0&&(e=r.getChildCount()),n={container:r.getNativeElement(),offset:e}}}else(r=Gd.unwrap(e.find('.sc-text-property[data-path="'+t.path.join(".")+'"]')))&&(n=r.getDOMCoordinate(t.offset));return n}mapDOMRange(e,t){return this._getRange(Xh.wrapNativeElement(e.startContainer),e.startOffset,Xh.wrapNativeElement(e.endContainer),e.endOffset,t)}clear(){window.getSelection().removeAllRanges(),this.state.dom=null,this.state.model=null}collapse(e){let t,r=window.getSelection();r.rangeCount>0&&((t=r.getRangeAt(0)).collapse("left"===e),r.removeAllRanges(),r.addRange(t))}select(e){let t=window.getSelection(),r=window.document.createRange();r.selectNode(e.getNativeElement()),t.removeAllRanges(),t.addRange(r)}extend(e,t){window.getSelection().extend(e.getNativeElement(),t)}setCursor(e,t){let r=window.getSelection(),n=window.document.createRange();n.setStart(e.getNativeElement(),t),r.removeAllRanges(),r.addRange(n)}_getRange(e,t,r,n,s={}){let i,o,a=Xh.isReverse(e,t,r,n);return e===r&&t===n?i=o=this._getCoordinate(e,t,s):(i=this._getCoordinate(e,t,{direction:a?"right":"left"}),o=this._getCoordinate(r,n,s)),i&&o?mu({start:i,end:o,isReverse:a}):null}_getCoordinate(e,t,r={}){let n=null;n||(n=ou.getCoordinate(this.editor.getElement(),e,t));let s=Gd.unwrap(e);if(!n&&s&&s.context.isolatedNodeComponent&&(n=uu.getCoordinate(e,r)),!n)if(s&&s._isContainerEditor){let e=0===t?0:t-1,r=0===t,i=s.getDocument(),o=s.getContainerPath(),a=i.get(o),l=i.get(a[e]),c=s.getChildAt(e);(n=new ki([l.id],r?0:1))._comp=c}else if(e.isElementNode()&&e.getChildCount()>0){let r,s=t>0?e.getChildAt(t-1):e.firstChild,i=Gd.unwrap(s);i&&i._isTextPropertyComponent&&(r=s),r&&(n=ou.getCoordinate(e,r,t>0?r.getChildCount():0))}return n}}function mu({start:e,end:t,isReverse:r}){if(r&&([e,t]=[t,e]),!e._comp||!t._comp)return console.error("FIXME: getCoordinate() should provide a component instance"),null;let n=e._comp.context.surface;return n?n!==t._comp.context.surface?(console.error("Coordinates are within two different surfaces. Can not create a selection."),null):new Yd(e,t,r,n.getContainerPath(),n.id):(console.error("FIXME: Editable components should have their surface in the context"),null)}class _u{constructor(e,t){this.editorSession=e,this.context=t,this.editorSession.onRender("document",this._onDocumentChange,this)}dispose(){this.editorSession.off(this)}triggerFetch(e){e.fetchPayload(this.context,(t,r)=>{t?this._updateNode(e.id,{errorMessage:t.toString()}):this._updateNode(e.id,r)})}_onDocumentChange(e){let t=this.editorSession.getDocument();r(e.created,(e,r)=>{let n=t.get(r);n.constructor.isResource&&setTimeout(()=>{this.triggerFetch(n)})})}_updateNode(e,t){this.editorSession.transaction(n=>{r(t,(t,r)=>{n.set([e,r],t)})})}}class yu extends Gd{constructor(...e){super(...e),this._initialize(this.props)}didMount(){this.getEditorSession().attachEditor(this)}dispose(){this._dispose()}_initialize(e){const t=e.editorSession;if(!t)throw new Error("EditorSession instance required");this.editorSession=t,this.doc=t.getDocument();let r=t.getConfigurator();this.componentRegistry=r.getComponentRegistry(),this.commandGroups=r.getCommandGroups(),this.keyboardShortcuts=r.getKeyboardShortcutsByCommand(),this.tools=r.getTools(),this.labelProvider=r.getLabelProvider(),this.iconProvider=r.getIconProvider(),this.surfaceManager=t.surfaceManager,this.commandManager=t.commandManager,this.dragManager=t.dragManager,this.macroManager=t.macroManager,this.converterRegistry=t.converterRegistry,this.globalEventHandler=t.globalEventHandler,this.editingBehavior=t.editingBehavior,this.markersManager=t.markersManager,this.resourceManager=new _u(t,this.getChildContext()),this.domSelection=new gu(this),this.labelProvider.setLanguage(t.getLanguage()),t.onUpdate("lang",e=>{this.labelProvider.setLanguage(e)},this),t.onRender("lang",this.rerender,this)}willReceiveProps(e){let t=e.editorSession;t&&t!==this.editorSession&&(this._dispose(),this._initialize(e))}_dispose(){const e=this.getEditorSession();e.off(this),e.detachEditor(this),this.empty(),this.resourceManager.dispose()}getChildContext(){return{editor:this,editorSession:this.editorSession,configurator:this.editorSession.getConfigurator(),doc:this.doc,document:this.doc,componentRegistry:this.componentRegistry,surfaceManager:this.surfaceManager,domSelection:this.domSelection,commandManager:this.commandManager,markersManager:this.markersManager,converterRegistry:this.converterRegistry,dragManager:this.dragManager,editingBehavior:this.editingBehavior,globalEventHandler:this.globalEventHandler,iconProvider:this.iconProvider,labelProvider:this.labelProvider,resourceManager:this.resourceManager,commandGroups:this.commandGroups,tools:this.tools,keyboardShortcuts:this.keyboardShortcuts}}onKeyDown(e){if("Dead"===e.key)return;return this.editorSession.keyboardManager.onKeydown(e)}getDocument(){return this.editorSession.getDocument()}getConfigurator(){return this.editorSession.getConfigurator()}getEditorSession(){return this.editorSession}getComponentRegistry(){return this.componentRegistry}getSurfaceManager(){return this.surfaceManager}getLabelProvider(){return this.labelProvider}}const wu={};class bu{constructor(e,t){this.entries={},this.names=[],this.validator=t,e&&r(e,function(e,t){this.add(t,e)}.bind(this))}contains(e){return this.entries.hasOwnProperty(e)}add(e,t){if(this.validator&&this.validator(t),wu[e])throw new Error('Illegal key: "'+e+'" is a property of Object which is thus not allowed as a key.');this.contains(e)&&this.remove(e),this.entries[e]=t,this.names.push(e)}remove(e){let t=this.names.indexOf(e);t>=0&&this.names.splice(t,1),delete this.entries[e]}clear(){this.names=[],this.entries={}}get(e,t){let r=this.entries[e];if(t&&!r)throw new Error("No entry registered for name "+e);return r}forEach(e){for(let t=0;t<this.names.length;t++){let r=this.names[t];if(!1===e(this.entries[r],r))break}}map(e){let t=[];return this.forEach((r,n)=>{t.push(e(r,n))}),t}filter(e){let t=[];return this.forEach(function(r,n){e(r,n)&&t.push(r)}),t}values(){return this.filter(()=>!0)}get _isRegistry(){return!0}}class vu{constructor(e,t){if(!e.editorSession)throw new Error("EditorSession required.");this.editorSession=e.editorSession,this.commands=t,this.context=Object.assign({},e,{doc:this.editorSession.getDocument()}),this._initialize(),this.editorSession.on("pre-render",this._onSessionUpdate,this),this._updateCommandStates(this.editorSession)}dispose(){this.editorSession.off(this)}executeCommand(e,t,r){let n=this._getCommand(e);if(!n)return void console.warn("command",e,"not registered");let s=this.editorSession.getCommandStates()[e],i=Object.assign(this._getCommandParams(),t,{commandState:s});if(!n.isAsync){return n.execute(i,this._getCommandContext())}this.editorSession.lock(),n.execute(i,this._getCommandContext(),(e,t)=>{e?r?r(e):console.error(e):r&&r(null,t),this.editorSession.unlock()})}_initialize(){this.commandRegistry=new bu,r(this.commands,e=>{this.commandRegistry.add(e.name,e)})}_getCommand(e){return this.commandRegistry.get(e)}_updateCommandStates(e){const t=this._getCommandContext(),r=this._getCommandParams(),n=r.surface,s=this.commandRegistry;let i={},o=s.names.slice();if(o.forEach(e=>{i[e]={disabled:!0}}),n){let e=n.props.commands,t=n.props.excludedCommands;e?o=e.filter(e=>s.contains(e)):t&&(o=Us(o,...t))}o.map(e=>s.get(e)).forEach(e=>{e&&(i[e.getName()]=e.getCommandState(r,t))}),this.commandStates=i,e.setCommandStates(i)}_onSessionUpdate(){const e=this.editorSession;(e.hasChanged("change")||e.hasChanged("selection")||e.hasChanged("commandStates"))&&this._updateCommandStates(e)}_getCommandContext(){return this.context}_getCommandParams(){let e=this.context.editorSession;return{editorSession:e,selectionState:e.getSelectionState(),selection:e.getSelection(),surface:e.getFocusedSurface()}}}class Cu extends bu{register(e){var t=e.prototype.type;if(!S(t)||!t)throw new Error("Node type must be string and not empty");if(!e.prototype._isNode)throw new Error("Nodes must be subclasses of Substance.Data.Node");this.contains(t)&&(console.info("Overriding node type",t),this.remove(t)),this.add(t,e)}}class Su{constructor(e,t){this.name=e,this.definition=t,Object.freeze(this),Object.freeze(t)}isArray(){return m(this.definition.type)}isReference(){return this.isArray()?"id"===Di(this.definition.type):"id"===this.definition.type}isText(){return Boolean(this.definition._isText)}isContainer(){return Boolean(this.definition._isContainer)}isOwned(){return Boolean(this.definition.owned)}isOptional(){return this.definition.optional||this.hasDefault()}isNotNull(){return Boolean(this.definition.notNull)}hasDefault(){return this.definition.hasOwnProperty("default")}getDefault(){return this.definition.default}createDefaultValue(){if(m(this.definition.type))return[];switch(this.definition.type){case"boolean":return!1;case"string":return"";case"number":return-1;case"object":return{};case"coordinate":return new ki([],0);default:return null}}get type(){return this.definition.type}get targetTypes(){return this.definition.targetTypes}get defaultTextType(){return this.definition.defaultTextType}get values(){return this.definition.values}}class xu{constructor(e,t){this._properties=e,this._superTypes=t,this._ownedPropNames=new Set,this._ownedProps=[];for(let t of e.values())(t.isReference()&&t.isOwned()||"file"===t.type)&&(this._ownedPropNames.add(t.name),this._ownedProps.push(t))}getProperty(e){return this._properties.get(e)}hasOwnedProperties(){return this._ownedPropNames.size>0}getOwnedProperties(){return this._ownedProps.slice()}isOwned(e){return this._ownedPropNames.has(e)}getSuperType(){return this._superTypes[0]}getSuperTypes(){return this._superTypes.slice()}[Symbol.iterator](){return this._properties.values()}}const Eu=new Set(["id","string","number","boolean","enum","object","array","coordinate"]);class Nu extends l{constructor(...e){super(),this._properties={},this._initialize(...e)}_initialize(e){let t=this.constructor.schema;for(let r of t){let t=r.name;const n=void 0!==e[t],s=r.isOptional(),i=r.hasDefault();if(!s&&!n)throw new Error("Property "+t+" is mandatory for node type "+this.type);n?this._properties[t]=Pu(r,e[t]):i&&(this._properties[t]=b(Pu(r,r.getDefault())))}}dispose(){this._disposed=!0}isDisposed(){return Boolean(this._disposed)}isInstanceOf(e){return Nu.isInstanceOf(this.constructor,e)}getSchema(){return this.constructor.schema}getTypeNames(){let e=this.constructor,t=this.schema.getSuperTypes();return e.hasOwnProperty("type")&&t.unshift(e.type),t}getPropertyType(e){return this.constructor.schema.getProperty(e).type}toJSON(){var e={type:this.type};const t=this.getSchema();for(let r of t){let t=this[r.name];r.isOptional()&&void 0===t||((m(t)||s(t))&&(t=b(t)),e[r.name]=t)}return e}get type(){return this.constructor.type}_set(e,t){this._properties[e]=t}static isInstanceOf(e,t){let r=e.schema;if(!r)return!1;if(e.type===t)return!0;for(let e of r._superTypes)if(e===t)return!0;return!1}get _isNode(){return!0}static _defineSchema(e){Nu.schema=e}}function Tu(e){return Eu.has(e)}function Pu(e,t){let r,n=e.name;if(r=e.isArray()?"array":e.type,null===t){if(e.isNotNull())throw new Error("Value for property "+n+" is null.");return t}if(void 0===t)throw new Error("Value for property "+n+" is undefined.");if("string"===r&&!S(t)||"enum"===r&&!S(t)||"boolean"===r&&!ed(t)||"number"===r&&!x(t)||"array"===r&&!m(t)||"id"===r&&!S(t)||"object"===r&&!s(t))throw new Error("Illegal value type for property "+n+": expected "+r+", was "+typeof t);return t}function Du(e){var t=[];let r=Iu(e);for(;r&&"@node"!==r.type;)r.hasOwnProperty("type")&&t.push(r.type),r=Iu(r);return t}function Iu(e){var t=Object.getPrototypeOf(e.prototype);if(t)return t.constructor}Object.defineProperty(Nu,"schema",{get(){let e=this;if(!e.hasOwnProperty("_schema")){let t=Iu(e).schema;e._schema=new xu(t._properties,Du(e))}return e._schema},set(e){let t=this;e.type&&(t.type=e.type),t._schema=function(e,t){let n=[function(e){let t=new Map;return r(e,function(e,r){"type"!==r&&((e=function(e){let t=Object.assign({},e),r=e.type;if(m(r)){let e=r,n=e.length-1,s=e[0],i=e[n],o="array"===s;o?(t.type=e.slice(),"id"===i||Tu(i)||(t.targetTypes=[i],t.type[n]="id")):e.length>1?(e.forEach(e=>{if(Tu(e))throw new Error("Multi-types must consist of node types.")}),t.type=["array","id"],t.targetTypes=e):Tu(s)?t.type=["array",s]:(t.type=["array","id"],t.targetTypes=e)}else"text"===r?t={type:"string",default:"",_isText:!0,targetTypes:e.targetTypes}:"id"===r||Tu(r)||(t.type="id",t.targetTypes=[r]);return t}(e=S(e)||m(e)?{type:e}:b(e))).name=r,t.set(r,new Su(r,e)))}),t}(t)],s=Iu(e);for(;s;)s&&s._schema&&n.unshift(s._schema._properties),s=Iu(s);let i=Du(e),o=new xu(function(e){let t=new Map;for(let r of e)for(let[e,n]of r)t.has(e)&&t.delete(e),t.set(e,n);return t}(n),i);for(let t of o){let r=t.name;Object.defineProperty(e.prototype,r,{get(){return this._properties[r]},set(e){this.set(r,e)},enumerable:!0,configurable:!0})}return o}(t,e)}}),Nu.schema={type:"@node",id:"string"};class Au{constructor(e){arguments.length>1&&(console.warn('DEPRECATED: use "new Schema(options)" instead'),e={name:arguments[0],version:arguments[1]}),this.name=e.name,this.version=e.version,this.nodeRegistry=new Cu,this.addNodes(this.getBuiltIns()),e.nodes&&this.addNodes(e.nodes)}addNodes(e){e&&r(e,e=>{e.prototype._isNode?this.addNode(e):console.error("Illegal node class: ",e)})}addNode(e){this.nodeRegistry.register(e)}getNodeClass(e,t){return this.nodeRegistry.get(e,t)}getBuiltIns(){return[]}isInstanceOf(e,t){var r=this.getNodeClass(e);return!!r&&Nu.isInstanceOf(r,t)}each(...e){return this.nodeRegistry.each(...e)}getDefaultTextType(){throw new Error("Schmema.prototype.getDefaultTextType() must be overridden.")}getNodeSchema(e){var t=this.getNodeClass(e);return t?t.schema:(console.error("Unknown node type ",e),null)}}class Ou{constructor(e,t){this.id=e,this.type=t,this.prev=null,this.property=null,this.pos=null}toJSON(){let e={id:this.id,type:this.type};return this.property&&(e.property=this.property),x(this.pos)&&(e.pos=this.pos),e}toArray(){let e=[this.toJSON()],t=this;for(;t.prev;)t=t.prev,e.unshift(t.toJSON());return e}}const ku=new class extends Xa.DomUtils{isTag(){return!0}getChildren(e){return Do(e)}getParent(e){return Io(e)}getAttributeValue(e,t){return e[t]}getAttributes(e){return["id",e.id]}hasAttrib(e,t){return"id"===t||e.hasOwnProperty(t)}getName(e){return e.type}getNameWithoutNS(e){return this.getName(e)}getText(e){return e.isText()?e.getText():""}};class Mu extends Nu{_initialize(e,t){this.document=e,super._initialize(t),this._xpath=new Ou(this.id,this.type)}getDocument(){return this.document}resolve(e){let t=this[e];if(t){let e=this.getDocument();return m(t)?t.map(t=>e.get(t)):e.get(t)}}set(e,t){this.getDocument().set([this.id,e],t)}assign(e){e&&Object.keys(e).forEach(t=>{this.set(t,e[t])})}hasParent(){return Boolean(this.parent)}getParent(){return S(this.parent)?this.document.get(this.parent):this.parent}setParent(e){S(e)&&(e=this.document.get(e)),this.parent=e}getRoot(){let e=this;for(;e.parent;)e=e.parent;return e}find(e){return ml.selectOne(e,this,{xmlMode:!0,adapter:ku})}findAll(e){return ml.selectAll(e,this,{xmlMode:!0,adapter:ku})}getXpath(){return this._xpath}getPosition(){return this._xpath.pos}isAnchor(){return this.constructor.isAnchor()}isAnnotation(){return this.constructor.isAnnotation()}isBlock(){return this.constructor.isBlock()}isContainer(){return this.constructor.isContainer()}isContainerAnnotation(){return this.constructor.isContainerAnnotation()}isInlineNode(){return this.constructor.isInlineNode()}isList(){return this.constructor.isList()}isListItem(){return this.constructor.isListItem()}isPropertyAnnotation(){return this.constructor.isPropertyAnnotation()}isText(){return this.constructor.isText()}static isAnchor(){return!1}static isAnnotation(){return!1}static isBlock(){return!1}static isContainer(){return!1}static isContainerAnnotation(){return!1}static isInlineNode(){return!1}static isList(){return!1}static isListItem(){return!1}static isPropertyAnnotation(){return!1}static isText(){return!1}get _isDocumentNode(){return!0}}function Lu(e){return class extends e{getContentPath(){throw new Error("This method is abstract")}getContent(){return this.getDocument().get(this.getContentPath())}contains(e){return this.getChildIndex(e)>=0}getNodeAt(e){const t=this._getNodeIdAt(e);if(t)return this.getDocument().get(t)}getNodes(){const e=this.getDocument();return this.getContent().map(t=>e.get(t)).filter(Boolean)}getNodeIndex(e){return this.getContent().indexOf(e)}getPath(){return this.getContentPath()}append(e){const t=arguments[0];return S(t)||t._isNode&&(e=t.id),this.insertAt(this.length,e)}insertAt(e,t){const r=this.getDocument(),n=this.length;if(!x(e)||e<0||e>n)throw new Error("Index out of bounds");if(!S(t)){if(!t._isNode)throw new Error("Invalid argument.");t=t.id}r.update(this.getContentPath(),{type:"insert",pos:e,value:t})}remove(e){const t=zi(this.getDocument(),this.getContentPath(),e);this.removeAt(t)}removeAt(e){const t=this.length;if(!(e>=0&&e<t))throw new Error("Index out of bounds.");this.getDocument().update(this.getContentPath(),{type:"delete",pos:e})}get length(){return this.getLength()}getLength(){return this.getContent().length}_getNodeIdAt(e){let t=this.getContent();return e<0||e>=t.length?void 0:t[e]}static isContainer(){return!0}}}class Ru extends(Lu(Mu)){getContentPath(){return[this.id,"nodes"]}getContent(){return this.nodes}}function qu(e){class t extends e{constructor(e,t){super(e,function(e){if(e.hasOwnProperty("start"))e.hasOwnProperty("end")&&!e.end.path&&(e.end.path=e.start.path);else{let t,r;(e.hasOwnProperty("startPath")||e.hasOwnProperty("path"))&&(t={path:e.startPath||e.path,offset:e.startOffset}),(e.hasOwnProperty("endPath")||e.hasOwnProperty("endOffset"))&&(r={path:e.endPath||e.path,offset:e.endOffset}),t&&!r&&(r=b(t)),t&&(delete(e=Object.assign({},e)).path,delete e.startPath,delete e.endPath,delete e.startOffset,delete e.endOffset,e.start=t,e.end=r)}return e}(t)),this._properties.start=new ki(this.start),this._properties.end=new ki(this.end)}get path(){return console.warn("DEPRECATED: use annotation.start.path instead"),this.start.path}getPath(){return this.start.path}get startPath(){return console.warn("DEPRECATED: use annotation.start.path instead."),this.start.path}set startPath(e){console.warn("DEPRECATED: use annotation.start.path instead."),this.start.path=e}get startOffset(){return console.warn("DEPRECATED: use annotation.start.offset instead."),this.start.offset}set startOffset(e){console.warn("DEPRECATED: use annotation.start.offset instead."),this.start.offset=e}get endPath(){return console.warn("DEPRECATED: use annotation.end.path instead."),this.end.path}set endPath(e){console.warn("DEPRECATED: use annotation.end.path instead."),this.end.path=e}get endOffset(){return console.warn("DEPRECATED: use annotation.end.offset instead."),this.end.offset}set endOffset(e){console.warn("DEPRECATED: use annotation.end.offset instead."),this.end.offset=e}getText(){var e=this.getDocument();return e?uo(e,this.getSelection()):(console.warn("Trying to use a Annotation which is not attached to the document."),"")}isAnnotation(){return!0}canSplit(){return!0}getSelection(){const e=this.getDocument();return e?this.isContainerAnnotation()?e.createSelection({type:"container",containerPath:this.containerPath,startPath:this.start.path,startOffset:this.start.offset,endPath:this.end.path,endOffset:this.end.offset}):this.getDocument().createSelection({type:"property",path:this.start.path,startOffset:this.start.offset,endOffset:this.end.offset}):(console.warn("Trying to use a ContainerAnnotation which is not attached to the document."),Ii.nullSelection())}_updateRange(e,t){if(t.isContainerSelection())E(this.start.path,t.start.path)||e.set([this.id,"start","path"],t.start.path),this.start.offset!==t.start.offset&&e.set([this.id,"start","offset"],t.start.offset),E(this.end.path,t.end.path)||e.set([this.id,"end","path"],t.end.path),this.end.offset!==t.end.offset&&e.set([this.id,"end","offset"],t.end.offset);else{if(!t.isPropertySelection())throw new Error("Invalid selection.");Oi(this.start.path,t.start.path)||e.set([this.id,"path"],t.start.path),this.start.offset!==t.start.offset&&e.set([this.id,"start","offset"],t.start.offset),this.end.offset!==t.end.offset&&e.set([this.id,"end","offset"],t.end.offset)}}static isAnnotation(){return!0}}return t.schema={start:{type:"coordinate",default:{path:[],offset:0}},end:{type:"coordinate",default:{path:[],offset:0}}},t}Ru.schema={type:"@container",nodes:{type:["array","id"],default:[],owned:!0}};class Bu extends(qu(Mu)){get _isAnnotation(){return!0}get _isPropertyAnnotation(){return!0}static isPropertyAnnotation(){return!0}static get autoExpandRight(){return!0}}Bu.schema={type:"@annotation",_content:{type:"string",optional:!0}};class Fu extends(qu(Mu)){setHighlighted(e,t){this.highlighted!==e&&(this.highlighted=e,this.highlightedScope=t,this.emit("highlighted",e,t),r(this.fragments,function(r){r.emit("highlighted",e,t)}))}static isAnnotation(){return!0}static isContainerAnnotation(){return!0}}Fu.schema={type:"@container-annotation",containerPath:{type:["array","id"]},start:"coordinate",end:"coordinate"};class ju extends Au{constructor(e){if(super(e),!e.DocumentClass)throw new Error("DocumentClass is mandatory");Object.assign(this,e)}getDocumentClass(){return this.DocumentClass}getDefaultTextType(){return this.defaultTextType}getBuiltIns(){return[Mu,Bu,Ru,Fu]}}class Hu extends bu{constructor(e){super(e,function(e){if(!e.prototype._isComponent)throw new Error("Component registry: wrong type. Expected a ComponentClass. Was: "+String(e))})}}class Uu extends Gd{render(e){return this.props.stack?e("span").addClass("fa-stack").append(this.props.stack.map(t=>e("i").addClass("fa "+t+" fa-stack"))):e("i").addClass("fa "+this.props.icon)}}class zu{constructor(e){this.faMap={},this.textMap={},r(e,(e,t)=>{let r=e.fontawesome;r&&(S(r)&&(r={icon:r}),this.addFAIcon(t,r));let n=e.text;n&&this.addTextIcon(t,n)})}renderIcon(e,t){let r=this.faMap[t],n=this.textMap[t];return r?e(Uu,r):n||void 0}addFAIcon(e,t){this.faMap[e]=t}addTextIcon(e,t){this.textMap[e]=t}}class Vu{constructor(e,t){this.lang=t||"en",this.labels=e}getLabel(e,t){let r=this.labels[this.lang];if(!r)return e;let n=r[e]||e;return t?this._evalTemplate(n,t):n}setLanguage(e){this.lang=e||"en"}_evalTemplate(e,t){return this._extractVariables(e).forEach(r=>{let n=new RegExp(`\\\${${r}}`,"g"),s=t[r];e=e.replace(n,s)}),e}_extractVariables(e){let t,r=/\${(\w+)}/g,n=[];for(;t=r.exec(e);)n.push(t[1]);return n}}function Gu(e){let t,r=e.clientX,n=e.clientY;if(document.body.createTextRange)(t=document.body.createTextRange()).moveToPoint(r,n);else if(!N(document.createRange))if(N(e.rangeParent))if(document.caretPositionFromPoint){let e=document.caretPositionFromPoint(r,n);(t=document.createRange()).setStart(e.offsetNode,e.offset),t.collapse(!0)}else document.caretRangeFromPoint&&(t=document.caretRangeFromPoint(r,n));else(t=document.createRange()).setStart(e.rangeParent,e.rangeOffset),t.collapse(!0);return t}function Ju(e,t){var r=t.left-e.left,n=t.top-e.top;return{left:r,top:n,right:e.width-r-t.width,bottom:e.height-n-t.height,width:t.width,height:t.height}}function Ku(e){if(y.inBrowser){const t=window.getSelection();if(0===t.rangeCount)return;const r=t.getRangeAt(0);let n=e,s=r.getBoundingClientRect();if(0===s.top&&0===s.bottom){let e=function(e,t){let r=e.anchorNode;if(!r||!r.getBoundingClientRect)return;let n=r.getBoundingClientRect();return{left:n.left,top:n.top,width:0,height:n.height,right:n.width,bottom:n.bottom}}(t);e&&(s=e)}return Ju(n,s)}}function $u(e){let t=window.getSelection();if(0===t.rangeCount)return!1;let r=t.getRangeAt(0).getBoundingClientRect();return e.clientX>=r.left&&e.clientX<=r.right&&e.clientY>=r.top&&e.clientY<=r.bottom}class Xu{match(e,t){return!1}drop(e,t){}get _isDragAndDropHandler(){return!0}}class Wu extends l{constructor(e,t){super(),this.context=t;let r=[],n=[];e.forEach(e=>{switch(e.type||"drop-asset"){case"drop-asset":r.push(e);break;case"move-inline":n.push(e);break;default:console.warn("Unknown type of drop handler.",e)}}),this.dropHandlers=[new Zu(n),new Yu,new Qu(r,this.context),new ep],y.inBrowser&&(this.el=Xh.wrapNativeElement(document),this.el.on("dragstart",this.onDragStart,this),this.el.on("drop",this.onDragEnd,this),this.el.on("dragenter",this.onDragEnter,this),this.el.on("dragexit",this.onDragExit,this),this.el.on("mousedown",this.onMousedown,this))}dispose(){this.el&&this.el.off(this)}onDragStart(e){this._initDrag(e,{external:!1});var t=document.createElement("img");t.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",e.dataTransfer.setDragImage(t,0,0),"inline"===this.dragState.mode?e.dataTransfer.setData("text/html",t.outerHTML):e.dataTransfer.setData("text/html","<div></div>")}onDragEnter(e){this.dragState||this._initDrag(e,{external:!0})}onDragEnd(e){e.__reserved__||this.dragState&&(e.stopPropagation(),e.preventDefault(),this._onDragEnd(e))}onDragExit(e){y.isFF||this._onDragEnd(e)}extendDragState(e){Object.assign(this.dragState,e)}onMousedown(e){this.dragState&&(this.dragState=null,this._onDragEnd(e))}_onDragEnd(e){this.dragState?this._handleDrop(e):console.warn("Not in a valid drag state."),this.emit("drag:finished"),this.dragState=null}_handleDrop(e){let t,r,n=this.dragState,s=!1;for(n.event=e,n.data=this._getData(e),t=0;t<this.dropHandlers.length&&!s;t++)s=(r=this.dropHandlers[t]).match(n);if(s){this.context.editorSession.transaction(e=>{r.drop(e,n)})}else console.error("No drop handler could be found.")}_initDrag(e,t){let r=this._getSelection(),n=Object.assign({startEvent:e},t);if(this.dragState=n,n.external)return n.selectionDrag=!1,n.sourceSelection=null,n.scrollPanes=this._getSurfacesGroupedByScrollPane(),void this.emit("drag:started",n);if((r.isPropertySelection()||r.isContainerSelection())&&$u(e))return r.isContainerSelection()?(console.warn("Dragging of ContainerSelection is not supported yet."),a()):(n.inline=!0,n.selectionDrag=!0,void(n.sourceSelection=r));let s,i=Gd.unwrap(e.target);if(!i)return a();if(i._isInlineNodeComponent?(s=i,n.inline=!0,n.sourceNode=i.props.node):s=i.context.isolatedNodeComponent,!s)return a();let o=s.context.surface;if(s._isInlineNodeComponent){let e=s.props.node;return n.inline=!0,n.selectionDrag=!0,void(n.sourceSelection={type:"property",path:e.start.path,startOffset:e.start.offset,endOffset:e.end.offset,containerPath:o.getContainerPath(),surfaceId:o.id})}function a(){e.preventDefault(),e.stopPropagation()}n.selectionDrag=!1,n.nodeDrag=!0,n.sourceSelection={type:"node",nodeId:s.props.node.id,containerPath:o.getContainerPath(),surfaceId:o.id},n.scrollPanes=this._getSurfacesGroupedByScrollPane(),this.emit("drag:started",n)}_getSurfacesGroupedByScrollPane(){let e={};return this.context.surfaceManager.getSurfaces().forEach(t=>{if(!t.isContainerEditor())return;let r=t.context.scrollPane,n=r.getName(),s=t.getName();if(e[n])e[n].surfaces[s]=t;else{let i={};i[s]=t,e[n]={scrollPane:r,surfaces:i}}}),e}_getSelection(){return this.context.editorSession.getSelection()}_getComponents(e){let t=[],r=e;for(;r;){let e=Gd.getComponentForDOMElement(r);if(e&&(t.unshift(e),e._isSurface))return t;r=r.parentNode}return null}_getIsolatedNodeOrContainerChild(e){let t,r;for(t=(r=e).parentNode;t;){if(t._comp&&t._comp._isContainerEditor)return r._comp;if(r._comp&&r._comp._isIsolatedNode)return r._comp;t=(r=t).parentNode}}_extractUris(e){let t=[],r=e.getData("text/uri-list");return r&&(t=r.split("\n").filter(function(e){return!e.startsWith("#")})),t}_getData(e){let t=e.dataTransfer;if(t)return{files:Array.prototype.slice.call(t.files),uris:this._extractUris(t),text:t.getData("text/plain"),html:t.getData("text/html")}}}class Yu extends Xu{match(e){let{insertPos:t}=e.dropParams;return!e.external&&e.nodeDrag&&"place"===e.dropType&&t>=0}drop(e,t){let{insertPos:r}=t.dropParams;e.setSelection(t.sourceSelection);let n=e.copySelection();e.deleteSelection({clear:!0});let s=t.targetSurface.getContainerPath(),i=t.targetSurface.getName(),o=e.get(s),a=o[r],l="before";a||(a=o[r-1],l="after"),e.setSelection({type:"node",nodeId:a,mode:l,containerPath:s,surfaceId:i}),e.paste(n)}}class Zu extends Xu{match(e){return!e.external&&e.inline}drop(e,t){let r=t.event,n=t.sourceSelection,s=Gu(r);if(!s)return;let i=Gd.unwrap(r.target);if(!i)return;let o=i.context.domSelection;if(!o)return;let a=o.mapDOMRange(s);if(!a)return;let l=e.getDocument()._createSelectionFromRange(a);e.selection=n;let c=e.copySelection();e.deleteSelection(),e.selection=Mo(l,e),e.paste(c)}}class Qu extends Xu{constructor(e,t){super(),this.assetHandlers=e,this.context=t}match(e){return"place"===e.dropType&&e.external}drop(e,t){let{insertPos:r}=t.dropParams,n=t.data.files,s=t.data.uris,i=t.targetSurface.getContainerPath(),o=t.targetSurface.id,a=e.get(i),l=a[r],c="before";l||(l=a[r-1],c="after"),e.setSelection({type:"node",nodeId:l,mode:c,containerPath:i,surfaceId:o}),n.length>0?n.forEach(t=>{this._callHandlers(e,{file:t,type:"file"})}):s.length>0?s.forEach(t=>{this._callHandlers(e,{uri:t,type:"uri"})}):console.info("TODO: implement html/text drop here")}_callHandlers(e,t){let r,n;for(r=0;r<this.assetHandlers.length;r++){if((n=this.assetHandlers[r]).match(t,this.context)){n.drop(e,t,this.context);break}}}}class ep extends Xu{match(e){return"custom"===e.dropType}drop(e,t){t.component.handleDrop(e,t)}}class tp{constructor(e,t){this.extensions=e,this.proxies={},this.context=t;const n=t.editorSession;if(!n)throw new Error("'context.editorSession' is required.");r(n.getDocument().getNodes(),e=>{e._isFileNode&&this.storeFile(e)}),n.onUpdate("document",this._onDocumentChange,this)}dispose(){this.context.editorSession.off(this)}storeFile(e){let t=this.proxies[e.id];return t||(t=this.createFileProxy(e))&&(this.proxies[e.id]=t),e.proxy=t,t}createFileProxy(e){let t=this.context;for(var r=0;r<this.extensions.length;r++){let n=this.extensions[r];if(n.match(e,t))return new n(e,t)}console.error("No file adapter found for ",e)}getProxy(e){return this.proxies[e.id]}sync(){let e=g(this.proxies,e=>e.sync());return Promise.all(e)}_onDocumentChange(e){let t=this.context.editorSession.getDocument();r(e.created,(e,r)=>{let n=t.get(r);n._isFileNode&&this.storeFile(n)})}}const rp=["keydown","keyup","keypress","mousedown","mouseup","copy"];class np{constructor(){this.listeners=[],this.initialize()}initialize(){if(y.inBrowser){let e=Xh.wrapNativeElement(window.document);rp.forEach(function(t){e.on(t,this._dispatch.bind(this,t),this)}.bind(this))}}dispose(){if(y.inBrowser){Xh.wrapNativeElement(window.document).off(this)}}addEventListener(e,t,r){if(!r.id)throw new Error("GlobalEventHandler can only be used with option 'id'");let n=new Yo(e,t,r);this.listeners.push(n)}removeEventListener(e){let t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}getEventListeners(){return this.listeners}_getActiveListener(e){const t=this.getSelection();if(t){let r=t.surfaceId;for(let t=0;t<this.listeners.length;t++){let n=this.listeners[t];if(n.eventName===e&&n.options.id===r)return n}}}_dispatch(e,t){const r=this._getActiveListener(e);r&&r.handler(t)}on(...e){return Qo.prototype.on.apply(this,e)}off(...e){return Qo.prototype.off.apply(this,e)}}class sp extends np{constructor(e){super(),this.editorSession=e}getSelection(){return this.editorSession.getSelection()}}function ip(e,t){let r=[];return e.altKey&&("AltRight"===e.code?r.push("ALTGR"):r.push("ALT")),e.ctrlKey&&r.push("CTRL"),e.metaKey&&r.push("META"),e.shiftKey&&r.push("SHIFT"),t||r.push(e.keyCode),r.join("+")}class op{constructor(e){const t=e.editorSession;t&&(this.editorSession=t,this.selection=t.getSelection(),this.selectionState=t.getSelectionState(),this.surface=t.getFocusedSurface())}}class ap{onKeydown(e,t){let r=ip(e),n=this._getBindings("keydown",r);if(n){t=t||this._getContext();let r=this._getParams(t),s=!1;for(let e=0;e<n.length&&!s;e++){s=(0,n[e])(r,t)}return s&&(e.preventDefault(),e.stopPropagation()),s}}onTextInput(e,t){let r=this._getBindings("textinput",e);if(r){t=t||this._getContext();let e=this._getParams(t),n=!1;for(let s=0;s<r.length&&!n;s++){n=(0,r[s])(e,t)}return n}}_getParams(e){return new op(e)}_getBindings(e,t){throw new Error("This method is abstract")}_getContext(){throw new Error("This method is abstract")}}function lp(e){let t=e.split("+"),r={keyCode:-1};for(var n=0;n<t.length;n++){let s=t[n].toUpperCase();switch(s){case"ALT":r.altKey=!0;break;case"ALTGR":r.altKey=!0,r.code="AltRight";break;case"CMD":r.metaKey=!0;break;case"CTRL":r.ctrlKey=!0;break;case"COMMANDORCONTROL":y.isMac?r.metaKey=!0:r.ctrlKey=!0;break;case"MEDIANEXTTRACK":r.code="MediaTrackNext";break;case"MEDIAPLAYPAUSE":r.code="MediaPlayPause";break;case"MEDIAPREVIOUSTRACK":r.code="MediaPreviousTrack";break;case"MEDIASTOP":r.code="MediaStop";break;case"SHIFT":r.shiftKey=!0;break;case"SUPER":r.metaKey=!0;break;default:if(1===s.length)r.keyCode=s.charCodeAt(0);else{if(!lu.hasOwnProperty(s))throw new Error("Unsupported keyboard command: "+e);r.keyCode=lu[s]}}}return r}class cp extends ap{constructor(e,t,r){super(),this.editorSession=e,this.context=r.context||{},this.keydownBindings={},this.textInputBindings={},t.forEach(({key:t,spec:r})=>{let n=r.type||"keydown";if(!r.command)throw new Error("Keyboard binding not supported",r);{let s=new hp(e,r.command),i=s.execute.bind(s);"keydown"===n?(t=ip(lp(t)),this.keydownBindings[t]||(this.keydownBindings[t]=[]),this.keydownBindings[t].push(i)):"textinput"===n&&(this.textInputBindings[t]=i)}})}_getBindings(e,t){switch(e){case"keydown":return this.keydownBindings[t];case"textinput":return this.textInputBindings[t];default:throw new Error("Unsupported keyboard event type")}}_getContext(){return this.context}static parseCombo(...e){return ip(lp(...e))}}class hp{constructor(e,t){this.editorSession=e,this.commandName=t}execute(e){let t=e.editorSession.getCommandStates()[this.commandName];return!(!t||t.disabled)&&(this.editorSession.executeCommand(this.commandName,e),!0)}}class dp{constructor(e,t){this.context=e,this.macros=t,this.context.editorSession.onFinalize("document",this.onDocumentChanged,this)}dispose(){this.context.editorSession.off(this)}onDocumentChanged(e,t){this.executeMacros(e,t)}executeMacros(e,t){let r,n,s,i,o,a,l=this.context.editorSession.getDocument();switch(t.action){case"type":{let t=e.ops[0];"update"===t.type&&t.diff._isTextOperation&&(r=(a=t.path)[0],n=l.get(r),s=l.get(a),o=(i=t.diff.pos)+t.diff.getLength());break}case"break":{let t=e.before.selection;if(!t.isPropertySelection())return;if(r=(a=t.path)[0],!(n=l.get(r))||!n.isText())return;s=n.getText(),o=i=t.start.offset;break}case"paste":if(1===e.ops.length){let t=e.ops[0];if("update"===t.type&&"string"===t.propertyType){if(r=(a=t.path)[0],!(n=l.get(r)).isText())return;s=n.getText(),o=(i=t.diff.pos)+t.diff.getLength()}}break;default:return}let c={action:t.action,node:n,path:a,text:s,start:i,end:o,editorSession:this.context.editorSession,selection:this.context.editorSession.getSelection()};setTimeout(()=>{for(let e=0;e<this.macros.length;e++){if(this.macros[e].execute(c,this.context))break}})}}class up{add(e,t){let r=this._getKey(e);this[r]||(this[r]=[]),this[r].push(t)}remove(e,t){let r=this._getKey(e);this[r]&&Qh(this[r],t)}get(e){return this[this._getKey(e)]||[]}_getKey(e){return S?e:v(e)}}class pp extends Bu{_initialize(e,t){if(this.document=e,this.type=t.type,!t.type)throw new Error("'type' is mandatory");if(!t.start)throw new Error("'start' is mandatory");if(!t.end)throw new Error("'end' is mandatory");Object.assign(this._properties,t)}containsSelection(e){return!e.isNull()&&(e.isPropertySelection()?Oi(this.start.path,e.start.path)&&this.start.offset<=e.start.offset&&this.end.offset>=e.end.offset:void console.warn("Marker.contains() does not support other selection types."))}get type(){return this._type}set type(e){this._type=e}get _isPropertyAnnotation(){return!1}get _isMarker(){return!0}}class fp{constructor(e){this.editorSession=e,this._textProperties={},this._dirtyProps={},this._markers=new gp(this),e.onUpdate("document",this._onChange,this),e.onRender(this._updateProperties,this)}dispose(){this.editorSession.off(this),this._markers.dispose()}setMarkers(e,t){this.clearMarkers(e),t.forEach(t=>this.addMarker(e,t))}addMarker(e,t){t._key=e,t._isMarker||(t=new pp(this.editorSession.getDocument(),t)),this._markers.add(t)}clearMarkers(e){this._markers.clear(e)}register(e){let t=String(e.getPath()),r=this._textProperties[t];r||(r=this._textProperties[t]=[]),r.push(e)}deregister(e){let t=String(e.getPath()),r=this._textProperties[t];r&&(Qh(this._textProperties[t],e),0===r.length&&delete this._textProperties[t])}getMarkers(e,t){t=t||{};let r=this.editorSession.getDocument().getAnnotations(e)||[],n=this._markers.get(e,t.surfaceId,t.containerPath);return r.concat(n)}_onChange(e){this._markers._onDocumentChange(e),this._recordDirtyTextProperties(e)}_recordDirtyTextProperties(e){r(e.updated,(e,t)=>{this._dirtyProps[t]=!0})}_updateProperties(){Object.keys(this._dirtyProps).forEach(e=>{let t=this._textProperties[e];t&&t.forEach(this._updateTextProperty.bind(this))}),this._dirtyProps={}}_updateTextProperty(e){let t=e.getPath(),r=this.getMarkers(t,{surfaceId:e.getSurfaceId(),containerPath:e.getContainerPath()});e.setState({markers:r})}}class gp{constructor(e){this._manager=e,this._byKey=new up,this._documentMarkers=new up,this._surfaceMarkers={},this._containerMarkers={}}get(e,t){let r=this._documentMarkers[e]||[];if(t&&this._surfaceMarkers[t]){let n=this._surfaceMarkers[t][e];n&&(r=r.concat(n))}return r}add(e){const t=e._key;this._byKey.add(t,e),this._add(e)}remove(e){const t=e._key;this._byKey.remove(t,e),this._remove(e)}clear(e){this._byKey.get(e).forEach(e=>{this._remove(e)})}_add(e){const t=this._manager._dirtyProps;switch(e.scope||"document"){case"document":{const r=e.start.path;t[r]=!0,this._documentMarkers.add(r,e);break}case"surface":{this._surfaceMarkers[e.surfaceId]||(this._surfaceMarkers[e.surfaceId]=new up);const r=e.start.path;t[r]=!0,this._surfaceMarkers[e.surfaceId].add(r,e);break}case"container":console.warn("Container scoped markers are not supported yet");break;default:console.error("Invalid marker scope.")}}_remove(e){const t=this._manager._dirtyProps;switch(e.scope||"document"){case"document":{const r=e.start.path;t[r]=!0,this._documentMarkers.remove(r,e);break}case"surface":{this._surfaceMarkers[e.surfaceId]||(this._surfaceMarkers[e.surfaceId]=new up);const r=e.start.path;t[r]=!0,this._surfaceMarkers[e.surfaceId].remove(r,e);break}case"container":console.warn("Container scoped markers are not supported yet");break;default:console.error("Invalid marker scope.")}}_getAllCustomMarkers(e){let t=this._documentMarkers[e]||[];for(let r in this._surfaceMarkers){if(!this._surfaceMarkers.hasOwnProperty(r))continue;let n=this._surfaceMarkers[r][e];n&&(t=t.concat(n))}return t}_onDocumentChange(e){e.ops.forEach(e=>{if("update"===e.type&&e.diff._isTextOperation){let t=this._getAllCustomMarkers(e.path),r=e.diff;switch(r.type){case"insert":this._transformInsert(t,r);break;case"delete":this._transformDelete(t,r)}}})}_transformInsert(e,t){const r=t.pos,n=t.str.length;0!==n&&e.forEach(e=>{var t=e.start.offset,s=e.end.offset,i=t,o=s;if(!(r>=s))return r<=t?(i+=n,o+=n,e.start.offset=i,void(e.end.offset=o)):void(r<s&&(o+=n,e.end.offset=o,this._remove(e)))})}_transformDelete(e,t){const r=t.pos,n=t.str.length,s=r+n;r!==s&&e.forEach(e=>{var t=e.start.offset,i=e.end.offset,o=t,a=i;if(s<=t)o-=n,a-=n,e.start.offset=o,e.end.offset=a;else if(r>=i);else{if(r<=t&&(o=t-Math.min(s-r,t-r)),r<=i&&(a=i-Math.min(s-r,i-r)),t!==i&&o===a)return void this._remove(e);t!==o&&(e.start.offset=o),i!==a&&(e.end.offset=a),this._remove(e)}})}}class mp{constructor(e){this.editorSession=e,this.surfaces={},this._state={selection:null},e.onUpdate("selection",this._onSelectionChanged,this),e.onPostRender(this._recoverDOMSelection,this)}dispose(){this.editorSession.off(this)}getSurface(e){if(e)return this.surfaces[e]}getFocusedSurface(){const e=this._state.selection;if(e&&e.surfaceId)return this.getSurface(e.surfaceId)}getSurfaces(){return Object.keys(this.surfaces).map(e=>this.surfaces[e])}registerSurface(e){const t=e.getId();this.surfaces[t]&&console.error(`A surface with id ${t} has already been registered.`),this.surfaces[t]=e}unregisterSurface(e){e.off(this);let t=e.getId();this.surfaces[t]===e&&delete this.surfaces[t]}_onSelectionChanged(e){this._state.selection=e,e&&e.isCustomSelection()&&y.inBrowser&&(window.getSelection().removeAllRanges(),window.document.activeElement.blur())}_recoverDOMSelection(){if(this.editorSession._blurred)return;let e=this.getFocusedSurface();e&&!e.isDisabled()&&(e._focus(),e.rerenderDOMSelection())}}class _p{saveDocument({fileManager:e}){return console.info("Simulating save ..."),e.sync().then(()=>{console.info("Creating document snapshot...")})}}class yp{constructor(){this.config={schema:{},nodes:{},tools:{},components:{},converters:{},importers:{},exporters:{},fileProxies:[],commands:{},commandGroups:{},toolPanels:{},editingBehaviors:[],macros:[],managers:{},dropHandlers:[],keyboardShortcuts:[],icons:{},labels:{},lang:"en",editorOptions:[],CommandManagerClass:vu,DragManagerClass:Wu,SaveHandlerClass:null}}defineSchema(e){if(e.ArticleClass&&(console.warn("DEPRECATED: schema.ArticleClass is now called schema.DocumentClass"),e.DocumentClass=e.ArticleClass),!e.DocumentClass)throw new Error("schema.DocumentClass is mandatory");this.config.schema=e}addEditorOption(e){if(!e.key)throw new Error("An option key must be defined");if(!e.value)throw new Error("An option value must be defined");this.config.editorOptions[e.key]=e.value}getEditorOptions(){return this.config.editorOptions}addNode(e,t){let r=e.type;if(!r)throw new Error("A NodeClass must have a type.");if(this.config.nodes[r]&&!t)throw new Error("NodeClass with this type name is already registered: "+r);this.config.nodes[r]=e}addConverter(e,t){let r=this.config.converters[e];if(r||(r={},this.config.converters[e]=r),io(t)){t=new t}if(!t.type)throw new Error("A converter needs an associated type.");r[t.type]=t}addImporter(e,t){this.config.importers[e]=t}addExporter(e,t){this.config.exporters[e]=t}addComponent(e,t,r){if(!r&&this.config.components[e])throw new Error(e+" already registered");if(!t)throw new Error("Provided nil for component "+e);if(!t.prototype._isComponent)throw new Error("ComponentClass must be a subclass of ui/Component.");this.config.components[e]=t}addCommand(e,t,r){if(!S(e))throw new Error("Expecting 'name' to be a String");if(!t)throw new Error("Provided nil for command "+e);if(!t.prototype._isCommand)throw new Error("Expecting 'CommandClass' to be of type ui/Command.");if(r=r||{},this.config.commands[e]&&!r.force)throw new Error(`Another command with name ${e} has already been registered. Use 'options.force' if this is intentional.`);this.config.commands[e]={name:e,CommandClass:t,options:r};let n=r.commandGroup;n&&(this.config.commandGroups[n]||(this.config.commandGroups[n]=[]),this.config.commandGroups[n].push(e))}addTool(e,t){if(!S(e))throw new Error("Expecting 'name' to be a String");if(!t)throw new Error("Provided nil for tool "+e);if(!t||!t.prototype._isTool)throw new Error("Expecting 'ToolClass' to be of type ui/Tool. name:",e);this.config.tools[e]=t}getTools(){return this.config.tools}addToolPanel(e,t){this.config.toolPanels[e]=t}getToolPanel(e){return this.config.toolPanels[e]}addManager(e,t){this.config.managers[e]=t}getManagers(){return this.config.managers}addIcon(e,t){var r=this.config.icons[e];r||(r={},this.config.icons[e]=r),Object.assign(r,t)}addLabel(e,t){S(t)?(this.config.labels.en||(this.config.labels.en={}),this.config.labels.en[e]=t):r(t,function(t,r){this.config.labels[r]||(this.config.labels[r]={}),this.config.labels[r][e]=t}.bind(this))}addSeed(e){this.config.seed=e}addEditingBehavior(e){console.error("Support for custom EditingBehaviors has been removed. Instead you can override Document.getEditingInterface()")}addMacro(e){this.config.macros.push(e)}addDragAndDrop(e){if(console.warn("DEPRECATED: Use addDropHandler() instead"),!e.prototype._isDragAndDropHandler)throw new Error("Only instances of DragAndDropHandler are allowed.");this.addDropHandler(new e)}addDropHandler(e){e._isDragAndDropHandler&&(e.type=e.type||"drop-asset"),this.config.dropHandlers.push(e)}addKeyboardShortcut(e,t){let r={key:e,spec:t};this.config.keyboardShortcuts.push(r)}addFileProxy(e){this.config.fileProxies.push(e)}getFileAdapters(){return this.config.fileProxies.slice(0)}import(e,t){return e.configure(this,t||{}),this}getConfig(){return this.config}getStyles(){return this.config.styles}getSchema(){return this.schema||(this.schema=new ju(this.config.schema),this.schema.addNodes(this.config.nodes)),this.schema}getDocumentClass(){return this.config.schema.DocumentClass}createArticle(e){return console.warn("DEPRECATED: createArticle is now called createDocument"),this.createDocument(e)}createDocument(e){const t=this.getSchema();let r=new(t.getDocumentClass())(t);return e&&e(r),r}createImporter(e,t,r={}){return new(0,this.config.importers[e])(Object.assign({schema:this.getSchema(),converters:this.getConverterRegistry().get(e).values()},r),t)}createExporter(e,t,r={}){return new(0,this.config.exporters[e])(Object.assign({schema:this.getSchema(),converters:this.getConverterRegistry().get(e).values()},r),t)}getComponentRegistry(){var e=new Hu;return r(this.config.components,function(t,r){e.add(r,t)}),e}getCommands(){return g(this.config.commands,function(e,t){return new e.CommandClass(Object.assign({name:t},e.options))})}getCommandGroups(){return this.config.commandGroups}getConverterRegistry(){if(!this.converterRegistry){var e=new bu;r(this.config.converters,function(t,r){e.add(r,new bu(t))}),this.converterRegistry=e}return this.converterRegistry}getDropHandlers(){return this.config.dropHandlers.slice(0)}getSeed(){return this.config.seed}getIconProvider(){return new zu(this.config.icons)}getEditingBehavior(){console.error("Support for custom EditingBehaviors has been removed. Instead you can override Document.getEditingInterface()")}getMacros(){return this.config.macros}getKeyboardShortcuts(){return this.config.keyboardShortcuts}getFindAndReplaceConfig(){return this.config.findAndReplace}setFindAndReplaceConfig(e){this.config.findAndReplace=e}getKeyboardShortcutsByCommand(){let e={};return this.config.keyboardShortcuts.forEach(t=>{if(t.spec.command){let r=t.key.toUpperCase();r=y.isMac?(r=(r=(r=(r=(r=r.replace(/CommandOrControl/i,"⌘")).replace(/Ctrl/i,"^")).replace(/Shift/i,"⇧")).replace(/Enter/i,"↵")).replace(/Alt/i,"⌥")).replace(/\+/g,""):r.replace(/CommandOrControl/i,"Ctrl"),e[t.spec.command]=r}}),e}setDefaultLanguage(e){this.config.lang=e}getDefaultLanguage(){return this.config.lang||"en"}setCommandManagerClass(e){this.config.CommandManagerClass=e}getCommandManagerClass(){return this.config.CommandManagerClass||vu}setDragManagerClass(e){this.config.DragManagerClass=e}getDragManagerClass(){return this.config.DragManagerClass||Wu}setFileManagerClass(e){this.config.FileManagerClass=e}getFileManagerClass(){return this.config.FileManagerClass||tp}setGlobalEventHandlerClass(e){this.config.GlobalEventHandlerClass=e}getGlobalEventHandlerClass(){return this.config.GlobalEventHandlerClass||sp}setKeyboardManagerClass(e){this.config.KeyboardManagerClass=e}getKeyboardManagerClass(){return this.config.KeyboardManagerClass||cp}setMacroManagerClass(e){this.config.MacroManagerClass=e}getMacroManagerClass(){return this.config.MacroManagerClass||dp}setMarkersManagerClass(e){this.config.MarkersManagerClass=e}getMarkersManagerClass(){return this.config.MarkersManagerClass||fp}setSurfaceManagerClass(e){this.config.SurfaceManagerClass=e}getSurfaceManagerClass(){return this.config.SurfaceManagerClass||mp}setSaveHandlerClass(e){this.config.SaveHandlerClass=e}getSaveHandler(){return new(this.config.SaveHandlerClass||_p)}getLabelProviderClass(){return this.config.LabelProviderClass||Vu}setLabelProviderClass(e){this.config.LabelProviderClass=e}getLabelProvider(){return new(this.getLabelProviderClass())(this.config.labels)}}class wp extends Gd{didMount(){this.context.editorSession.onRender("commandStates",this._onCommandStatesChanged,this)}dispose(){this.context.editorSession.off(this)}render(e){throw new Error("This method is abstract")}getEntryTypeComponents(){return{"tool-group":this.getComponent("tool-group"),"tool-dropdown":this.getComponent("tool-dropdown"),"tool-prompt":this.getComponent("tool-prompt"),"tool-separator":this.getComponent("tool-separator")}}renderEntries(e){return this.props.toolPanel.map(t=>{let r=this.getEntryTypeComponents()[t.type];if(!r)throw new Error("Toolpanel entry type not found");let n=Object.assign({},t,{theme:this.getTheme()}),s=e(r,n);return t.name&&s.ref(t.name),s})}hasEnabledTools(){let e=!1;return this.refs.entriesContainer.childNodes.forEach(t=>{t.hasEnabledTools()&&(e=!0)}),e}getActiveToolGroupNames(){throw new Error("Abstract method")}showDisabled(){return!1}getToolStyle(){throw new Error("Abstract method")}getTheme(){return this.props.theme||"dark"}_onCommandStatesChanged(){this.rerender()}}class bp extends wp{didMount(){if(super.didMount(),!this.context.scrollPane)throw new Error("Requires a scrollPane context");this.context.scrollPane.on("context-menu:opened",this._onContextMenuOpened,this)}dispose(){super.dispose(),this.context.scrollPane.off(this)}render(e){let t=e("div").addClass("sc-context-menu sm-hidden");return t.addClass("sm-theme-"+this.getTheme()),t.append(e("div").addClass("se-active-tools").append(this.renderEntries(e)).ref("entriesContainer")),t}show(e){this.el.removeClass("sm-hidden"),this._position(e)}hide(){this.el.addClass("sm-hidden")}_onContextMenuOpened(e){let t=e.mouseBounds;this.el.removeClass("sm-hidden");let r=this.el.htmlProp("offsetWidth");this.el.css("top",t.top);let n=t.left;n=Math.max(n,0);let s=t.left+t.right-r;n=Math.min(n,s),this.el.css("left",n)}getTheme(){return this.props.theme||"dark"}}function vp(e,t){let r;var n,s,i,o,a;r=t._isDOMElement?t.getNativeElement():t,m(e)||(e=[e]);let l=Cp(e.map(e=>{let t;return t=e._isDOMElement?e.getNativeElement():e,e=t,s=r.getBoundingClientRect(),i=Cp(e.getClientRects()),o=i.left-s.left,a=i.top-s.top,{left:o,top:a,right:s.width-o-i.width,bottom:s.height-a-i.height,width:i.width,height:i.height}})),c=r.getBoundingClientRect();return{left:l.left,top:l.top,right:c.width-l.left-l.width,bottom:c.height-l.top-l.height,width:l.width,height:l.height}}function Cp(e){var t={left:Number.POSITIVE_INFINITY,top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY,width:Number.NaN,height:Number.NaN};return r(e,function(e){e.left<t.left&&(t.left=e.left),e.top<t.top&&(t.top=e.top),e.left+e.width>t.right&&(t.right=e.left+e.width),e.top+e.height>t.bottom&&(t.bottom=e.top+e.height)}),t.width=t.right-t.left,t.height=t.bottom-t.top,t}class Sp extends Gd{didMount(){const e=this._getDragManager();e&&(e.on("drag:started",this.onDragStarted,this),e.on("drag:finished",this.onDragFinished,this))}dispose(){const e=this._getDragManager();e&&e.off(this)}render(e){let t=e("div").addClass("sc-dropzones");return this.state.dropzones?(t.on("dragenter",this.onDrag).on("dragover",this.onDrag),r(this.state.dropzones,(r,n)=>{r.forEach((r,s)=>{let i,o=r.type;if("place"===o?i=e("div").addClass("se-dropzone").attr({"data-dropzone-index":s,"data-dropzone-surface":n}).append(e("div").addClass("se-drop-teaser").css({top:r.teaserPos})):"custom"===o&&(i=e("div").addClass("se-custom-dropzone").attr({"data-dropzone-index":s,"data-dropzone-surface":n}).append(e("div").addClass("se-message").append(r.message))),i){let n=e("div").addClass("se-drop-shield").on("dragenter",this.onDragEnter).on("dragleave",this.onDragLeave).on("drop",this.onDrop).on("mouseenter",this.onDragEnter).on("mouseleave",this.onDragLeave).on("mouseup",this.onDrop);i.append(n),i.css({position:"absolute",top:r.top,left:r.left,width:r.width,height:r.height}),t.append(i)}})})):t.addClass("sm-hidden"),t}onDragStarted(e){let t=this._computeDropzones(e);setTimeout(()=>{this.setState({dropzones:t})},250)}onDragFinished(){this.setState({})}onDragEnter(e){e.target.parentNode.classList.add("sm-over")}onDragLeave(e){e.target.parentNode.classList.remove("sm-over")}onDrag(e){e.preventDefault()}onDrop(e){e.__reserved__=!0,e.preventDefault(),e.stopPropagation();let t=e.target.parentNode.dataset.dropzoneIndex,r=e.target.parentNode.dataset.dropzoneSurface,n=this.state.dropzones[r][t],s=n.dropParams,i=n.type,o=this.context.surfaceManager.getSurface(r),a=n.component,l=n.dropzoneComponent,c=this.context.dragManager;c.extendDragState({targetSurface:o,dropType:i,dropParams:s,component:a,dropzoneComponent:l}),c._onDragEnd(e)}_getDragManager(){return this.context.dragManager}_getBoundingRect(e){let t=e.context.scrollPane.getContentElement();return vp(e.el,t)}_computeDropzones(e){let t=this.context.scrollPane.getName(),n={};return r(e.scrollPanes[t].surfaces,e=>{let t=e.childNodes,r=t.length+1,s=[];for(let e=0;e<r;e++){if(0===e){let r=this._getBoundingRect(t[0]);s.push({type:"place",left:r.left,top:r.top,width:r.width,height:r.height/2,teaserPos:0,dropParams:{insertPos:e}})}else if(e===r-1){let r=this._getBoundingRect(t[e-1]);s.push({type:"place",left:r.left,top:r.top+r.height/2,width:r.width,height:r.height/2,teaserPos:r.height/2,dropParams:{insertPos:e}})}else{let r=this._getBoundingRect(t[e-1]),n=this._getBoundingRect(t[e]),i=r.top+r.height/2,o=n.top+n.height/2;s.push({type:"place",left:r.left,top:i,width:r.width,height:o-i,teaserPos:(r.top+r.height+n.top)/2-i,dropParams:{insertPos:e}})}if(e<r-1){let r=t[e];if(r._isIsolatedNodeComponent&&(r=r.getContent()),r.getDropzoneSpecs){r.getDropzoneSpecs().forEach(e=>{let t=e.component,n=this._getBoundingRect(t);s.push({type:"custom",component:r,dropzoneComponent:t,left:n.left,top:n.top,width:n.width,height:n.height,message:e.message,dropParams:e.dropParams})})}}}n[e.getName()]=s}),n}_renderDropTeaser(e){e.visible?(this.el.removeClass("sm-hidden"),this.el.css("top",e.rect.top),this.el.css("left",e.rect.left),this.el.css("right",e.rect.right)):this.el.addClass("sm-hidden")}}class xp{constructor(){this.reset()}reset(){this.doneChanges=[],this.undoneChanges=[],this.lastChange=null}canUndo(){return this.doneChanges.length>0}canRedo(){return this.undoneChanges.length>0}push(e){this.doneChanges.push(e),this.undoneChanges=[]}}class Ep{constructor(e){this.master=e,this.stage=e.newInstance().createFromDocument(e),this.stage._isTransactionDocument=!0,this.tx=this.stage.createEditingInterface(),this._isTransacting=!1,e._ops.length=0}dispose(){this.stage.dispose()}get ops(){return this.stage._ops}set ops(e){this.stage._ops=e}_reset(){this._before={},this._after={},this.stage._ops.length=0,this._info={}}_recordChange(e,t){if(this._isTransacting)throw new Error("Nested transactions are not supported.");if(!io(e))throw new Error("Document.transaction() requires a transformation function.");let r,n=!1;this._isTransacting=!0,this._reset();try{e(this.tx);let s=this.ops;if(s.length>0&&((r=new Oo(s,{},{})).info=t,this.master._isXMLDocument))if(t&&"type"===t.action);else{let e=this.stage._validateChange(r);if(!e.ok)throw new Error("Transaction is violating the schema: \n"+e.errors.map(e=>e.msg).join("\n"))}n=!0}finally{n||this._rollback(),this._isTransacting=!1}return r}_sync(){const e=this.master,t=this.stage;let r=e._ops;for(let e=0;e<r.length;e++)t._applyOp(r[e]);r.length=0}__applyChange__(e){const t=this.stage,r=e.ops;for(let e=0;e<r.length;e++)t._applyOp(r[e])}_rollback(){const e=this.stage;let t=e._ops;for(let r=t.length-1;r>=0;r--)e._applyOp(t[r].invert());t.length=0}}class Np{constructor(e){this.document=e,this.selection=Ii.nullSelection,this._reset()}getSelection(){return this.selection}setSelection(e){return e?e.attach(this.document):e=Ii.nullSelection,this.selection=e,this._deriveState(e),!0}_deriveState(e){this._reset(),this._deriveContainerSelectionState(e),this._deriveAnnoState(e),this.document.getIndex("markers")&&this._deriveMarkerState(e)}_deriveContainerSelectionState(e){let t=this.document,r=e.containerPath;if(r){let n,s,i=e.start.getNodeId(),o=e.end.getNodeId(),a=Ui(t,r,i),l=a.getPosition();l>0&&(this.previousNode=To(t,r,l)),this.isFirst=Gi(t,r,e.start),o===i?(n=a,s=l):s=(n=Ui(t,r,o)).getPosition(),this.nextNode=Po(t,r,s),this.isLast=Ji(t,r,e.end)}}_deriveAnnoState(e){const t=this.document;let r={};function n(e){r[e.type]||(r[e.type]=[]),r[e.type].push(e)}const s=co(t,e);s.forEach(n),1===s.length&&s[0].isInlineNode()&&(this.isInlineNodeSelection=s[0].getSelection().equals(e));const i=e.containerPath;if(i){ho(t,e,i).forEach(n)}this.annosByType=r}_deriveMarkerState(e){let t=po(this.document,e);this.markers=t}_reset(){this.annosByType={},this.markers=null,this.isInlineNodeSelection=!1,this.previousNode=null,this.nextNode=null,this.isFirst=!1,this.isLast=!1,this.surface=null,this.isolatedNodes=null}}class Tp extends l{constructor(e,t){super(),t=t||{},this.__id__=d(),this.document=e;const n=t.configurator;if(!n)throw new Error("No configurator provided.");var s,i;this.configurator=n,this._transaction=new Ep(e),s=this._transaction,i=this,s.setSelection=function(e){return Pp(e=Ep.prototype.setSelection.call(s,e),i),Dp(e,i),e},this._history=new xp,this._currentChange=null,this._selectionState=new Np(e),this._commandStates=[],this._resources=["document","selection","commandStates"],this._dirtyFlags={},this._change=null,this._info=null,this._flowStages=["update","pre-render","render","post-render","position","finalize"],this._postponed=[],this._observers={},this._lang=t.lang||this.configurator.getDefaultLanguage(),this._dir=t.dir||"ltr";const o=n.getCommandManagerClass(),a=n.getDragManagerClass(),l=n.getFileManagerClass(),c=n.getGlobalEventHandlerClass(),h=n.getKeyboardManagerClass(),u=n.getMacroManagerClass(),p=n.getMarkersManagerClass(),f=n.getSurfaceManagerClass();this.surfaceManager=new f(this),this._context={editorSession:this,surfaceManager:this.surfaceManager},t.context&&Object.assign(this._context,t.context);let g=n.getCommands(),m=n.getDropHandlers(),_=n.getMacros(),y=n.getConverterRegistry();this.fileManager=t.fileManager||new l(n.getFileAdapters(),this._context),this._hasUnsavedChanges=!1,this._isSaving=!1,t.saveHandler?this.saveHandler=t.saveHandler:this.saveHandler=n.getSaveHandler(),this._managers={},r(n.getManagers(),(e,t)=>{this._managers[t]=new e(this._context)}),this.commandManager=t.commandManager||new o(this._context,g),this.dragManager=new a(m,Object.assign({},this._context,{commandManager:this.commandManager})),this.macroManager=new u(this._context,_),this.globalEventHandler=new c(this,this.surfaceManager),this.markersManager=new p(this),this.keyboardManager=new h(this,n.getKeyboardShortcuts(),{context:this._context}),this.converterRegistry=y}dispose(){this._transaction.dispose(),this.surfaceManager.dispose(),this.fileManager.dispose(),this.commandManager.dispose(),this.dragManager.dispose(),this.macroManager.dispose(),this.globalEventHandler.dispose(),this.markersManager.dispose(),r(this._managers,e=>{e.dispose&&e.dispose()})}hasChanged(e){return this._dirtyFlags[e]}hasDocumentChanged(){return this.hasChanged("document")}hasSelectionChanged(){return this.hasChanged("selection")}hasCommandStatesChanged(){return this.hasChanged("commandStates")}hasLanguageChanged(){return this.hasChanged("lang")}hasTextDirectionChanged(){return this.hasChanged("dir")}get(e){switch(e){case"document":return this.getDocument();case"selection":return this.getSelection();case"commandStates":return this.getCommandStates();case"change":return this.getChange();case"lang":return this.getLanguage();case"dir":return this.getTextDirection();default:throw new Error("Unknown resource: "+e)}}getConfigurator(){return this.configurator}getContext(){return this._context}getDocument(){return this.document}getManager(e){return this._managers[e]}getSelection(){return this.getSelectionState().getSelection()}getSelectionState(){return this._selectionState}getCommandStates(){return this._commandStates}getChange(){return this._change}getChangeInfo(){return this._info}getFocusedSurface(){return this.surfaceManager.getFocusedSurface()}getSurface(e){return this.surfaceManager.getSurface(e)}getLanguage(){return this._lang}getTextDirection(){return this._dir}canUndo(){return this._history.canUndo()}canRedo(){return this._history.canRedo()}resetHistory(){this._history.reset(),this._setDirty("commandStates"),this._flowing||this.startFlow()}executeCommand(...e){this.commandManager.executeCommand(...e)}attachEditor(e){this.editor=e}detachEditor(){this.editor=void 0}getEditor(){return this.editor}setSelection(e,t){if(e&&C(e)&&(e=this.getDocument().createSelection(e)),e&&!e.isNull()&&!e.surfaceId){let t=this.getFocusedSurface();t&&(e.surfaceId=t.id)}return Pp(e,this),Dp(e,this),this._setSelection(e)&&!t&&this.startFlow(),e}selectNode(e){let t=this.getFocusedSurface();this.setSelection({type:"node",nodeId:e,containerPath:t.getContainerPath(),surfaceId:t.id})}setCommandStates(e){this._commandStates=e,this._setDirty("commandStates")}setLanguage(e){this._lang!==e&&(this._lang=e,this._setDirty("lang"),this.startFlow())}setTextDirection(e){this._dir!==e&&(this._dir=e,this._setDirty("dir"),this.startFlow())}createSelection(){const e=this.getDocument();return e.createSelection.apply(e,arguments)}getCollaborators(){return null}setSaveHandler(e){this.saveHandler=e}transaction(e,t){const r=this._transaction,n=r.tx;t=t||{},r._sync();let s=this.getSelection();n.selection=s;let i=r._recordChange(e,t),o=n.selection;return i?(i.before={selection:s},i.after={selection:o},this._commit(i,t)):(this._setSelection(n.selection),this.startFlow()),i}undo(){this._undoRedo("undo")}redo(){this._undoRedo("redo")}on(...e){let t=e[0];if(this._flowStages.indexOf(t)>=0){e.shift();let r=e[2]||{},n=r.resource;n&&(delete r.resource,e.unshift(n)),this._registerObserver(t,e)}else l.prototype.on.apply(this,e)}off(...e){if(1===e.length){let t=e[0];if(super.off(...e),t[this.__id__]){const e=t[this.__id__];delete t[this.__id__],e.forEach(e=>{this.__deregisterObserver(e)})}}else{const t=e[0],r=e[1],n=e[2];this._deregisterObserver(t,r,n)}}onUpdate(...e){return this._registerObserver("update",e)}onPreRender(...e){return this._registerObserver("pre-render",e)}onRender(...e){return this._registerObserver("render",e)}onPostRender(...e){return this._registerObserver("post-render",e)}onPosition(...e){return this._registerObserver("position",e)}onFinalize(...e){return this._registerObserver("finalize",e)}_setSelection(e){let t=this.getSelectionState().setSelection(e);return t&&this._setDirty("selection"),t}_undoRedo(e){const t=this.getDocument();var r,n;"redo"===e?(r=this._history.undoneChanges,n=this._history.doneChanges):(r=this._history.doneChanges,n=this._history.undoneChanges);var s=r.pop();if(s){this._applyChange(s,{}),this._transaction.__applyChange__(s),n.push(t.invert(s));let e=s.after.selection;e&&e.attach(t),this._setSelection(e),this.startFlow()}else console.warn("No change can be %s.","undo"===e?"undone":"redone")}_transformLocalChangeHistory(e){var t={ops:e.ops.map(function(e){return e.clone()})};ko(t,this._history.doneChanges),ko(t,this._history.undoneChanges)}_transformSelection(e){return Mo(this.getSelection(),e)}_commit(e,t){this._commitChange(e,t),this._hasUnsavedChanges=!0,this.startFlow()}_commitChange(e,t){if(e.timestamp=Date.now(),this._applyChange(e,t),!1!==t.history&&!t.hidden){let t=this.getDocument().invert(e);this._history.push(t)}var r=e.after.selection||Ii.nullSelection;r.isNull()||r.surfaceId||(r.surfaceId=e.after.surfaceId),this._setSelection(r),this.emit("commit",e)}_applyChange(e,t){if(!e)return void console.error("FIXME: change is null.");const r=this.getDocument();r._apply(e),r._notifyChangeListeners(e,t),this._setDirty("document"),this._change=e,this._info=t}_applyRemoteChange(e){e.ops.length>0&&(this._applyChange(e,{remote:!0}),this._transaction.__applyChange__(e),this._transformLocalChangeHistory(e),this._setSelection(this._transformSelection(e)),this.startFlow())}hasUnsavedChanges(){return this._hasUnsavedChanges}save(){var e=this.saveHandler;if(this._hasUnsavedChanges&&!this._isSaving){if(this._isSaving=!0,e){let t={editorSession:this,fileManager:this.fileManager};return e.saveDocument(t).then(()=>{this._hasUnsavedChanges=!1,this.setSelection(this.getSelection())}).catch(e=>{console.error("Error during save",e)}).then(()=>{this._isSaving=!1})}{let e="Document saving is not handled at the moment. Make sure saveHandler instance provided to editorSession";return console.error(e),Promise.reject(new Error(e))}}}startFlow(){if(this._flowing)throw new Error("Already in a flow. You need to postpone the update.");this._flowing=!0;try{this.performFlow()}finally{this._resetFlow(),this._flowing=!1}const e=this._postponed,t=this;this._postponed=[],setTimeout(function(){e.forEach(function(e){e(t)})},0)}performFlow(){this._flowStages.forEach(e=>{this._notifyObservers(e)})}postpone(e){this._postponed.push(e)}_parseObserverArgs(e){let t={stage:null,resource:null,handler:null,context:null,options:{}},r=0,n=e[r];if(S(n)&&(t.resource=n,n=e[++r]),!n)throw new Error("Provided handler function was nil.");if(!io(n))throw new Error("Expecting a handler Function.");return t.handler=n,(n=e[++r])&&(t.context=n,n=e[++r]),n&&(t.options=n),t}_registerObserver(e,t){let r=this._parseObserverArgs(t);r.stage=e,this.__registerObserver(e,r)}__registerObserver(e,t){if(t.context){const e=t.context;e[this.__id__]||(e[this.__id__]=[]),e[this.__id__].push(t)}let r=this._observers[e];r||(r=this._observers[e]=[]),r.push(t)}_deregisterObserver(e,t,n){let s=this;if(1===arguments.length)r(s._observers,e=>{for(let t=e.length-1;t>=0;t--){const r=e[t];r.context===n&&(e.splice(t,1),r._deregistered=!0)}});else{let r=s._observers[e];if(r)for(let e=r.length-1;e>=0;e--){let s=r[e];s.handler===t&&s.context===n&&(r.splice(e,1),s._deregistered=!0)}else l.prototype.off.apply(s,arguments)}}__deregisterObserver(e){const t=e.stage,r=this._observers[t],n=e.context,s=e.handler;for(let e=r.length-1;e>=0;e--){let t=r[e];t.handler===s&&t.context===n&&(r.splice(e,1),t._deregistered=!0)}}_notifyObservers(e){let t=this._observers[e];if(!t)return;let r=t.slice();for(let e=0;e<r.length;e++){let t=r[e];if(!t._deregistered)if(t.resource)if("document"===t.resource){if(!this.hasDocumentChanged())continue;const e=this.getChange(),r=this.getChangeInfo(),n=t.options.path;n?e.hasUpdated(n)&&t.handler.call(t.context,e,r,this):t.handler.call(t.context,e,r,this)}else{if(!this.hasChanged(t.resource))continue;const e=this.get(t.resource);t.handler.call(t.context,e,this)}else t.handler.call(t.context,this)}}_setDirty(e){this._dirtyFlags[e]=!0}_resetFlow(){Object.keys(this._dirtyFlags).forEach(e=>{this._dirtyFlags[e]=!1}),this._change=null,this._info=null}setBlurred(e){this._blurred=e,this.commandManager._updateCommandStates(this),this._setDirty("commandStates")}isBlurred(){return Boolean(this._blurred)}}function Pp(e,t){if(e&&!e.isNull()&&!e.surfaceId){let r=t.getFocusedSurface();r&&(e.surfaceId=r.id)}}function Dp(e,t){if(e&&!e.isNull()&&e.surfaceId&&!e.containerPath){let r=t.getSurface(e.surfaceId);if(r){let t=r.getContainerPath();t&&(e.containerPath=t)}}}class Ip extends Gd{render(e){let t=this.props.commandState,r=e("button").addClass("sc-menu-item").append(this._renderIcon(e),this._renderLabel(e),this._renderKeyboardShortcut(e)).on("click",this._onClick);return this.props.label&&r.append(this.renderLabel(e)),t.active&&r.addClass("sm-active"),t.disabled?r.attr("tabindex",-1).attr("disabled",!0):r.attr("tabindex",1),r}_renderLabel(e){return e("div").addClass("se-label").append(this._getLabel())}_renderIcon(e){return e("div").addClass("se-icon").append(this.context.iconProvider.renderIcon(e,this.props.name))}_renderKeyboardShortcut(e){return e("div").addClass("se-keyboard-shortcut").append(this._getKeyboardShortcut())}_getLabel(){return this.context.labelProvider.getLabel(this.props.name,this.props.commandState)}_getKeyboardShortcut(){let e=this.props.name,t=this.context.keyboardShortcuts;return t[e]?t[e]:""}_onClick(e){e.preventDefault(),e.stopPropagation(),this.props.commandState.disabled||this.executeCommand()}executeCommand(e){this.context.commandManager.executeCommand(this.props.name,e)}}class Ap extends Gd{render(e){let t=this.props.commandStates,r=e("div").addClass("sc-menu");return this.props.items.forEach(n=>{n.command?r.append(e(Ip,{name:n.command,commandState:t[n.command]})):"separator"===n.type&&r.append(e("div").addClass("separator"))}),r}}class Op extends Gd{render(e){let t=e("div").addClass("sc-tooltip");return t.append(this.props.text),t}}class kp extends Gd{render(e){let t=e("div").addClass("sc-toggle-tool"),r=this.getClassNames();return r&&t.addClass(r),t.append(this.renderButton(e)),t.append(e(Op,{text:this._getTooltipText()})),t}renderButton(e){let t=this.props.commandState;return e(this.getComponent("button"),{icon:this.getIconName(),active:t.active,disabled:t.disabled,theme:this.props.theme}).on("click",this.onClick)}getClassNames(){return""}getCommandName(){return this.getName()}getName(){return this.props.name}getIconName(){return this.props.name}onClick(e){e.preventDefault(),e.stopPropagation(),this.props.disabled||this.executeCommand()}_getTooltipText(){let e=this.props.name,t=this.context.labelProvider.getLabel(e),r=this.context.keyboardShortcuts;return r[e]?[t," (",r[e],")"].join(""):t}executeCommand(e){e=Object.assign({mode:this.props.mode},e),this.context.commandManager.executeCommand(this.getCommandName(),e)}get _isTool(){return!0}}class Mp extends Gd{isToolEnabled(e,t){let r=!0;return this.props.contextual&&!t.showInContext&&(r=!1),t.disabled&&(r=!1),r}hasEnabledTools(e){let t;return e||(e=this._getCommandStates()),r(e,(e,r)=>{this.isToolEnabled(r,e)&&(t=!0)}),t}render(e){let t=this._getCommandStates(),n=e("div").addClass(this._getClassNames());return n.addClass("sm-"+this.props.name),r(t,(t,r)=>{if(this.isToolEnabled(r,t)||this.props.showDisabled){let s=this._getToolClass(r);n.append(e(s,{name:r,commandState:t,style:this.props.style,theme:this.props.theme}).ref(r))}}),n}_getCommandStates(){let e=this.context.editorSession.getCommandStates(),t=this.context.commandGroups,r={};return this.props.commandGroups.forEach(n=>{t[n]&&t[n].forEach(t=>{e[t]&&(r[t]=e[t])})}),r}_getClassNames(){return"sc-tool-group"}_getToolClass(e){let t,r=this.context.tools;return t="descriptive"===this.props.style?Ip:kp,r[e]||t}}class Lp extends Mp{_getToolClass(e){return this.context.tools[e]||Ip}_getClassNames(){return"sc-menu-group"}}class Rp extends wp{didMount(){if(super.didMount(),!this.context.scrollPane)throw new Error("Requires scrollPane context");this.context.scrollPane.on("selection:positioned",this._onSelectionPositioned,this)}dispose(){super.dispose(),this.context.scrollPane.off(this)}render(e){let t=e("div").addClass("sc-overlay");return t.addClass("sm-hidden"),t.addClass("sm-theme-"+this.getTheme()),t.append(e("div").addClass("se-active-tools").append(this.renderEntries(e)).ref("entriesContainer")),t}show(e){this.el.removeClass("sm-hidden"),this._position(e)}hide(){this.el.addClass("sm-hidden")}_onSelectionPositioned(e){if(this.hasEnabledTools()){this.el.removeClass("sm-hidden");let t=this.el.htmlProp("offsetWidth"),r=e.selectionRect,n=r.width;this.el.css("top",r.top+r.height);let s=r.left+n/2-t/2;s=Math.max(s,0);let i=r.left+n+r.right-t;s=Math.min(s,i),this.el.css("left",s)}else this.el.addClass("sm-hidden")}getTheme(){return this.props.theme||"dark"}}class qp extends Gd{didMount(){Xh.getBrowserWindow().on("resize",this.onResize,this),this.props.scrollPane.on("scroll",this.onScroll,this),setTimeout(()=>{this.updatePositions()})}dispose(){Xh.getBrowserWindow().off(this),this.props.scrollPane.off(this)}didUpdate(){this.updatePositions()}render(e){let t=e("div").addClass("sc-scrollbar").on("mousedown",this.onMouseDown);if(this.props.highlights){let n=[];r(this.props.highlights,function(t,s){r(t,function(t){n.push(e("div").ref(t).addClass("se-highlight sm-"+s))})}),t.append(e("div").ref("highlights").addClass("se-highlights").append(n))}return t.append(e("div").ref("thumb").addClass("se-thumb")),t}updatePositions(){let e=this.props.scrollPane,t=e.getScrollableElement(),n=e.getContentHeight(),s=e.getHeight(),i=e.getScrollPosition(),o=e.getContentElement();this.factor=n/s,this.factor<=1?this.el.addClass("sm-hide-thumb"):this.el.removeClass("sm-hide-thumb"),this.refs.thumb.css({top:i/this.factor,height:s/this.factor}),this.props.highlights&&r(this.props.highlights,function(e){r(e,function(e){let r=t.find('*[data-id="'+e+'"]');if(!r)return;let n=vp(r,o),s=n.top/this.factor,i=n.height/this.factor;i<qp.overlayMinHeight&&(i=qp.overlayMinHeight),this.refs[e]?this.refs[e].css({top:s,height:i}):console.warn("no ref found for highlight",e)}.bind(this))}.bind(this))}getScrollableElement(){return this.props.scrollPane.getScrollableElement()}onResize(){this.rerender()}onScroll(){this.updatePositions()}onMouseDown(e){e.stopPropagation(),e.preventDefault(),this._mouseDown=!0;let t=Xh.getBrowserWindow();t.on("mousemove",this.onMouseMove,this),t.on("mouseup",this.onMouseUp,this);let r=this.el.getOffset().top,n=e.pageY-r,s=this.refs.thumb.el;e.target!==s.getNativeElement()?(this.offset=s.height/2,this.onMouseMove(e)):this.offset=n-s.getPosition().top}onMouseUp(){this._mouseDown=!1;let e=Xh.getBrowserWindow();e.off("mousemove",this.onMouseMove,this),e.off("mouseup",this.onMouseUp,this)}onMouseMove(e){if(this._mouseDown){let t=this.props.scrollPane.getScrollableElement(),r=this.el.getOffset().top,n=(e.pageY-r-this.offset)*this.factor;t.setProperty("scrollTop",n)}}}function Bp(e,t){let r=t.getBoundingClientRect(),n=e.clientX-r.left,s=e.clientY-r.top;return{left:n,right:r.width-n,top:s,bottom:r.height-s}}qp.overlayMinHeight=2;class Fp extends Gd{getChildContext(){return{scrollPane:this}}didMount(){y.inBrowser&&(this.windowEl=Xh.wrapNativeElement(window),this.windowEl.on("resize",this.onSelectionPositioned,this))}dispose(){this.windowEl&&this.windowEl.off(this)}getName(){return this.props.name}onSelectionPositioned(){let e=this._getContentRect(),t=this._getSelectionRect();if(!t)return;let r={contentRect:e,selectionRect:t};this._emitSelectionPositioned(r),this._scrollSelectionIntoView(t)}_emitSelectionPositioned(e){this.emit("selection:positioned",e),this.emit("dom-selection:rendered",e)}_onContextMenu(e){e.preventDefault();let t=this._getMouseBounds(e);this.emit("context-menu:opened",{mouseBounds:t})}_scrollSelectionIntoView(e){let t=this.getScrollPosition(),r=t+this.getHeight(),n=e.top,s=e.top+e.height;(n<t&&s<t||n>r&&s>r)&&this.setScrollPosition(n)}getHeight(){throw new Error("Abstract method")}getContentHeight(){throw new Error("Abstract method")}getContentElement(){throw new Error("Abstract method")}getScrollableElement(){throw new Error("Abstract method")}getScrollPosition(){throw new Error("Abstract method")}setScrollPosition(){throw new Error("Abstract method")}getPanelOffsetForElement(e){throw new Error("Abstract method")}scrollTo(e,t){throw new Error("Abstract method")}_getContentRect(){return this.getContentElement().getNativeElement().getBoundingClientRect()}_getSelectionRect(){return Ku(this._getContentRect())}_getMouseBounds(e){return Bp(e,this.getContentElement().getNativeElement())}}class jp extends Fp{didMount(){super.didMount(),this.refs.scrollbar&&this.props.highlights&&this.props.highlights.on("highlights:updated",this.onHighlightsUpdated,this),this.refs.scrollbar&&(y.inBrowser&&(this.domObserver=new window.MutationObserver(this._onContentChanged.bind(this)),this.domObserver.observe(this.el.getNativeElement(),{subtree:!0,attributes:!0,characterData:!0,childList:!0})),this.context.editorSession.onPosition(this._onPosition,this))}dispose(){super.dispose(),this.props.highlights&&this.props.highlights.off(this),this.context.editorSession.off(this),this.context.dragManager.off(this),this.domObserver&&this.domObserver.disconnect()}render(e){let t=e("div").addClass("sc-scroll-pane");return y.isFF&&t.addClass("sm-firefox"),this.props.noStyle||t.addClass("sm-default-style"),"substance"===this.props.scrollbarType&&(t.addClass("sm-substance-scrollbar"),t.addClass("sm-scrollbar-position-"+this.props.scrollbarPosition),t.append(e(qp,{scrollPane:this}).ref("scrollbar").attr("id","content-scrollbar")),t.append(e("div").ref("scanline").addClass("se-scanline"))),t.append(e("div").ref("scrollable").addClass("se-scrollable").append(this.renderContent(e)).on("scroll",this.onScroll)),t}renderContent(e){let t=e("div").ref("content").addClass("se-content");return t.append(this.props.children),"custom"===this.props.contextMenu&&t.on("contextmenu",this._onContextMenu),t}_onContentChanged(){this._contentChanged=!0}_onPosition(){this.refs.scrollbar&&this._contentChanged&&(this._contentChanged=!1,this._updateScrollbar())}_updateScrollbar(){this.refs.scrollbar&&this.refs.scrollbar.updatePositions()}onHighlightsUpdated(e){this.refs.scrollbar.extendProps({highlights:e})}onScroll(){let e=this.getScrollPosition(),t=this.refs.scrollable;this.props.onScroll&&this.props.onScroll(e,t),this.props.tocProvider&&this.props.tocProvider.markActiveEntry(this),this.emit("scroll",e,t)}getHeight(){return this.getScrollableElement().height}getContentHeight(){return this.refs.content.el.getNativeElement().scrollHeight}getContentElement(){return this.refs.content.el}getScrollableElement(){return this.refs.scrollable.el}getScrollPosition(){return this.getScrollableElement().getProperty("scrollTop")}setScrollPosition(e){this.getScrollableElement().setProperty("scrollTop",e)}getPanelOffsetForElement(e){return vp(e,this.refs.content.el).top}scrollTo(e,t){let r=this.getScrollableElement(),n=r.find(e);if(n){const e=this.getPanelOffsetForElement(n);let s=!0;if(t){const t=r.height,n=r.getProperty("scrollTop");s=e<n||n+t<e}s&&this.setScrollPosition(e)}else console.warn(`No match found for selector '${e}' in scrollable container`)}onSelectionPositioned(...e){super.onSelectionPositioned(...e),this._updateScrollbar()}_onContextMenu(e){super._onContextMenu(e),this._updateScrollbar()}}class Hp extends wp{render(e){let t=e("div").addClass("sc-toolbar");return t.append(e("div").addClass("se-active-tools").append(this.renderEntries(e)).ref("entriesContainer")),t}getTheme(){return this.props.theme||"light"}}class Up extends Mp{willReceiveProps(){this.setState({showChoices:!1})}render(e){let t=this.getComponent("button"),r=this._getCommandStates(),n=e("div").addClass("sc-tool-dropdown");n.addClass("sm-"+this.props.name);const s=this._getToggleName(r)||this.props.name;if(this.props.showDisabled||this.hasEnabledTools(r)){let i;if("minimal"===this.props.style)i=e(t,{icon:s,dropdown:!0,active:this.state.showChoices,theme:this.props.theme}).on("click",this._toggleChoices);else{if("descriptive"!==this.props.style)throw new Error("Style "+this.props.style+" not supported");i=e(t,{label:s,commandState:r[s],dropdown:!0,active:this.state.showChoices,theme:this.props.theme}).on("click",this._toggleChoices)}n.append(i),this.state.showChoices?n.append(e("div").addClass("se-choices").append(e(Ap,{commandStates:r,items:this._getMenuItems(r)}))):"minimal"!==this.props.style&&s===this.props.name||n.append(this._renderToolTip(e))}return n}_renderToolTip(e){let t=this.context.labelProvider;return e(Op,{text:t.getLabel(this.props.name)})}_getToggleName(e){return this._getActiveCommandName(e)}_getMenuItems(e){const t=this.props.showDisabled;let n=[];return r(e,(e,r)=>{(t||this.isToolEnabled(r,e))&&n.push({command:r})}),n}_getActiveCommandName(e){let t;return r(e,(e,r)=>{e.active&&!t&&(t=r)}),t}_toggleChoices(){this.setState({showChoices:!this.state.showChoices})}}class zp extends Mp{_getClassNames(){return"sc-tool-prompt"}}class Vp extends Gd{render(e){return e("div").addClass("sc-tool-separator")}hasEnabledTools(){return!1}}class Gp extends wp{render(e){let t=e("div").addClass("sc-workflow-pane");return t.append(e("div").addClass("se-active-tools").append(this.renderEntries(e)).ref("entriesContainer")),t}getTheme(){return this.props.theme||"light"}}function Jp(e,t){!function e(t,r,n){r(t,n);if(t.getChildCount()>0){let s=t.getChildNodeIterator();for(;s.hasNext();)e(s.next(),r,n+1)}}(e,t,0)}var Kp=Object.freeze({findParentDOMElement:function(e){for(;e;){let t=Xh.unwrap(e);if(t)return t;e=e.parentNode}},findParent:function(e,t){for(;e;){if(e.is(t))return e;e=e.getParent()}},stop:function(e){e.stopPropagation()},stopAndPrevent:function(e){e.stopPropagation(),e.preventDefault()},walk:Jp,isRightButton:function(e){let t=!1;return"which"in e?t=3===e.which:"button"in e&&(t=2===e.button),t},getBoundingRect:function(e){let t=e.getNativeElement().getBoundingClientRect();return{top:t.top,left:t.left,height:t.height,width:t.width}},getBoundingRectForRects:function(...e){let t,r,n,s;if(e.length>0){let i=e[0];t=i.top,r=i.left,n=t+i.height,s=r+i.width;for(let i=1;i<e.length;i++){let o=e[i];t=Math.min(t,o.top),r=Math.min(r,o.left),n=Math.max(n,o.top+o.height),s=Math.max(s,o.left+o.width)}}return{top:t,left:r,right:s,bottom:n,height:n-t,width:s-r}},isXInside:function(e,t){return e>=t.left&&e<=t.left+t.width},isYInside:function(e,t){return e>=t.top&&e<=t.top+t.height}});class $p{constructor(e){this.documentSession=e,this._undo=[],this._redo=[]}canUndo(){return this._undo.length>0}canRedo(){return this._redo.length>0}commit(e,t){let r=this.documentSession._history.length;this.documentSession._commitChange(e,t),this._undo.push(r),this._redo.length=0}undo(){if(0===this._undo.length)return;let e,t=this.documentSession._history.length,r=this._undo.pop();try{e=this.documentSession.revert(r),this._redo.push(t)}catch(e){console.error(e),this._undo.push(r)}return e}redo(){if(0===this._redo.length)return;let e,t=this.documentSession._history.length,r=this._redo.pop();try{e=this.documentSession.revert(r),this._undo.push(t)}catch(e){console.error(e),this._redo.push(r)}return e}reset(){this._undo.length=0,this._redo.length=0}}class Xp{constructor(e){this.masterSession=e;let t=e.getDocument();this.masterDocument=t,this.stageDocument=t.newInstance().createFromDocument(t),this.stageDocument._isTransactionDocument=!0,this.stageVersion=this._getMasterVersion(),this.tx=this.stageDocument.createEditingInterface(),this._isTransacting=!1}dispose(){this.stageDocument.dispose()}_reset(){this.stageDocument._ops.length=0}_transaction(e,t,r={}){if(this._isTransacting)throw new Error("Nested transactions are not supported.");if(!io(e))throw new Error("Document.transaction() requires a transformation function.");let n,s=!1;this._isTransacting=!0,this._reset(),this._sync();try{const i=this.tx;r.selection&&(i.selection=r.selection),e(i);let o=this.stageDocument._ops;o.length>0&&((n=new Oo(o,{},{})).info=t,n.before=r,n.after={selection:i.selection},this.stageVersion++),s=!0}finally{s||this._rollback(),this._reset(),this._isTransacting=!1}return n}_sync(){const e=this._getMasterVersion(),t=this.stageVersion;if(t<e){let r=this.stageDocument,n=this.masterSession._history.slice(t);for(let e of n)r._apply(e);this.stageVersion=e}else if(t>e)throw new Error("stage document is in an unexpected state.")}_rollback(){const e=this.stageDocument;let t=e._ops;for(let r=t.length-1;r>=0;r--)e._applyOp(t[r].invert());this._reset()}_getMasterVersion(){return this.masterSession._history.length}}class Wp{}class Yp{get(e){return arguments.length>1&&(e=Array.prototype.slice(arguments,0)),zt(this,e=Zp(e))}getAll(e){if(arguments.length>1&&(e=Array.prototype.slice(arguments,0)),!m(e=Zp(e)))throw new Error("Illegal argument for TreeIndex.get()");let t=zt(this,e);return this._collectValues(t)}set(e,t){Ms(this,e=Zp(e),t,function(e){if(!e)return new Wp})}delete(e){if(1===(e=Zp(e)).length)delete this[e[0]];else{let t=e[e.length-1],r=zt(this,e=e.slice(0,-1));r&&delete r[t]}}clear(){let e=this;for(let t in e)e.hasOwnProperty(t)&&delete e[t]}traverse(e){this._traverse(this,[],e)}forEach(...e){this.traverse(...e)}_traverse(e,t,r){let n;for(n in e){if(!e.hasOwnProperty(n))continue;let s=e[n],i=t.concat([n]);s instanceof Wp?this._traverse(s,i,r):r(s,i)}}_collectValues(e){let t={};return this._traverse(e,[],function(e,r){let n=r[r.length-1];t[n]=e}),t}}function Zp(e){return S(e)?[e]:e}Yp.Arrays=class extends Yp{contains(e){let t=super.get(e);return Boolean(t)}get(e){let t=super.get(e);return t instanceof Wp&&(t=t.__values__||[]),t}set(e,t){super.get(e).__values__=t}add(e,t){if(!m(e=Zp(e)))throw new Error("Illegal arguments.");let r;Ms(this,e.concat(["__values__","__dummy__"]),void 0,function(e,t){return"__values__"===t?(e||(e=[]),r=e):e||(e=new Wp),e}),delete r.__dummy__,r.push(t)}remove(e,t){let r=zt(this,e);r instanceof Wp&&(1===arguments.length?delete r.__values__:Qh(r.__values__,t))}_collectValues(e){let t=[];return this._traverse(e,[],function(e){t.push(e)}),t=Array.prototype.concat.apply([],t)}};class Qp extends so{constructor(){super(),this.byPath=new Yp,this.byType=new Yp}select(e){return e.isPropertyAnnotation()||e.isInlineNode()}clear(){this.byPath.clear(),this.byType.clear()}get(e,t,r,n){var s;return s=g(s=S(e)||1===e.length?this.byPath.getAll(e)||{}:this.byPath.get(e)),x(t)&&(s=oo(s,Qp.filterByRange(t,r))),n&&(s=oo(s,so.filterByType(n))),s}create(e){const t=e.start.path;this.byType.set([e.type,e.id],e),t&&t.length>0&&this.byPath.set(e.start.path.concat([e.id]),e)}delete(e){this._delete(e.type,e.id,e.start.path)}_delete(e,t,r){this.byType.delete([e,t]),r&&r.length>0&&this.byPath.delete(r.concat([t]))}update(e,t,r,n){this.select(e)&&"start"===t[1]&&"path"===t[2]&&(this._delete(e.type,e.id,n),this.create(e))}}Qp.filterByRange=function(e,t){return function(r){var n=r.start.offset,s=r.end.offset>=e;return x(t)&&(s=s&&n<=t),s}};class ef extends Mu{static isBlock(){return!0}}function tf(e,t){if(!t)throw new Error("'selection' is mandatory.");let n=null;return t.isNull()||t.isCollapsed()||(t.isPropertySelection()?n=function(e,t){let n=t.start.path,s=t.start.offset,i=t.end.offset,o=e.get(n),a=e.createSnippet(),l=a.getContainer();return a.create({type:e.schema.getDefaultTextType(),id:vo,content:o.substring(s,i)}),l.append(vo),r(e.getIndex("annotations").get(n,s,i),function(e){let t=b(e.toJSON()),r=[vo,"content"];t.start={path:r,offset:Math.max(s,e.start.offset)-s},t.end={path:r,offset:Math.min(i,e.end.offset)-s},a.create(t)}),a}(e,t):t.isContainerSelection()?n=function(e,t){let r=t.containerPath,n=e.createSnippet(),s=n.getContainer().getContentPath(),i=Qi(e,t),o=i.length;if(0===o)return n;let a=t.start,l=t.end,c=!1,h=!1,d={};for(let t=0;t<o;t++){let u=i[t],p=e.get(u);0===t&&Ji(e,r,a)?c=!0:t===o-1&&Gi(e,r,l)?h=!0:d[u]||(go(p).forEach(e=>{let t=n.create(e);d[t.id]=!0}),So(n,s,u))}if(!c){let e=Ui(n,s,a.getNodeId());e.isText()?mo(n,null,a):e.isList()&&_o(n,e,null,a,{deleteEmptyFirstItem:!0})}if(!h){let e=Ui(n,s,l.getNodeId());e.isText()?mo(n,l,null):e.isList()&&_o(n,e,l,null)}return n}(e,t):t.isNodeSelection()?n=function(e,t){let r=e.createSnippet(),n=r.getContainer().getContentPath(),s=t.getNodeId(),i=e.get(s);return go(i).forEach(e=>{r.create(e)}),So(r,n,i.id),r}(e,t):console.error("Copy is not yet supported for selection type.")),n}function rf(e,t,r,n){if(n[r])throw new Error("FIXME: dont call me twice");n[r]=r;const s=e.get(r,"strict"),i=s.toJSON();let o,a=r;t.contains(r)&&(o=d(s.type),i.id=o);const l=e.getIndex("annotations"),c=s.getSchema();let h=[];for(let r of c){const s=r.name;if("id"!==s&&"type"!==s)if(r.isReference()&&r.isOwned()||"file"===r.type)if(r.isArray()){let r=i[s];i[s]=nf(e,t,r,n)}else{let r=i[s];n[r]||(i[s]=rf(e,t,r,n))}else if(r.isText()){let e=l.get([a,r.name]);for(let t=0;t<e.length;t++){let r=e[t];r.start.path[0]===a&&o&&(r.start.path[0]=o),r.end.path[0]===a&&o&&(r.end.path[0]=o),h.push(r)}}}t.create(i);for(let r=0;r<h.length;r++)rf(e,t,h[r].id,n);return i.id}function nf(e,t,r,n){let s=r.slice(0);for(let i=0;i<r.length;i++){let o=r[i];if(m(o))s[i]=nf(e,t,o,n);else{let r=o;r&&!n[r]&&(s[i]=rf(e,t,r,n))}}return s}function sf(e,t){let r=e.selection;if(!r||r.isNull())throw new Error("Can not paste without selection.");if(r.isCustomSelection())throw new Error("Paste not implemented for custom selection.");(t=t||{}).text=t.text||"";let n=t.doc,s=Boolean(r.containerPath);if(r.isCollapsed()||e.deleteSelection(),!n){if(!s)return void e.insertText(t.text);n=function(e,t){let r,n=t.text.split(/\s*\n\s*\n/),s=e.getDocument().newInstance(),i=s.getSchema().getDefaultTextType(),o=s.create({type:"@container",id:bo,nodes:[]});if(1===n.length)r=s.create({id:vo,type:i,content:n[0]}),o.append(r.id);else for(let e=0;e<n.length;e++)r=s.create({id:d(i),type:i,content:n[e]}),o.append(r.id);return s}(e,t)}let i=n.get(bo),o=i.getLength();if(0===o)return;let a=i.getNodeAt(0);return s?(a.isText()&&(of(e,n),i.removeAt(0),o--),o>0&&function(e,t){let r=t.get(bo);if(0===r.getLength())return;let n,s=e.selection,i=s.containerPath;if(s.isPropertySelection()){let t=s.start.path,o=Ui(e,i,s.start.getNodeId());if(o.isText()){let r=o.getPosition(),a=e.get(t);0===a.length?(xo(e,i,n=r),fo(e,e.get(o.id))):a.length===s.start.offset?n=r+1:(e.break(),n=r+1)}else if(o.isList()){let t=o,a=e.get(s.start.getNodeId()),l=r.getNodeAt(0);if(l.isList()){if(l.getLength()>0){let n=a.getPosition();0===a.getLength()?(xo(e,t.getItemsPath(),n),fo(e,a),af(e,t,l,n)):0===s.start.offset?af(e,t,l,n):s.start.offset>=a.getLength()?af(e,t,l,n+1):(e.break(),af(e,t,l,n+1)),r.getLength()>1&&lf(e,i,t)}r.removeAt(0),n=t.getPosition()+1}else 1===t.getLength()&&0===a.getLength()?(n=t.getPosition(),xo(e,i,n),fo(e,t)):0===a.getPosition()&&0===s.start.offset?n=t.getPosition():a.getPosition()===t.getLength()-1&&s.end.offset>=a.getLength()?n=t.getPosition()+1:(n=t.getPosition()+1,lf(e,i,t))}}else if(s.isNodeSelection()){let t=zi(e,i,s.getNodeId());if(s.isBefore())n=t;else{if(!s.isAfter())throw new Error("Illegal state: the selection should be collapsed.");n=t+1}}!function(e,t,r,n){let s=[],i={},o=t.get(bo).nodes.map(e=>t.get(e)),a=e.getProperty(r).targetTypes;a&&a.length>0&&(o=o.filter(e=>a.indexOf(e.type)>=0));for(let t of o){let o=rf(t.getDocument(),e,t.id,i);t=e.get(o),Co(e,r,n++,o),s.push(t)}if(s.length>0){let t=Di(s);$i(e,t,r,"after")}}(e,t,i,n)}(e,n)):1===o?a.isText()&&of(e,n):of(e,n=function(e,t){let r=e.selection.start.path,n=e.createSnippet(),s=n.getSchema().getDefaultTextType(),i=t.get("snippet").getContent(),o=[],a=0,l=[];for(let e of i){let n=t.get(e);if(n.isText()){let e=n.getText();o.length>0&&(o.push(" "),a+=1);let t=g(n.getAnnotations(),e=>{let t=e.toJSON();return t.start.path=r.slice(0),t.start.offset+=a,t.end.offset+=a,t});o.push(e),l=l.concat(t),a+=e.length}}return n.create({id:vo,type:s,content:o.join("")}),l.forEach(e=>n.create(e)),n.getContainer().append(vo),n}(e,n)),t}function of(e,t){let r=e.selection;const n=t.get(bo).nodes[0],s=t.get(n).getPath(),i=t.get(s),o=t.getIndex("annotations").get(s);let a=r.start.path,l=r.start.offset;e.insertText(i);let c=e.getProperty(a);if(c.isText()){let t=g(o),r=c.targetTypes;r&&(t=t.filter(e=>r.indexOf(e.type)>=0));for(let r of t){let t=r.toJSON();t.start.path=a.slice(0),t.start.offset+=l,t.end.offset+=l,e.get(t.id)&&(t.id=d(t.type)),e.create(t)}}}function af(e,t,r,n){let s,i=e.getSelection(),o=r.resolve("items"),a={};for(let r of o){let i=rf(r.getDocument(),e,r.id,a);Co(e,t.getItemsPath(),n++,i),s=e.get(i)}e.setSelection({type:"property",path:s.getPath(),startOffset:s.getLength(),surfaceId:i.surfaceId,containerPath:i.containerPath})}function lf(e,t,r){let n=r.getPosition(),s=e.selection;e.break(),e.get(e.selection.start.getNodeId()).getLength()>0&&(e.setSelection(s),e.break()),console.assert(0===e.get(e.selection.start.getNodeId()).getLength(),"at this point the current list-item should be empty"),e.break(),fo(e,xo(e,t,n+1))}class cf{annotate(e,t){let r=e.selection,n=e.getSchema().getNodeClass(t.type);if(!n)throw new Error("Unknown annotation type",t);let s={start:r.start,end:r.end,containerPath:r.containerPath};if(r.isPropertySelection()){if(!n.isAnnotation())throw new Error("Annotation can not be created for a selection.")}else r.isContainerSelection()&&n.isPropertyAnnotation()&&console.warn("NOT SUPPORTED YET: creating property annotations for a non collapsed container selection.");return Object.assign(s,t),e.create(s)}break(e){let t=e.selection;if(t.isNodeSelection()){let r=t.containerPath,n=zi(e,r,t.getNodeId()),s=this.createTextNode(e,r);t.isBefore()?Co(e,r,n,s.id):(Co(e,r,n+1,s.id),$i(e,s,r,"before"))}else if(t.isCustomSelection());else if(t.isCollapsed()||t.isPropertySelection()){let r=t.containerPath;if(t.isCollapsed()||(this._deletePropertySelection(e,t),e.setSelection(t.collapse("left"))),r){let n=t.start.path[0],s=e.get(n);this._breakNode(e,s,t.start,r)}}else if(t.isContainerSelection()){let r=t.start,n=t.containerPath,s=zi(e,n,r.path[0]);this._deleteContainerSelection(e,t,{noMerge:!0}),$i(e,Po(e,n,s),n,"before")}}createTextNode(e,t,r){let n=e.getProperty(t);if(!n.defaultTextType)throw new Error('Container properties must have a "defaultTextType" defined in the schema');return e.create({type:n.defaultTextType,content:r})}createListNode(e,t,r={}){return e.create({type:"list",items:[],listType:r.listType||"bullet"})}delete(e,t){let r=e.selection;if(r.isNodeSelection())this._deleteNodeSelection(e,r,t);else if(r.isCustomSelection());else if(r.isCollapsed()){let n=r.start.path,s=n[0],i=r.containerPath,o=e.get(n),a=r.start.offset;if(i&&(0===a&&"left"===t||a===o.length&&"right"===t)){let n=Ui(e,i,s);if(n.isList()&&0===a&&"left"===t)return this.toggleList(e);this._merge(e,n,r.start,t,i)}else{if(0===a&&"left"===t||a===o.length&&"right"===t)return;let s="left"===t?a-1:a;mo(e,{path:n,offset:s},{path:n,offset:s+1}),e.setSelection({type:"property",path:n,startOffset:s,containerPath:r.containerPath})}}else r.isPropertySelection()?(mo(e,r.start,r.end),e.setSelection(r.collapse("left"))):r.isContainerSelection()?this._deleteContainerSelection(e,r):console.warn("Unsupported case: tx.delete(%)",t,r)}_deleteNodeSelection(e,t,r){let n=t.getNodeId(),s=t.containerPath,i=zi(e,s,n);if(t.isFull()||t.isBefore()&&"right"===r||t.isAfter()&&"left"===r){xo(e,s,i),fo(e,e.get(n));let r=this.createTextNode(e,t.containerPath);Co(e,s,i,r.id),e.setSelection({type:"property",path:r.getPath(),startOffset:0,containerPath:s})}else if(t.isBefore()&&"left"===r){if(i>0){let t=To(e,s,i);t.isText()?(e.setSelection({type:"property",path:t.getPath(),startOffset:t.getLength()}),this.delete(e,r)):e.setSelection({type:"node",nodeId:t.id,containerPath:s})}}else if(t.isAfter()&&"right"===r){if(i<e.get(s).length-1){let t=Po(e,s,i);t.isText()?(e.setSelection({type:"property",path:t.getPath(),startOffset:0}),this.delete(e,r)):e.setSelection({type:"node",nodeId:t.id,containerPath:s})}}else console.warn("Unsupported case: delete(%s)",r,t)}_deletePropertySelection(e,t){let r=t.start.path,n=t.start.offset,s=t.end.offset;e.update(r,{type:"delete",start:n,end:s}),to.deletedText(e,r,n,s)}_deleteContainerSelection(e,t,r={}){let n=t.containerPath,s=t.start,i=t.end,o=s.getNodeId(),a=i.getNodeId(),l=zi(e,n,o),c=zi(e,n,a);if(l===c){let r=Ui(e,n,o);if(r.isText())mo(e,s,i);else{if(!r.isList())throw new Error("Not supported yet.");_o(e,r,s,i)}return void e.setSelection(t.collapse("left"))}let h=s.getNodeId(),d=i.getNodeId(),u=e.get(s.getNodeId()),p=e.get(i.getNodeId()),f=Ki(0,u,s,null),g=Ki(0,p,null,i);if(g)xo(e,n,c),fo(e,p);else{let t=Ui(e,n,d);t.isText()?mo(e,null,i):t.isList()&&_o(e,t,null,i)}for(let t=c-1;t>l;t--){let r=xo(e,n,t);fo(e,e.get(r))}if(f)xo(e,n,l),fo(e,u);else{let t=Ui(e,n,h);t.isText()?mo(e,s,null):t.isList()&&_o(e,t,s,null)}if(f&&g){let t=this.createTextNode(e,n);Co(e,n,l,t.id),e.setSelection({type:"property",path:t.getPath(),startOffset:0,containerPath:n})}else if(f||g)f?$i(e,p,n,"before"):$i(e,u,n,"after");else{if(!r.noMerge){let r=Ui(e,n,u.id);this._merge(e,r,t.start,"right",n)}e.setSelection(t.collapse("left"))}}insertInlineNode(e,t){let r=e.selection;this.insertText(e,"\ufeff"),r=e.selection;let n=e.selection.end.offset,s=n-"\ufeff".length;return t=Object.assign({},t,{start:{path:r.path,offset:s},end:{path:r.path,offset:n}}),e.create(t)}insertBlockNode(e,t){let r,n=e.selection,s=n.containerPath;if(r=t._isNode&&e.get(t.id)?e.get(t.id):e.create(t),n.isNodeSelection()){let t=n.getNodeId(),i=zi(e,s,t);n.isBefore()?Co(e,s,i,r.id):n.isAfter()?(Co(e,s,i+1,r.id),e.setSelection({type:"node",containerPath:s,nodeId:r.id,mode:"after"})):(xo(e,s,i),fo(e,e.get(t)),Co(e,s,i,r.id),e.setSelection({type:"node",containerPath:s,nodeId:r.id,mode:"after"}))}else if(n.isPropertySelection()){if(!s)throw new Error("insertBlockNode can only be used within a container.");n.isCollapsed()||(this._deletePropertySelection(e,n),e.setSelection(n.collapse("left")));let t=e.get(n.path[0]);if(!t)throw new Error("Invalid selection.");let i=zi(e,s,t.id);if(t.isText()){let o=t.getText();0===o.length?(xo(e,s,i),fo(e,t),Co(e,s,i,r.id),$i(e,r,s,"after")):0===n.start.offset?Co(e,s,i,r.id):n.start.offset===o.length?(Co(e,s,i+1,r.id),$i(e,r,s,"before")):(this.break(e),Co(e,s,i+1,r.id),$i(e,r,s,"after"))}else console.error("Not supported: insertBlockNode() on a custom node")}else if(n.isContainerSelection()){if(n.isCollapsed()){let t=n.start;if(t.isPropertyCoordinate())e.setSelection({type:"property",path:t.path,startOffset:t.offset,containerPath:s});else{if(!t.isNodeCoordinate())throw new Error("Unsupported selection for insertBlockNode");e.setSelection({type:"node",containerPath:s,nodeId:t.path[0],mode:0===t.offset?"before":"after"})}return this.insertBlockNode(e,r)}return this.break(e),this.insertBlockNode(e,r)}return r}insertText(e,t){let r=e.selection;if(r.isNodeSelection()){let n=r.containerPath,s=r.getNodeId(),i=zi(e,n,s),o=this.createTextNode(e,n,t);r.isBefore()?Co(e,n,i,o.id):r.isAfter()?Co(e,n,i+1,o.id):(xo(e,n,i),fo(e,e.get(s)),Co(e,n,i,o.id)),$i(e,o,n,"after")}else r.isCustomSelection()||(r.isCollapsed()||r.isPropertySelection()?this._insertText(e,r,t):r.isContainerSelection()&&(this._deleteContainerSelection(e,r),this.insertText(e,t)))}paste(e,t){if(t)if(S(t))sf(e,{text:t});else{if(!t._isDocument)throw new Error("Illegal content for paste.");sf(e,{doc:t})}}switchTextType(e,t){let r=e.selection;if(!r.isPropertySelection())throw new Error("Selection must be a PropertySelection.");let n=r.containerPath;if(!n)throw new Error("Selection must be within a container.");let s=r.path,i=s[0],o=e.get(i);if(!o.isText())throw new Error("Trying to use switchTextType on a non text node.");const a=d(t.type),l=o.getPath();console.assert(2===l.length,"Currently we assume that TextNodes store the plain-text on the first level");const c=l[1];let h=[a,c],u=Object.assign({id:a,type:t.type,direction:o.direction},t);u[c]=o.getText();let p=e.create(u);to.transferAnnotations(e,s,0,h,0);let f=zi(e,n,i);return xo(e,n,f),fo(e,o),Co(e,n,f,p.id),e.setSelection({type:"property",path:h,startOffset:r.start.offset,endOffset:r.end.offset,containerPath:n}),p}toggleList(e,t){let r=e.selection,n=r.containerPath;if(!n)throw new Error("Selection must be within a container.");if(r.isPropertySelection()){let s=Ui(e,n,r.start.path[0]),i=s.getPosition();if(s.isText()){xo(e,n,i);let o=this.createListNode(e,n,t),a=o.createListItem(s.getText());to.transferAnnotations(e,s.getPath(),0,a.getPath(),0),o.appendItem(a),fo(e,s),Co(e,n,i,o.id),e.setSelection({type:"property",path:a.getPath(),startOffset:r.start.offset,containerPath:n})}else if(s.isList()){let t=r.start.path[0],o=e.get(t),a=s.getItemPosition(o),l=this.createTextNode(e,n,o.getText());if(to.transferAnnotations(e,o.getPath(),0,l.getPath(),0),s.removeItemAt(a),s.isEmpty())xo(e,n,i),fo(e,s),Co(e,n,i,l.id);else if(0===a)Co(e,n,i,l.id);else if(s.getLength()<=a)Co(e,n,i+1,l.id);else{let t=[];const r=s.getItems();for(let e=r.length-1;e>=a;e--)t.unshift(r[e]),s.removeItemAt(e);let o=this.createListNode(e,n,s);for(let e=0;e<t.length;e++)o.appendItem(t[e]);Co(e,n,i+1,l.id),Co(e,n,i+2,o.id)}e.setSelection({type:"property",path:l.getPath(),startOffset:r.start.offset,containerPath:n})}}else r.isContainerSelection()&&console.error("TODO: support toggleList with ContainerSelection")}indent(e){let t=e.selection,r=t.containerPath;if(t.isPropertySelection()){let n=Ui(e,r,t.start.getNodeId());if(n.isList()){let r=t.start.path[0],s=e.get(r),i=s.getLevel();s&&i<3&&(s.setLevel(s.level+1),e.set([n.id,"_itemsChanged"],!0))}}else t.isContainerSelection()&&console.error("TODO: support toggleList with ContainerSelection")}dedent(e){let t=e.selection,r=t.containerPath;if(t.isPropertySelection()){let n=Ui(e,r,t.start.getNodeId());if(n.isList()){let r=t.start.path[0],s=e.get(r),i=s.getLevel();s&&i>1&&(s.setLevel(s.level-1),e.set([n.id,"_itemsChanged"],!0))}}else t.isContainerSelection()&&console.error("TODO: support toggleList with ContainerSelection")}_insertText(e,t,r){let n=t.start,s=t.end;if(!Oi(n.path,s.path))throw new Error("Unsupported state: range should be on one property");let i=n.path,o=n.offset,a=s.offset,l=!t.isCollapsed(),c=r.length;l&&e.update(i,{type:"delete",start:o,end:a}),e.update(i,{type:"insert",start:o,text:r}),e.getAnnotations(i).forEach(function(t){let r=t.start.offset,n=t.end.offset;n<o||(r>=a?(e.update([t.id,"start"],{type:"shift",value:o-a+c}),e.update([t.id,"end"],{type:"shift",value:o-a+c})):r>=o&&n<a||t.isInlineNode()&&r>=o&&n<=a?e.delete(t.id):r>=o&&n>=a?((r>o||!l)&&e.update([t.id,"start"],{type:"shift",value:o-r+c}),e.update([t.id,"end"],{type:"shift",value:o-a+c})):r<o&&n<a?e.update([t.id,"end"],{type:"shift",value:o-n+c}):(n!==o||t.constructor.autoExpandRight)&&(r<o&&n>=a?t.isInlineNode()||e.update([t.id,"end"],{type:"shift",value:o-a+c}):console.warn("TODO: handle annotation update case.")))});let h=o+r.length;e.setSelection({type:"property",path:n.path,startOffset:h,containerPath:t.containerPath,surfaceId:t.surfaceId})}_breakNode(e,t,r,n){(t=Ui(e,n,t.id)).isText()?this._breakTextNode(e,t,r,n):t.isList()?this._breakListNode(e,t,r,n):console.error("FIXME: _breakNode() not supported for type",t.type)}_breakTextNode(e,t,r,n){let s=r.path,i=r.offset,o=t.getPosition(),a=t.getText();if(0===i){Co(e,n,o,e.create({type:t.type,content:""}).id),e.setSelection({type:"property",path:s,startOffset:0,containerPath:n})}else{const r=t.getPath()[1],l=d(t.type);let c=t.toJSON();c.id=l,c[r]=a.substring(i),i===a.length&&(c.type=e.getSchema().getDefaultTextType());let h=e.create(c);i<a.length&&(to.transferAnnotations(e,s,i,h.getPath(),0),e.update(s,{type:"delete",start:i,end:a.length})),Co(e,n,o+1,h.id),e.setSelection({type:"property",path:h.getPath(),startOffset:0,containerPath:n})}}_breakListNode(e,t,r,n){let s=r.path,i=r.offset,o=e.get(s[0]),a=t.length,l=t.getItemPosition(o),c=o.getText(),h=o.getPath()[1],d=o.toJSON();if(delete d.id,0===i)if(c){d[h]="";let r=e.create(d);t.insertItemAt(l,r),e.setSelection({type:"property",path:o.getPath(),startOffset:0})}else{let r=t.getPosition(),s=this.createTextNode(e,n);if(a<2)xo(e,n,r),fo(e,t),Co(e,n,r,s.id);else if(0===l)t.removeItem(o),fo(e,o),Co(e,n,r,s.id);else if(l>=a-1)t.removeItem(o),fo(e,o),Co(e,n,r+1,s.id);else{let i=[];const o=t.getItems().slice();for(let e=a-1;e>l;e--)i.unshift(o[e]),t.removeItem(o[e]);t.removeItem(o[l]);let c=this.createListNode(e,n,t);for(let e=0;e<i.length;e++)c.appendItem(i[e]);Co(e,n,r+1,s.id),Co(e,n,r+2,c.id)}e.setSelection({type:"property",path:s.getPath(),startOffset:0})}else{d[h]=c.substring(i);let r=e.create(d);i<c.length&&(to.transferAnnotations(e,s,i,r.getPath(),0),e.update(s,{type:"delete",start:i,end:c.length})),t.insertItemAt(l+1,r),e.setSelection({type:"property",path:r.getPath(),startOffset:0})}}_merge(e,t,r,n,s){if(t.isList()){let i=t,o=r.path[0],a=e.get(o),l=i.getItemPosition(a);if("left"===n&&l>0||"right"===n&&l<i.items.length-1){l="left"===n?l-1:l;let t=i.getItemAt(l),r=t.getLength();return wo(e,i.id,l),void e.setSelection({type:"property",path:t.getPath(),startOffset:r,containerPath:s})}}let i=e.get(s),o=t.getPosition();"left"===n&&o>0?this._mergeNodes(e,s,o-1,n):"right"===n&&o<i.length-1&&this._mergeNodes(e,s,o,n)}_mergeNodes(e,t,r,n){let s=e.get(t),i=e.get(s[r]),o=r+1,a=e.get(s[o]);if(i.isText()){if(i.isEmpty())return xo(e,t,r),o--,fo(e,i),void $i(e,a,t,"before");let s=i,l=s.getPath(),c=s.getLength();if(a.isText()){let r=a,n=r.getPath();xo(e,t,o),e.update(l,{type:"insert",start:c,text:r.getText()}),to.transferAnnotations(e,n,0,l,c),fo(e,r),e.setSelection({type:"property",path:l,startOffset:c,containerPath:t})}else if(a.isList()){let r=a;if(!a.isEmpty()){let t=r.getFirstItem(),n=t.getPath();r.removeItemAt(0),e.update(l,{type:"insert",start:c,text:t.getText()}),to.transferAnnotations(e,n,0,l,c),fo(e,t)}r.isEmpty()&&(xo(e,t,o),fo(e,r)),e.setSelection({type:"property",path:l,startOffset:c,containerPath:t})}else Xi(e,"left"===n?i.id:a.id,t)}else if(i.isList())if(a.isText()){let n=i.getLastItem(),l=n.getPath(),c=n.getLength(),h=s.length>r+2?e.get(s[r+2]):null;if(0===a.getLength())xo(e,t,o),fo(e,a);else{let r=a,n=r.getPath();xo(e,t,o),e.update(l,{type:"insert",start:c,text:r.getText()}),to.transferAnnotations(e,n,0,l,c),fo(e,r)}h&&h.type===i.type&&this._mergeTwoLists(e,t,i,h),e.setSelection({type:"property",path:n.getPath(),startOffset:c,containerPath:t})}else if(a.isList()){if("right"!==n)throw new Error("Illegal state");let r=i.getLastItem();this._mergeTwoLists(e,t,i,a),e.setSelection({type:"property",path:r.getPath(),startOffset:r.getLength(),containerPath:t})}else Xi(e,"left"===n?i.id:a.id,t);else a.isText()&&a.isEmpty()?(xo(e,t,o),fo(e,a),$i(e,i,t,"after")):Xi(e,"left"===n?i.id:a.id,t)}_mergeTwoLists(e,t,r,n){xo(e,t,n.getPosition());let s=n.getItems().slice();for(let e=0;e<s.length;e++)n.removeItemAt(0),r.appendItem(s[e]);fo(e,n)}}class hf{constructor(e,t={}){this._document=e,this._selection=null,this._impl=t.editing||new cf,this._direction=null}dispose(){}getDocument(){return this._document}get(...e){return this._document.get(...e)}getProperty(...e){return this._document.getProperty(...e)}contains(e){return this._document.contains(e)}find(e){return this._document.find(e)}findAll(e){return this._document.findAll(e)}create(e){return this._document.create(e)}delete(e){return this._document.delete(e)}deepDeleteNode(e){return fo(this._document.get(e))}set(e,t){return this._document.set(e,t)}update(e,t){return this._document.update(e,t)}updateNode(e,t){return this._document.updateNode(e,t)}createSelection(e){return e=Zi(e,this._selection),this._document.createSelection(e)}setSelection(e){return e?C(e)?e=this.createSelection(e):e.isNull()||(e=Zi(e,this._selection)):e=Ii.nullSelection,this._selection=e,e}getSelection(){return this._selection}get selection(){return this._selection}set selection(e){this.setSelection(e)}get textDirection(){return this._direction}set textDirection(e){this._direction=e}annotate(e){const t=this._selection;if(t&&(t.isPropertySelection()||t.isContainerSelection()))return this._impl.annotate(this,e)}break(){this._selection&&!this._selection.isNull()&&this._impl.break(this)}copySelection(){const e=this.getDocument(),t=this._selection;if(t&&!t.isNull()&&!t.isCollapsed())return tf(e,this._selection)}deleteSelection(e){const t=this._selection;!t||t.isNull()||t.isCollapsed()||this._impl.delete(this,"right",e)}deleteCharacter(e){const t=this._selection;!t||t.isNull()||(t.isCollapsed()?this._impl.delete(this,e):this.deleteSelection())}insertText(e){const t=this._selection;t&&!t.isNull()&&this._impl.insertText(this,e)}insertInlineNode(e){const t=this._selection;if(t&&!t.isNull()&&t.isPropertySelection())return this._impl.insertInlineNode(this,e)}insertBlockNode(e){const t=this._selection;if(t&&!t.isNull())return this._impl.insertBlockNode(this,e)}paste(e){const t=this._selection;if(t&&!t.isNull()&&!t.isCustomSelection())return this._impl.paste(this,e)}switchTextType(e){const t=this._selection;if(t&&!t.isNull())return this._impl.switchTextType(this,e)}toggleList(e){const t=this._selection;if(t&&!t.isNull())return this._impl.toggleList(this,e)}indent(){const e=this._selection;if(e&&!e.isNull())return this._impl.indent(this)}dedent(){const e=this._selection;if(e&&!e.isNull())return this._impl.dedent(this)}getIndex(...e){return this._document.getIndex(...e)}getAnnotations(...e){return this._document.getAnnotations(...e)}getSchema(){return this._document.getSchema()}createSnippet(){return this._document.createSnippet()}}class df extends hf{constructor(e){super(e.clone())}generateChange(){const e=this.getDocument(),t=e._ops.slice();e._ops.length=0;let r=new Oo(t,{},{});return r._extractInformation(e),r}}function uf(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}class pf{constructor(e,t){if(this.context=t||{},!e.converters)throw new Error("config.converters is mandatory");if(e.converters._isRegistry?this.converters=e.converters:(this.converters=new bu,e.converters.forEach(function(e){let t=io(e)?new e:e;t.type?this.converters.add(t.type,t):console.error("Converter must provide the type of the associated node.",t)}.bind(this))),this.state={doc:null},this.config=e,this._elementFactory=e.elementFactory,!this._elementFactory)throw new Error("'elementFactory' is mandatory");this.$$=this.createElement.bind(this)}exportDocument(e){return this.convertDocument(e)}convertDocument(e){throw new Error("This method is abstract")}convertContainer(e,t){if(!t)throw new Error("Illegal arguments: containerPath is mandatory.");return this.state.doc=e,e.get(t).map(t=>{let r=e.get(t);return this.convertNode(r)})}convertNode(e){S(e)?e=this.state.doc.get(e):this.state.doc=e.getDocument();var t,r=this.getNodeConverter(e);return!e.isPropertyAnnotation()||r&&r.export?(r||(r=this.getDefaultBlockConverter()),(t=r.tagName?this.$$(r.tagName):this.$$("div")).attr(this.config.idAttribute,e.id),t=r.export?r.export(e,t,this)||t:this.getDefaultBlockConverter().export(e,t,this)||t):this._convertPropertyAnnotation(e)}convertProperty(e,t,r){return this.initialize(e,r),this.$$("div").append(this.annotatedText(t)).innerHTML}annotatedText(e){var t=this.state.doc,r=t.get(e),n=t.getIndex("annotations").get(e);return this._annotatedText(r,n)}getNodeConverter(e){return this.converters.get(e.type)}getDefaultBlockConverter(){throw new Error("This method is abstract.")}getDefaultPropertyAnnotationConverter(){throw new Error("This method is abstract.")}getDocument(){return this.state.doc}createElement(e){return this._elementFactory.createElement(e)}_annotatedText(e,t){var r=this,n=new tu;n.onText=function(e,t){t&&(r.config.ENCODE_ENTITIES_IN_TEXT&&(t=uf(t)),e.children.push(t))},n.onEnter=function(e){return{annotation:e.node,children:[]}},n.onExit=function(e,t,n){var s,i=t.annotation,o=r.getNodeConverter(i);if(o||(o=r.getDefaultPropertyAnnotationConverter()),(s=o.tagName?this.$$(o.tagName):this.$$("span")).attr(this.config.idAttribute,i.id),i.isInlineNode())s=o.export?o.export(i,s,r)||s:this.convertNode(i)||s;else{if(!i.isAnnotation())throw new Error("Illegal element type: only inline nodes and annotations are allowed within a TextNode");if(o.export&&(s=o.export(i,s,r)||s).children.length)throw new Error("A converter for an annotation type must not convert children. The content of an annotation is owned by their TextNode.");s.append(t.children)}n.children.push(s)}.bind(this);var s={children:[]};return n.start(s,e,t),s.children}_convertPropertyAnnotation(e){return this.$$("div").append(this.annotatedText(e.path)).find("["+this.config.idAttribute+'="'+e.id+'"]')}}class ff extends pf{constructor(e,t){super(function(e){(e=Object.assign({idAttribute:"data-id"},e)).elementFactory||(e.elementFactory=Xh.createDocument("html"));return e}(e),t)}exportDocument(e){let t=Xh.parseHTML("<html><head></head><body></body></html>");return this.convertDocument(e,t)}getDefaultBlockConverter(){return mf}getDefaultPropertyAnnotationConverter(){return gf}}const gf={tagName:"span",export:function(e,t){t.tagName="span",t.attr("data-type",e.type),r(e.toJSON(),function(e,r){"id"!==r&&"type"!==r&&(S(e)||x(e)||ed(e))&&t.attr("data-"+r,e)})}},mf={export:function(e,t,n){t.attr("data-type",e.type),r(e.toJSON(),function(r,s){if("id"!==s&&"type"!==s){var i=n.$$("div").attr("property",s);"string"===e.getPropertyType(s)&&r?i.append(n.annotatedText([e.id,s])):i.text(r),t.append(i)}})}};class _f{importDocument(e,t){if(!t.nodes)throw new Error("Invalid JSON format.");var n=e.getSchema();if(t.schema&&n.name!==t.schema.name)throw new Error("Incompatible schema.");var s=t.nodes;return e.import(function(e){r(s,function(t){e.get(t.id)&&e.delete(t.id),e.create(t)})}),e}exportDocument(e){var t={schema:{name:e.getSchema().name},nodes:{}};return r(e.getNodes(),function(e){e._isDocumentNode&&(t.nodes[e.id]=e.toJSON())}),t}}class yf extends ff{exportDocument(e){let t;this.state.doc=e;let r=this.convertDocument(e);t=1===r.length&&r[0].attr("data-id")===vo?r[0].innerHTML:r.map(function(e){return e.outerHTML}).join("");let n=new _f;return"<html><head>"+`<script id="substance-clipboard" type="application/json">${JSON.stringify(n.exportDocument(e))}<\/script>`+"</head><body>"+t+"</body></html>"}convertDocument(e){let t=e.get(bo);if(!t)throw new Error('Illegal clipboard document: could not find container "'+bo+'"');return this.convertContainer(e,t.getContentPath())}}function wf(){var e={};return function(t){return e.hasOwnProperty(t)||(e[t]=1),[t,"-",e[t]++].join("")}}const bf=/^\s+/g,vf=/\s+$/g,Cf=/\s+/g,Sf=" ",xf=/[\t\n\r]+/g,Ef="​";class Nf{constructor(e,t){if(this.context=t||{},!e.schema)throw new Error('"config.schema" is mandatory');if(!e.converters)throw new Error('"config.converters" is mandatory');this.config=Object.assign({idAttribute:"id"},e),this.schema=e.schema,this.converters=e.converters,this.state=null,this._defaultBlockConverter=null,this._allConverters=[],this._blockConverters=[],this._propertyAnnotationConverters=[],this.state=new Nf.State,this._initialize()}_initialize(){const e=this.schema,t=e.getDefaultTextType(),r=this.converters;for(let n=0;n<r.length;n++){let s;if("function"==typeof r[n]){s=new(0,r[n])}else s=r[n];if(!s.type)throw new Error("Converter must provide the type of the associated node.");if(!s.matchElement&&!s.tagName)throw new Error("Converter must provide a matchElement function or a tagName property.");s.matchElement||(s.matchElement=this._defaultElementMatcher.bind(s));const i=e.getNodeClass(s.type);if(!i)throw new Error("No node type defined for converter");this._defaultBlockConverter||t!==s.type||(this._defaultBlockConverter=s),this._allConverters.push(s),i.isPropertyAnnotation()||i.isInlineNode()?this._propertyAnnotationConverters.push(s):this._blockConverters.push(s)}}dispose(){this.state.doc&&this.state.doc.dispose()}reset(){this.state.doc&&this.state.doc.dispose(),this.state.reset(),this.state.doc=this._createDocument()}getDocument(){return this.state.doc}convertContainer(e,t){this.state.doc||this.reset();const r=this.state,n=new Xo(e),s=[];for(;n.hasNext();){const e=n.next();let t;const i=this._getConverterForElement(e,"block");if(i){r.pushContext(e.tagName,i);let n=this._createNodeData(e,i.type);n=i.import(e,n,this)||n,t=this._createNode(n),r.popContext().annos.forEach(e=>{this._createNode(e)})}else{if(e.isCommentNode())continue;if(e.isTextNode()&&/^\s*$/.exec(e.textContent))continue;n.back(),t=this._wrapInlineElementsIntoBlockElement(n)}t&&s.push(t.id)}return this._createNode({type:"@container",id:t,nodes:s})}convertElement(e){this.state.doc||this.reset();let t,r,n=!this.state.isConverting;n&&(this.state.isConverting=!0);const s=this._getConverterForElement(e);if(!s)throw new Error("No converter found for "+e.tagName);{const n=this.schema.getNodeClass(s.type);t=this._createNodeData(e,s.type),this.state.pushContext(e.tagName,s),t=n.isInlineNode()?this._convertInlineNode(e,t,s):n.isPropertyAnnotation()?this._convertPropertyAnnotation(e,t):s.import(e,t,this)||t,r=this.state.popContext().annos}const i=this._createNode(t);return r.forEach(e=>{this._createNode(e)}),this.config["stand-alone"]&&n&&(this.state.isConverting=!1,this.reset()),i}annotatedText(e,t,r={}){if(!t)throw new Error("path is mandatory");const n=this.state,s=Di(n.contexts);if(!s)throw new Error("This should be called from within an element converter.");const i=n.preserveWhitespace;r.preserveWhitespace&&(n.preserveWhitespace=!0),n.stack.push({path:t,offset:0,text:"",annos:[]}),this.state.lastChar="";const o=this.getChildNodeIterator(e),a=this._annotatedText(o),l=n.stack.pop();return s.annos=s.annos.concat(l.annos),n.preserveWhitespace=i,a}plainText(e){var t=this.state,r=e.textContent;if(t.stack.length>0){var n=Di(t.stack);n.offset+=r.length,n.text+=n.text.concat(r)}return r}_customText(e){var t=this.state;if(t.stack.length>0){var r=Di(t.stack);r.offset+=e.length,r.text+=r.text.concat(e)}return e}nextId(e){return this.state.uuid(e)}_getNextId(e,t){let r=this.nextId(t);for(;this.state.ids[r]||e.find("#"+r);)r=this.nextId(t);return r}_getIdForElement(e,t){let r=e.getAttribute(this.config.idAttribute);return r&&!this.state.ids[r]?r:this._getNextId(e.getOwnerDocument(),t)}_createDocument(){const e=this.config.schema;return new(e.getDocumentClass())(e)}_convertPropertyAnnotation(e,t){const r=[t.id,"_content"];return t._content=this.annotatedText(e,r),t.start={path:r,offset:0},t.end={offset:t._content.length},t}_convertInlineNode(e,t,r){const n=[t.id,"_content"];return r.import&&(t=r.import(e,t,this)||t),t._content="$",t.start={path:n,offset:0},t.end={offset:1},t}_createNodeData(e,t){if(!t)throw new Error("type is mandatory.");let r={type:t,id:this._getIdForElement(e,t)};return this.state.ids[r.id]=!0,r}_createNode(e){let t=this.state.doc,r=t.get(e.id);return r&&t.delete(r.id),t.create(e)}getChildNodeIterator(e){return e.getChildNodeIterator()}_defaultElementMatcher(e){return e.is(this.tagName)}_annotatedText(e){const t=this.state,r=Di(t.stack);if(!r)throw new Error("Illegal state: context is null.");for(;e.hasNext();){var n=e.next(),s="";if(n.isTextNode())(s=this._prepareText(n.textContent)).length&&(r.text=r.text.concat(s),r.offset+=s.length);else{if(n.isCommentNode())continue;if(n.isElementNode()){const e=this._getConverterForElement(n,"inline");if(!e){this.IGNORE_DEFAULT_WARNINGS||console.warn("Unsupported inline element. We will not create an annotation for it, but process its children to extract annotated text.",n.outerHTML);const e=this.getChildNodeIterator(n);this._annotatedText(e);continue}var i=r.offset;const s=e.type,o=this.schema.getNodeClass(s);if(!o)throw new Error(`No Node class registered for type ${s}.`);let a=this._createNodeData(n,s),l={path:r.path,offset:i,text:"",annos:[]};if(t.stack.push(l),e.import&&(t.pushContext(n.tagName,e),a=e.import(n,a,this)||a,t.popContext()),o.isInlineNode())this._customText(Ef),t.lastChar="";else{const e=this.getChildNodeIterator(n);this._annotatedText(e)}t.stack.pop(),r.offset=l.offset,r.text=r.text.concat(l.text);const c=r.offset;a.start={path:r.path.slice(0),offset:i},a.end={offset:c};let h=Di(t.stack);h.annos=h.annos.concat(l.annos,a)}else console.warn("Unknown element type. Taking plain text.",n.outerHTML),s=this._prepareText(n.textContent),r.text=r.text.concat(s),r.offset+=s.length}}return r.text}_getConverterForElement(e,t){var r;if("block"===t){if(!e.tagName)return null;r=this._blockConverters}else r="inline"===t?this._propertyAnnotationConverters:this._allConverters;for(var n=null,s=0;s<r.length;s++)if(this._converterCanBeApplied(r[s],e)){n=r[s];break}return n}_converterCanBeApplied(e,t){return e.matchElement(t,this)}_wrapInlineElementsIntoBlockElement(e){if(!e.hasNext())return;const t=this._defaultBlockConverter;if(!t)throw new Error("Wrapping inline elements automatically is not supported in this schema.");let r=e.peek().getOwnerDocument(),n=r.createElement("wrapper");for(;e.hasNext();){const t=e.next();if(this._getConverterForElement(t,"block")){e.back();break}n.append(t.clone())}const s=this.schema.getDefaultTextType();let i={type:s,id:this._getNextId(r,s)};this.state.pushContext("wrapper",t),i=t.import(n,i,this)||i;let o=this.state.popContext().annos;const a=this._createNode(i);return o.forEach(e=>{this._createNode(e)}),a}_prepareText(e){const t=this.state;if(t.preserveWhitespace)return e;var r=Sf;return e=e.replace(xf,""),e=(e=t.lastChar===Sf?e.replace(bf,""):e.replace(bf,r)).replace(vf,r),(this.config.REMOVE_INNER_WS||t.removeInnerWhitespace)&&(e=e.replace(Cf,Sf)),t.lastChar=e[e.length-1]||t.lastChar,e}_trimTextContent(e){var t,r,n=e.getChildNodes(),s=n[0],i=Di(n);return s&&s.isTextNode()&&(t=s.textContent,r=this._trimLeft(t),s.textContent=r),i&&i.isTextNode()&&(t=i.textContent,r=this._trimRight(t),i.textContent=r),e}_trimLeft(e){return e.replace(bf,"")}_trimRight(e){return e.replace(vf,"")}}Nf.State=class{constructor(){this.reset()}reset(){this.preserveWhitespace=!1,this.nodes=[],this.annotations=[],this.containerPath=null,this.container=[],this.ids={},this.contexts=[],this.stack=[],this.lastChar="",this.skipTypes={},this.ignoreAnnotations=!1,this.isConverting=!1,this.uuid=wf()}pushContext(e,t){this.contexts.push({tagName:e,converter:t,annos:[]})}popContext(){return this.contexts.pop()}getCurrentContext(){return Di(this.contexts)}},Nf.INVISIBLE_CHARACTER=Ef;class Tf extends Nf{constructor(e){super(Object.assign({idAttribute:"data-id"},e)),this._el=Xh.parseHTML("<html></html>")}importDocument(e){this.reset();var t=Xh.parseHTML(e);return this.convertDocument(t),this.state.doc}convertDocument(e){throw new Error("This method is abstract")}}const Pf=["a","b","big","i","small","tt","abbr","acronym","cite","code","dfn","em","kbd","strong","samp","time","var","bdo","br","img","map","object","q","script","span","sub","sup","button","input","label","select","textarea"].reduce((e,t)=>(e[t]=!0,e),{});class Df extends Tf{constructor(e){super(function(e){let t=(e=Object.assign({},e)).schema.getDefaultTextType();t&&(e.converters=e.converters.concat([{type:t,matchElement:function(e){return e.is("div")},import:function(e,t,r){t.content=r.annotatedText(e,[t.id,"content"])}}]));return e}(e)),this.IGNORE_DEFAULT_WARNINGS=!0,Object.assign(e,{trimWhitespaces:!0,REMOVE_INNER_WS:!0}),this.editorOptions=e.editorOptions}importDocument(e){if(y.isWindows){let t=/<!--StartFragment-->(.*)<!--EndFragment-->/.exec(e);t&&(e=t[1])}if(e.search(/script id=.substance-clipboard./)>=0){let t=Xh.parseHTML(e).find("#substance-clipboard");if(t){let e=t.textContent;try{return this.importFromJSON(e)}finally{}}}if(this.editorOptions&&this.editorOptions.forcePlainTextPaste)return null;let t=Xh.parseHTML(e),r=t.find('meta[name="generator"]'),n=t.find("html").getAttribute("xmlns:w");if(r){r.getAttribute("content").indexOf("LibreOffice")>-1&&(this._isLibreOffice=!0)}else if(n){if(n.indexOf("office:word")>-1){this._isMicrosoftWord=!0;let r=/<!--StartFragment-->([\s\S]*)<!--EndFragment-->/.exec(e);r&&(t=Xh.parseHTML(r[1]))}}else e.indexOf("docs-internal-guid")>-1&&(this._isGoogleDoc=!0);let s=t.find("body");if(!(s=this._sanitizeBody(s)))return console.warn("Invalid HTML."),null;return this._wrapIntoParagraph(s),this.reset(),this.convertBody(s),this.state.doc}_sanitizeBody(e){if(e.findAll("meta").forEach(e=>e.remove()),this._isLibreOffice||this._isMicrosoftWord){let t=e.getInnerHTML();e.setInnerHTML(t.replace(/\r\n|\r|\n/g," "))}else this._isGoogleDoc&&(e=this._fixupGoogleDocsBody(e));return e}_fixupGoogleDocsBody(e){if(!e)return;let t=e.find("b");t&&/^docs-internal/.exec(t.id)&&(e=t),e.findAll("span").forEach(e=>{let t=[];"700"===e.getStyle("font-weight")&&t.push("b"),"italic"===e.getStyle("font-style")&&t.push("i"),"super"===e.getStyle("vertical-align")&&t.push("sup"),"sub"===e.getStyle("vertical-align")&&t.push("sub"),e.removeAttribute("style"),function r(n,s){if(t.length>0){let i=n.createElement(t[0]);1===t.length&&i.append(e.textContent),s?n.replaceChild(e,i):n.appendChild(i),t.shift(),r(i)}}(e.getParent(),!0)});return["b","i","sup","sub"].forEach(t=>{e.findAll(t).forEach(e=>{let r=e.getPreviousSibling();if(r&&e.tagName===r.tagName){let n=e.getParent(),s=n.createElement(t);s.setInnerHTML(r.getInnerHTML()+e.getInnerHTML()),n.replaceChild(e,s),n.removeChild(r)}if(r&&r.tagName&&e.getChildCount()>0&&e.getChildAt(0).tagName===r.tagName){let n=e.getParent(),s=e.getChildAt(0),i=n.createElement(r.tagName),o=i.createElement(t);o.setTextContent(s.textContent),i.appendChild(o),n.replaceChild(e,i)}})}),e}_wrapIntoParagraph(e){let t=e.getChildNodes(),r=!1;for(let e=0;e<t.length;e++){const n=t[e];if(n.isTextNode()){if(!/^\s+$/.exec(n.textContent)){r=!0;break}}else if(Pf[n.tagName]){r=!0;break}}if(r){let r=e.createElement("p");r.append(t),e.append(r)}}importFromJSON(e){this.reset();let t=this.getDocument(),r=JSON.parse(e);return(new _f).importDocument(t,r),t}convertBody(e){this.convertContainer(e.childNodes,bo)}_createDocument(){return super._createDocument().createSnippet()}}class If extends so{constructor(){super(),this.byId=new Yp}select(e){return e.isContainerAnnotation()}clear(){this.byId.clear()}get(e,t){var r=g(this.byId.get(String(e)));return S(t)&&(r=oo(r,so.filterByType)),r}create(e){this.byId.set([String(e.containerPath),e.id],e)}delete(e){this.byId.delete([String(e.containerPath),e.id])}update(e,t,r,n){}}class Af extends l{constructor(e,t){if(super(),!e)throw new Error("schema is mandatory");if(!t)throw new Error("nodeFactory is mandatory");this.schema=e,this.nodeFactory=t,this.nodes={},this.indexes={},this.__QUEUE_INDEXING__=!1,this.queue=[]}contains(e){return Boolean(this.nodes[e])}get(e,t){let r=this._get(e);if(t&&void 0===r)throw S(e)?new Error("Could not find node with id '"+e+"'."):this.contains(e[0])?new Error("Property for path '"+e+"' us undefined."):new Error("Could not find node with id '"+e[0]+"'.");return r}_get(e){if(!e)return;let t;if(S(e)){let r=e;t=this.nodes[r]}else if(1===e.length){let r=e[0];t=this.nodes[r]}else if(e.length>1){let r=e[0],n=this.nodes[r];for(let t=1;t<e.length-1;t++){if(!n)return;n=n[e[t]]}if(!n)return;t=n[e[e.length-1]]}return t}getNodes(){return this.nodes}create(e){var t=this.nodeFactory.create(e.type,e);if(!t)throw new Error("Illegal argument: could not create node for data:",e);if(this.contains(t.id))throw new Error("Node already exists: "+t.id);if(!t.id||!t.type)throw new Error("Node id and type are mandatory.");this.nodes[t.id]=t;var r={type:"create",node:t};return this.__QUEUE_INDEXING__?this.queue.push(r):this._updateIndexes(r),t}delete(e){var t=this.nodes[e];if(t){t.dispose(),delete this.nodes[e];var r={type:"delete",node:t};return this.__QUEUE_INDEXING__?this.queue.push(r):this._updateIndexes(r),t}}set(e,t){let r=this.get(e[0]),n=this._set(e,t);var s={type:"set",node:r,path:e,newValue:t,oldValue:n};return this.__QUEUE_INDEXING__?this.queue.push(s):this._updateIndexes(s),n}_set(e,t){return function(e,t,r){m(r)?r=r.slice():C(r)&&(r=b(r));let n=e,s=t.length;for(let e=0;e<s-1;e++)if(!(n=n[t[e]]))throw new Error("Can not set value.");let i=t[s-1],o=n[i];n._isNode?n._set(i,r):n[i]=r;return o}(this.nodes,e,t)}update(e,t){let r,n=this.get(e[0]),s=this._get(e);if(t._isOperation)if(t._isArrayOperation){let e=s;s=Array.from(s),r=t.apply(e)}else if(t._isCoordinateOperation){let e=s;s=s.clone(),r=t.apply(e)}else r=t.apply(s);else if(t=this._normalizeDiff(s,t),S(s))switch(t.type){case"delete":r=s.split("").splice(t.start,t.end-t.start).join("");break;case"insert":r=[s.substring(0,t.start),t.text,s.substring(t.start)].join("");break;default:throw new Error("Unknown diff type")}else if(m(s))switch(r=s.slice(0),t.type){case"delete":r.splice(t.pos,1);break;case"insert":r.splice(t.pos,0,t.value);break;default:throw new Error("Unknown diff type")}else{if(!s._isCoordinate)throw new Error("Diff is not supported:",JSON.stringify(t));switch(t.type){case"shift":(r=s={path:s.path,offset:s.offset}).offset+=t.value;break;default:throw new Error("Unknown diff type")}}this._set(e,r);var i={type:"update",node:n,path:e,newValue:r,oldValue:s};return this.__QUEUE_INDEXING__?this.queue.push(i):this._updateIndexes(i),s}_normalizeDiff(e,t){return S(e)?t.delete?(console.warn('DEPRECATED: use doc.update(path, {type:"delete", start:s, end: e}) instead'),t={type:"delete",start:t.delete.start,end:t.delete.end}):t.insert&&(console.warn('DEPRECATED: use doc.update(path, {type:"insert", start:s, text: t}) instead'),t={type:"insert",start:t.insert.offset,text:t.insert.value}):m(e)?t.delete?(console.warn('DEPRECATED: use doc.update(path, {type:"delete", pos:1}) instead'),t={type:"delete",pos:t.delete.offset}):t.insert&&(console.warn('DEPRECATED: use doc.update(path, {type:"insert", pos:1, value: "foo"}) instead'),t={type:"insert",pos:t.insert.offset,value:t.insert.value}):e._isCoordinate&&t.hasOwnProperty("shift")&&(console.warn('DEPRECATED: use doc.update(path, {type:"shift", value:2}) instead'),t={type:"shift",value:t.shift}),t}toJSON(){let e={};return r(this.nodes,t=>{e[t.id]=t.toJSON()}),{schema:[this.schema.id,this.schema.version],nodes:e}}reset(){this.clear()}clear(){this.nodes={},r(this.indexes,e=>e.clear())}addIndex(e,t){return this.indexes[e]&&console.error("Index with name %s already exists.",e),t.reset(this),this.indexes[e]=t,t}getIndex(e){return this.indexes[e]}_updateIndexes(e){e&&!this.__QUEUE_INDEXING__&&r(this.indexes,function(t){if(t.select(e.node))switch(t[e.type]||console.error("Contract: every NodeIndex must implement "+e.type),e.type){case"create":t.create(e.node);break;case"delete":t.delete(e.node);break;case"set":t.set(e.node,e.path,e.newValue,e.oldValue);break;case"update":t.update(e.node,e.path,e.newValue,e.oldValue);break;default:throw new Error("Illegal state.")}})}_stopIndexing(){this.__QUEUE_INDEXING__=!0}_startIndexing(){for(this.__QUEUE_INDEXING__=!1;this.queue.length>0;){var e=this.queue.shift();this._updateIndexes(e)}}}class Of{constructor(e,t){this.fileNode=e,this.context=t,e.setProxy(this)}get id(){return this.fileNode.id}triggerUpdate(){let e=this.fileNode.id;this.context.editorSession.transaction(t=>{t.set([e,"__changed__"],"")},{history:!1})}getUrl(){return""}sync(){return Promise.reject(new Error("sync method not implemented"))}}Of.match=function(e,t){return!1};class kf extends Of{constructor(e,t){super(e,t),this.file=e.sourceFile,this.file&&(this._fileUrl=URL.createObjectURL(this.file)),this.url=e.url}getUrl(){return this.url?this.url:this._fileUrl?this._fileUrl:""}sync(){return this.url||(console.info("Simulating file upload. Creating blob url instead.",this._fileUrl),this.url=this._fileUrl),Promise.resolve()}}class Mf extends no{constructor(e){super(),this._property=e||"id",this.index=new Yp}get(e){return this.index.get(e)||{}}getAll(e){return this.index.getAll(e)}clear(){this.index.clear()}select(e){return!0}create(e){var t=e[this._property];m(t)||(t=[t]),r(t,function(t){this.index.set([t,e.id],e)}.bind(this))}delete(e){var t=e[this._property];m(t)||(t=[t]),r(t,function(t){this.index.delete([t,e.id])}.bind(this))}update(e,t,n,s){if(this.select(e)&&t[1]===this._property){var i=s;m(i)||(i=[i]),r(i,function(t){this.index.delete([t,e.id])}.bind(this)),m(i=n)||(i=[i]),r(i,function(t){this.index.set([t,e.id],e)}.bind(this))}}set(e,t,r,n){this.update(e,t,r,n)}_initialize(e){r(e.getNodes(),function(e){this.select(e)&&this.create(e)}.bind(this))}}class Lf extends Af{create(e){e._isNode&&(e=e.toJSON());let t=ui.Create([e.id],e);return this.apply(t),t}delete(e){var t=null,r=this.get(e);if(r){var n=r.toJSON();t=ui.Delete([e],n),this.apply(t)}return t}update(e,t){var r=this._getDiffOp(e,t),n=ui.Update(e,r);return this.apply(n),n}set(e,t){var r=this.get(e),n=ui.Set(e,r,t);return this.apply(n),n}apply(e){if(e.type!==ui.NOP){if(e.type===ui.CREATE)super.create(b(e.val));else if(e.type===ui.DELETE)super.delete(e.val.id);else if(e.type===ui.UPDATE){let t=e.diff;super.update(e.path,t)}else{if(e.type!==ui.SET)throw new Error("Illegal state.");super.set(e.path,e.val)}this.emit("operation:applied",e,this)}}_getDiffOp(e,t){var r=null;if(t.isOperation)r=t;else{var n=this.get(e);if(t=this._normalizeDiff(n,t),null===n||void 0===n)throw new Error("Property has not been initialized: "+JSON.stringify(e));if(S(n))switch(t.type){case"delete":r=Ys.Delete(t.start,n.substring(t.start,t.end));break;case"insert":r=Ys.Insert(t.start,t.text);break;default:throw new Error("Unknown diff type")}else if(m(n))switch(t.type){case"delete":r=ri.Delete(t.pos,n[t.pos]);break;case"insert":r=ri.Insert(t.pos,t.value);break;default:throw new Error("Unknown diff type")}else if(n._isCoordinate)switch(t.type){case"shift":r=oi.Shift(t.value);break;default:throw new Error("Unknown diff type")}}if(!r)throw new Error("Unsupported diff: "+JSON.stringify(t));return r}}class Rf{constructor(e){this.doc=e}create(e,t){var r=this.doc.schema.getNodeClass(e);if(!r)throw new Error("No node registered by that name: "+e);return new r(this.doc,t)}}class qf{constructor(e){this.doc=e,this.parents={},e.data.on("operation:applied",this._onOperationApplied,this)}_onOperationApplied(e){let t,r=this.doc.get(e.path[0]),n=!1,s=!1;switch(r&&(n=(t=r.getSchema()).hasOwnedProperties(),s=r.isAnnotation()),e.type){case"create":if(n)for(let e of t.getOwnedProperties()){let t=e.isArray(),n=r[e.name];n&&this._setParent(r,n,e.name,t),t&&this._updateContainerPositions([r.id,e.name])}s&&this._setAnnotationParent(r),this._setRegisteredParent(r);break;case"update":if(n){let n=e.path[1];if(t.isOwned(n)){let t=e.diff,s=t._isArrayOperation;t.isDelete()?this._setParent(null,t.getValue(),n,s):this._setParent(r,t.getValue(),n,s),s&&this._updateContainerPositions(e.path)}}break;case"set":if(n){let n=e.path[1];if(t.isOwned(n)){let s=t.getProperty(n).isArray(),i=e.getOldValue(),o=e.getValue();this._setParent(null,i,n,s),this._setParent(r,o,n,s),s&&this._updateContainerPositions(e.path)}}s&&"start"===e.path[1]&&"path"===e.path[2]&&this._setAnnotationParent(r)}}_setParent(e,t,r,n){t&&(m(t)?t.forEach(t=>this.__setParent(e,t,r,n)):this.__setParent(e,t,r,n))}__setParent(e,t,r,n){let s=this.doc.get(t);s?this._setParentAndXpath(e,s,r):this.parents[t]={parent:e,property:r,isChildren:n}}_setRegisteredParent(e){let t=this.parents[e.id];if(t){let{parent:r,property:n,isChildren:s}=t;this._setParentAndXpath(r,e,n),s&&(e._xpath.pos=r[n].indexOf(e.id)),delete this.parents[e.id]}}_setParentAndXpath(e,t,r){t.setParent(e);let n=t._xpath;e?(n.prev=e._xpath,n.property=r):(n.prev=null,n.property=null,n.pos=null)}_updateContainerPositions(e){let t=this.doc,r=t.get(e);if(r)for(let e=0;e<r.length;e++){let n=r[e],s=t.get(n);s&&(s._xpath.pos=e)}}_setAnnotationParent(e){let t=e.getDocument(),r=e.start.path,n=t.get(r[0]);this._setParent(n,e.id,r[1])}}qf.register=function(e){return new qf(e)};const Bf=new _f;class Ff extends l{constructor(e,...t){if(super(),this.schema=e,!e)throw new Error("A document needs a schema for reflection.");this._ops=[],this._initialize(...t)}_initialize(){this.__id__=d(),this.nodeFactory=new Rf(this),this.data=new Lf(this.schema,this.nodeFactory),this.addIndex("type",new Mf("type")),this.addIndex("annotations",new Qp),this.addIndex("container-annotations",new If),qf.register(this)}dispose(){this.off(),this.data.off()}get id(){return this.__id__}getSchema(){return this.schema}contains(e){return this.data.contains(e)}get(e,t){return this.data.get(e,t)}resolve(e,t){let r=this.getProperty(e);if(!r){if(t)throw new Error("Invalid path");return}let n=this.get(e,t);return r.isReference()?r.isArray()?n.map(e=>this.get(e)):this.get(n):n}getNodes(){return this.data.getNodes()}getAnnotations(e){return this.getIndex("annotations").get(e)}getProperty(e){if(2!==e.length)throw new Error("path must have length=2");let[t,r]=e,n=this.get(t);if(n)return n.getSchema().getProperty(r);throw new Error("Invalid path.")}import(e){try{this.data._stopIndexing(),e(this),this.data._startIndexing()}finally{this.data.queue=[],this.data._startIndexing()}}create(e){if(e.id||(e.id=d(e.type)),!e.type)throw new Error("No node type provided");const t=this._create(e);if(t)return this._ops.push(t),this._isTransactionDocument||this._emitChange(t),this.get(e.id)}createDefaultTextNode(e,t){return this.create({type:this.getSchema().getDefaultTextType(),content:e||"",direction:t})}delete(e){const t=this.get(e),r=this._delete(e);return r&&(this._ops.push(r),this._isTransactionDocument||this._emitChange(r)),t}set(e,t){const r=this.get(e),n=this._set(e,t);return n&&(this._ops.push(n),this._isTransactionDocument||this._emitChange(n)),r}update(e,t){const r=this._update(e,t);return r&&(this._ops.push(r),this._isTransactionDocument||this._emitChange(r)),r}updateNode(e,t){let n=this.get(e);r(t,(r,s)=>{E(n[s],t[s])||this.set([e,s],r)})}addIndex(e,t){return this.data.addIndex(e,t)}getIndex(e){return this.data.getIndex(e)}createSelection(e){let t;if(N(e))return Ii.nullSelection;if(1!==arguments.length||!C(e))throw new Error("Illegal argument: call createSelection({ type: ... }");switch(e.type){case"property":{N(e.endOffset)&&(e.endOffset=e.startOffset),e.hasOwnProperty("reverse")||e.startOffset>e.endOffset&&([e.startOffset,e.endOffset]=[e.endOffset,e.startOffset],e.reverse=!e.reverse);let r=this.get(e.path,"strict");if(e.startOffset<0||e.startOffset>r.length)throw new Error("Invalid startOffset: target property has length "+r.length+", given startOffset is "+e.startOffset);if(e.endOffset<0||e.endOffset>r.length)throw new Error("Invalid startOffset: target property has length "+r.length+", given endOffset is "+e.endOffset);t=new Mi(e);break}case"container":{let r=e.containerPath;if(!this.get(r))throw new Error('Can not create ContainerSelection: container "'+r+'" does not exist.');let n=this._normalizeCoor({path:e.startPath,offset:e.startOffset,containerPath:r}),s=this._normalizeCoor({path:e.endPath,offset:e.endOffset,containerPath:r});e.hasOwnProperty("reverse")||Li(this,r,n,s)>0&&([n,s]=[s,n],e.reverse=!0),t=new Bi(r,n.path,n.offset,s.path,s.offset,e.reverse,e.surfaceId);break}case"node":t=Wi({doc:this,nodeId:e.nodeId,mode:e.mode,containerPath:e.containerPath,reverse:e.reverse,surfaceId:e.surfaceId});break;case"custom":t=Hi.fromJSON(e);break;default:throw new Error("Illegal selection type",e)}return t.isNull()||t.attach(this),t}newInstance(){return new(0,this.constructor)(this.schema)}createSnippet(){var e=this.newInstance(),t=e.create({type:"@container",id:bo});return e.getContainer=function(){return t},e}rebase(e,t){return t.length>0&&ko(t,e,{rebase:!0,immutableLeft:!0}),e}createFromDocument(e){this.clear();let t=Object.values(e.getNodes()),r={},n=new Set;return t.forEach(e=>{n.has(e)||this._computeDependencyLevel(e,r,n)}),t.sort((e,t)=>r[t.id]-r[e.id]),t.forEach(e=>this.create(e)),this}_computeDependencyLevel(e,t,r){if(!e)throw new Error("node was nil");if(r.has(e))throw new Error("Cyclic node dependency");r.add(e);let n=0;if(e.isAnnotation()||e.isInlineNode())n=-1;else{let s=e.getParent();if(s){let e;n=(e=t.hasOwnProperty(s.id)?t[s.id]:this._computeDependencyLevel(s,t,r))+1}}return t[e.id]=n,n}toJSON(){return Bf.exportDocument(this)}clone(){let e=this.newInstance();return e.createFromDocument(this),e}clear(){this.data.clear(),this._ops.length=0}createEditingInterface(){return new hf(this)}invert(e){return e.invert()}_apply(e){let t=e.ops;for(let e of t)this._applyOp(e);e._extractInformation(this)}_applyOp(e){this.data.apply(e),this.emit("operation:applied",e)}_create(e){return this.data.create(e)}_delete(e){return this.data.delete(e)}_set(e,t){return this.data.set(e,t)}_update(e,t){return this.data.update(e,t)}_emitChange(e){const t=new Oo([e],{},{});t._extractInformation(this),this._notifyChangeListeners(t,{hidden:!0})}_notifyChangeListeners(e,t){t=t||{},this.emit("document:changed",e,t,this)}_createSelectionFromRange(e){if(!e)return Ii.nullSelection;return E(e.start.path,e.end.path)?e.start.isNodeCoordinate()?new ji(e.containerPath,e.start.getNodeId(),"full",e.reverse,e.surfaceId):this.createSelection({type:"property",path:e.start.path,startOffset:e.start.offset,endOffset:e.end.offset,reverse:e.reverse,containerPath:e.containerPath,surfaceId:e.surfaceId}):this.createSelection({type:"container",startPath:e.start.path,startOffset:e.start.offset,endPath:e.end.path,endOffset:e.end.offset,reverse:e.reverse,containerPath:e.containerPath,surfaceId:e.surfaceId})}_normalizeCoor({path:e,offset:t,containerPath:r}){if(1===e.length){let n=Ui(this,r,e[0]);if(n.isText())return new ki(n.getPath(),0===t?0:n.getLength());if(n.isList()){if(0===t){let e=n.getItemAt(0);return new ki(e.getPath(),0)}{let e=this.get(Di(n.items));return new ki(e.getPath(),e.getLength())}}}return new ki(e,t)}get _isDocument(){return!0}}class jf extends Mu{getUrl(){return this.proxy?this.proxy.getUrl():(console.warn("No file proxy attached to ",this.id),"")}setProxy(e){this.proxy=e}get _isFileNode(){return!0}static get _isFileNode(){return!0}}jf.schema={type:"file",url:{type:"string",optional:!0},fileType:{type:"string",optional:!0},mimeType:{type:"string",optional:!0},sourceFile:{type:"object",optional:!0}};const Hf="This method is abstract!";function Uf(e){return class extends e{createListItem(e){throw new Error(Hf)}getItems(){throw new Error(Hf)}getItemsPath(){throw new Error(Hf)}insertItemAt(e,t){throw new Error(Hf)}removeItemAt(e){throw new Error(Hf)}getItemAt(e){return this.getItems()[e]}getItemPosition(e){return this.getItems().indexOf(e)}getLength(){return this.getItems().length}getFirstItem(){return this.getItemAt(0)}getLastItem(){return this.getItemAt(this.getLength()-1)}appendItem(e){this.insertItemAt(this.items.length,e)}removeItem(e){const t=this.getItemPosition(e);t>=0&&this.removeItemAt(t)}isEmpty(){return 0===this.getLength()}get length(){return this.getLength()}getListType(e){let t=e-1;return this._getListTypes()[t]||"bullet"}setListType(e,t){let r=e-1,n=this._getListTypes();if(n.length<e)for(let e=0;e<r;e++)n[e]||(n[e]="bullet");n[r]=t,this._setListTypes(n)}_getListTypes(){let e=this.getListTypeString();return e?e.split(",").map(e=>e.trim()):[]}_setListTypes(e){m(e)&&(e=e.join(",")),this.getListTypeString()!==e&&this.setListTypeString(e)}static isList(){return!0}}}function zf(...e){return{type:"text",targetTypes:e=ao(e)}}const Vf=Object.freeze(zf());function Gf(...e){return{type:["array","id"],targetTypes:e=ao(e),default:[],owned:!0}}function Jf(e){return class extends e{getTextPath(){return console.warn("DEPRECATED: use node.getPath()"),this.getPath()}getText(){return this.content}setText(e){return yo(this.getDocument(),this.getPath(),e),this}isEmpty(){return!this.getText()}getLength(){return this.getText().length}getAnnotations(){return this.getDocument().getIndex("annotations").get(this.getPath())}}}class Kf extends(Jf(Mu)){getPath(){return[this.id,"content"]}getText(){return this.content}static isText(){return!0}}Kf.schema={type:"text-node",content:"text",direction:{type:"enum",optional:!0,values:["left","right"]},textAlign:{type:"enum",default:"left",values:["left","right"]}};class $f extends Kf{static isBlock(){return!0}}const Xf={tagName:"annotation",export:function(e,t){t.attr("type",e.type),r(e.toJSON(),function(e,r){"id"!==r&&"type"!==r&&(S(e)||x(e)||ed(e))&&t.attr(r,e)})}},Wf={tagName:"block",export:function(e,t,n){t.attr("type",e.type),r(e.toJSON(),function(r,s){if("id"===s||"type"===s)return;const i=n.$$(s);"string"===e.getPropertyType(s)?i.append(n.annotatedText([e.id,s])):i.text(r),t.append(i)})}};class Yf{constructor(e){let t=e.getSchema(),r=e.getConverterRegistry(),n=[];r&&r.contains("html")&&(n=r.get("html").values()||[]),this._config={schema:t,DocumentClass:t.getDocumentClass(),converters:n,editorOptions:e.getEditorOptions()}}onCopy(e){let t=this._copy();Zh._clipboardData=e.clipboardData,e.clipboardData&&t.doc&&(e.preventDefault(),e.clipboardData.setData("text/plain",t.text),e.clipboardData.setData("text/html",t.html))}onCut(e){e.preventDefault(),this.onCopy(e),this._cut()}onPaste(e){let t,r,n=e.clipboardData,s={};for(let e=0;e<n.types.length;e++)s[n.types[e]]=!0;e.preventDefault(),e.stopPropagation(),s["text/plain"]&&(t=n.getData("text/plain")),s["text/html"]&&(r=n.getData("text/html")),Zh.clipboardData={text:t,html:r},r&&this._pasteHtml(r,t)||this._pastePlainText(t)}_getImporter(){return new Df(this._config)}_getExporter(){return new yf(this._config)}_copy(){throw new Error("This method is abstract.")}_cut(){throw new Error("This method is abstract.")}_pastePlainText(e){throw new Error("This method is abstract.")}_pasteHtml(e,t){throw new Error("This method is abstract.")}}class Zf{constructor(e){if(this.config=e||{},this.name=this.config.name,!this.name)throw new Error("'name' is required")}get isAsync(){return!1}getName(){return this.name}getCommandState(e,t){throw new Error("Command.getCommandState() is abstract.")}execute(e,t){throw new Error("Command.execute() is abstract.")}isAnnotationCommand(){return!1}isInsertCommand(){return!1}isSwitchTypeCommand(){return!1}getParams(e){return new op(e)}get _isCommand(){return!0}}Zf.DISABLED=Object.freeze({disabled:!0,active:!1});class Qf extends Zf{constructor(e){if(super(e),!this.config.nodeType)throw new Error("'nodeType' is required")}getAnnotationType(){return this.config.nodeType}getType(){return this.getAnnotationType()}getAnnotationData(){return{}}isDisabled(e,t){let r=t.selectionState;return!!(t.editorSession.isBlurred()||!e||e.isNull()||!e.isAttached()||e.isCustomSelection()||e.isNodeSelection()||e.isContainerSelection()||r.isInlineNodeSelection)}showInContext(e){return!e.isCollapsed()}canCreate(e,t){if(t.isCollapsed())return!1;if(0===e.length)return!0;for(let r of e)if(t.overlaps(r.getSelection(),"strict"))return!1;return!0}canFuse(e,t){return e.length>=2&&!t.isCollapsed()}canDelete(e,t){if(1!==e.length)return!1;let r=e[0].getSelection();return t.isInsideOf(r)}canExpand(e,t){if(1!==e.length)return!1;let r=e[0].getSelection();return t.overlaps(r,"strict")&&!t.isInsideOf(r)}canTruncate(e,t){if(1!==e.length)return!1;let r=e[0].getSelection();return(t.isLeftAlignedWith(r)||t.isRightAlignedWith(r))&&!t.contains(r)&&!t.isCollapsed()}getCommandState(e,t){const r=e.selection;if(this.isDisabled(r,e,t))return{disabled:!0};let n=this._getAnnotationsForSelection(e),s={disabled:!1,active:!1,mode:null};return this.canCreate(n,r)?s.mode="create":this.canFuse(n,r)?s.mode="fuse":this.canTruncate(n,r)?(s.active=!0,s.mode="truncate"):this.canExpand(n,r)?s.mode="expand":this.canDelete(n,r)?(s.active=!0,s.mode="delete"):s.disabled=!0,s.showInContext=this.showInContext(r,e,t),s}execute(e,t){let r=e.commandState;if(r.disabled)return!1;switch(r.mode){case"create":return this.executeCreate(e,t);case"fuse":return this.executeFuse(e,t);case"truncate":return this.executeTruncate(e,t);case"expand":return this.executeExpand(e,t);case"delete":return this.executeDelete(e,t);default:return console.warn("Command.execute(): unknown mode",r.mode),!1}}executeCreate(e,t){const r=e.editorSession,n=this._getAnnotationsForSelection(e,t);this._checkPrecondition(e,n,this.canCreate);let s,i=this.getAnnotationData();return i.type=this.getAnnotationType(),r.transaction(e=>{s=e.annotate(i)}),{mode:"create",anno:s}}executeFuse(e){let t=this._getAnnotationsForSelection(e);return this._checkPrecondition(e,t,this.canFuse),this._applyTransform(e,e=>{to.fuseAnnotation(e,t)}),{mode:"fuse",anno:t[0]}}executeTruncate(e){let t=this._getAnnotationsForSelection(e),r=t[0];return this._checkPrecondition(e,t,this.canTruncate),this._applyTransform(e,t=>{to.truncateAnnotation(t,r,e.selection)}),{mode:"truncate",anno:r}}executeExpand(e){let t=this._getAnnotationsForSelection(e),r=t[0];return this._checkPrecondition(e,t,this.canExpand),this._applyTransform(e,t=>{to.expandAnnotation(t,r,e.selection)}),{mode:"expand",anno:r}}executeDelete(e){let t=this._getAnnotationsForSelection(e),r=t[0];return this._checkPrecondition(e,t,this.canDelete),this._applyTransform(e,e=>e.delete(r.id)),{mode:"delete",annoId:r.id}}isAnnotationCommand(){return!0}_checkPrecondition(e,t,r){let n=e.selection;if(!r.call(this,t,n))throw new Error("AnnotationCommand: can't execute command for selection "+n.toString())}_getAnnotationsForSelection(e){return e.selectionState.annosByType[this.getAnnotationType()]||[]}_applyTransform(e,t){const r=e.editorSession,n=e.selection;if(n.isNull())return;let s;return r.setSelection(n),r.transaction(function(r){let n=t(r,e);n&&(s=n.result)}),s}}class eg extends Gd{didMount(){this.props.node.on("highlighted",this.onHighlightedChanged,this)}dispose(){this.props.node.off(this)}render(e){let t=e(this.getTagName()).attr("data-id",this.props.node.id).addClass(this.getClassNames());return this.props.node.highlighted&&t.addClass("sm-highlighted"),t.append(this.props.children),t}getClassNames(){return"sc-"+this.props.node.type}onHighlightedChanged(){this.props.node.highlighted?this.el.addClass("sm-highlighted"):this.el.removeClass("sm-highlighted")}getTagName(){return"span"}}class tg extends Gd{didMount(){this.context.editorSession.onRender("document",this.rerender,this,{path:[this.props.node.id]})}dispose(){this.context.editorSession.off(this)}render(e){return e(this.getTagName()).attr("data-id",this.props.node.id).addClass(this.getClassNames())}getTagName(){return"div"}getClassNames(){return""}rerender(...e){this.props.node.isDisposed()||super.rerender(...e)}}class rg extends Gd{render(e){let t=e("button").addClass("sc-button");return this.props.icon&&t.append(this.renderIcon(e)),this.props.label&&t.append(this.renderLabel(e)),this.props.dropdown&&t.append(this.renderDropdownIcon(e)),this.props.active&&t.addClass("sm-active"),this.props.theme&&t.addClass("sm-theme-"+this.props.theme),this.props.disabled?t.attr("tabindex",-1).attr("disabled",!0):t.attr("tabindex",1),t.append(this.props.children),t}renderIcon(e){return this.context.iconProvider.renderIcon(e,this.props.icon)}renderDropdownIcon(e){let t=this.context.iconProvider.renderIcon(e,"dropdown");return t.addClass("se-dropdown"),t}renderLabel(e){return e("span").addClass("se-label").append(this.getLabel(this.props.label))}getLabel(e){return this.context.labelProvider.getLabel(e,this.props.commandState)}}class ng extends Yf{constructor(e,t){super(e),this.editorSession=t}_copy(){let e=this.getEditorSession(),t=e.getSelection(),r=e.getDocument(),n=null,s="",i="",o=this._getExporter();return t.isCollapsed()||(s=uo(r,t)||"",n=tf(r,t),i=o.exportDocument(n)),{doc:n,html:i,text:s}}_cut(){this.getEditorSession().transaction(e=>{e.deleteSelection()})}_pastePlainText(e){this.getEditorSession().transaction(t=>{t.paste(e)},{action:"paste"})}_pasteHtml(e,t){let r=this._getImporter().importDocument(e)||t;if(r){this.getEditorSession().transaction(e=>{e.paste(r)},{action:"paste"})}return!0}getEditorSession(){return this.editorSession}}function sg(e,t){return!!S(e)&&(e.startsWith?e.startsWith(t):(S(t)||(t=String(t)),e.slice(0,t.length)===t))}class ig extends Gd{render(e){return e("pre").addClass("content-node unsupported").attr({"data-id":this.props.node.id,contentEditable:!1}).append(JSON.stringify(this.props.node.toJSON(),null,2))}}const og=y.isFF?1:0;class ag extends Gd{constructor(...e){super(...e),this._initialize()}_initialize(){if(!this.getEditorSession())throw new Error("editorSession is mandatory");if(this.name=this.props.name,!this.name)throw new Error("Surface must have a name.");if(this.name.indexOf("/")>-1)throw new Error("Surface.name must not contain '/'");this._surfaceId=ag.createSurfaceId(this),this.clipboard=this.context.clipboard||this._initializeClipboard(),this.domSelection=this.context.domSelection||this._initializeDOMSelection(),this._state={skipNextFocusEvent:!1}}_initializeClipboard(){return new ng(this.getConfigurator(),this.getEditorSession())}_initializeDOMSelection(){return new gu(this)}getChildContext(){return{surface:this,parentSurfaceId:this.getId(),doc:this.getDocument(),isolatedNodeComponent:null}}didMount(){this.getEditorSession().onRender("selection",this._onSelectionChanged,this);const e=this.getSurfaceManager();e&&e.registerSurface(this);const t=this.getGlobalEventHandler();t&&t.addEventListener("keydown",this._muteNativeHandlers,this)}dispose(){this.getEditorSession().off(this);const e=this.getSurfaceManager();e&&e.unregisterSurface(this);const t=this.getGlobalEventHandler();t&&t.removeEventListener("keydown",this._muteNativeHandlers)}didUpdate(){this._updateContentEditableState()}render(e){let t=e(this.props.tagName||"div").addClass(this._getClassNames()).attr("tabindex",2).attr("data-surface-id",this.id);return this.isDisabled()||(this.isEditable()&&(t.on("keydown",this.onKeyDown),y.isIE||(t.on("compositionstart",this.onCompositionStart),t.on("compositionend",this.onCompositionEnd)),y.inBrowser&&window.TextEvent&&!y.isIE?t.on("textInput",this.onTextInput):t.on("keypress",this.onTextInputShim),t.on("paste",this._onPaste),t.on("cut",this._onCut)),this.isReadonly()||(t.on("mousedown",this.onMouseDown),t.on("contextmenu",this.onContextMenu),t.on("focus",this.onNativeFocus),t.on("blur",this.onNativeBlur)),t.on("copy",this._onCopy)),t}_getClassNames(){return`sc-surface sm-${this.name}`}getName(){return this.name}getId(){return this._surfaceId}getSurfaceId(){return this._surfaceId}isDisabled(){return this.props.disabled}isEditable(){return"full"===this.props.editing||void 0===this.props.editing}isSelectable(){return"selection"===this.props.editing||"full"===this.props.editing}isReadonly(){return"readonly"===this.props.editing}getElement(){return this.el}getDocument(){return this.getEditorSession().getDocument()}getComponentRegistry(){return this.context.componentRegistry}getConfigurator(){return this.context.configurator}getEditorSession(){return this.context.editorSession}getSurfaceManager(){return this.context.surfaceManager}getGlobalEventHandler(){return this.context.globalEventHandler}getKeyboardManager(){return this.context.keyboardManager}isEnabled(){return!this.state.disabled}isContainerEditor(){return!1}isCustomEditor(){return!1}hasNativeSpellcheck(){return"native"===this.props.spellcheck}getContainerPath(){return null}focus(){this.getEditorSession().getSelection().surfaceId!==this.getId()&&this.selectFirst()}blur(){const e=this.getEditorSession();e.getSelection().surfaceId===this.getId()&&e.setSelection(null)}selectFirst(){throw new Error("This method is abstract.")}rerenderDOMSelection(){if(!this.isDisabled()&&y.inBrowser){let e=this.getEditorSession().getSelection();if(e.surfaceId===this.getId()){this.domSelection.setSelection(e);const t=this.context.scrollPane;t&&t.onSelectionPositioned&&(console.error("DEPRECATED: you should manage the scrollPane yourself"),t.onSelectionPositioned())}}}getDomNodeForId(e){return this.el.getNativeElement().querySelector('*[data-id="'+e+'"]')}onKeyDown(e){if(!this._shouldConsumeEvent(e))return;if("Dead"===e.key)return;if(!this.getKeyboardManager().onKeydown(e))switch(e.keyCode){case lu.LEFT:case lu.RIGHT:return this._handleLeftOrRightArrowKey(e);case lu.UP:case lu.DOWN:return this._handleUpOrDownArrowKey(e);case lu.HOME:case lu.END:return this._handleHomeOrEndKey(e);case lu.PAGEUP:case lu.PAGEDOWN:return this._handlePageUpOrDownKey(e);case lu.ENTER:return this._handleEnterKey(e);case lu.TAB:return this._handleTabKey(e);case lu.BACKSPACE:case lu.DELETE:return this._handleDeleteKey(e);case lu.ESCAPE:return this._handleEscapeKey(e);case lu.SPACE:return this._handleSpaceKey(e)}}onTextInput(e){if(!this._shouldConsumeEvent(e))return;if(e.preventDefault(),e.stopPropagation(),!e.data)return;let t=e.data;const r=this.getKeyboardManager();if(!r||!r.onTextInput(t)){this.getEditorSession().transaction(e=>{e.insertText(t)},{action:"type"})}}onCompositionStart(e){if(this._shouldConsumeEvent(e)&&e.data){const t=this.getEditorSession();let r=e.data.length,n=t.getSelection();if(n.isPropertySelection()&&n.isCollapsed()){let e=n.start.offset;t.setSelection(n.createWithNewRange(e-r,e))}}}onCompositionEnd(e){if(this._shouldConsumeEvent(e)&&y.isFF){if(e.preventDefault(),e.stopPropagation(),!e.data)return;this._delayed(()=>{let t=e.data;const r=this.getKeyboardManager();if(!r||!r.onTextInput(t)){this.getEditorSession().transaction(e=>{e.insertText(t)},{action:"type"})}})}}onTextInputShim(e){if(!this._shouldConsumeEvent(e))return;if(0===e.which||0===e.charCode||e.keyCode===lu.TAB||e.keyCode===lu.ESCAPE||Boolean(e.metaKey)||Boolean(e.ctrlKey)^Boolean(e.altKey))return;let t=String.fromCharCode(e.which);e.shiftKey||(t=t.toLowerCase()),e.preventDefault(),e.stopPropagation();const r=this.getKeyboardManager();r&&r.onTextInput(t)||t.length>0&&this.getEditorSession().transaction(e=>{e.insertText(t)},{action:"type"})}onMouseDown(e){if(!this._shouldConsumeEvent(e))return!1;if(!e.__reserved__&&(e.__reserved__=this,this.isEditable()&&this.el.setAttribute("contenteditable",!0),0===e.button)){if(!(y.isIE&&y.version<12)&&e.detail>=3){let t=this.getEditorSession().getSelection();if(t.isPropertySelection())return this._selectProperty(t.path),e.preventDefault(),void e.stopPropagation();if(t.isContainerSelection())return this._selectProperty(t.startPath),e.preventDefault(),void e.stopPropagation()}if(this._state.skipNextFocusEvent=!0,y.inBrowser){Xh.wrapNativeElement(window.document).on("mouseup",this.onMouseUp,this,{once:!0})}}}onMouseUp(e){e.stopPropagation(),this._delayed(()=>{let e=this.domSelection.getSelection();this._setSelection(e)})}onContextMenu(e){if(!this._shouldConsumeEvent(e))return;let t=this.domSelection.getSelection();this._setSelection(t)}onNativeBlur(){this._state.hasNativeFocus=!1}onNativeFocus(){this._state.hasNativeFocus=!0}_onCopy(e){this.clipboard.onCopy(e)}_onCut(e){this.clipboard.onCut(e)}_onPaste(e){this.clipboard.onPaste(e)}_onSelectionChanged(e){let t=this._deriveModeFromSelection(e);this.state.mode!==t&&this.extendState({mode:t})}_deriveModeFromSelection(e){if(!e)return null;let t,r=e.surfaceId,n=this.getId();return sg(r,n)&&(t=r.length===n.length?"focused":"co-focused"),t}_updateContentEditableState(){let e=this.isEditable()&&!this.props.disabled;e&&"co-focused"===this.state.mode&&(e=function(e,t){if(t){let r=e.getSelection(),n=t.getSurface(r.surfaceId);if(n){let e=n.context.isolatedNodeComponent;if(e)return e.isOpen()}}}(this.getEditorSession(),this.getSurfaceManager())),e?this.el.setAttribute("contenteditable",!0):this.el.removeAttribute("contenteditable")}_blur(){this.el&&this.el.blur()}_focus(){this.isDisabled()||(y.isFF&&(this.domSelection.clear(),this.el.getNativeElement().blur()),this._focusElement())}_focusElement(){this._state.hasNativeFocus=!0,this.el&&!y.isWebkit&&(this._state.skipNextFocusEvent=!0,this.el.focus({preventScroll:!0}),this._state.skipNextFocusEvent=!1)}_handleLeftOrRightArrowKey(e){e.stopPropagation();let t=e.keyCode===lu.LEFT?"left":"right";this._delayed(()=>{this._updateModelSelection({direction:t})})}_handleUpOrDownArrowKey(e){e.stopPropagation(),this._delayed(()=>{let t={direction:e.keyCode===lu.UP?"left":"right"};this._updateModelSelection(t)})}_handleHomeOrEndKey(e){e.stopPropagation(),this._delayed(()=>{let t={direction:e.keyCode===lu.HOME?"left":"right"};this._updateModelSelection(t)})}_handlePageUpOrDownKey(e){e.stopPropagation(),this._delayed(()=>{let t={direction:e.keyCode===lu.PAGEUP?"left":"right"};this._updateModelSelection(t)})}_handleSpaceKey(e){e.stopPropagation(),e.preventDefault();const t=this.getKeyboardManager();if(!t||!t.onTextInput(" ")){this.getEditorSession().transaction(e=>{e.insertText(" ")},{action:"type"})}}_handleTabKey(e){e.stopPropagation(),this.el.emit("tab",{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,code:e.code}),!1===this.props.handleTab?e.preventDefault():this.__handleTab(e)}__handleTab(){this._delayed(()=>{this._updateModelSelection()})}_handleEnterKey(e){e.preventDefault(),e.stopPropagation(),this.getEditorSession().transaction(e=>{e.break()},{action:"break"})}_handleEscapeKey(){}_handleDeleteKey(e){e.preventDefault(),e.stopPropagation();let t=e.keyCode===lu.BACKSPACE?"left":"right";this.getEditorSession().transaction(e=>{e.deleteCharacter(t)},{action:"delete"})}_hasNativeFocus(){return Boolean(this._state.hasNativeFocus)}_setSelection(e){!e.isNull()&&e.surfaceId===this.id&&y.isFF&&this._focusElement(),this.getEditorSession().setSelection(e)}_updateModelSelection(e){let t=this.domSelection.getSelection(e);this._setSelection(t)}_selectProperty(e){let t=this.getDocument(),r=t.get(e);this._setSelection(t.createSelection({type:"property",path:e,startOffset:0,endOffset:r.length}))}_renderNode(e,t){let r=this.getDocument().get(t),n=this.getComponent(r.type,!0);return n||(console.error("Could not resolve a component for type: "+r.type),n=ig),e(n,this._getNodeProps(r))}_getNodeProps(e){return{node:e,placeholder:this.props.placeholder,disabled:this.props.disabled}}_shouldConsumeEvent(e){let t=Gd.unwrap(e.target);return t&&(t===this||t.context.surface===this)}getSelectionFromEvent(e){let t=Gu(e),r=this.domSelection.getSelectionForDOMRange(t);return r.surfaceId=this.getId(),r}setSelectionFromEvent(e){let t=this.getSelectionFromEvent(e);t?(this._state.skipNextFocusEvent=!0,this._setSelection(t)):console.error("Could not create a selection from event.")}get id(){return this._surfaceId}_delayed(e){y.inBrowser&&window.setTimeout(e,og)}_muteNativeHandlers(e){let t;t=y.isMac?["META+66","META+73","META+85"]:["CTRL+66","CTRL+73","CTRL+85"];const r=ip(e);t.indexOf(r)>-1&&e.preventDefault()}}ag.prototype._isSurface=!0,ag.createSurfaceId=function(e){let t=e.context.parentSurfaceId;return t?t+"/"+e.name:e.name};class lg extends ag{constructor(e,t,r){t.containerPath=t.containerPath||t.node.getContentPath(),t.name=t.name||t.containerPath.join(".")||t.node.id,super(e,t,r)}_initialize(){if(super._initialize(),this.containerPath=this.props.containerPath,!m(this.containerPath))throw new Error("Property 'containerPath' is mandatory.");this._deriveInternalState(this.props)}shouldRerender(e){return e.disabled!==this.props.disabled}willReceiveProps(e){super.willReceiveProps.apply(this,arguments),this._deriveInternalState(e)}didMount(){super.didMount.apply(this,arguments),this.getEditorSession().onUpdate("document",this._onContainerChanged,this,{path:this.getContainerPath()})}dispose(){super.dispose.apply(this,arguments),this.getEditorSession().off(this)}render(e){let t=super.render(e),r=this.getDocument(),n=this.getContainerPath();t.attr("data-id",n.join(".")),t.attr("spellcheck","native"===this.props.spellcheck);let s=r.get(n);return t.append(s.map((t,n)=>this._renderNode(e,r.get(t),n))),this.props.disabled||this.isEmpty()||(t.addClass("sm-enabled"),t.setAttribute("contenteditable",!0)),t}_getClassNames(){return"sc-container-editor sc-surface"}selectFirst(){let e=this.getDocument(),t=this.getContainerPath(),r=e.get();if(r.length>0){$i(this.getEditorSession(),e.get(r[0]),t,"before")}}_renderNode(e,t,r){if(!t)throw new Error("Illegal argument");return e(this._getNodeComponentClass(t),this._getNodeProps(t)).ref(t.id)}_getNodeComponentClass(e){let t=this.getComponent(e.type);return e.isText()||t.prototype._isCustomNodeComponent||t.prototype._isIsolatedNodeComponent?t:this.getComponent("isolated-node")}_deriveInternalState(e){let t=this._state;!e.hasOwnProperty("enabled")||e.enabled?t.enabled=!0:t.enabled=!1}_selectNextIsolatedNode(e){let t=this.getEditorSession().getSelectionState(),r="left"===e?t.previousNode:t.nextNode,n=!r.isText()&&!r.isList();return!(!r||!n)&&(!!("left"===e&&t.isFirst||"right"===e&&t.isLast)&&(this.getEditorSession().setSelection({type:"node",nodeId:r.id,containerPath:this.getContainerPath(),surfaceId:this.id}),!0))}_handleLeftOrRightArrowKey(e){e.stopPropagation();const t=this.getDocument(),r=this.getEditorSession().getSelection(),n=e.keyCode===lu.LEFT,s=!n,i=n?"left":"right";if(r&&!r.isNull()){let o=r.containerPath;if(r.isNodeSelection()){let i=t.get(o),a=zi(t,o,r.getNodeId());if(n&&0===a||s&&a===i.length-1)return void e.preventDefault()}r.isNodeSelection()&&!e.shiftKey&&this.domSelection.collapse(i)}this._delayed(()=>{this._updateModelSelection({direction:i})})}_handleUpOrDownArrowKey(e){e.stopPropagation();const t=this.getDocument(),r=this.getEditorSession().getSelection(),n=e.keyCode===lu.UP,s=!n,i=n?"left":"right";if(r&&!r.isNull()){let i=r.containerPath;if(r.isNodeSelection()){let o=t.get(i),a=zi(t,i,r.getNodeId());if(n&&0===a||s&&a===o.length-1)return void e.preventDefault();let l=this.getEditorSession();if(!e.shiftKey){if(e.preventDefault(),n){return void $i(l,t.get(o[a-1]),i,"after")}return void $i(l,t.get(o[a+1]),i,"before")}}}this._delayed(()=>{this._updateModelSelection({direction:i})})}_handleTabKey(e){const t=this.getEditorSession(),r=t.getSelection();if(r.isNodeSelection()&&r.isFull()){const n=this.refs[r.getNodeId()];if(n&&Yi(t,n))return e.preventDefault(),void e.stopPropagation()}super._handleTabKey(e)}__handleTab(e){e.preventDefault(),e.shiftKey?this.getEditorSession().transaction(e=>{e.dedent()},{action:"dedent"}):this.getEditorSession().transaction(e=>{e.indent()},{action:"indent"})}isContainerEditor(){return!0}getContainerPath(){return this.containerPath}isEmpty(){let e=this.getDocument().get(this.containerPath);return!e||0===e.length}isEditable(){return super.isEditable.call(this)&&!this.isEmpty()}_onContainerChanged(e){let t=this.getDocument(),r=ad.createContext(this).$$,n=this.getContainerPath();for(let s=0;s<e.ops.length;s++){let i=e.ops[s];if(Oi(i.path,n))if("update"===i.type){let e=i.diff;if("insert"===e.type){let n,s=e.getValue(),i=t.get(s);n=i?this._renderNode(r,i):r("div"),this.insertAt(e.getOffset(),n)}else"delete"===e.type&&this.removeAt(e.getOffset())}else this.empty(),this.rerender()}}get _isContainerEditor(){return!0}}class cg extends Zf{constructor(...e){if(super(...e),!this.config.nodeType)throw new Error("Every AnnotationCommand must have a nodeType")}getCommandState(e,t){let r=e.selection,n={disabled:!0,active:!1},s=this._getAnnotationsForSelection(e);if(s.length>0)for(let e of s)if(e.getSelection().equals(r)){n.disabled=!1,n.nodeId=e.id;break}return n}execute(e,t){}_getAnnotationsForSelection(e){return e.selectionState.annosByType[this.config.nodeType]||[]}}class hg extends cg{getCommandState(e,t){let r=e.selection,n=this._getAnnotationsForSelection(e),s={disabled:!0};return 1===n.length&&r.isPropertySelection()&&r.isCollapsed()&&(s.disabled=!1,s.showInContext=!0,s.nodeId=n[0].id),s}}class dg extends Zf{constructor(e){super(e),this.config.nodeType||console.error("'config.nodeType' should be provided for InsertNodeCommand")}getType(){return this.config.nodeType}getCommandState(e,t){let r=e.selection,n={disabled:!0,active:!1};return r&&!r.isNull()&&!r.isCustomSelection()&&r.containerPath&&(n.disabled=!1),n.showInContext=this.showInContext(r,e,t),n}showInContext(e,t,r){let n=t.editorSession.getSelectionState();return e.isCollapsed()&&n.isFirst&&n.isLast}isInsertCommand(){return!0}execute(e,t){if(e.commandState.disabled)return;e.editorSession.transaction(r=>{let n=this.createNodeData(r,e,t),s=r.insertBlockNode(n);this.setSelection(r,s)})}createNodeData(e,t,r){const n=t.type;if(!n)throw new Error("'type' is mandatory");const s=t.editorSession.getDocument().getSchema().getNodeSchema(n);let i={type:n};for(let e of s)i[e.name]=t[e.name];return i}setSelection(e,t){t.isText()&&(e.selection={type:"property",path:t.getPath(),startOffset:0})}}class ug extends cu{render(e){const t=this.props.node,r=this.ContentClass,n=this.state;let s=e("span");s.addClass(this.getClassNames()).addClass("sc-inline-node").addClass("sm-"+t.type).attr("data-id",t.id).attr("data-inline","1");let i=this.isDisabled();return n.mode?s.addClass("sm-"+n.mode):s.addClass("sm-not-selected"),r.noStyle||s.addClass("sm-default-style"),s.on("keydown",this.onKeydown),s.append(this.renderContent(e,t).ref("content").addClass("se-content")),i&&s.addClass("sm-disabled").attr("contenteditable",!1).on("click",this.onClick),t.shouldBeDraggable&&s.attr("draggable",!0),s}isDisabled(){return!this.state.mode||["co-selected","cursor"].indexOf(this.state.mode)>-1}getClassNames(){return""}onClick(e){this._shouldConsumeEvent(e)&&(e.stopPropagation(),e.preventDefault(),this.selectNode())}selectNode(){const e=this.getEditorSession(),t=this.props.node;let r={type:"property",path:t.start.path,startOffset:t.start.offset,endOffset:t.end.offset};const n=this.getParentSurface();n&&Object.assign(r,{containerPath:n.getContainerPath(),surfaceId:n.id}),e.setSelection(r)}_getContentClass(){const e=this.props.node;let t;return(t=this.getComponent(e.type,!0))||(t=this.getComponent("unsupported-inline-node",!0)),t||(console.error(`No component registered for inline node '${e.type}'.`),t=pg),t}_deriveStateFromSelectionState(e,t){const r=this._getSurfaceForSelection(e,t),n=this.getParentSurface();if(!r)return null;if(r===n){const t=this.props.node;if(e.isPropertySelection()&&!e.isCollapsed()&&E(e.start.path,t.start.path)){const r=t.getSelection();if(r.equals(e))return{mode:"selected"};if(e.contains(r))return{mode:"co-selected"}}}let s=r.context.isolatedNodeComponent;return s?s===this?{mode:"focused"}:this._getIsolatedNodes(e,t).indexOf(this)>-1?{mode:"co-focused"}:null:null}get _isInlineNodeComponent(){return!0}}class pg extends Gd{render(e){const t=this.props.node;return e("span").text("???").attr("data-id",t.id).attr("data-type",t.type)}}class fg extends l{constructor(...e){super(...e),this.__isStarted__=!1}start(){Xh.getBrowserWindow().on("hashchange",this._onHashChange,this),this.__isStarted__=!0}readRoute(){return this.__isStarted__||this.start(),this.parseRoute(this.getRouteString())}writeRoute(e,t){t=t||{};let r=this.stringifyRoute(e);r?this._writeRoute(r,t):this.clearRoute(t)}dispose(){Xh.getBrowserWindow().off(this)}parseRoute(e){return fg.routeStringToObject(e)}stringifyRoute(e){return fg.objectToRouteString(e)}getRouteString(){return Xh.getBrowserWindow().getNativeElement().location.hash.slice(1)}_writeRoute(e,t){let r=Xh.getBrowserWindow().getNativeElement();this.__isSaving__=!0;try{t.replace?r.history.replaceState({},"",`#${e}`):r.history.pushState({},"",`#${e}`)}finally{this.__isSaving__=!1}}clearRoute(e){this._writeRoute("",e)}_onHashChange(){if(!this.__isSaving__)if(this.__isLoading__)console.error("FIXME: router is currently applying a route.");else{this.__isLoading__=!0;try{let e=this.getRouteString(),t=this.parseRoute(e);this.emit("route:changed",t)}finally{this.__isLoading__=!1}}}static objectToRouteString(e){return g(e,(e,t)=>`${t}=${e}`).join(",")}static routeStringToObject(e){let t={};if(!e)return t;let r=e.split(",");for(let e of r)if(e.indexOf("=")>=0){let r=e.split("=");if(2!==r.length)throw new Error("Illegal route.");t[r[0].trim()]=r[1].trim()}else t[e]=!0;return t}}class gg extends Zf{constructor(e){if(super(e),!e.spec)throw new Error("'config.spec' is mandatory");if(!e.spec.type)throw new Error("'config.spec.type' is mandatory")}getType(){return this.config.spec.type}getCommandState(e){const t=e.editorSession,r=t.getDocument(),n=e.selection,s=t.isBlurred();let i={disabled:!1};if(n.isPropertySelection()&&!s){let e=n.getPath(),t=r.get(e[0]);t&&t.isText()&&t.isBlock()?(i.active=Hn(t,this.config.spec),i.showInContext=0===n.start.offset&&0===n.end.offset):i.disabled=!0}else i.disabled=!0;return i}execute(e){e.editorSession.transaction(e=>e.switchTextType(this.config.spec))}isSwitchTypeCommand(){return!0}}class mg extends tg{render(e){let t=super.render(e);t.addClass("sc-text-block");let r=this.props.node;return r.direction&&t.attr("dir",r.direction),r.textAlign&&t.addClass("sm-align-"+r.textAlign),t.append(e(ou,{placeholder:this.props.placeholder,path:r.getPath(),direction:r.direction})),t}}class _g extends ag{constructor(e,t){if(t.name=t.name||t.path.join("."),super(e,t),!t.path)throw new Error("Property 'path' is mandatory.")}render(e){const t=this.getComponent("text-property");let r=super.render.apply(this,arguments);return this.props.disabled||(r.addClass("sm-enabled"),r.attr("contenteditable",!0),r.attr("spellcheck","native"===this.props.spellcheck)),r.append(e(t,{doc:this.getDocument(),placeholder:this.props.placeholder,tagName:this.props.tagName||"div",path:this.props.path,markers:this.props.markers,withoutBreak:this.props.withoutBreak}).ref("property")),r}_getClassNames(){return"sc-text-property-editor sc-surface"}selectFirst(){this.editorSession.setSelection({type:"property",path:this.getPath(),startOffset:0,surfaceId:this.id})}getPath(){return this.props.path}_handleEnterKey(e){e.stopPropagation(),!1!==this.props.handleEnter&&this.props.multiLine||e.preventDefault(),this.el.emit("enter",{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,code:e.code})}_handleEscapeKey(e){this.el.emit("escape",{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,code:e.code})}get _isTextPropertyEditor(){return!0}}class yg extends Gd{render(e){if(2!==this.props.children.length)throw new Error("SplitPane only works with exactly two child elements");let t=e("div").addClass("sc-split-pane");"horizontal"===this.props.splitType?t.addClass("sm-horizontal"):t.addClass("sm-vertical");let r=this.props.children[0],n=this.props.children[1];return this.props.sizeB?(n.addClass("se-pane sm-sized"),n.css(this.getSizedStyle(this.props.sizeB)),r.addClass("se-pane sm-auto-fill")):(r.addClass("se-pane sm-sized"),r.css(this.getSizedStyle(this.props.sizeA)),n.addClass("se-pane sm-auto-fill")),t.append(r,n),t}getSizedStyle(e){return e&&"inherit"!==e?"horizontal"===this.props.splitType?{height:e}:{width:e}:{}}}class wg extends Zf{getCommandState(e){return{disabled:!e.editorSession.canUndo(),active:!1}}execute(e){let t=e.editorSession;return t.canUndo()&&t.undo(),!0}}class bg extends Zf{getCommandState(e){return{disabled:!e.editorSession.canRedo(),active:!1}}execute(e){let t=e.editorSession;return!!t.canRedo()&&(t.redo(),!0)}}class vg extends Zf{getCommandState(e){let t=e.editorSession,r=t.isBlurred(),n=e.surface||t.getFocusedSurface(),s=t.getSelection();return{disabled:r||!s||s.isNull()||!n||!(n._isContainerEditor||n._isTextPropertyEditor)}}execute(e){let t=e.editorSession,r=t.getDocument(),n=e.surface||t.getFocusedSurface();if(n){let e;if(n._isContainerEditor){let s=n.getContainerPath(),i=r.get(s);if(0===i.length)return!1;let o=i[0],a=Di(i);e=t.createSelection({type:"container",startPath:[o],startOffset:0,endPath:[a],endOffset:1,containerPath:s,surfaceId:n.id})}else if(n._isTextPropertyEditor){let s=n.getPath(),i=r.get(s);e=t.createSelection({type:"property",path:s,startOffset:0,endOffset:i.length,surfaceId:n.id})}return t.setSelection(e),!0}return!1}}var Cg=Object.freeze({series:function e(t,r,n){t[n=n||0](function(s,...i){if(s)return r(s);n===t.length-1?r(s,...i):e(t,r,n+1)})}});const Sg="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function xg(e){if(!x(e))throw new Error("Illegal argument.");let t="";for(;;){let r=e%Sg.length;if(e=Math.floor(e/Sg.length),t=Sg[r]+t,e>0)e--;else if(0===e)break}return t}function Eg(e){var t=/^([A-Z]+)([1-9][0-9]*)$/.exec(e);return[parseInt(t[2],10)-1,Pg(t[1])]}const Ng="A".charCodeAt(0),Tg=Sg.length;function Pg(e){let t=0,r=0;for(let n=e.length-1;n>=0;n--){let s=e.charCodeAt(n)-Ng;if(s<0||s>=Tg)throw new Error("Illegal column label: "+e);t+=Math.pow(Tg,r)*(s+1),r++}return t-1}var Dg=Object.freeze({ALPHABET:Sg,getColumnLabel:xg,getRowCol:Eg,getColumnIndex:Pg,getCellLabel:function(e,t){return xg(t)+(e+1)},getIndexesFromRange:function(e,t){let r,n,[s,i]=Eg(e);return t?([r,n]=Eg(t),s>r&&([s,r]=[r,s]),i>n&&([i,n]=[n,i])):[r,n]=[s,i],{startRow:s,startCol:i,endRow:r,endCol:n}},getRangeFromMatrix:function(e,t,r,n,s,i){if(!i){if(t===n&&r===s){let n=e[t];return n?n[r]:void 0}if(t===n){let n=e[t];return n?n.slice(r,s+1):[]}if(r===s){let s=[];for(let i=t;i<=n;i++){let t=e[i];t&&s.push(t[r])}return s}}let o=[];for(var a=t;a<n+1;a++){let t=e[a];t&&o.push(t.slice(r,s+1))}return o}});function Ig(e){return e.reduce((e,t)=>(e[t]=!0,e),{})}function Ag(e,t){let r=[];for(let n=0;n<=t.length;n++){if(r[n]=[n],0===n)continue;let s=n-1;for(let i=0;i<=e.length;i++){if(r[0][i]=i,0===i)continue;let o=i-1;r[n][i]=t.charAt(s)===e.charAt(o)?r[s][o]:Math.min(r[s][o]+1,r[n][o]+1,r[s][i]+1)}}return r}function Og(e,t){return m(e)?e.concat(t):null}function kg(e,t){return m(e)?t:null}function Mg(e,t){let r=e.getItems(),n=[t(s(1))];for(let e=0;e<r.length;e++){const i=r[e],o=i.getLevel();if(o<n.length)for(let e=n.length;e>o;e--)n.pop();else if(o>n.length)for(let e=n.length;e<o;e++){let r,i=n[e-1],o=i.getChildCount();0===o?(r=t("li"),i.append(r)):r=i.getChildAt(o-1);let a=t(s(e+1));r.append(a),n.push(a)}console.assert(o===n.length,"item.level should now be the same as stack.length"),Di(n).append(t(i))}for(let e=n.length;e>1;e--)n.pop();return n[0];function s(t){return"order"===e.getListType(t)?"ol":"ul"}}function Lg(e,t){return new Promise(function(n,s){var i=(e.method||"GET").toUpperCase(),o=e.url;if(["GET","POST","PUT","DELETE"].indexOf(i)<0)throw new Error("Parameter 'method' must be 'GET', 'POST', 'PUT', or 'DELETE'.");if(!o)throw new Error("Parameter 'url' is required.");var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState)return function(){if(200===a.status){var e=a.responseText;t&&t(null,e),n(e)}else{console.error(a.statusText);let e=new Error(a.statusText);t&&t(e),s(e)}}()},a.open(i,o,!0),e.header&&r(e.header,function(e,t){a.setRequestHeader(t,e)}),e.data instanceof FormData?a.send(e.data):e.data?a.send(JSON.stringify(e.data)):a.send()})}function Rg(e,t,r){for(let n=0;n<e;n++)t.call(r)}const qg="START",Bg="END",Fg="EPSILON";class jg{constructor(e){e&&0!==Object.keys(e).length||(e={START:{EPSILON:Bg}}),this.transitions=e}consume(e,t){const r=this.transitions;if(!r[e])return-1;let n=r[e][t];if(void 0!==n)return n;for(;void 0!==r[e][Fg];){if((e=r[e][Fg])===Bg)return-1;if(void 0!==(n=r[e][t]))return n}return-1}canConsume(e,t){return-1!==this.consume(e,t)}isFinished(e){const t=this.transitions;if("END"===e)return!0;if(!t[e])return!1;for(;void 0!==t[e][Fg];)if("END"===(e=t[e][Fg]))return!0;return!1}_tokensByPath(){const e=[],t=this.transitions;if(!t)return[];let n={};r(t[qg],(e,t)=>{n[e]||(n[e]=[]),n[e].push(t)});let s={START:!0,END:!0};return r(n,(r,n)=>{let i={};r.forEach(e=>{e!==Fg&&(i[e]=!0)});let o=[n];for(;o.length>0;){let e=o.pop();if(n===Bg)continue;s[e]=!0;let r=t[e];if(!r)throw new Error(`Internal Error: no transition from state ${e}`);let a=Object.keys(r);for(let e=0;e<a.length;e++){const t=a[e],n=r[t];s[n]||o.push(n),t!==Fg&&(i[t]=!0)}}let a=Object.keys(i);a.length>0&&e.push(a)}),e}}jg.START=qg,jg.END=Bg,jg.EPSILON=Fg,jg.TEXT="TEXT";const Hg=jg.START,Ug=jg.END,zg=jg.EPSILON;class Vg{constructor(e){this.transitions=e}addTransition(e,t,r){return this.transitions||(this.transitions={}),m(r)||(r=[r]),r.forEach(r=>Gg(this.transitions,e,t,r)),this}append(e){if(this.transitions&&e.transitions){let t=b(this.transitions),n=b(e.transitions),s=Boolean(t[Hg][zg]),i=Boolean(n[Hg][zg]);s&&delete t[Hg][zg];let o=d();r(t,e=>{r(e,(t,r)=>{t===Ug&&(e[r]=o)})}),s&&r(n[Hg],(e,r)=>{Gg(t,Hg,e,r)}),n[o]=n[Hg],r(n,e=>{r(e,(t,r)=>{t===Hg&&(e[r]=o)})}),delete n[Hg],r(n,(e,n)=>{r(e,(e,r)=>{Gg(t,n,e,r)})}),s&&i&&Gg(t,Hg,Ug,zg),this.transitions=t}else e.transitions&&(this.transitions=b(e.transitions));return this}merge(e){if(this.transitions&&e.transitions){let t=this.transitions;r(e.transitions,(e,n)=>{r(e,(e,r)=>{Gg(t,n,e,r)})})}else e.transitions&&(this.transitions=b(e.transitions));return this}optional(){let e=new Vg(b(this.transitions));return this.transitions&&e.addTransition(Hg,Ug,zg),e}kleene(){return this.plus().optional()}plus(){let e;if(this.transitions){let t=b(this.transitions);const n=Boolean(t[Hg][zg]);delete t[Hg][zg];let s=d();r(t,e=>{r(e,(t,r)=>{t===Ug&&(e[r]=s)})}),Gg(t,s,Ug,zg),r(t[Hg],(e,r)=>{Gg(t,s,e,r)}),n&&Gg(t,Hg,Ug,zg),e=new Vg(t)}else e=new Vg(b(this.transitions));return e}toJSON(){return b(this.transitions)}copy(){let e=b(this.transitions);if(this.transitions){let t=Object.keys(e),n={START:Hg,END:Ug};t.forEach(e=>{e!==Hg&&e!==Ug&&(n[e]=d())}),r(e,(t,s)=>{s!==Hg&&s!==Ug&&(e[n[s]]=t,delete e[s]),r(t,(e,r)=>{e!==Hg&&e!==Ug&&(t[r]=n[e])})})}return new Vg(e)}}function Gg(e,t,r,n){let s=e[t];if(s||(e[t]=s={}),n===zg&&t===Hg&&r!==Ug)throw new Error("The only EPSILON transition from START must be START->END");s[n]&&s[n]!==r?console.error("Token %s already used. Ignoring this transition.",n):s[n]=r}function Jg(e){return Boolean(/^\s*$/.exec(e.textContent))}Vg.singleToken=function(e){let t=new Vg;return t.addTransition(Hg,Ug,e),t};const{START:Kg,END:$g,TEXT:Xg,EPSILON:Wg}=jg;class Yg{constructor(e,t){this.name=e,this.root=t,this._initialize()}_initialize(){this._compile()}toString(){return this.root.toString()}copy(){return this.root.copy()}toJSON(){return{name:this.name,content:this.root.toJSON()}}isAllowed(e){return Boolean(this._allowedChildren[e])}_normalize(){this.root._normalize()}_compile(){this.root._compile()}_describeError(e,t){let r=[];return t!==Xg?this.isAllowed(t)?r.push(`<${t}> is not allowed at the current position in <${this.name}>.\n${this.toString()}`):r.push(`<${t}> is not valid in <${this.name}>\nSchema: ${this.toString()}`):r.push(`TEXT is not allowed at the current position: ${e.trace.join(",")}\n${this.toString()}`),r.join("")}}function Zg(e,t){return t instanceof im?new tm(e,t):new Qg(e,t)}Yg.fromJSON=function(e){return Zg(e.name,cm(e.content))};class Qg extends Yg{getInitialState(){return{dfaState:Kg,errors:[],trace:[]}}canConsume(e,t){return this.dfa.canConsume(e.dfaState,t)}consume(e,t){const r=this.dfa;let n=e.dfaState,s=r.consume(n,t);return e.dfaState=s,-1===s?(e.errors.push({msg:this._describeError(e,t),el:e.el}),!1):(e.trace.push(t),!0)}isFinished(e){return this.dfa.isFinished(e.dfaState)}_initialize(){super._initialize(),this._computeAllowedChildren()}_compile(){super._compile(),this.dfa=new jg(this.root.dfa.transitions)}_computeAllowedChildren(){this._allowedChildren=em(this.dfa)}_findInsertPos(e,t,r){const n=this.root;return n instanceof sm?this._findInsertPosInSequence(e,t,r):n instanceof lm||n instanceof am?"first"===r?0:e.childNodes.length:void 0}_isValid(e){let t=this.getInitialState();for(let r=0;r<e.length;r++){const n=e[r];if(n&&!this.consume(t,n))return!1}return this.isFinished(t)}_findInsertPosInSequence(e,t,r){const n=[];e.getChildNodes().forEach(e=>{const t=e.tagName;t?n.push(t):e._isDOMElement&&e.isTextNode()&&!Jg(e)?n.push(Xg):n.push(null)});const s=n.length,i=this;function o(e){let r=n.slice(0);return r.splice(e,0,t),i._isValid(r)}if("first"===r){for(let e=0;e<=s;e++)if(o(e))return e}else for(let e=s;e>=0;e--)if(o(e))return e;return-1}}function em(e){const t={};return e.transitions&&r(e.transitions,e=>{Object.keys(e).forEach(e=>{e!==Wg&&(t[e]=!0)})}),t}class tm extends Yg{getInitialState(){const e=this.dfas,t=new Array(e.length);return t.fill(Kg),{dfaStates:t,errors:[],trace:[],lastDFA:0}}canConsume(e,t){return this._findNextDFA(e,t)>=0}consume(e,t){const r=this._findNextDFA(e,t);if(r<0)return e.errors.push({msg:this._describeError(e,t)}),!1;{const n=this.dfas[r],s=e.dfaStates[r],i=n.consume(s,t);return e.dfaStates[r]=i,e.trace.push(t),!0}}isFinished(e){const t=this.dfas;for(let r=0;r<t.length;r++){const n=t[r],s=e.dfaStates[r];if(!n.isFinished(s))return!1}return!0}_initialize(){super._initialize(),this._computeAllowedChildren()}_compile(){super._compile(),this.blocks=this.root.blocks,this.dfas=this.blocks.map(e=>new jg(e.dfa.transitions))}_computeAllowedChildren(){this._allowedChildren=Object.assign(...this.blocks.map(e=>em(e.dfa)))}_findNextDFA(e,t){console.assert(e.dfaStates.length===this.dfas.length);const r=this.dfas;for(let n=0;n<e.dfaStates.length;n++){const s=r[n],i=e.dfaStates[n];if(s.canConsume(i,t))return n}return-1}_findInsertPos(e,t,r){return e.childNodes.length}}class rm{constructor(e){this.name=e}toString(){return this.name}toJSON(){return this.name}copy(){return new rm(this.name)}_normalize(){}_compile(){this.dfa=Vg.singleToken(this.name)}}rm.fromJSON=function(e){return new rm(e)};class nm{constructor(e){this.blocks=e}copy(){return new nm(this.blocks.map(e=>e.copy()))}toJSON(){return{type:"|",blocks:this.blocks.map(e=>e.toJSON())}}_normalize(){const e=this.blocks;for(let t=e.length-1;t>=0;t--){let r=e[t];r._normalize(),r instanceof nm&&e.splice(t,1,...r.blocks)}}_compile(){let e=new Vg;return this.blocks.forEach(t=>{if(t instanceof rm)e.addTransition(Kg,$g,t.name);else{if(t instanceof im)throw new Error("Nested interleave blocks are not supported.");t.dfa||t._compile(),e.merge(t.dfa)}}),this.dfa=e,e}toString(){return"("+this.blocks.map(e=>e.toString()).join("|")+")"}}nm.fromJSON=function(e){return new nm(e.blocks.map(e=>cm(e)))};class sm{constructor(e){this.blocks=e}copy(){return new sm(this.blocks.map(e=>e.copy()))}toJSON(){return{type:",",blocks:this.blocks.map(e=>e.toJSON())}}_compile(){let e=new Vg;return this.blocks.forEach(t=>{if(t instanceof rm)e.append(Vg.singleToken(t.name));else{if(t instanceof im)throw new Error("Nested interleave blocks are not supported.");t.dfa||t._compile(),e.append(t.dfa)}}),this.dfa=e,e}_normalize(){const e=this.blocks;for(let t=e.length-1;t>=0;t--){let r=e[t];r._normalize(),r instanceof sm&&e.splice(t,1,...r.blocks)}}toString(){return"("+this.blocks.map(e=>e.toString()).join(",")+")"}}sm.fromJSON=function(e){return new sm(e.blocks.map(e=>cm(e)))};class im{constructor(e){this.blocks=e}copy(){return new im(this.blocks.map(e=>e.copy()))}toString(){return"("+this.blocks.map(e=>e.toString()).join(", ")+")[unordered]"}toJSON(){return{type:"~",blocks:this.blocks.map(e=>e.toJSON())}}_normalize(){}_compile(){this.blocks.forEach(e=>e._compile())}}im.fromJSON=function(e){return new im(e.blocks.map(e=>cm(e)))};class om{constructor(e){this.block=e}copy(){return new om(this.block.copy())}toJSON(){return{type:"?",block:this.block.toJSON()}}_compile(){const e=this.block;if(e instanceof im)throw new Error("Nested interleave blocks are not supported.");return e.dfa||e._compile(),this.dfa=e.dfa.optional(),this.dfa}_normalize(){const e=this.block;e._normalize(),e instanceof om?this.block=e.block:e instanceof am&&console.error("FIXME -  <optional> is useless here",this.toString())}toString(){return this.block.toString()+"?"}}om.fromJSON=function(e){return new om(cm(e.block))};class am{constructor(e){this.block=e}copy(){return new am(this.block.copy())}toJSON(){return{type:"*",block:this.block.toJSON()}}_compile(){const e=this.block;if(e instanceof im)throw new Error("Nested interleave blocks are not supported.");return e.dfa||e._compile(),this.dfa=e.dfa.kleene(),this.dfa}_normalize(){const e=this.block;if(e._normalize(),e instanceof om||e instanceof am)this.block=e.block;else if(e instanceof lm)throw new Error("This does not make sense:"+this.toString())}toString(){return this.block.toString()+"*"}}am.fromJSON=function(e){return new am(cm(e.block))};class lm{constructor(e){this.block=e}copy(){return new lm(this.block.copy())}toJSON(){return{type:"+",block:this.block.toJSON()}}_compile(){const e=this.block;if(e instanceof im)throw new Error("Nested interleave blocks are not supported.");return e.dfa||e._compile(),this.dfa=e.dfa.plus(),this.dfa}_normalize(){const e=this.block;if(e._normalize(),e instanceof om||e instanceof am)throw new Error("This does not make sense:"+this.toString());e instanceof lm&&(this.block=e.block)}toString(){return this.block.toString()+"+"}}function cm(e){switch(e.type){case",":return sm.fromJSON(e);case"~":return im.fromJSON(e);case"|":return nm.fromJSON(e);case"?":return om.fromJSON(e);case"+":return lm.fromJSON(e);case"*":return am.fromJSON(e);default:if(S(e))return new rm(e);throw new Error("Unsupported data.")}}lm.fromJSON=function(e){return new lm(cm(e.block))};const{TEXT:hm}=jg;function dm(e){r(e,e=>{Object.assign(e,{children:{},parents:{},siblings:{},usedInlineBy:{},usedStructuredBy:{}})}),r(e,t=>{!function(e,t){const r=e.expr,n=e.name;if(!r)return;let s=[];r instanceof Qg?r.dfa&&(s=r.dfa._tokensByPath()):r instanceof tm&&r.dfas.forEach(e=>{e&&(s=s.concat(e._tokensByPath()))});0===s.length&&"implicit"===e.type&&(e.type="element");let i=!1,o=!1;s.forEach(r=>{let s=r.indexOf(hm)>=0,a=!s&&r.length>0;s&&(i=!0),a&&(o=!0),r.forEach(i=>{const o=t[i];o&&(o.parents[n]=!0,e.children[i]=!0,e.siblings[n]=r,a&&(o.usedStructuredBy[n]=!0),s&&(o.usedInlineBy[n]=!0))})}),o&&(e.isStructured=!0);i&&(e.isText=!0);"implicit"===e.type&&(e.type=i?"text":"element")}(t,e)})}function um(e){const t=[];return ym(e)&&t.push(`[1]: text element <${e.name}> is used inline by ${wm(e).join(",")}`),e.isText||t.push(`[4]: text element <${e.name}> does not allow text content`),e.isStructured&&t.push(`[5]: text element <${e.name}> must not allow structured content`),t}function pm(e){const t=[];return ym(e)&&t.push(`[2]: element <${e.name}> is used inline by ${wm(e).join(",")}`),e.isText&&t.push(`[6]: element <${e.name}> must not allow text content`),t}function fm(e){const t=[];return bm(e)&&t.push(`[2.2]: hybrid element <${e.name}> is used inline by ${wm(e).join(",")}`),e.isText&&e.isStructured||t.push(`[7]: hybrid element <${e.name}> must allow text and structured content`),t}function gm(e){const t=[];return bm(e)||t.push(`[3]: annotation <${e.name}> is used in structured content by ${vm(e).join(",")}`),e.isText||t.push(`[8]: annotation <${e.name}> does not allow text content`),t}function mm(e){const t=[];return bm(e)||t.push(`[3]: inline-element <${e.name}> is used in structured content by ${vm(e).join(",")}`),t}function _m(e){const t=[];return bm(e)||t.push(`[3]: anchor <${e.name}> is used in structured content by ${vm(e).join(",")}`),t}function ym(e){let t=e.usedInlineBy||{};return Object.keys(t).length>0}function wm(e){let t=e.usedInlineBy||{};return Object.keys(t)}function bm(e){return 0===vm(e).length}function vm(e){let t=e.usedInlineBy||{};return Object.keys(e.parents).filter(e=>!t[e])}function Cm(e){const t=e.indexOf(":");return t>0?e.slice(t+1):e}const{TEXT:Sm}=jg;class xm{constructor(e,t){if(!e[t])throw new Error("startElement must be a valid element.");this._elementSchemas={},this.startElement=t,r(e,(e,t)=>{this._elementSchemas[t]=new Em(e.name,e.type,e.attributes,e.expr)})}getIdAttribute(){return"id"}getTagNames(){return Object.keys(this._elementSchemas)}getElementSchema(e){return this._elementSchemas[e]}getStartElement(){return this.startElement}toJSON(){let e={start:this.getStartElement(),elements:{}};return r(this._elementSchemas,(t,r)=>{e.elements[r]=t.toJSON()}),e}toMD(){let e=[],t=Object.keys(this._elementSchemas);return t.sort(),t.forEach(t=>{let r=this._elementSchemas[t];e.push(`# <${r.name}>`),e.push(""),e.push(`type: ${r.type}`),e.push("attributes: "+g(r.attributes,(e,t)=>t).join(", ")),e.push("children:"),e.push("  "+r.expr.toString()),e.push("")}),e.join("\n")}validateElement(e){let t=e.tagName;return function(e,t){let r=[],n=!0;{const e={ok:!0};e.ok||(r=r.concat(e.errors),n=!1)}if("external"===e.type||"not-implemented"===e.type);else{let s;(s=t._isXMLTextElement?Nm(e,t.toXML()):Nm(e,t)).ok||(r=r.concat(s.errors),n=!1)}return{errors:r,ok:n}}(this.getElementSchema(t),e)}}xm.fromJSON=function(e){let t={};return r(e.elements,e=>{let r=Em.fromJSON(e);t[r.name]=r}),new xm(t,e.start)};class Em{constructor(e,t,r,n){if(this.name=e,this.type=t,this.attributes=r,this.expr=n,!e)throw new Error("'name' is mandatory");if(!t)throw new Error("'type' is mandatory");if(!r)throw new Error("'attributes' is mandatory");if(!n)throw new Error("'expr' is mandatory")}toJSON(){return{name:this.name,type:this.type,attributes:this.attributes,elements:this.expr.toJSON()}}isAllowed(e){return this.expr.isAllowed(e)}isTextAllowed(){return this.expr.isAllowed(Sm)}printStructure(){return`${this.name} ::= ${this.expr.toString()}`}findFirstValidPos(e,t){return this.expr._findInsertPos(e,t,"first")}findLastValidPos(e,t){return this.expr._findInsertPos(e,t,"last")}}function Nm(e,t){if("external"===e.type||"not-implemented"===e.type)return!0;const r="text"===e.type,n=e.expr,s=n.getInitialState(),i=t.getChildNodeIterator();let o=!0;for(;o&&i.hasNext();){const e=i.next();let t;if(e.isTextNode()){if(Jg(e))continue;t=Sm}else if(e.isElementNode())t=e.tagName;else{if("cdata"!==e.getNodeType())continue;t=Sm}n.consume(s,t)||(o=!1)}s.errors.length>0&&s.errors.forEach(e=>{e.el=t});const a=n.isFinished(s);return!o||a||r||(s.errors.push({msg:`<${t.tagName}> is incomplete.\nSchema: ${n.toString()}`,el:t}),o=!1),o&&(s.ok=!0),s}function Tm(e,t,r){for(let n=0;n<t.length;n++){let s=t[n]+"/"+r;if(e.existsSync(s))return s}}function Pm(e,t,r){let n=r.findAll("include");return 0!==n.length&&(n.forEach(r=>{const n=r.parentNode,s=r.attr("href"),i=Tm(e,t,s);if(!i)throw new Error(`Could not find ${s}`);const o=e.readFileSync(i,"utf8"),a=Xh.parseXML(o,"full-doc").find("grammar");if(!a)throw new Error("No grammar element found");a.children.forEach(e=>{n.insertBefore(e,r)}),r.remove()}),!0)}function Dm(e,t,r){m(t)||(t=[t]);let n=Tm(e,t,r),s=e.readFileSync(n,"utf8");const i=Xh.parseXML(s,"full-doc");for(;Pm(e,t,i););return i}Em.fromJSON=function(e){return new Em(e.name,e.type,e.attributes,Yg.fromJSON(e.elements))};const Im=jg.TEXT;function Am(e,t,r,n={}){switch(t.tagName){case"element":return[e.createElement("element").attr("name",t.attr("name"))];case"ref":return function(e,t,r,n={}){const s=t.attr("name");if(n[s])throw new Error("Cyclic references are not supported.");n[s]=!0;const i=r[s];if(!i)throw new Error(`Unknown definition ${s}`);let o=[];return i.children.forEach(t=>{let s=Am(e,t,r,n);o=o.concat(s)}),delete n[s],o}(e,t,r,n);case"empty":case"notAllowed":return[];default:{let s=t.clone(!1);return t.children.forEach(t=>{s.append(Am(e,t,r,n))}),[s]}}}function Om(e,t){if(!e)return new sm([]);let r=km(e.children,t);return 1===r.length?r[0]:new sm(r)}function km(e,t){const r=[];for(var n=0;n<e.length;n++){const s=e[n];switch(s.tagName){case"attribute":case"empty":case"notAllowed":break;case"element":{const e=s.attr("name");r.push(new rm(e));break}case"text":r.push(new rm(Im));break;case"ref":{const e=Rm(s,t);r.push(e);break}case"group":r.push(Mm(s,t));break;case"choice":{const e=Lm(s,t);r.push(e);break}case"optional":{const e=new om(Om(s,t));r.push(e);break}case"oneOrMore":{const e=new lm(Om(s,t));r.push(e);break}case"zeroOrMore":{const e=new am(Om(s,t));r.push(e);break}case"interleave":{const e=new im(km(s.children,t));r.push(e);break}default:throw new Error("Not supported yet: "+s.tagName)}}return r}function Mm(e,t){if(e.expr)return e.expr.copy();const r=km(e.children,t);return e.expr=new sm(r),e.expr}function Lm(e,t){if(e.expr)return e.expr.copy();let r=km(e.children,t);return e.expr=new nm(r),e.expr}function Rm(e,t){const r=e.attr("name"),n=t.defs[r];if(!n)throw new Error(`Illegal ref: ${r} is not defined.`);if(n.expr)return n.expr.copy();if(t._visiting[r])throw new Error("Cyclic references are not supported yet");t._visiting[r]=!0;const s=Om(n,t);return n.expr=s,delete t._visiting[r],n.expr}function qm(e){return{name:e.attr("name")}}const Bm=new class extends Xa.DomUtils{isTag(){return!0}getChildren(e){return e.getChildren?e.getChildren():[]}getAttributeValue(e,t){if(e.getAttribute)return e.getAttribute(t)}getAttributes(e){return e.hasOwnProperty("attributes")?["id",e.id].concat(g(e.attributes,(e,t)=>[t,e])):["id",e.id]}hasAttrib(e,t){return"id"===t||!!e.hasOwnProperty("attributes")&&e.attributes.hasOwnProperty(t)}getName(e){return e.type}getNameWithoutNS(e){return Cm(this.getName(e))}getText(e){return"text"===e._elementType?e.getText():""}};function Fm(e,t){return zm(e,e._childNodes.length,t),e}function jm(e,t){return e._childNodes.indexOf(t.id)}function Hm(e,t){const r=jm(e,t);if(!(r>=0))throw new Error(`Node ${t.id} is not a child of ${e.id}`);return Vm(e,r),e}function Um(e,t,r){if(r){let n=jm(e,r);if(n<0)throw new Error(`Node ${t.id} is not a child of ${e.id}`);zm(e,n,t)}else Fm(e,t);return e}function zm(e,t,r){const n=e._childNodes.length;if(!(t>=0&&t<=n))throw new Error("Index out of bounds.");e.getDocument().update([e.id,"_childNodes"],{type:"insert",pos:t,value:r.id});return e}function Vm(e,t){const r=e._childNodes.length;if(!(t>=0&&t<r))throw new Error("Index out of bounds.");e.getDocument().update([e.id,"_childNodes"],{type:"delete",pos:t});return e}function Gm(e,t){let r=e._childNodes[t];if(r)return e.getDocument().get(r)}function Jm(e,t){let r;switch(t._elementType){case"text":r=function(e,t){const r=t.getAnnotations(),n=t.getText();let s=Km(e,t);if(r&&r.length>0){let i=new tu({onText:(e,t)=>{const r=e.node;(r.isText()||r.isAnnotation())&&e.el.append(t)},onEnter:t=>({el:Jm(e,t.node),node:t.node}),onExit:(e,t,r)=>{r.el.append(t.el)}});i.start({el:s,node:t},n,r)}else s.append(n);return s}(e,t);break;case"element":case"inline-element":case"container":r=function(e,t){let r=Km(e,t);return r.append(t.getChildren().map(t=>Jm(e,t))),r}(e,t);break;case"anchor":case"annotation":r=Km(e,t);break;case"external":r=Xh.parseSnippet(t.xml,"xml");break;default:throw new Error("Invalid element type.")}return r}function Km(e,t){let r=e.createElement(t.type);return r.attr("id",t.id),r.attr(t.attributes),r}class $m extends Mu{_initialize(e,t){t.attributes&&delete t.attributes.id,super._initialize(e,t)}toXML(){return e=this,Jm(Xh.createDocument("xml"),e);var e}findChild(e){const t=this.getChildren();for(let r=0;r<t.length;r++){const n=t[r];if(n.type===e)return n}}find(e){return ml.selectOne(e,this,{xmlMode:!0,adapter:Bm})}findAll(e){return ml.selectAll(e,this,{xmlMode:!0,adapter:Bm})}isContainer(){return!1}isBlock(){const e=this.parentNode;return e&&e.isContainer()}get children(){return this.getChildren()}getChildren(){return this.getChildNodes()}getChildNodes(){return this._childNodes?Eo(this.getDocument(),this._childNodes):[]}getChildCount(){return this._childNodes?this._childNodes.length:0}getChildPosition(e){return e&&this._childNodes?this._childNodes.indexOf(e.id):-1}getChildNodeIterator(){return new Xo(this.getChildNodes())}getFirstChild(){if(this._childNodes)return this.getDocument().get(this._childNodes[0])}getLastChild(){if(this._childNodes)return this.getDocument().get(Di(this._childNodes))}getParent(){return this.parentNode}setParent(e){this.parentNode=e}get tagName(){return this.type}get parent(){return this.parentNode}setAttribute(e,t){if("id"===e)throw new Error("'id' is read-only and can not be changed");return this.getDocument().set([this.id,"attributes",e],t),this}getAttribute(e){return"id"===e?this.id:this.attributes[e]}removeAttribute(e){return this.attributes.hasOwnProperty(e)&&(this.getDocument().set([this.id,"attributes",e],void 0),delete this.attributes[e]),this}getAttributes(){return _(this.attributes)}getElementSchema(){return this.getDocument().getElementSchema(this.type)}serialize(){return this.toXML()}isTextNode(){return!1}isElementNode(){return!1}getInnerXML(){return(e=this)._childNodes?e.getChildNodes().map(e=>e.toXML().serialize()).join(""):e.isText()?e.toXML().getInnerXML():"";var e}get _isXMLNode(){return!0}}$m.prototype.attr=Qo.prototype.attr,$m.schema={attributes:{type:"object",default:{}}};class Xm extends(Jf($m)){getPath(){return[this.id,"content"]}getText(){return this.content}getChildren(){const e=this.getAnnotations();return e.sort(Wm),e}getTextContent(){return this.getText()}setTextContent(e){return this.setText(e)}get textContent(){return this.getText()}set textContent(e){this.setText(e)}appendChild(e){throw new Error("This is not implemented yet.")}removeChild(e){throw new Error("This is not implemented yet.")}isElementNode(){return!0}text(){return Qo.prototype.text.apply(this,arguments)}get _isXMLTextElement(){return!0}get _elementType(){return"text"}static isText(){return!0}static isBlock(){return!0}}function Wm(e,t){return e.start.offset-t.start.offset}Xm.schema={type:"text",content:"text"};class Ym{constructor(e){this.type=e,this.tagName=Cm(e),this.tagNameNS=e}matchElement(e){return e.tagName===this.tagNameNS}export(e,t){t.tagName=this.tagNameNS,t.attr(e.attributes)}}class Zm extends Ym{import(e,t,r){t.content=r.annotatedText(e,[t.id,"content"],{preserveWhitespace:!0})}export(e,t,r){t.tagName=this.tagNameNS,t.attr(e.attributes),t.append(r.annotatedText([e.id,"content"]))}}class Qm extends $m{appendChild(e){return Fm(this,e)}removeChild(e){return Hm(this,e)}insertBefore(e,t){return Um(this,e,t)}insertAt(e,t){return zm(this,e,t)}removeAt(e){return Vm(this,e)}getChildAt(e){return Gm(this,e)}isElementNode(){return!0}append(){return Qo.prototype.append.apply(this,arguments)}replaceChild(e,t){return function(e,t,r){const n=jm(e,t);if(!(n>=0))throw new Error(`Node ${t.id} is not a child of ${e.id}`);return Vm(e,n),zm(e,n,r),e}(this,e,t)}get _elementType(){return"element"}static isBlock(){return!0}}Qm.schema={type:"element",_childNodes:{type:["array","id"],default:[],owned:!0}};class e_ extends Ym{import(e,t,r){let n=r.getChildNodeIterator(e),s=[];for(;n.hasNext();){const e=n.next();if(e.isElementNode()){let t=r.convertElement(e);s.push(t.id)}}t._childNodes=s}export(e,t,r){t.tagName=this.tagNameNS,t.attr(e.attributes),e.getChildren().forEach(e=>{let n=r.convertNode(e);t.appendChild(n)})}}class t_ extends(qu($m)){get parentNode(){const e=this.start.path;return this.getDocument().get(e[0])}static isPropertyAnnotation(){return!0}get _elementType(){return"annotation"}}t_.schema={type:"@annotation"};class r_ extends $m{get parentNode(){const e=this.coor.start.path;return this.getDocument().get(e[0])}}r_.prototype._elementType="anchor",r_.type="anchor",r_.schema={coor:{type:"coordinate",optional:!0}};class n_ extends(qu($m)){get parentNode(){const e=this.start.path;if(e[0]){return this.getDocument().get(e[0])}return this._parentNode}set parentNode(e){if(this.start.path[0])throw new Error("parent of inline-element is implicitly given");this._parentNode=e}getChildAt(e){return Gm(this,e)}appendChild(e){return Fm(this,e)}removeChild(e){return Hm(this,e)}insertBefore(e,t){return Um(this,e,t)}insertAt(e,t){return zm(this,e,t)}removeAt(e){return Vm(this,e)}getInnerXML(){return this.getChildren().map(e=>e.toXML().outerHTML).join("")}static isInlineNode(){return!0}get _elementType(){return"inline-element"}get _isInlineNode(){return!0}}n_.schema={type:"inline-element",_childNodes:{type:["array","id"],default:[],owned:!0}};class s_ extends $m{get _elementType(){return"external"}static isBlock(){return!0}}s_.schema={type:"external",xml:{type:"string",default:""}};class i_ extends Ym{import(e,t){t.xml=e.innerHTML}export(e,t){t.tagName=this.tagNameNS,t.setAttributes(e.attributes),t.innerHTML=e.xml}}class o_ extends(Lu(Qm)){getContentPath(){return[this.id,"_childNodes"]}getContent(){return this._childNodes}isContainer(){return!0}appendChild(e){super.append(e.id)}get _elementType(){return"container"}static isBlock(){return!0}}o_.schema={type:"container"};const{TEXT:a_}=jg;class l_{constructor(e,t,r){this.el=e,this.it=t,this.expr=r,this.state=r.getInitialState(),this._oldStates=[]}hasNext(){return this.it.hasNext()}next(){const e=this.state,t=this.expr;let r,n=this.it.next(),s=b(this.state);if(n.isTextNode()?r=t.consume(e,a_):n.isElementNode()&&(r=t.consume(e,n.tagName)),r)return this._oldStates.push(s),n;if(n.isTextNode())Jg(n)||console.error(`TEXT is invalid within <${t.name}>. Skipping.`,n.textContent);else if(n.isElementNode()){let t=Di(e.errors);console.error(t.msg,this.el.getNativeElement())}return this.state=s,n.createComment(n.outerHTML)}back(){return this.it.back(),this.state=this._oldStates.pop(),this}peek(){return this.it.peek()}}class c_ extends Nf{constructor(e,t){super(function(e){const t=e.schema,r=e.xmlSchema||t.xmlSchema;return{schema:t,xmlSchema:r,converters:e.converters,idAttribute:e.idAttribute||r.getIdAttribute()}}(e),t),this.xmlSchema=e.xmlSchema||e.schema.xmlSchema}importDocument(e){this.reset();const t=this.state.doc;S(e)&&(e=Xh.parseXML(e));const r=this.xmlSchema.getStartElement();let n;if(!(n=e.is(r)?e:e.find(r)))throw new Error(`Could not find <${r}> element.`);return t.root=this.convertElement(n),this.state.doc}_initialize(){const e=this.schema,t=e.getDefaultTextType(),r=this.converters;this._allConverters=[],this._propertyAnnotationConverters=[],this._blockConverters=[];for(let n=0;n<r.length;n++){let s;if("function"==typeof r[n]){s=new(0,r[n])}else s=r[n];if(!s.type)throw new Error("Converter must provide the type of the associated node.");if(!s.matchElement&&!s.tagName)throw new Error("Converter must provide a matchElement function or a tagName property.");s.matchElement||(s.matchElement=this._defaultElementMatcher.bind(s));const i=e.getNodeClass(s.type);if(!i)throw new Error("No node type defined for converter");this._defaultBlockConverter||t!==s.type||(this._defaultBlockConverter=s),i.isAnnotation()||i.isInlineNode()?this._propertyAnnotationConverters.push(s):this._blockConverters.push(s)}this._allConverters=this._blockConverters.concat(this._propertyAnnotationConverters)}_createNodeData(e,t){let r=super._createNodeData(e,t),n={};return e.getAttributes().forEach((e,t)=>{n[t]=e}),r.attributes=n,r}getChildNodeIterator(e){let t=this.xmlSchema.getElementSchema(e.tagName),r=e.getChildNodeIterator();return t?new l_(e,r,t.expr):r}_convertPropertyAnnotation(){throw new Error("stand-alone annotations are not supported.")}_convertInlineNode(e,t,r){return r.import&&(t=r.import(e,t,this)||t),t.start={path:[],offset:0},t.end={offset:0},t}}const h_=["id","type","attributes","_childNodes","_content"];const d_=Object.freeze({disabled:!0});class u_{constructor(e){this.doc=e,this.parents={},e.data.on("operation:applied",this._onOperationApplied,this)}_onOperationApplied(e){const t=this.doc,r=this.parents;let n=t.get(e.path[0]);switch(e.type){case"create":n._childNodes&&s(n,n._childNodes),function(e){let t=r[e.id];t&&(e.parentNode=t)}(n);break;case"update":{let t=e.diff;"_childNodes"===e.path[1]&&(t.isInsert()?s(n,t.getValue()):t.isDelete()&&s(null,t.getValue()));break}case"set":"_childNodes"===e.path[1]&&(s(null,e.getOldValue()),s(n,e.getValue()))}function s(e,n){function s(n){r[n]=e;let s=t.get(n);s&&(s.parentNode=e)}n&&(m(n)?n.forEach(s):s(n))}}static register(e){return new u_(e)}}class p_ extends hf{find(e){return this.getDocument().find(e)}findAll(e){return this.getDocument().findAll(e)}createElement(...e){return this.getDocument().createElement(...e)}}class f_ extends Ff{_initialize(){this.nodeFactory=new Rf(this),this.data=new Lf(this.schema,this.nodeFactory),this.addIndex("type",new Mf("type")),this.addIndex("annotations",new Qp),u_.register(this)}toXML(){let e=Xh.createDocument("xml");e.setDoctype(...this.getDocTypeParams());let t=this.getRootNode().toXML();return e.append(t),e}getDocTypeParams(){throw new Error("This method is abstract")}getXMLSchema(){throw new Error("This method is abstract")}getRootNode(){throw new Error("This method is abstract")}getDocTypeAsString(){return new Error("This method is abstract")}createEditingInterface(){return new p_(this)}find(e){return this.getRootNode().find(e)}findAll(e){return this.getRootNode().findAll(e)}createElement(e,t){return this.create(Object.assign({id:d(e),type:e},t))}getElementSchema(e){return this.getXMLSchema().getElementSchema(e)}_validateChange(e){let t={},r=[];e.ops.forEach(e=>{switch(e.type){case"delete":r.push(e.val.id);break;case"create":t[e.val.id]=!0;break;default:e.path&&(t[e.path[0]]=!0)}}),r.forEach(e=>delete t[e]);const n=this.getXMLSchema();let s=[];return Object.keys(t).forEach(e=>{let t=this.get(e);if(t&&t._isXMLNode){let e=n.validateElement(t);e.ok||(s=s.concat(e.errors))}}),{ok:0===s.length,errors:s}}_apply(e){if(!e.ops)return;let t={},r={},n={};const s=this;function i(e,t){let r=n[e];return r||(r=n[e]={ops:[]}),t&&r.ops.push(t),r}e.ops.forEach(e=>{switch(e.type){case"create":t[e.path[0]]=e.val;break;case"delete":{let t=this.get(e.path[0]);r[t.id]=t;break}case"update":case"set":n[e.path]=!0,i(this.get(e.path[0]).id,e);break}!function(e){switch(e.type){case"create":case"delete":{const t=e.val;if(t.hasOwnProperty("start")){n[t.start.path]=!0;let r=s.get(t.start.path[0]);r&&i(r.id,e)}if(t.hasOwnProperty("end")){n[t.end.path]=!0;let r=s.get(t.start.path[0]);r&&i(r.id,e)}break}case"update":case"set":{let t=s.get(e.path[0]);if(t)if(t.isPropertyAnnotation()){n[t.start.path]=!0;let r=s.get(t.start.path[0]);r&&i(r.id,e)}else t.isContainerAnnotation();break}}}(e),this._applyOp(e)}),Object.keys(r).forEach(e=>{delete n[e]}),e.created=t,e.updated=n,e.deleted=r,e._extracted=!0}}f_.prototype._isXMLDocument=!0;var g_={name:"button",configure:function(e){e.addComponent("button",rg),e.addIcon("dropdown",{fontawesome:"fa-angle-down"})},Button:rg},m_={name:"context-menu",configure:function(e){e.addComponent("context-menu",bp)}};class __ extends Gd{render(e){let t=this._getDocumentValue(),r=e("input").attr({value:t,type:this.props.type,placeholder:this.props.placeholder}).addClass("sc-input").val(t).on("keydown",this._onKeydown);return this.props.path&&r.on("change",this._onChange),this.props.centered&&r.addClass("sm-centered"),r}_onChange(){let e=this.context.editorSession,t=this.props.path,r=this.el.val(),n=this._getDocumentValue();r!==n&&(e.transaction(function(e){e.set(t,r)}),this.props.retainFocus&&this.el.getNativeElement().focus())}_getDocumentValue(){if(this.props.val)return this.props.val;{let e=this.context.editorSession,t=this.props.path;return e.getDocument().get(t)}}_onKeydown(e){e.keyCode===lu.ESCAPE&&(e.stopPropagation(),e.preventDefault(),this.el.val(this._getDocumentValue()))}}var y_={name:"input",configure:function(e){e.addComponent("input",__)},Input:__};class w_ extends Gd{render(e){let t=e("div").addClass("sc-modal");return t.on("click",this._closeModal),this.props.width&&t.addClass("sm-width-"+this.props.width),t.append(e("div").addClass("se-body").append(this.props.children)),t}_closeModal(e){e.target.classList.contains("sc-modal")&&this.send("closeModal")}}var b_={name:"modal",configure:function(e){e.addComponent("modal",w_)},Modal:w_},v_={name:"overlay",configure:function(e){e.addComponent("overlay",Rp)}},C_={name:"dropzones",configure:function(e){e.addComponent("dropzones",Sp)},Dropzones:Sp},S_={name:"scrollbar",configure:function(e){e.addComponent("scrollbar",qp)},Scrollbar:qp},x_={name:"scroll-pane",configure:function(e){e.addComponent("scroll-pane",jp)},ScrollPane:jp};class E_ extends Fp{getChildContext(){return{scrollPane:this}}getName(){return"body"}render(e){let t=e("div");return"custom"===this.props.contextMenu&&t.on("contextmenu",this._onContextMenu),t.append(this.props.children),t}getHeight(){return y.inBrowser?window.innerHeight:0}getContentHeight(){return y.inBrowser?document.body.scrollHeight:0}getContentElement(){return y.inBrowser?Xh.wrapNativeElement(window.document.body):null}getScrollableElement(){return y.inBrowser?document.body:null}getScrollPosition(){return y.inBrowser?document.body.scrollTop:0}setScrollPosition(e){y.inBrowser&&(document.body.scrollTop=e)}getPanelOffsetForElement(e){console.warn("TODO: implement")}scrollTo(e,t){console.warn("TODO: implement")}}var N_={name:"body-scroll-pane",configure:function(e){e.addComponent("body-scroll-pane",E_)},BodyScrollPane:E_},T_={name:"split-pane",configure:function(e){e.addComponent("split-pane",yg)},SplitPane:yg};class P_ extends Gd{render(e){let t=e("div").addClass("sc-tabbed-pane"),n=e("div").addClass("se-tabs");return r(this.props.tabs,function(t){let r=e("a").addClass("se-tab").attr({href:"#","data-id":t.id}).on("click",this.onTabClicked);t.id===this.props.activeTab&&r.addClass("sm-active"),r.append(e("span").addClass("label").append(t.name)),n.append(r)}.bind(this)),t.append(n),t.append(e("div").addClass("se-tab-content").ref("tabContent").append(this.props.children)),t}onTabClicked(e){e.preventDefault();let t=e.currentTarget.dataset.id;this.send("switchTab",t)}}var D_={name:"tabbed-pane",configure:function(e){e.addComponent("tabbed-pane",P_)},TabbedPane:P_},I_={name:"file",configure:function(e){e.addNode(jf)}},A_={name:"tool-panel",configure(e){e.addComponent("tool-panel",wp),e.addComponent("tool-dropdown",Up),e.addComponent("tool-group",Mp),e.addComponent("menu-group",Lp),e.addComponent("tool-prompt",zp),e.addComponent("tool-separator",Vp)}},O_={name:"base",configure:function(e){e.import(I_),e.import(x_),e.import(N_),e.import(T_),e.import(D_),e.import(S_),e.import(b_),e.import(y_),e.import(g_),e.import(m_),e.import(v_),e.import(C_),e.import(A_),e.addCommand("undo",wg,{commandGroup:"undo-redo"}),e.addCommand("redo",bg,{commandGroup:"undo-redo"}),e.addCommand("select-all",vg,{commandGroup:"selection"}),e.addIcon("insert",{fontawesome:"fa-plus"}),e.addIcon("undo",{fontawesome:"fa-undo"}),e.addIcon("redo",{fontawesome:"fa-repeat"}),e.addIcon("edit",{fontawesome:"fa-cog"}),e.addIcon("delete",{fontawesome:"fa-times"}),e.addIcon("expand",{fontawesome:"fa-arrows-h"}),e.addIcon("truncate",{fontawesome:"fa-arrows-h"}),e.addLabel("undo",{en:"Undo",de:"Rückgängig"}),e.addLabel("redo",{en:"Redo",de:"Wiederherstellen"}),e.addLabel("select-all",{en:"Select All",de:"Alles Auswählen"}),e.addLabel("text-types",{en:"Text Type",de:"Texttyp"}),e.addLabel("container-selection",{en:"Container",de:"Container"}),e.addLabel("@container",{en:"Container",de:"Container"}),e.addLabel("insert",{en:"Insert",de:"Einfügen"}),e.addLabel("insert-container",{en:"Insert Container",de:"Container einfügen"}),e.addComponent("text-property",ou),e.addComponent("isolated-node",uu),e.addComponent("inline-node",ug),e.addComponent("annotation",eg),e.addKeyboardShortcut("CommandOrControl+Z",{command:"undo"}),e.addKeyboardShortcut("CommandOrControl+Shift+Z",{command:"redo"}),e.addKeyboardShortcut("CommandOrControl+A",{command:"select-all"})},UndoCommand:wg,RedoCommand:bg,SelectAllCommand:vg};class k_ extends $f{}k_.type="blockquote";class M_ extends mg{render(e){return super.render.call(this,e).addClass("sc-blockquote")}}var L_={type:"blockquote",tagName:"blockquote",import:function(e,t,r){t.content=r.annotatedText(e,[t.id,"content"])},export:function(e,t,r){t.append(r.annotatedText([e.id,"content"]))}},R_={name:"blockquote",configure:function(e){e.addNode(k_),e.addComponent(k_.type,M_),e.addConverter("html",L_),e.addConverter("xml",L_),e.addCommand("blockquote",gg,{spec:{type:"blockquote"},commandGroup:"text-types"}),e.addIcon("blockquote",{fontawesome:"fa-quote-right"}),e.addLabel("blockquote",{en:"Blockquote",de:"Blockzitat"}),e.addKeyboardShortcut("CommandOrControl+Alt+B",{command:"blockquote"})},Blockquote:k_,BlockquoteComponent:M_,BlockquoteHTMLConverter:L_};class q_ extends Bu{}q_.type="code";var B_={type:"code",tagName:"code"},F_={name:"code",configure:function(e){e.addNode(q_),e.addConverter("html",B_),e.addConverter("xml",B_),e.addComponent("code",eg),e.addCommand("code",Qf,{nodeType:q_.type,commandGroup:"annotations"}),e.addIcon("code",{fontawesome:"fa-code"}),e.addLabel("code",{en:"Code",de:"Code"})},Code:q_,CodeHTMLConverter:B_};class j_ extends $f{}j_.type="codeblock";class H_ extends mg{render(e){return super.render.call(this,e).addClass("sc-codeblock")}}var U_={type:"codeblock",tagName:"pre",import:function(e,t,r){let n=e.find("code");n&&(t.content=r.annotatedText(n,[t.id,"content"],{preserveWhitespace:!0}))},export:function(e,t,r){let n=r.$$;t.append(n("code").append(r.annotatedText([e.id,"content"])))}},z_={name:"codeblock",configure:function(e){e.addNode(j_),e.addComponent("codeblock",H_),e.addConverter("html",U_),e.addConverter("xml",U_),e.addCommand("codeblock",gg,{spec:{type:"codeblock"},commandGroup:"text-types"}),e.addIcon("codeblock",{fontawesome:"fa-quote-right"}),e.addLabel("codeblock",{en:"Codeblock",de:"Codeblock"}),e.addKeyboardShortcut("CommandOrControl+Alt+C",{command:"codeblock"})},Codeblock:j_,CodeblockComponent:H_,CodeblockHTMLConverter:U_};class V_ extends Bu{}V_.type="emphasis",V_.fragmentation=tu.ANY;var G_={type:"emphasis",tagName:"em",matchElement:function(e){return e.is("em, i")}};class J_ extends eg{getTagName(){return"em"}}var K_={name:"emphasis",configure:function(e){e.addNode(V_),e.addConverter("html",G_),e.addConverter("xml",G_),e.addComponent("emphasis",J_),e.addCommand("emphasis",Qf,{nodeType:V_.type,commandGroup:"annotations"}),e.addIcon("emphasis",{fontawesome:"fa-italic"}),e.addLabel("emphasis",{en:"Emphasis",de:"Betonung"}),e.addKeyboardShortcut("CommandOrControl+I",{command:"emphasis"})},Emphasis:V_,EmphasisComponent:J_,EmphasisHTMLConverter:G_};class $_ extends Zf{getCommandState({editorSession:e}){let t=e.getManager("find-and-replace");if(t){return t.getCommandState()}return{disabled:!0}}execute(){}}class X_ extends Zf{getCommandState({editorSession:e}){return e.getManager("find-and-replace")?{disabled:!1}:{disabled:!0}}execute({editorSession:e}){let t=e.getManager("find-and-replace");e.getFocusedSurface()&&t.enable()}}class W_ extends Zf{getCommandState({editorSession:e}){let t=e.getManager("find-and-replace");if(t){return{disabled:t.getCommandState().disabled}}return{disabled:!0}}execute({editorSession:e}){let t=e.getManager("find-and-replace");t.getCommandState().disabled||t.disable()}}class Y_ extends X_{execute({editorSession:e}){e.getManager("find-and-replace").findNext()}}class Z_ extends $_{execute({editorSession:e}){e.getManager("find-and-replace").findPrevious()}}class Q_ extends $_{execute({editorSession:e}){e.getManager("find-and-replace").replaceNext()}}class ey extends $_{execute({editorSession:e}){e.getManager("find-and-replace").replaceAll()}}class ty extends kp{didMount(){this.context.editorSession.onPosition(this._onPosition,this)}dispose(){this.context.editorSession.off(this)}_onPosition(){let e=this.context.editorSession.getManager("find-and-replace");e._requestLookupMatch&&(this._scrollToSelectedMatch(),e._requestLookupMatch=!1),e._requestFocusSearchString&&setTimeout(()=>{this.refs.findString.el.focus(),this.refs.findString.el.select(),e._requestFocusSearchString=!1},0)}render(e){let t=this.props.commandState,r=e("div").addClass("sc-find-and-replace-tool");return r.append(this._renderStatusDescription(e),e("div").addClass("se-section").append(e("div").addClass("se-section-item se-find-input").addClass("sm-flex").append(e("input").ref("findString").attr("type","text").attr("placeholder","Find in body").attr("tabindex",500).val(t.findString).on("input",We(this._startFind,300)).on("keypress",this._triggerFindNext).on("focus",this._onFocus).on("blur",this._onBlur),this._renderStatusCounter(e)),e("div").addClass("se-section-item se-replace-input").append(e("button").append("Find").attr("tabindex",502).on("click",this._findNext)),e("div").addClass("se-section-item")),e("div").addClass("se-section").append(e("div").addClass("se-section-item").addClass("sm-flex").append(e("input").ref("replaceString").val(t.replaceString).attr("type","text").attr("tabindex",501).attr("placeholder","Replace in body").on("focus",this._onFocus).on("blur",this._onBlur).on("input",this._setReplaceString).on("keypress",this._triggerReplace)),e("div").addClass("se-section-item").append(e("button").append("Replace").attr("tabindex",503).on("click",this._replaceNext)),e("div").addClass("se-section-item").append(e("button").append("Replace All").attr("tabindex",504).on("click",this._replaceAll)))),r}_renderStatusDescription(e){let t=this.props.commandState,r=e("div").addClass("se-status").append(e("div").addClass("se-status-title").append(this.getLabel("find-and-replace-title")));return t.totalMatches>0?r.append(e("div").addClass("se-status-description").append(t.totalMatches," results found for ",'"'+t.findString+'"')):""!==t.findString?r.append(e("div").addClass("se-status-description").append("No results found for ",'"'+t.findString+'"')):r.append(e("div").addClass("se-status-description").append("Close this panel with ESC key")),r}_onFocus(){let e=this.context.editorSession;e.setBlurred(!0),e.startFlow()}_onBlur(){this.context.editorSession.setBlurred(!1)}_renderStatusCounter(e){let t,r=this.props.commandState;return r.totalMatches>0&&(t=e("span").addClass("se-status-counter").append([r.selectedMatch,r.totalMatches].join(" of "))),t}_findNext(){this.context.editorSession.getManager("find-and-replace").findNext()}_replaceNext(){this.context.editorSession.getManager("find-and-replace").replaceNext()}_replaceAll(){this.context.editorSession.getManager("find-and-replace").replaceAll()}findStringHasChanged(){let e=this.refs.findString.val(),t=this._previousFindString;return this._previousFindString=e,e!==t}_startFind(){let e=this.context.editorSession,t=this.refs.findString.val();e.getManager("find-and-replace").startFind(t)}_scrollToSelectedMatch(){this.context.editorSession.getFocusedSurface().context.scrollPane.scrollTo(".sc-selected-match","onlyIfNotVisible")}_triggerFindNext(e){13===e.keyCode&&this._findNext()}_triggerReplace(e){13===e.keyCode&&this._replaceNext()}_setReplaceString(){let e=this.refs.replaceString.val();this.context.editorSession.getManager("find-and-replace").setReplaceString(e)}}class ry{constructor(e){if(!e.editorSession)throw new Error("EditorSession required.");this.editorSession=e.editorSession,this.editorSession.onRender("document",this._onDocumentChanged,this),this.doc=this.editorSession.getDocument(),this.context=Object.assign({},e,{doc:this.doc}),this._state={disabled:!0,findString:"",replaceString:"",matches:[],selectedMatch:void 0},this._requestLookupMatch=!1,this._requestFocusSearchString=!1}dispose(){this.editorSession.off(this)}_resetState(){this._state.disabled=!0,this._state.matches=[],this._state.selectedMatch=void 0}getCommandState(){let e=this._state;return{disabled:e.disabled,findString:e.findString,replaceString:e.replaceString,totalMatches:e.matches.length,selectedMatch:e.selectedMatch+1}}enable(){this._state.disabled=!1,this._requestFocusSearchString=!0,this.startFind(this._state.findString)}disable(){this._state.disabled=!0,this._resetState(),this._propagateUpdate()}_onDocumentChanged(){this._state.disabled||(this._computeMatches(),this._state.selectedMatch=0,this._updateMarkers())}startFind(e){this._state.findString=e,this._computeMatches();let t=this._getClosestMatch();this._state.selectedMatch=t>0?t:0,this._requestLookupMatch=!0,this._setSelection(),this._propagateUpdate()}setReplaceString(e){this._state.replaceString=e}findNext(){let e=this._state.selectedMatch,t=this._state.matches.length;0!==t&&(this._state.selectedMatch=(e+1)%t,this._requestLookupMatch=!0,this._setSelection(),this._propagateUpdate())}findPrevious(){let e=this._state.selectedMatch,t=this._state.matches.length;0!==t&&(this._state.selectedMatch=e>0?e-1:t-1,this._requestLookupMatch=!0,this._setSelection(),this._propagateUpdate())}_setSelection(){let e=this._state.matches[this._state.selectedMatch];if(!e)return;let t=e.getSelection();this.editorSession.setSelection(t,"skipFlow")}replaceNext(){let e=this._state.selectedMatch,t=this._state.matches[e],r=this._state.matches.length;void 0!==t&&(this.editorSession.transaction((e,r)=>(e.setSelection(t.getSelection()),e.insertText(this._state.replaceString),r)),this._computeMatches(),e+1<r&&(this._state.selectedMatch=e),this._requestLookupMatch=!0,this._setSelection(),this._propagateUpdate())}replaceAll(){let e=this._state.matches.reverse();this.editorSession.transaction((t,r)=>(e.forEach(e=>{t.setSelection(e.getSelection()),t.insertText(this._state.replaceString)}),r)),this._computeMatches()}_getClosestMatch(){let e=this.editorSession.getDocument(),t=Object.keys(e.getNodes()),r=this.editorSession.getSelection(),n=0;if(!r.isNull()){let e=r.start.offset,s=r.start.path[0],i=t.indexOf(s);n=this._state.matches.findIndex(r=>{let n=r.getSelection(),s=n.start.offset,o=n.start.path[0],a=t.indexOf(o);return!(i>a)&&(i<a||e<=s)})}return n}_computeMatches(){let e=this._state.matches,t=void 0===e?0:e.length;this._state.matches=this._findAllMatches();let r=this._state.matches;r.length!==t&&(this._state.selectedMatch=r.length>0?0:void 0)}_findAllMatches(){let e=this._getAllAffectedTextPropertiesInOrder();const t=this._state.findString;let r=[];return t&&e.forEach(e=>{let n=this._findInTextProperty({path:e,findString:t});r=r.concat(n)}),r}_getAllAffectedTextPropertiesInOrder(){let e=[];const t=this.editorSession.getEditor();return e=(t.find(this.getRootElementSelector())||t).findAll(".sc-text-property").map(e=>e.props.path)}_findInTextProperty({path:e,findString:t}){const r=this.doc,n=r.get(e);let s,i=new RegExp(t,"ig"),o=[];for(;s=i.exec(n);){let t=new pp(r,{type:"match",start:{path:e,offset:s.index},end:{offset:i.lastIndex}});o.push(t)}return o}_propagateUpdate(){this._updateMarkers(),this.editorSession._setDirty("commandStates"),this.editorSession.startFlow()}_updateMarkers(){const e=this._state,t=this.editorSession.markersManager;e.matches.forEach((t,r)=>{t.type=r===e.selectedMatch?"selected-match":"match"}),t.setMarkers("find-and-replace",e.matches)}getRootElementSelector(){return this.editorSession.getConfigurator().getFindAndReplaceConfig().rootElement}}var ny={name:"find-and-replace",configure:function(e,t){e.addCommand("find-and-replace",$_,{commandGroup:"workflows"}),e.addCommand("toggle-find-and-replace",X_,{commandGroup:"find-and-replace"}),e.addCommand("close-find-and-replace",W_,{commandGroup:"find-and-replace"}),e.addCommand("find-next",Y_,{commandGroup:"find-and-replace"}),e.addCommand("find-previous",Z_,{commandGroup:"find-and-replace"}),e.addCommand("replace-next",Q_,{commandGroup:"find-and-replace"}),e.addCommand("replace-all",ey,{commandGroup:"find-and-replace"}),e.addTool("find-and-replace",ty),e.addKeyboardShortcut("CommandOrControl+F",{command:"toggle-find-and-replace"}),e.addKeyboardShortcut("CommandOrControl+Alt+F",{command:"toggle-find-and-replace"}),e.addKeyboardShortcut("CommandOrControl+G",{command:"find-next"}),e.addKeyboardShortcut("CommandOrControl+Shift+G",{command:"find-previous"}),e.addKeyboardShortcut("CommandOrControl+Alt+E",{command:"replace-next"}),e.addKeyboardShortcut("esc",{command:"close-find-and-replace"}),e.addManager("find-and-replace",ry),e.addLabel("find-and-replace-title",{en:"Find and replace",de:"Suchen und Ersetzen"}),e.setFindAndReplaceConfig(t)},FindAndReplaceCommand:$_,ToggleFindAndReplaceCommand:X_,FindNextCommand:Y_,FindPreviousCommand:Z_,ReplaceNextCommand:Q_,ReplaceAllCommand:ey,FindAndReplaceTool:ty,FindAndReplaceManager:ry};class sy extends $f{isHeading(){return!0}getLevel(){return this.level}}sy.schema={type:"heading",level:{type:"number",default:1}};class iy extends mg{render(e){return super.render(e).addClass("sc-heading sm-level-"+this.props.node.level)}getTagName(){return"h"+this.props.node.level}}var oy={type:"heading",matchElement:function(e){return/^h\d$/.exec(e.tagName)},import:function(e,t,r){t.level=Number(e.tagName[1]);let n=e.attr("data-text-align");t.textAlign=n||"left",t.content=r.annotatedText(e,[t.id,"content"])},export:function(e,t,r){t.tagName="h"+e.level,"left"!==e.textAlign&&t.attr("data-text-align",e.textAlign),t.append(r.annotatedText([e.id,"content"]))}},ay={name:"heading",configure:function(e){e.addNode(sy),e.addComponent(sy.type,iy),e.addConverter("html",oy),e.addConverter("xml",oy),e.addCommand("heading1",gg,{spec:{type:"heading",level:1},commandGroup:"text-types"}),e.addCommand("heading2",gg,{spec:{type:"heading",level:2},commandGroup:"text-types"}),e.addCommand("heading3",gg,{spec:{type:"heading",level:3},commandGroup:"text-types"}),e.addKeyboardShortcut("CommandOrControl+Alt+1",{command:"heading1"}),e.addKeyboardShortcut("CommandOrControl+Alt+2",{command:"heading2"}),e.addKeyboardShortcut("CommandOrControl+Alt+3",{command:"heading3"}),e.addLabel("heading1",{en:"Heading 1",de:"Überschrift 1"}),e.addLabel("heading2",{en:"Heading 2",de:"Überschrift 2"}),e.addLabel("heading3",{en:"Heading 3",de:"Überschrift 3"}),e.addIcon("heading1",{fontawesome:"fa-header"}),e.addIcon("heading2",{fontawesome:"fa-header"}),e.addIcon("heading3",{fontawesome:"fa-header"})},Heading:sy,HeadingComponent:iy,HeadingHTMLConverter:oy,HeadingMacro:{appliesTo:["paragraph"],execute:function(e){if(-1===this.appliesTo.indexOf(e.node.type))return!1;if("type"!==e.action)return!1;let t=/^#\s/.exec(e.text);if(t){let r=e.editorSession,n=r.getSelection(),s=n.start.path,i=n.start.offset;return r.transaction(function(e){e.setSelection({type:"property",path:s,startOffset:0,endOffset:t[0].length}),e.deleteSelection();let r=e.switchTextType({type:"heading",level:1});e.setSelection({type:"property",path:r.getPath(),startOffset:i-t[0].length})}),!0}}}};class ly extends Mu{getImageFile(){if(this.imageFile)return this.document.get(this.imageFile)}getUrl(){let e=this.getImageFile();if(e)return e.getUrl()}}ly.schema={type:"image",imageFile:{type:"file"}};class cy extends tg{didMount(){super.didMount.call(this),this.context.editorSession.onRender("document",this._onDocumentChange,this)}dispose(){super.dispose.call(this),this.context.editorSession.off(this)}_onDocumentChange(e){(e.hasUpdated(this.props.node.id)||e.hasUpdated(this.props.node.imageFile))&&this.rerender()}render(e){let t=super.render(e);return t.addClass("sc-image"),t.append(e("img").attr({src:this.props.node.getUrl()}).ref("image")),t}getDropzoneSpecs(){return[{component:this.refs.image,message:"Replace Image",dropParams:{action:"replace-image",nodeId:this.props.node.id}}]}handleDrop(e,t){let r=t.data.files[0];if(t.external){let t=e.create({type:"file",fileType:"image",mimeType:r.type,url:URL.createObjectURL(r)});e.set([this.props.node.id,"imageFile"],t.id)}else{let r=t.sourceSelection.nodeId,n=e.get(r);"image"===n.type&&e.set([this.props.node.id,"imageFile"],n.imageFile)}}}var hy={type:"image",tagName:"img",import:function(e,t,r){let n=r.getDocument().create({id:"file-"+t.id,type:"file",fileType:"image",url:e.attr("src")});t.imageFile=n.id},export:function(e,t){let r=e.document.get(e.imageFile);t.attr("src",r.getUrl())}};function dy(e,t){let r=e.create({type:"file",fileType:"image",mimeType:t.type,sourceFile:t});e.insertBlockNode({type:"image",imageFile:r.id})}class uy extends dg{execute(e){e.editorSession.transaction(t=>{e.files.forEach(e=>{dy(t,e)})})}}class py extends kp{getClassNames(){return"sc-insert-image-tool"}renderButton(e){return[super.renderButton(e),e("input").attr("type","file").ref("input").on("change",this.onFileSelect)]}onClick(){this.refs.input.click()}onFileSelect(e){let t=e.currentTarget.files;this.executeCommand({files:Array.prototype.slice.call(t)})}}var fy={type:"drop-asset",match(e){let t=0===e.file.type.indexOf("image/");return"file"===e.type&&t},drop(e,t){dy(e,t.file)}};class gy extends kf{}gy.match=function(e){return"image"===e.fileType};var my={name:"image",configure:function(e){e.addNode(ly),e.addComponent("image",cy),e.addConverter("html",hy),e.addConverter("xml",hy),e.addCommand("insert-image",uy,{nodeType:"image",commandGroup:"insert"}),e.addTool("insert-image",py),e.addIcon("insert-image",{fontawesome:"fa-image"}),e.addLabel("image",{en:"Image",de:"Bild"}),e.addLabel("insert-image",{en:"Insert image",de:"Bild einfügen"}),e.addDropHandler(fy),e.addFileProxy(gy)},ImageNode:ly,ImageComponent:cy,ImageHTMLConverter:hy,InsertImageCommand:uy,InsertImageTool:py,DropImage:fy};class _y extends Bu{static get fragmentation(){return tu.SHOULD_NOT_SPLIT}static get autoExpandRight(){return!1}}_y.schema={type:"link",title:{type:"string",optional:!0},url:{type:"string",default:""}};class yy extends eg{didMount(...e){super.didMount(...e);let t=this.props.node;this.context.editorSession.onRender("document",this.rerender,this,{path:[t.id,"url"]})}dispose(...e){super.dispose(...e),this.context.editorSession.off(this)}render(e){let t=super.render(e);t.tagName="a",t.attr("href",this.props.node.url);let r=[this.props.node.url];return this.props.node.title&&r.push(this.props.node.title),t.attr("title",r.join(" | "))}}class wy extends Qf{canFuse(){return!1}executeCreate(e){let t=super.executeCreate(e);return this._getEditorSession(e).transaction(e=>{e.setSelection(e.selection.collapse())}),t}}var by={type:"link",tagName:"a",import:function(e,t){t.url=e.attr("href"),t.title=e.attr("title")},export:function(e,t){t.attr({href:e.url,title:e.title})}};class vy extends kp{getUrlPath(){let e=this.constructor.urlPropertyPath;return[this.getNodeId()].concat(e)}getNodeId(){return this.props.commandState.nodeId}_openLink(){let e=this.context.editorSession.getDocument();window.open(e.get(this.getUrlPath()),"_blank")}render(e){let t=this.getComponent("input"),r=this.getComponent("button"),n=this.props.commandState,s=e("div").addClass("sc-edit-link-tool");if(n.disabled)return console.warn("Tried to render EditLinkTool while disabled."),s;let i=this.getUrlPath();return s.append(e(t,{type:"url",path:i,placeholder:"Paste or type a link url"}).ref("input"),e(r,{icon:"open-link",theme:this.props.theme}).attr("title",this.getLabel("open-link")).on("click",this._openLink),e(r,{icon:"delete",theme:this.props.theme}).attr("title",this.getLabel("delete-link")).on("click",this.onDelete)),s}onDelete(e){e.preventDefault();let t=this.getNodeId();this.context.surfaceManager.getFocusedSurface()?this.context.editorSession.transaction(function(e,r){return e.delete(t),r}):console.warn("No focused surface. Stopping command execution.")}}vy.urlPropertyPath=["url"];var Cy={name:"link",configure:function(e){e.addNode(_y),e.addComponent("link",yy),e.addConverter("html",by),e.addConverter("xml",by),e.addCommand("link",wy,{nodeType:"link",commandGroup:"annotations"}),e.addCommand("edit-link",hg,{nodeType:"link",commandGroup:"prompt"}),e.addTool("edit-link",vy),e.addIcon("link",{fontawesome:"fa-link"}),e.addIcon("open-link",{fontawesome:"fa-external-link"}),e.addLabel("link",{en:"Link",de:"Link"}),e.addLabel("open-link",{en:"Open Link",de:"Link öffnen"}),e.addLabel("delete-link",{en:"Remove Link",de:"Link löschen"}),e.addKeyboardShortcut("CommandOrControl+K",{command:"link"})},Link:_y,LinkComponent:yy,LinkCommand:wy,LinkHTMLConverter:by,EditLinkTool:vy};class Sy extends(Uf(Mu)){createListItem(e){return this.getDocument().create({type:"list-item",content:e})}getItems(){const e=this.getDocument();return this.items.map(t=>e.get(t))}getItemsPath(){return[this.id,"items"]}insertItemAt(e,t){const r=this.getDocument(),n=t.id;r.update(this.getItemsPath(),{type:"insert",pos:e,value:n})}removeItemAt(e){this.getDocument().update(this.getItemsPath(),{type:"delete",pos:e})}getItemAt(e){return this.getDocument().get(this.items[e])}getItemPosition(e){const t=e.id;let r=this.items.indexOf(t);if(r<0)throw new Error("Item is not within this list: "+t);return r}getLength(){return this.items.length}getListTypeString(){return this.listType}setListTypeString(e){this.getDocument().set([this.id,"listType"],e)}}Sy.type="list",Sy.schema={items:{type:["array","id"],default:[],owned:!0},listType:{type:"string",default:"bullet"}};class xy extends Kf{getLevel(){return this.level}setLevel(e){this.level!==e&&this.getDocument().set([this.id,"level"],e)}static isListItem(){return!0}}xy.schema={type:"list-item",level:{type:"number",default:1}};class Ey extends Gd{render(e){const t=this.props.node,r=t.getPath();let n=e("li").addClass("sc-list-item");return n.append(e(ou,{path:r,doc:t.getDocument()}).ref("text")),this.props.children&&n.append(this.props.children),n}}class Ny extends tg{render(e){let t=this.props.node,r=Mg(t,t=>S(t)?e(t):"list-item"===t.type?e(Ey,{node:t}).ref(t.id):void 0);return r.addClass("sc-list").attr("data-id",t.id),r}get _isCustomNodeComponent(){return!0}}class Ty{get type(){return"list"}matchElement(e){return e.is("ul")||e.is("ol")}import(e,t,r){this._santizeNestedLists(e);let n=[],s=[];Jp(e,(e,t)=>{e.isElementNode()&&(e.is("li")?n.push({el:e,level:t}):s[t]||(e.is("ul")?s[t]="bullet":e.is("ol")&&(s[t]="order")))}),this._createItems(r,t,n,s)}_createItems(e,t,r,n){t.items=r.map(t=>{let r=e.convertElement(t.el);return r.level=t.level,r.id}),t.listType=n.join(",")}export(e,t,r){let n=r.$$,s=Mg(e,function(e){if(S(e))return n(e);{let t=e.getPath();return n("li").append(r.annotatedText(t))}});return t.tagName=s.tagName,t.attr(s.getAttributes()),t.append(s.getChildNodes()),t}_santizeNestedLists(e){e.findAll("ol,ul").forEach(e=>{for(;!e.parentNode.is("ol,ul");){let t=e.parentNode,r=t.parentNode,n=r.getChildIndex(t);r.insertAt(n+1,e)}})}}var Py={type:"list-item",matchElement:function(e){return e.is("li")},import:function(e,t,r){t.content=r.annotatedText(e,[t.id,"content"])},export:function(e,t,r){t.append(r.annotatedText(e.getPath()))}};class Dy extends Zf{getCommandState(e){let t=e.editorSession,r=t.getDocument(),n=t.getSelection();if(n&&n.isPropertySelection()){let e=n.path,t=r.get(e[0]);if(t){if(t.isListItem()){let e=t.getLevel(),r=t.getParent(),n=r.getListType(e)===this.config.spec.listType;return{disabled:!1,active:n,action:n?"toggleList":"setListType",listId:r.id,level:e}}if(t.isText()&&t.isBlock())return{disabled:!1,action:"switchTextType"}}}return{disabled:!0}}execute(e){let t=e.commandState;const{disabled:r,action:n}=t;if(r)return;let s=e.editorSession;switch(n){case"toggleList":s.transaction(e=>{e.toggleList()},{action:"toggleList"});break;case"setListType":{const{listId:e,level:r}=t;s.transaction(t=>{t.get(e).setListType(r,this.config.spec.listType)},{action:"setListType"});break}case"switchTextType":s.transaction(e=>{e.toggleList({listType:this.config.spec.listType})},{action:"toggleList"})}}}class Iy extends Zf{getCommandState(e){let t=e.editorSession,r=t.getDocument(),n=t.getSelection();if(n&&n.isPropertySelection()){let e=n.path,t=r.get(e[0]);if(t&&t.isListItem())return{disabled:!1}}return{disabled:!0}}execute(e){let t=e.commandState;const{disabled:r}=t;if(r)return;let n=e.editorSession;switch(this.config.spec.action){case"indent":n.transaction(e=>{e.indent()},{action:"indent"});break;case"dedent":n.transaction(e=>{e.dedent()},{action:"dedent"})}}}var Ay={name:"list",configure:function(e){e.addNode(Sy),e.addNode(xy),e.addComponent("list",Ny),e.addComponent("list-item",Ey),e.addConverter("html",Ty),e.addConverter("html",Py),e.addCommand("toggle-unordered-list",Dy,{spec:{listType:"bullet"},commandGroup:"list"}),e.addLabel("toggle-unordered-list",{en:"Toggle list",de:"Liste entfernen"}),e.addIcon("toggle-unordered-list",{fontawesome:"fa-list-ul"}),e.addCommand("toggle-ordered-list",Dy,{spec:{listType:"order"},commandGroup:"list"}),e.addLabel("toggle-ordered-list",{en:"Toggle list",de:"Aufzählung entfernen"}),e.addIcon("toggle-ordered-list",{fontawesome:"fa-list-ol"}),e.addCommand("indent-list",Iy,{spec:{action:"indent"},commandGroup:"list"}),e.addLabel("indent-list",{en:"Increase indentation",de:"Einrückung vergrößern"}),e.addIcon("indent-list",{fontawesome:"fa-indent"}),e.addCommand("dedent-list",Iy,{spec:{action:"dedent"},commandGroup:"list"}),e.addLabel("dedent-list",{en:"Decrease indentation",de:"Einrückung verringern"}),e.addIcon("dedent-list",{fontawesome:"fa-dedent"})},ListNode:Sy,ListItemNode:xy,ListComponent:Ny,ListHTMLConverter:Ty,ListItemHTMLConverter:Py,ToggleListCommand:Dy,IndentListCommand:Iy};class Oy extends Gd{didMount(){this._recomputeOrder()}getInitialState(){return{options:this.props.options,selectedOptions:this.props.selectedOptions,collapsed:!0}}render(e){let t=this.state.options,r=this.props.maxItems,n=this.state.selectedOptions,s=this.state.collapsed,i=n.length>r?n.length:r,o=e("div").addClass("sc-multi-select"),a=t.map((t,r)=>{if(!s||r<=i-1){let r=e("div").addClass("se-select-option"),s=n.indexOf(t.id)>-1?"selected-option":"unselected-option";return r.append(this.renderIcon(e,s).addClass("se-option-icon"),e("span").addClass("se-option-label").append(t.label)).on("click",this._onToggleCheckbox.bind(this,t.id)),r}return""});o.append(a);let l=e("div").addClass("se-multi-collapse-label");if(t.length>i)if(s){let e=t.length-i;l.append(this.getLabel("expand-options")+" ("+e+")").on("click",this._onToggleExpand)}else l.append(this.getLabel("collapse-options")).on("click",this._onToggleExpand);return o.append(l),o}renderIcon(e,t){return this.context.iconProvider.renderIcon(e,t)}getSelectedOptions(){return this.state.selectedOptions}_recomputeOrder(){let e=this.state.options,t=this.state.selectedOptions,r=Js(e,e=>t.indexOf(e.id),"desc");this.extendState({options:r})}_onToggleCheckbox(e){let t=this.state.selectedOptions,r=t.indexOf(e);r>-1?t.splice(r,1):t.push(e),this.extendState({selectedOptions:t}),this.el.emit("change")}_onToggleExpand(){let e=this.state.collapsed;this._recomputeOrder(),this.extendState({collapsed:!e})}}var ky={name:"multi-select",configure:function(e){e.addComponent("multi-select",Oy),e.addIcon("selected-option",{fontawesome:"fa-check-square-o"}),e.addIcon("unselected-option",{fontawesome:"fa-square-o"}),e.addLabel("expand-options",{en:"Show more",de:"Zeig mehr"}),e.addLabel("collapse-options",{en:"Show less",de:"Zeige weniger"})}};class My extends $f{}My.type="paragraph";class Ly extends mg{render(e){return super.render(e).addClass("sc-paragraph")}getTagName(){return"p"}}var Ry={type:"paragraph",tagName:"p",import:function(e,t,r){let n=e.attr("data-text-align");t.textAlign=n||"left",t.content=r.annotatedText(e,[t.id,"content"])},export:function(e,t,r){"left"!==e.textAlign&&t.attr("data-text-align",e.textAlign),t.append(r.annotatedText([e.id,"content"]))}},qy={name:"paragraph",configure:function(e){e.addNode(My),e.addComponent(My.type,Ly),e.addConverter("html",Ry),e.addConverter("xml",Ry),e.addCommand("paragraph",gg,{spec:{type:"paragraph"},commandGroup:"text-types"}),e.addIcon("paragraph",{fontawesome:"fa-paragraph"}),e.addLabel("paragraph",{en:"Paragraph",de:"Paragraph"}),e.addKeyboardShortcut("CommandOrControl+Alt+0",{command:"paragraph"})},Paragraph:My,ParagraphComponent:Ly,ParagraphHTMLConverter:Ry};class By extends Zf{constructor(){super({name:"save"})}getCommandState(e){return{disabled:!e.editorSession.hasUnsavedChanges(),active:!1}}execute(e){return e.editorSession.save(),{status:"saving-process-started"}}}var Fy={name:"persistence",configure:function(e){e.addCommand("save",By,{commandGroup:"persistence"}),e.addIcon("save",{fontawesome:"fa-save"}),e.addLabel("save",{en:"Save",de:"Speichern"}),e.addKeyboardShortcut("CommandOrControl+S",{command:"save"})},SaveCommand:By};class jy extends Bu{}jy.type="strong",jy.fragmentation=tu.ANY;var Hy={type:"strong",tagName:"strong",matchElement:function(e){return e.is("strong, b")}};class Uy extends eg{getTagName(){return"strong"}}var zy={name:"strong",configure:function(e){e.addNode(jy),e.addConverter("html",Hy),e.addConverter("xml",Hy),e.addComponent("strong",Uy),e.addCommand("strong",Qf,{nodeType:"strong",commandGroup:"annotations"}),e.addIcon("strong",{fontawesome:"fa-bold"}),e.addLabel("strong",{en:"Strong",de:"Fett"}),e.addKeyboardShortcut("CommandOrControl+B",{command:"strong"})},Strong:jy,StrongComponent:Uy,StrongHTMLConverter:Hy};class Vy extends Bu{}Vy.type="subscript",Vy.fragmentation=tu.ANY;var Gy={type:"subscript",tagName:"sub"},Jy={name:"subscript",configure:function(e){e.addNode(Vy),e.addConverter("html",Gy),e.addConverter("xml",Gy),e.addComponent("subscript",eg),e.addCommand("subscript",Qf,{nodeType:"subscript",commandGroup:"annotations"}),e.addIcon("subscript",{fontawesome:"fa-subscript"}),e.addLabel("subscript",{en:"Subscript",de:"Tiefgestellt"})},Subscript:Vy,SubscriptHTMLConverter:Gy};class Ky extends Bu{}Ky.type="superscript",Ky.fragmentation=tu.ANY;var $y={type:"superscript",tagName:"sup"},Xy={name:"superscript",configure:function(e){e.addNode(Ky),e.addConverter("html",$y),e.addConverter("xml",$y),e.addComponent("superscript",eg),e.addCommand("superscript",Qf,{nodeType:"superscript",commandGroup:"annotations"}),e.addIcon("superscript",{fontawesome:"fa-superscript"}),e.addLabel("superscript",{en:"Superscript",de:"Hochgestellt"})},Superscript:Ky,SuperscriptHTMLConverter:$y};const Wy="“",Yy="”";class Zy extends Zf{getCommandState(e,t){return{disabled:!1}}execute(e,t){let r=e.editorSession,n=r.getSelection(),s=r.getDocument();if(n.isPropertySelection()){let e=n.start.getNodeId(),t=s.get(e);if(t.isText()){let e,s=t.getText(),i=n.start.offset;return e=0===i||/\s/.exec(s.slice(i-1,i))?Wy:Yy,r.transaction(t=>{t.insertText(e)}),!0}}return!1}}var Qy={name:"quote-marks",configure:function(e){e.addCommand("insert-quote-marks",Zy,{commandGroup:"text-macros"}),e.addKeyboardShortcut('"',{type:"textinput",command:"insert-quote-marks"})}};class ew extends ef{getRowCount(){return this.cells.length}getColCount(){return this.cells.length>0?this.cells[0].length:0}getCellAt(e,t){let r=this.cells[e][t];if(r)return this.document.get(r)}}ew.schema={type:"table",cells:{type:["array","array","id"],default:[],owned:!0}};class tw extends Kf{}tw.schema={type:"table-cell",rowspan:{type:"number",default:0},colspan:{type:"number",default:0}};class rw extends Gd{render(e){let t=this.props.node,r=e("td").addClass("sc-table-cell");return r.append(e(_g,{path:t.getPath(),disabled:this.props.disabled}).ref("editor")),t.rowspan>0&&r.attr("rowspan",t.rowspan),t.colspan>0&&r.attr("colspan",t.colspan),r}grabFocus(){let e=this.props.node;this.context.editorSession.setSelection({type:"property",path:e.getPath(),startOffset:e.getLength(),surfaceId:this.refs.editor.id})}}rw.prototype._isTableCellComponent=!0;class nw extends Gd{render(e){let t=e("table").addClass("sc-table"),r=this.props.node,n=this.props.node.getDocument(),s=this.props.node.cells,i=r.getRowCount(),o=r.getColCount();for(let r=0;r<i;r++){let i=e("tr");for(let t=0;t<o;t++){let o=s[r][t];if(o){let t=n.get(o),r=e(rw,{node:t,disabled:this.props.disabled}).ref(t.id);i.append(r)}}t.append(i)}return t.on("click",this.onClick),t.on("dblclick",this.onDblClick),t}onClick(e){e.stopPropagation()}onDblClick(e){e.stopPropagation();let t=Gd.unwrap(e.target);if(t){let e;t._isTableCellComponent?e=t:t._isTextPropertyEditor?e=t.getParent():t._isTextPropertyComponent?e=t.getParent().getParent():console.warn("TODO: find the right cell"),e&&e.grabFocus()}}grabFocus(){let e=this.props.node.cells[0][0];if(e){this.refs[e].grabFocus()}}}nw.hasDropzones=!0;var sw={type:"table",tagName:"table",import:function(e,t,r){let n=e.find("tbody").getChildren(),s=0,i=[],o=[];for(let e=0;e<n.length;e++){let t=n[e].getChildren(),a=[];s=Math.max(t.length,s);for(let e=0;e<t.length;e++){let n=t[e];o[e]>1&&(a.push(null),o[e]-=1);let s=r.convertElement(n);a.push(s.id),s.rowspan>1&&(o[e]=s.rowspan),s.colspan>1&&Rg(s.colspan-1,()=>{a.push(null)})}i.push(a)}t.cells=i},export:function(e,t,r){let n=r.$$,s=e.getRowCount(),i=e.getColCount();for(let o=0;o<s;o++){let s=n("tr");for(let t=0;t<i;t++){let n=e.cells[o][t];if(n){let e=r.convertNode(n);s.append(e)}}t.append(s)}return t}},iw={type:"table-cell",tagName:"td",import:function(e,t,r){t.content=r.annotatedText(e,[t.id,"content"]);let n=e.attr("colspan"),s=e.attr("rowspan");n&&(t.colspan=Number(n)),s&&(t.rowspan=Number(s))},export:function(e,t,r){return t.append(r.annotatedText([e.id,"content"])),e.rowspan>0&&t.attr("rowspan",e.rowspan),e.colspan>0&&t.attr("colspan",e.colspan),t}};class ow extends dg{createNodeData(e){let t=e.create({id:d("table-cell"),type:"table-cell",content:"A1"}),r=e.create({id:d("table-cell"),type:"table-cell",content:"B1"}),n=e.create({id:d("table-cell"),type:"table-cell",content:"A2"}),s=e.create({id:d("table-cell"),type:"table-cell",content:"B2"});return{id:d("table"),type:"table",cells:[[t.id,r.id],[n.id,s.id]]}}}var aw={name:"table",configure:function(e){e.addNode(ew),e.addNode(tw),e.addComponent("table",nw),e.addConverter("html",sw),e.addConverter("html",iw),e.addConverter("xml",sw),e.addConverter("xml",iw),e.addCommand("insert-table",ow,{nodeType:"table",commandGroup:"insert"}),e.addIcon("insert-table",{fontawesome:"fa-table"}),e.addLabel("insert-table",{en:"Table",de:"Tabelle"}),e.addLabel("table",{en:"Table",de:"Tabelle"}),e.addLabel("table-cell.content",{en:"Cell",de:"Zelle"})},Table:ew,TableCell:tw};class lw extends Ff{_initialize(){super._initialize(),this.create({type:"@container",id:"body",nodes:[]})}}class cw extends Tf{convertDocument(e){let t=e.find("body");this.convertContainer(t.children,"body")}}var hw={name:"prose-editor",configure:function(e){e.defineSchema({name:"prose-article",DocumentClass:lw,defaultTextType:"paragraph",version:"1.0"}),e.addImporter("html",cw),e.import(O_),e.import(R_),e.import(qy),e.import(ay),e.import(z_),e.import(F_),e.import(K_),e.import(ny,{targetSurfaces:["body"]}),e.import(zy),e.import(Jy),e.import(Xy),e.import(Cy),e.import(Qy),e.import(Ay),e.import(aw),e.addToolPanel("main-overlay",[{name:"prompt",type:"tool-group",commandGroups:["prompt"]}]),e.addToolPanel("workflow",[{name:"workflow",type:"tool-group",commandGroups:["workflows"]}]),e.addToolPanel("toolbar",[{name:"text-types",type:"tool-dropdown",showDisabled:!0,style:"descriptive",commandGroups:["text-types"]},{name:"annotations",type:"tool-group",showDisabled:!0,style:"minimal",commandGroups:["annotations"]},{name:"insert",type:"tool-dropdown",showDisabled:!0,style:"descriptive",commandGroups:["insert"]}])},ProseEditor:class extends yu{render(e){let t=this.componentRegistry.get("split-pane"),r=e("div").addClass("sc-prose-editor"),n=this._renderToolbar(e),s=this._renderEditor(e),i=this.getConfigurator(),o=this.componentRegistry.get("scroll-pane"),a=this.componentRegistry.get("overlay"),l=this.componentRegistry.get("context-menu"),c=this.componentRegistry.get("dropzones"),h=e(o,{name:"contentPanel",contextMenu:this.props.contextMenu||"native",scrollbarPosition:"right",scrollbarType:this.props.scrollbarType}).append(s,e(a,{toolPanel:i.getToolPanel("main-overlay"),theme:"dark"}),e(l),e(c)).ref("contentPanel");return r.append(e(t,{splitType:"horizontal"}).append(n,e(t,{splitType:"horizontal",sizeB:"inherit"}).append(h,e(Gp,{toolPanel:i.getToolPanel("workflow")})))),r}_renderToolbar(e){let t=this.getConfigurator();return e("div").addClass("se-toolbar-wrapper").append(e(Hp,{toolPanel:t.getToolPanel("toolbar")}).ref("toolbar"))}_renderEditor(e){let t=this.getConfigurator();return e(lg,{disabled:this.props.disabled,editorSession:this.editorSession,node:this.doc.get("body"),commands:t.getSurfaceCommandNames()}).ref("body")}},ProseArticle:lw};class dw extends kp{render(e){let t=this.props.node,r=this.getComponent("button"),n=e("div").addClass("sc-correction-tool");return t&&t.suggestions.length>0?t.suggestions.forEach(t=>{n.append(e(r,{label:t,style:this.props.style}).attr("title",this.getLabel("open-link")).attr("data-correction",t).on("click",this._applyCorrection.bind(this,t)))}):n.append(e(r,{label:"No suggestions",style:this.props.style,disabled:!0})),n}_applyCorrection(e){let t=this.context.editorSession,r=this.props.node;t.transaction(t=>{let n=t.getSelection();t.setSelection({type:"property",path:r.start.path,startOffset:r.start.offset,endOffset:r.end.offset,containerPath:n.containerPath}),t.insertText(e)})}}class uw extends Zf{getCommandState(e){let t=e.selectionState.getMarkers();return 0===t.length?{disabled:!0}:(t=t.filter(function(e){return"spell-error"===e.type})).length>0?{disabled:!1,active:!1,mode:null,node:t[0]}:{disabled:!0}}}const pw="http://localhost:4777/api/check";var fw={name:"spell-check",configure:function(e){e.addCommand("correction",uw,{commandGroup:"spell-check"}),e.addTool("correction",dw)},SpellCheckManager:class{constructor(e,t){let r=(t=t||{}).wait||750;this.editorSession=e,this.apiURL=t.apiURL||pw,this.textPropertyManager=e.markersManager,this.markersManager=e.markersManager,this._schedule={},this._scheduleCheck=We(this._runSpellCheck.bind(this),r),e.onFinalize("document",this._onDocumentChange,this)}dispose(){this.editorSession.off(this)}check(e){this._runSpellCheck(v(e))}runGlobalCheck(){Object.keys(this.textPropertyManager._textProperties).forEach(e=>{this._runSpellCheck(e)})}_onDocumentChange(e,t){if(t.spellcheck)return;const r=this.textPropertyManager._textProperties;Object.keys(e.updated).forEach(e=>{r[e]&&this._scheduleCheck(e)})}_runSpellCheck(e){let t=e.split("."),r=this.editorSession.getDocument().get(t),n=this.editorSession.getLanguage();r&&S(r)&&Lg({method:"POST",url:this.apiURL,header:{"Content-Type":"application/json; charset=UTF-8"},data:{text:r,lang:n}}).then(e=>{e=JSON.parse(e),this._addSpellErrors(t,e)}).catch(function(e){console.error(e)})}_addSpellErrors(e,t){const r=this.editorSession,n=r.markersManager,s="spell-error:"+e.join("."),i=t.map(t=>({type:"spell-error",start:{path:e,offset:t.start},end:{offset:t.end},suggestions:t.suggestions}));n.setMarkers(s,i),r.startFlow()}}};const{UndoCommand:gw,RedoCommand:mw,SelectAllCommand:_w}=O_;class yw extends yu{constructor(e,t={}){super(e,function(e){let t=new yp;t.addNode(Kf),t.addCommand("undo",gw),t.addCommand("redo",mw),t.addCommand("select-all",_w),t.addKeyboardShortcut("CommandOrControl+Z",{command:"undo"}),t.addKeyboardShortcut("CommandOrControl+Shift+Z",{command:"redo"}),t.addKeyboardShortcut("CommandOrControl+A",{command:"select-all"}),t.defineSchema({name:"text-input",defaultTextType:"text",ArticleClass:ww}),e.package&&t.import(e.package);let r=t.createArticle();e.content&&r.set(["input","content"],e.content);return{editorSession:new Tp(r,{configurator:t})}}(t)),this.doc=this.editorSession.getDocument()}render(e){let t=e(this._getTagName()).addClass("sc-text-input");return t.append(e(bw,{path:["input","content"]}).ref("input").on("enter",this._onEnter).on("escape",this._onEscape)),t}didMount(){this.refs.input.selectLast()}dispose(){super.dispose(),this.doc.dispose(),this.editorSession.dispose()}shouldRerender(){return!1}getContent(){return this.getDocument().getContent()}_getDocument(){return this.context.editorSession.getDocument()}_getTagName(){return this.props.tagName||"div"}_onEnter(e){e.stopPropagation(),this.el.emit("confirm")}_onEscape(e){e.stopPropagation(),this.el.emit("cancel")}}class ww extends Ff{constructor(...e){super(...e),this.create({type:"text",id:"input",content:""})}getContentNode(){return this.get("input")}getContent(){return this.getContentNode().getText()}}class bw extends _g{onKeyDown(e){let t=!1;27===e.keyCode&&(t=!0,this.el.emit("escape")),t?(e.stopPropagation(),e.preventDefault()):super.onKeyDown(e)}selectLast(){const e=this.getDocument().getContentNode();this.editorSession.setSelection({type:"property",path:e.getPath(),startOffset:e.getLength(),surfaceId:this.id})}selectAll(){const e=this.getDocument().getContentNode();this.editorSession.setSelection({type:"property",path:e.getPath(),startOffset:0,endffset:e.getLength(),surfaceId:this.id})}_handleEnterKey(...e){super._handleEnterKey(...e),this.el.emit("enter")}}var vw={name:"text-input",configure(e){e.addComponent("text-input",yw)},TextInput:yw},Cw={name:"toolbar",configure(e){e.addComponent("toolbar",Hp)},Toolbar:Hp};class Sw extends Zf{getCommandState(e){let t=this._getSelection(e),r=e.editorSession.getSelectionState(),n=e.editorSession.getDocument(),s={disabled:!0};if(t.isPropertySelection()&&!r.isInlineNodeSelection){let e=t.getPath(),r=n.get(e[0]);r&&r.isText()&&r.isBlock()&&(s.nodeId=r.id,s.disabled=!1,r.textAlign===this.config.textAlign&&(s.active=!0),s.showInContext=0===t.start.offset&&0===t.end.offset)}return s}execute(e){let t=e.commandState.nodeId;e.editorSession.transaction(e=>{e.set([t,"textAlign"],this.config.textAlign)})}}var xw={name:"text-align",configure:function(e){e.addCommand("align-left",Sw,{textAlign:"left",commandGroup:"text-align"}),e.addCommand("align-center",Sw,{textAlign:"center",commandGroup:"text-align"}),e.addCommand("align-right",Sw,{textAlign:"right",commandGroup:"text-align"}),e.addKeyboardShortcut("CommandOrControl+Shift+L",{command:"align-left"}),e.addKeyboardShortcut("CommandOrControl+Shift+E",{command:"align-center"}),e.addKeyboardShortcut("CommandOrControl+Shift+R",{command:"align-right"}),e.addIcon("align-left",{fontawesome:"fa-align-left"}),e.addIcon("align-center",{fontawesome:"fa-align-center"}),e.addIcon("align-right",{fontawesome:"fa-align-right"}),e.addLabel("align-left","Left"),e.addLabel("align-center","Center"),e.addLabel("align-right","Right"),e.addLabel("text-align","Text Align")}};e.cssSelect=ml,e.DomUtils=Xa,e.ChangeStore=t,e.CollabServer=class extends f{constructor(e){super(e),this.scope="substance/collab",this.configurator=e.configurator,this.documentEngine=this.configurator.getDocumentEngine(),this.collabEngine=new Fo(this.documentEngine)}_error(e,t,r){console.error(r),t.error({scope:this.scope,type:"error",error:{name:e.message.type+"Error",cause:{name:r.name}},documentId:e.message.documentId}),this.next(e,t)}authenticate(e,t){this.config.authenticate?this.config.authenticate(e,(r,s)=>{if(r)return console.error(r),void this._error(e,t,new n("AuthenticationError",{cause:r}));e.setAuthenticated(s),this.next(e,t)}):super.authenticate.apply(this,arguments)}enhanceRequest(e,t){this.config.enhanceRequest?this.config.enhanceRequest(e,r=>{if(r)return console.error("enhanceRequest returned an error",r),void this._error(e,t,r);e.setEnhanced(),this.next(e,t)}):super.enhanceRequest.apply(this,arguments)}onDisconnect(e){this.collabEngine.getDocumentIds(e).forEach(function(t){this._disconnectDocument(e,t)}.bind(this))}execute(e,t){let r=e.message,n=this[r.type];n?n.call(this,e,t):console.error("Method",r.type,"not implemented for CollabServer")}sync(e,t){let n=e.message;this.collabEngine.sync(n,(s,i)=>{if(s)return void this._error(e,t,s);let o=this.collabEngine.getCollaborators(n.documentId,n.collaboratorId);t.send({scope:this.scope,type:"syncDone",documentId:n.documentId,version:i.version,serverChange:i.serverChange}),r(o,e=>{this.send(e.collaboratorId,{scope:this.scope,type:"update",documentId:n.documentId,version:i.version,change:i.change})}),this.next(e,t)})}disconnect(e,t){let r=e.message,n=r.collaboratorId,s=r.documentId;this._disconnectDocument(n,s),t.send({scope:this.scope,type:"disconnectDone",documentId:r.documentId}),this.next(e,t)}_disconnectDocument(e,t){this.collabEngine.disconnect({documentId:t,collaboratorId:e})}},e.DocumentClient=class{constructor(e){this.config=e}createDocument(e,t){jo("POST",this.config.httpUrl,e,t)}getDocument(e,t){jo("GET",this.config.httpUrl+e,null,t)}deleteDocument(e,t){jo("DELETE",this.config.httpUrl+e,null,t)}},e.ServerRequest=u,e.WebSocketConnection=class extends Ho{_createWebSocket(){return new window.WebSocket(this.config.wsUrl)}},e.ClientConnection=Ho,e.CollabServerConfigurator=class{constructor(){this.config={heartbeat:3e4,documentStore:void 0,changeStore:void 0,snapshotStore:void 0}}setHost(e){this.config.host=e}setPort(e){this.config.port=e}setDocumentStore(e){this.config.documentStore=e}setChangeStore(e){this.config.changeStore=e}setSnapshotStore(e){this.config.snapshotStore=e}getHost(){return this.config.host}getPort(){return this.config.port}getDocumentStore(){return this.config.documentStore}getChangeStore(){return this.config.changeStore}getSnapshotStore(){return this.config.snapshotStore}getDocumentEngine(){return this.documentEngine||(this.documentEngine=new Go({documentStore:this.config.documentStore,changeStore:this.config.changeStore,snapshotStore:this.config.snapshotStore})),this.documentEngine}import(e,t){return e.configure(this,t||{}),this}},e.DocumentEngine=Go,e.ServerResponse=p,e.computeSnapshot=Uo,e.CollabClient=class extends l{constructor(e){super(),this.config=e,this.connection=e.connection,this.scope="substance/collab",this._onMessage=this._onMessage.bind(this),this._onConnectionOpen=this._onConnectionOpen.bind(this),this._onConnectionClose=this._onConnectionClose.bind(this),this.connection.on("open",this._onConnectionOpen),this.connection.on("close",this._onConnectionClose),this.connection.on("message",this._onMessage)}_onConnectionClose(){this.emit("disconnected")}_onConnectionOpen(){this.emit("connected")}_onMessage(e){e.scope===this.scope?this.emit("message",e):"_internal"!==e.scope&&console.info("Message ignored. Not sent in hub scope",e)}send(e){this.connection.isOpen()?(e.scope=this.scope,this.config.enhanceMessage&&(e=this.config.enhanceMessage(e)),this.connection.send(e)):console.warn("Message could not be sent. Connection not open.",e)}isConnected(){return this.connection.isOpen()}dispose(){this.connection.off(this)}},e.CollabServerPackage=Ko,e.DocumentServer=class{constructor(e){this.configurator=e.configurator,this.engine=this.configurator.getDocumentEngine(),this.path="/api/documents"}bind(e){e.post(this.path,this._createDocument.bind(this)),e.get(this.path+"/:id",this._getDocument.bind(this)),e.delete(this.path+"/:id",this._deleteDocument.bind(this))}_createDocument(e,t,r){const{documentId:n,change:s}=e.body;this.engine.createDocument(n,s,function(e,n){if(e)return r(e);t.json(n)})}_getDocument(e,t,r){const n=e.params.id;this.engine.getDocument(n,function(e,n,s){if(e)return r(e);t.json({data:n,version:s})})}_deleteDocument(e,t,r){let n=e.params.id;this.engine.deleteDocument(n,function(e,n){if(e)return r(e);t.json(n)})}},e.SnapshotEngine=Vo,e.CollabEngine=Fo,e.CollabSession=class extends Tp{constructor(e,t){if(super(e,t),t=t||{},this.config=t,this.collabClient=t.collabClient,t.docVersion&&console.warn("config.docVersion is deprecated: Use config.version instead"),t.docVersion&&console.warn("config.docId is deprecated: Use config.documentId instead"),this.version=t.version,this.documentId=t.documentId||t.docId,void 0!==t.autoSync?this.autoSync=t.autoSync:this.autoSync=!0,!this.documentId)throw new n("InvalidArgumentsError",{message:"documentId is mandatory"});if(void 0===this.version)throw new n("InvalidArgumentsError",{message:"version is mandatory"});this._connected=!1,this._nextChange=null,this._pendingChange=null,this._pendingSync=!1,this._error=null,this.onUpdate("document",this.afterDocumentChange,this),this.collabClient.on("connected",this.onCollabClientConnected,this),this.collabClient.on("disconnected",this.onCollabClientDisconnected,this),this.collabClient.on("message",this._onMessage.bind(this)),this.collabClient.isConnected()&&this.autoSync&&this.sync()}dispose(){this.disconnect(),this.collabClient.off(this)}disconnect(){let e={type:"disconnect",documentId:this.documentId};this._abortSync(),this._send(e)}sync(){if(this.__canSync()){let e=this._nextChange,t={type:"sync",documentId:this.documentId,version:this.version,change:e?this.serializeChange(e):void 0};this._send(t),this._pendingSync=!0,this._pendingChange=e,this.emit("sync"),this._nextChange=null,this._error=null}else console.error("Can not sync. Either collabClient is not connected or already syncing")}getCollaborators(){return this.collaborators}isConnected(){return this._connected}serializeChange(e){return e.toJSON()}deserializeChange(e){return Oo.fromJSON(e)}_onMessage(e){if(e.documentId!==this.documentId)return!1;switch((e=b(e)).type){case"syncDone":this.syncDone(e);break;case"syncError":this.syncError(e);break;case"update":this.update(e);break;case"disconnectDone":this.disconnectDone(e);break;case"error":this.error(e);break;default:return console.error("CollabSession: unsupported message",e.type,e),!1}return!0}_send(e){return this.collabClient.isConnected()?(this.collabClient.send(e),!0):(console.warn("Try not to call _send when disconnected. Skipping message",e),!1)}update(e){let t=e.change,r=e.version;this._nextChange||this._pendingSync?console.info("skipped remote update. Pending sync or local changes."):(t&&(t=this.deserializeChange(t),this._applyRemoteChange(t)),r&&(this.version=r),this.startFlow())}syncDone(e){let t=e.serverChange,r=e.version;t&&(t=this.deserializeChange(t),this._applyRemoteChange(t)),this.version=r,this._pendingChange=null,this._pendingSync=!1,this._error=null,this._connected=!0,this.startFlow(),this.emit("connected"),this._requestSync()}syncError(e){console.info("SyncError occured. Aborting sync",e),this._abortSync()}disconnectDone(){this._afterDisconnected()}error(e){let t=e.error,r=this[t.name],s=n.fromJSON(t);if(!r)return t("CollabSession: unsupported error",t.name),!1;this.emit("error",s),(r=r.bind(this))(s)}afterDocumentChange(e,t){t.remote||this._recordChange(e)}onCollabClientConnected(){this.autoSync&&this.sync()}onCollabClientDisconnected(){this._abortSync(),this._connected&&this._afterDisconnected()}_commit(e,t){this._commitChange(e,t),this.startFlow()}_applyRemoteChange(e){e.ops.length>0&&(this._transaction.__applyChange__(e),this.getDocument()._apply(e),this._setDirty("document"),this._transformLocalChangeHistory(e),this._setSelection(this._transformSelection(e)),this._change=e,this._info={remote:!0},this.startFlow())}_recordChange(e){this._nextChange?(this._nextChange.ops=this._nextChange.ops.concat(e.ops),this._nextChange.after=e.after):this._nextChange=e,this._requestSync()}__canSync(){return this.collabClient.isConnected()&&!this._pendingSync}_requestSync(){this._nextChange&&this.__canSync()&&this.sync()}_abortSync(){let e=this._nextChange;this._pendingChange&&(e=this._pendingChange,this._nextChange&&(e.ops=e.ops.concat(this._nextChange.ops),e.after=this._nextChange.after),this._pendingChange=null),this._pendingSync=!1,this._error=null,this._nextChange=e}_afterDisconnected(){this._connected=!1,this.emit("disconnected")}_hasLocalChanges(){return this._nextChange&&this._nextChange.ops.length>0}},e.Server=f,e.SnapshotStore=Jo,e.DOMElement=Qo,e.DOMEventListener=Yo,e.DefaultDOMElement=Xh,e.BrowserDOMElement=oa,e.MemoryDOMElement=Mh,e.domHelpers=Kp,e.documentHelpers=Ao,e.operationHelpers=Bo,e.selectionHelpers=eo,e.AbstractEditorSession=class extends l{constructor(e,t,r){super();const n=t.getDocument();this._id=e,this._document=n,this._documentSession=t,this._history=r||new $p(t),this._stage=new Xp(t),this._initialize()}_initialize(){}dispose(){}canUndo(){return this._history.canUndo()}canRedo(){return this._history.canRedo()}getDocument(){return this._document}getFocusedSurface(){}getSurface(e){}getSelection(){return this._getSelection()}setSelection(e){if(e||(e=Ii.nullSelection),e&&C(e)&&(e=this.getDocument().createSelection(e)),e&&!e.isNull()&&!e.surfaceId){let t=this.getFocusedSurface();t&&(e.surfaceId=t.id)}return e.isCustomSelection()||(e.surfaceId||function(e,t){if(e&&!e.isNull()&&!e.surfaceId){let r=t.getFocusedSurface();r&&(e.surfaceId=r.id)}}(e,this),e.containerPath||function(e,t){if(e&&!e.isNull()&&e.surfaceId&&!e.containerPath){let r=t.getSurface(e.surfaceId);if(r){let t=r.getContainerPath();t&&(e.containerPath=t)}}}(e,this)),this._setSelection(this._normalizeSelection(e)),e}transaction(e,t={}){const r=this._stage;let n={selection:this._getSelection()},s=r._transaction(e,t,n);if(s){let e=s.after.selection;this._setSelection(this._normalizeSelection(e)),this._commit(s,t)}return s}undo(){let e=this._history.undo();e&&this._setSelection(this._normalizeSelection(e.after.selection))}updateNodeStates(e,t={}){this._documentSession.updateNodeStates(e,t)}redo(){let e=this._history.redo();e&&this._setSelection(this._normalizeSelection(e.after.selection))}resetHistory(){this._history.reset()}_commit(e,t){this._history.commit(e,t)}_normalizeSelection(e){const t=this.getDocument();return e?e.attach(t):e=Ii.nullSelection,e}_getSelection(){}_setSelection(e){}_transformSelection(e){return Mo(this.getSelection(),e)}},e.annotationHelpers=to,e.AnnotationIndex=Qp,e.AnnotationMixin=qu,e.ArrayOperation=ri,e.BlockNode=ef,e.ChangeHistoryView=$p,e.ChangeRecorder=df,e.ClipboardExporter=yf,e.ClipboardImporter=Df,e.Conflict=$s,e.Container=Ru,e.ContainerAdapter=class extends Ru{constructor(e,t){super(e,{id:v(t)}),this.document=e,this.path=t,e.data.nodes[this.id]=this}getContentPath(){return this.path}get nodes(){return this.document.get(this.path)}get _isDocumentNode(){return!1}get _isContainer(){return!1}},e.ContainerAnnotation=Fu,e.ContainerAnnotationIndex=If,e.ContainerMixin=Lu,e.ContainerSelection=Bi,e.Coordinate=ki,e.CoordinateAdapter=class extends ki{constructor(e,t,r){super("SKIP"),this._owner=e,this._pathProp=t,this._offsetProp=r,Object.freeze(this)}equals(e){return e===this||Oi(e.path,this.path)&&e.offset===this.offset}get path(){return this._owner[this._pathProp]}set path(e){this._owner[this._pathProp]=e}get offset(){return this._owner[this._offsetProp]}set offset(e){this._owner[this._offsetProp]=e}toJSON(){return{path:this.path,offset:this.offset}}toString(){return"("+this.path.join(".")+", "+this.offset+")"}},e.CoordinateOperation=oi,e.copySelection=tf,e.createDocumentFactory=function(e,t){return{ArticleClass:e,createEmptyArticle:function(){return new e},createArticle:function(){const r=new e;return t(r),r},createChangeset:function(){const r=new e,n=new df(r);return t(n),[n.generateChange().toJSON()]}}},e.CustomSelection=Hi,e.Data=Af,e.DefaultChangeCompressor=class{shouldMerge(e,t){return!1}merge(e,t){var r=e.ops[0],n=t.ops[0],s=r.diff,i=n.diff,o=!1;return s.isInsert()?s.pos+s.getLength()===i.pos&&((o=r.toJSON()).diff.str+=i.str):s.isDelete()&&(s.pos===i.pos?(o=r.toJSON()).diff.str+=i.str:i.pos+i.getLength()===s.pos&&((o=r.toJSON()).diff=i,o.diff.str+=s.str)),!!o&&(e.ops[0]=ui.fromJSON(o),e.ops.length>1&&(e.ops=e.ops.concat(t.ops.slice(1)),e.after=t.after),!0)}},e.DefaultFileProxy=kf,e.Document=Ff,e.DocumentChange=Oo,e.DocumentIndex=so,e.DocumentNode=Mu,e.DocumentNodeFactory=Rf,e.DocumentSchema=ju,e.DocumentSession=class extends l{constructor(e){super(),this._document=e,this._history=[],e.on("document:changed",this._onDocumentChange,this)}dispose(){this._document.off(this)}getDocument(){return this._document}updateNodeStates(e,t={}){const r=this._document;let n=new Oo([],{},{}),s={action:"node-state-update"};n._extractInformation(),n.info=s;for(let[t,s]of e){let e=r.get(t);e&&(e.state||(e.state={}),Object.assign(e.state,s),n.updated[t]=!0)}t.silent||(r._notifyChangeListeners(n,s),this.emit("change",n,s))}revert(e){let t=this._history[e];if(!t)throw new Error("Illegal change index");const r=this.getDocument();let n=r.invert(t),s=this._history.slice(e+1),i=r.rebase(n,s);return this._applyChange(i,{replay:"true"}),i}_commitChange(e,t){e.timestamp=Date.now(),this._applyChange(e,t)}_applyChange(e,t){if(!e)throw new Error("Invalid change");const r=this.getDocument();r._apply(e),r._notifyChangeListeners(e,t),this.emit("change",e,t)}_onDocumentChange(e){e&&e.ops.length>0&&this._history.push(e)}},e.DOMExporter=pf,e.DOMImporter=Nf,e.Editing=cf,e.EditingInterface=hf,e.FileNode=jf,e.FileProxy=Of,e.Fragmenter=tu,e.getChangeFromDocument=function(e){return new df(e).generateChange()},e.HTMLExporter=ff,e.HTMLImporter=Tf,e.importNodeIntoDocument=function(e,t){let r=rf(t.getDocument(),e,t.id,{});return e.get(r)},e.IncrementalData=Lf,e.InlineNode=class extends(qu(Mu)){static isInlineNode(){return!0}},e.JSONConverter=_f,e.ListMixin=Uf,e.Marker=pp,e.Node=Nu,e.NodeIndex=no,e.NodeProperty=Su,e.NodeRegistry=Cu,e.NodeSelection=ji,e.ObjectOperation=ui,e.OperationSerializer=Ti,e.ParentNodeHook=qf,e.paste=sf,e.PropertyAnnotation=Bu,e.PropertyIndex=Mf,e.PropertySelection=Mi,e.Range=Yd,e.Schema=Au,e.Selection=Ii,e.TextBlock=$f,e.TextNode=Kf,e.TextNodeMixin=Jf,e.TextOperation=Ys,e.Transaction=Ep,e.XMLExporter=class extends pf{constructor(e,t){super(function(e){if(!(e=Object.assign({idAttribute:"id"},e)).elementFactory){let t={version:e.xmlVersion||"1.0",encoding:e.xmlEncoding||"UTF-8"};e.elementFactory=Xh.createDocument("xml",t)}return e}(e),t)}getDefaultBlockConverter(){return Wf}getDefaultPropertyAnnotationConverter(){return Xf}},e.XMLImporter=class extends Nf{constructor(e,t){super(Object.assign({idAttribute:"id"},e),t)}importDocument(e){this.reset();let t=Xh.parseXML(e);return this.convertDocument(t),this.state.doc}convertDocument(e){let t=e.children[0];if(!t)throw new Error("XML Root node could not be found.");this.convertElement(t)}},e.STRING={type:"string",default:""},e.TEXT=zf,e.PLAIN_TEXT=Vf,e.STRING_ARRAY={type:["array","string"],default:[]},e.BOOLEAN={type:"boolean",default:!1},e.ENUM=function(e,t={}){let r={type:"enum",values:e};return Object.assign(r,t),r},e.MANY=function(...e){return{type:["array","id"],targetTypes:e=ao(e),default:[]}},e.ONE=function(...e){return{type:"id",targetTypes:e=ao(e),default:null}},e.CHILDREN=Gf,e.CHILD=function(...e){return{type:"id",targetTypes:e=ao(e),owned:!0}},e.CONTAINER=function(e){let t,r;if(S(e)?(t=[e],r=e):({nodeTypes:t,defaultTextType:r}=e),!t)throw new Error("CONTAINER({ nodeTypes: [...] }) is mandatory.");if(!r)throw new Error("CONTAINER({ defaultTextType: [...] }) is mandatory.");let n=Gf(...t);return n.defaultTextType=r,n._isContainer=!0,n},e.OPTIONAL=function(e){return e.optional=!0,e},e.AbstractClipboard=Yf,e.AbstractIsolatedNodeComponent=cu,e.AbstractScrollPane=Fp,e.AbstractGlobalEventHandler=np,e.AbstractKeyboardManager=ap,e.AnnotatedTextComponent=su,e.AnnotationCommand=Qf,e.AnnotationComponent=eg,e.BlockNodeComponent=class extends tg{},e.Button=rg,e.Clipboard=ng,e.Command=Zf,e.Component=Gd,e.ComponentRegistry=Hu,e.ContainerEditor=lg,e.CustomSurface=class extends Gd{constructor(...e){super(...e),this._name=this._getCustomResourceId(),this._surfaceId=this._createSurfaceId()}getChildContext(){return{surface:this,parentSurfaceId:this.getId()}}didMount(){this._getSurfaceManager().registerSurface(this)}dispose(){this._getSurfaceManager().unregisterSurface(this)}rerenderDOMSelection(){}get name(){return this._name}getId(){return this._surfaceId}getSurfaceId(){return this.getId()}getContainer(){}getContainerId(){}isContainerEditor(){return!1}isCustomEditor(){return!0}isDisabled(){return Boolean(this.props.disabled)}_focus(){}_createSurfaceId(){let e=this.context.isolatedNodeComponent;return e?e.context.surface.id+"/"+e.props.node.id+"/"+this._name:this._name}_getCustomResourceId(){throw new Error("This method needs to be implemented by a CustomSurface")}_getSurfaceManager(){return this.context.surfaceManager}},e.DefaultLabelProvider=Vu,e.DOMSelection=gu,e.DragAndDropHandler=Xu,e.EditAnnotationCommand=hg,e.EditInlineNodeCommand=cg,e.FontAwesomeIcon=Uu,e.FontAwesomeIconProvider=zu,e.HandlerParams=op,e.Highlights=class extends l{constructor(e){super(),this.doc=e,this._highlights={}}get(){return this._highlights}set(e){let t=this._highlights,n=this.doc;r(e,function(e,s){let i=t[s]||[],o=Us(i,e),a=Us(e,i);r(o,function(e){let t=n.get(e);t&&(t.setHighlighted?t.setHighlighted(!1,s):console.warn("setHighlighted is not defined on target node"))}),r(a,function(e){let t=n.get(e);t&&(t.setHighlighted?t.setHighlighted(!0,s):console.warn("setHighlighted is not defined on target node"))})}),this._highlights=e,this.emit("highlights:updated",e)}},e.InsertInlineNodeCommand=class extends Zf{getCommandState(e,t){let r=e.selection;return{disabled:this.isDisabled(e,t),active:!1,showInContext:this.showInContext(r,e,t)}}showInContext(e,t){return!e.isCollapsed()}isDisabled(e,t){const r=this.getEditorSession(e,t);let n=r.getSelection(),s=r.getSelectionState();return!n.isPropertySelection()||!!s.isInlineNodeSelection}isAnnotationCommand(){return!0}execute(e,t){let r=e.commandState,n=e.editorSession;r.disabled||n.transaction(r=>{let n=this.createNodeData(r,e,t);r.insertInlineNode(n)})}createNodeData(e,t,r){throw new Error("This method is abstract")}},e.InsertNodeCommand=dg,e.IsolatedNodeComponent=uu,e.IsolatedInlineNodeComponent=ug,e.NodeComponent=tg,e.RenderingEngine=ad,e.Router=fg,e.SelectionFragmentComponent=iu,e.Surface=ag,e.SwitchTextTypeCommand=gg,e.TextBlockComponent=mg,e.TextPropertyComponent=ou,e.TextPropertyEditor=_g,e.Tooltip=Op,e.UnsupportedNodeComponent=ig,e.VirtualElement=td,e.SplitPane=yg,e.UndoCommand=wg,e.RedoCommand=bg,e.SelectAllCommand=vg,e.InlineNodeComponent=ug,e.findParentComponent=function(e){for(;e;){const t=Gd.unwrap(e);if(t)return t;e=e.parentNode}},e.async=Cg,e.tableHelpers=Dg,e.ArrayIterator=Xo,e.ArrayTree=up,e.array2table=Ig,e.camelCase=qe,e.capitalize=ue,e.clone=_,e.cloneDeep=b,e.createCountingIdGenerator=wf,e.debounce=We,e.deleteFromArray=Qh,e.diff=function(e,t,r){if(!S(e)||!S(t))throw new Error("Illegal arguments.");r=r||0;let n=[];(e||t)&&(!e&&t?n.push({type:"insert",start:r,text:t}):e&&!t?n.push({type:"delete",start:r,end:r+e.length}):n=function(e,t,r,n){let s,i=t.length,o=e.length,a=[];for(;i>0&&o>0;)l();return c(),a;function l(){let e=r[i][o],n=i-1,a=o-1;r[n][a]<e?(s&&"replace"===s.type?(s.start--,s.text.unshift(t.charAt(n))):(c(),s={type:"replace",start:a,end:o,text:[t.charAt(n)]}),i--,o--):r[n][o]<e?(s&&"insert"===s.type?(s.start--,s.text.unshift(t.charAt(n))):(c(),s={type:"insert",start:a,text:[t.charAt(n)]}),i--):r[i][a]<e?(s&&"delete"===s.type?s.start--:(c(),s={type:"delete",start:a,end:o}),o--):(c(),i--,o--)}function c(){if(s){switch(s.type){case"insert":s.start+=n,s.text=s.text.join("");break;case"delete":s.start+=n,s.end+=n;break;case"replace":s.start+=n,s.end+=n,s.text=s.text.join("");break;default:throw new Error("Invalid state")}a.push(s),s=null}}}(e,t,Ag(e,t),r));return n},e.encodeXMLEntities=uf,e.EventEmitter=l,e.extend=$o,e.Factory=class extends bu{create(e){var t=this.get(e);if(!t)throw new Error("No class registered by that name: "+e);var r=Array.prototype.slice.call(arguments,1),n=Object.create(t.prototype);return t.apply(n,r),n}},e.filter=oo,e.find=jn,e.findIndex=Wo,e.flatten=ao,e.flattenOften=lo,e.forEach=r,e.getKeyForPath=v,e.getRangeFromMatrix=function(e,t,r,n,s,i){if(!i){if(t===n&&r===s){let t=e[r];return t?t[s]:void 0}if(t===n){let n=e[t];return n?n.slice(r,s+1):[]}if(r===s){let s=[];for(let i=t;i<=n;i++){let t=e[i];t&&s.push(t[r])}return s}}let o=[];for(var a=t;a<n+1;a++){let t=e[a];t&&o.push(t.slice(r,s+1))}return o},e.getRelativeBoundingRect=vp,e.getRelativeMouseBounds=Bp,e.inBrowser=ha,e.includes=function(e,t){return!!e&&e.indexOf(t)>=0},e.isArray=m,e.isArrayEqual=Oi,e.isBoolean=ed,e.isEqual=E,e.isFunction=io,e.isMatch=Hn,e.isNil=N,e.isNumber=x,e.isObject=s,e.isPlainObject=C,e.isString=S,e.keys=lu,e.last=Di,e.levenshtein=Ag,e.makeMap=Ig,e.map=g,e.merge=function(e,t,r){var n=null;return"replace"===(r=r||{}).array?n=kg:"concat"===r.array&&(n=Og),n?Ts(e,t,n):Ns(e,t)},e.parseKeyCombo=lp,e.parseKeyEvent=ip,e.PathObject=Ks,e.percentage=function(e){return String(Math.floor(100*e*100)/100)+" %"},e.pick=ks,e.platform=y,e.pluck=function(e,t){return g(e,function(e){return e[t]})},e.printStacktrace=function(){try{throw new Error}catch(e){console.error(e.stack)}},e.request=jo,e.renderListNode=Mg,e.sendRequest=Lg,e.startsWith=sg,e.SubstanceError=n,e.substanceGlobals=Zh,e.times=Rg,e.toUnixLineEndings=function(e){return e.replace(/\r?\n/g,"\n")},e.TreeIndex=Yp,e.uniq=function(e){return e&&e.length?function(e,t,r){var n=-1,s=Rs,i=e.length,o=!0,a=[],l=a;if(r)o=!1,s=qs;else if(i>=Fs){var c=t?null:Bs(e);if(c)return tr(c);o=!1,s=Xt,l=new Kt}else l=t?[]:a;e:for(;++n<i;){var h=e[n],d=t?t(h):h;if(h=r||0!==h?h:0,o&&d==d){for(var u=l.length;u--;)if(l[u]===d)continue e;t&&l.push(d),a.push(h)}else s(l,d,r)||(l!==a&&l.push(d),a.push(h))}return a}(e):[]},e.uuid=d,e.without=Us,e.orderBy=Js,e.getDOMRangeFromEvent=Gu,e.getRelativeRect=Ju,e.getSelectionRect=Ku,e.isMouseInsideDOMSelection=$u,e.getQueryStringParam=function(e,t){if("undefined"==typeof window)return null;let r=t||window.location.href,n=new RegExp("[?&]"+e+"=([^&#]*)","i").exec(r);return n?decodeURIComponent(n[1]):null},e.setDOMSelection=function(e,t,r,n){let s=window.getSelection(),i=window.document.createRange();e._isDOMElement&&(e=e.getNativeElement()),r||(r=e,n=t),r._isDOMElement&&(r=r.getNativeElement()),i.setStart(e,t),i.setEnd(r,n),s.removeAllRanges(),s.addRange(i)},e._analyzeElementSchemas=dm,e.checkSchema=function(e){const t=e.getTagNames();let r=[];for(let n=0;n<t.length;n++){const s=t[n],i=e.getElementSchema(s);switch(i.type){case"text":r=r.concat(um(i));break;case"element":case"container":r=r.concat(pm(i));break;case"hybrid":r=r.concat(fm(i));break;case"annotation":r=r.concat(gm(i));break;case"inline-element":r=r.concat(mm(i));break;case"anchor":r=r.concat(_m(i));break;case"external":case"not-implemented":break;default:throw new Error("Unsupported element classification.")}}return r},e.compileRNG=function(e,t,r){let n,s=(n=1===arguments.length&&S(arguments[0])?Xh.parseXML(arguments[0]):Dm(e,t,r)).find("grammar");if(!s)throw new Error("<grammar> not found.");return function(e){let t={};e.children.forEach(e=>{const r=Cm(e.tagName);"define"===r&&function(e,t){const r=e.attr("name");"interleave"===e.attr("combine")?t[r]?t[r].append(e.children):t[r]=e:(t[r],t[r]=e)}(e,t)}),e.defs=t}(s),function(e){const t={};e.children.filter(e=>"element"===e.tagName).forEach(r=>{const n=r.attr("name"),s=function e(t,r,n={}){if(!t)return{};let s=t.children;for(let t=0;t<s.length;t++){const i=s[t];switch(i.tagName){case"attribute":{const e=qm(i);n[e.name]=e;break}case"group":case"choice":case"optional":case"oneOrMore":case"zeroOrMore":e(i,r,n)}}return n}(r.find("attributes")),i=r.find("children"),o=r.attr("type");let a=Om(i,e),l=Zg(n,a),c={name:n,type:o,attributes:s,expr:l};t[n]=c}),dm(t);const r=e.find("start");if(!r)throw new Error("<start> is mandatory");const n=r.attr("name");if(!n)throw new Error('<start> must have "name" set');return new xm(t,n)}(function(e){const t=e.createElement.bind(e);e.findAll("removed").forEach(t=>{let r=t.attr("name");e.findAll(`element[name="${r}"]`).forEach(e=>{e.remove()}),e.findAll(`ref[name="${r}"]`).forEach(e=>{e.remove()})});const r={},n=e.defs,s=e.findAll("define > element"),i=Xh.createDocument("xml"),o=i.createElement("grammar"),a=e.findAll("not-implemented").reduce((e,t)=>{let r=t.attr("name");return r&&e.add(r),e},new Set);s.forEach(e=>{const s=e.attr("name");if(!s)throw new Error("'name' is mandatory.");let l;l=a.has(s)?t("element").attr("name",s).attr("type","not-implemented"):function(e,t,r,n){let s=e.createElement("element").attr("name",t);s.attr("type","implicit");let i=e.createElement("attributes"),o=e.createElement("children");for(r.children.forEach(t=>{let r=Am(e,t,n,{});r.forEach(e=>{e.find("attribute")||e.is("attribute")?i.appendChild(e):o.appendChild(e)})}),s.appendChild(i),s.appendChild(o);;){let e=o.find("choice > choice");if(!e)break;{let t=e.parentNode,r=e.children;r.forEach(r=>{t.insertBefore(r,e)}),t.removeChild(e)}}let a=o.findAll("choice");for(let e=0;e<a.length;e++){let t=a[e],r=t.children;1===r.length&&t.parentNode.replaceChild(t,r[0])}let l=o.findAll("optional > text, zeroOrMore > text");for(let e=0;e<l.length;e++){let t=l[e],r=t.parentNode;1===r.getChildCount()&&r.parentNode.replaceChild(r,t)}let c=o.findAll("optional, zeroOrMore, oneOrMore");for(let e=0;e<c.length;e++){let t=c[e];0===t.getChildCount()&&t.remove()}return s}(i,s,e,n),r[s]=l,o.appendChild(l)}),e.findAll("elementType").forEach(e=>{const t=e.attr("name");let n=e.attr("s:type")||e.attr("type");if(!t||!n)throw new Error("Attributes name and type are mandatory.");const s=r[t];if(!s)throw new Error(`Unknown element ${t}.`);s.attr("type",n)});const l=function(e){const t=e.find("start");if(!t)throw new Error("<grammar> must have a <start> element");const r=t.find("ref");if(!r)throw new Error("Expecting one <ref> inside of <start>.");return r.attr("name")}(e);if(!l)throw new Error("<start> is mandatory.");return o.appendChild(i.createElement("start").attr("name",l)),o}(s))},e.cssSelectAdapter=Bm,e.loadRNG=Dm,e.prettyPrintXML=function(e){let t;const r=[];let n=(t=S(e)?Xh.parseXML(e):e).getChildNodes();if(t.isDocumentNode()){let e=t.empty().serialize();/<\?\s*xml/.exec(e)&&r.push(e)}return n.forEach(e=>{!function e(t,r,n){let s=new Array(2*n).fill(" ").join("");if(r.isElementNode()){const i=function(e){const t=e.childNodes;for(let e=0;e<t.length;e++){let r=t[e];if(r.isTextNode()&&!Jg(r))return!0}}(r),o=function(e){const t=e.childNodes;for(let e=0;e<t.length;e++){let r=t[e];if("cdata"===r.getNodeType())return!0}}(r);if(i||o)t.push(s+r.outerHTML);else{let i=r.children;const o=r.tagName;let a=[`<${o}`];r.getAttributes().forEach((e,t)=>{a.push(`${t}="${e}"`)}),i.length>0?(t.push(s+a.join(" ")+">"),r.children.forEach(r=>{e(t,r,n+1)}),t.push(s+`</${o}>`)):t.push(s+a.join(" ")+" />")}}else 0===n&&r.isTextNode()||t.push(s+r.outerHTML)}(r,e,0)}),r.join("\n")},e.registerSchema=function(e,t,n,s={}){const i=t.getName();let o;t.getDefaultTextType&&(o=t.getDefaultTextType()),e.defineSchema({name:i,version:t.getVersion(),defaultTextType:o,DocumentClass:n,xmlSchema:t}),t.getTagNames().forEach(n=>{const o=t.getElementSchema(n),a=o.name;let l,c;switch(o.type){case"element":l=Qm,c=e_;break;case"hybrid":throw new Error("Mixed element types are not supported yet.");case"text":l=Xm,c=Zm;break;case"annotation":l=t_,c=Ym;break;case"anchor":l=r_,c=Ym;break;case"inline-element":l=n_,c=e_;break;case"external":case"not-implemented":l=s_,c=i_;break;case"container":l=o_,c=e_;break;default:throw new Error("Illegal state")}class h extends l{}h.type=a,r(o.attributes,(e,t)=>{!function(e,t){let r=t.replace(":","_");r=qe(r),h_.indexOf(r)>=0||Object.defineProperty(e.prototype,r,{get(){return this.getAttribute(t)},set(e){return this.setAttribute(t,e),this}})}(h,t)}),e.addNode(h);let d=new c(a);e.addConverter(i,d);let u=s.ImporterClass||c_;e.addImporter(i,u)})},e.SchemaDrivenCommandManager=class extends vu{_initialize(){const e=new Map,t=new Map,r=new Map,n=new Map;this.commands.forEach(s=>{const i=s.getName();s.isAnnotationCommand()?e.set(i,s):s.isInsertCommand()?t.set(i,s):s.isSwitchTypeCommand()?r.set(i,s):n.set(i,s)}),this.annotationCommands=e,this.insertCommands=t,this.switchTypeCommands=r,this.otherCommands=n}_getCommand(e){return this.annotationCommands.get(e)||this.insertCommands.get(e)||this.switchTypeCommands.get(e)||this.otherCommands.get(e)}_updateCommandStates(e){const t={},r=this.annotationCommands,n=this.insertCommands,s=this.switchTypeCommands,i=this._getCommandContext(),o=this._getCommandParams(),a=e.getDocument(),l=o.selectionState,c=o.selection,h=o.editorSession.isBlurred(),d=!c||c.isNull()||!c.isAttached();if(h||d||c.isCustomSelection())u(r),u(n),u(s);else{const e=c.start.path,t=a.get(e[0]);if(!t)throw new Error("FIXME: explain when this happens");const r=t.isText(),n=a.getXMLSchema();if(r&&c.isPropertySelection()&&!l.isInlineNodeSelection()){const e=n.getElementSchema(t.type);p(this.annotationCommands,e)}else u(this.annotationCommands);let s=t.parentNode;if(s&&s.isContainer()){const e=n.getElementSchema(s.type);p(this.insertCommands,e)}else u(this.insertCommands);if(s&&c.containerPath&&r&&s.isContainer()){const e=n.getElementSchema(s.type);p(this.switchTypeCommands,e)}else u(this.switchTypeCommands)}function u(e){e.forEach((e,r)=>{t[r]=d_})}function p(e,r){e.forEach((e,n)=>{const s=e.getType();r.isAllowed(s)?t[n]=e.getCommandState(o,i):t[n]=d_})}this.otherCommands.forEach((e,r)=>{t[r]=e.getCommandState(o,i)}),e.setCommandStates(t)}},e.validateXMLSchema=function(e,t){let r=t.find(e.getStartElement());return r?function(e,t){let r=[],n=!0,s=[t];for(;s.length>0;){let t=s.shift(),i=e.validateElement(t);i.ok||(r=r.concat(i.errors),n=!1),t.isElementNode()&&(s=s.concat(t.getChildren()))}return{errors:r,ok:n}}(e,r):{errors:[{msg:"Start element is missing.",el:t}]}},e.ValidatingChildNodeIterator=l_,e.XMLAnchorNode=r_,e.XMLAnnotationNode=t_,e.XMLContainerNode=o_,e.XMLDocument=f_,e.XMLDocumentImporter=c_,e.XMLEditingInterface=p_,e.XMLElementNode=Qm,e.XMLElementNodeConverter=e_,e.XMLExternalNode=s_,e.XMLExternalNodeConverter=i_,e.XMLInlineElementNode=n_,e.XMLNodeConverter=Ym,e.XMLSchema=xm,e.XMLTextElement=Xm,e.XMLTextElementConverter=Zm,e.BasePackage=O_,e.BlockquotePackage=R_,e.BodyScrollPanePackage=N_,e.ButtonPackage=g_,e.CodePackage=F_,e.CodeblockPackage=z_,e.ContextMenuPackage=m_,e.DropzonesPackage=C_,e.EmphasisPackage=K_,e.FilePackage=I_,e.FindAndReplacePackage=ny,e.HeadingPackage=ay,e.ImagePackage=my,e.InputPackage=y_,e.LinkPackage=Cy,e.ListPackage=Ay,e.ModalPackage=b_,e.MultiSelectPackage=ky,e.OverlayPackage=v_,e.ParagraphPackage=qy,e.PersistencePackage=Fy,e.ProseEditorPackage=hw,e.QuoteMarksPackage=Qy,e.ScrollPanePackage=x_,e.ScrollbarPackage=S_,e.SpellCheckPackage=fw,e.SplitPanePackage=T_,e.StrongPackage=zy,e.SubscriptPackage=Jy,e.SuperscriptPackage=Xy,e.TabbedPanePackage=D_,e.TablePackage=aw,e.TextInputPackage=vw,e.ToolbarPackage=Cw,e.ToolPanelPackage=A_,e.TextAlignPackage=xw,e.AbstractEditor=yu,e.CommandManager=vu,e.Configurator=yp,e.ContextMenu=bp,e.DragManager=Wu,e.Dropzones=Sp,e.EditorSession=Tp,e.FileManager=tp,e.GlobalEventHandler=sp,e.KeyboardManager=cp,e.MacroManager=dp,e.MarkersManager=fp,e.Menu=Ap,e.MenuGroup=Lp,e.MenuItem=Ip,e.Overlay=Rp,e.Registry=bu,e.ResourceManager=_u,e.ResponsiveApplication=class extends Gd{constructor(...e){super(...e),this.pages={},this.handleActions({navigate:this.navigate})}getInitialState(){return{route:void 0,mobile:this._isMobile()}}didMount(){y.inBrowser&&Xh.getBrowserWindow().on("resize",this._onResize,this),this.router=this.getRouter(),this.router.on("route:changed",this._onRouteChanged,this);let e=this.router.readRoute();this.navigate(e,{replace:!0})}dispose(){this.router.off(this),this.router.dispose()}navigate(e,t){this.extendState({route:e}),this.router.writeRoute(e,t)}_onRouteChanged(e){this.navigate(e,{replace:!0})}_isMobile(){if(y.inBrowser)return window.innerWidth<700}_onResize(){this._isMobile()?this.state.mobile||this.extendState({mobile:!0}):this.state.mobile&&this.extendState({mobile:!1})}_getPage(){return this.state.route.page||this.getDefaultPage()}_getPageClass(){let e=this._getPage();return this.pages[e]}_getPageProps(){let e=b(this.state.route);return delete e.page,e.mobile=this.state.mobile,e}addPage(e,t){this.pages[e]=t}renderPage(e){let t=this._getPageClass(),r=this._getPage();return e(t,this._getPageProps()).ref(r)}render(e){let t=e("div").addClass("sc-responsive-application");return void 0===this.state.route?t:(t.append(this.renderPage(e)),t)}},e.Scrollbar=qp,e.ScrollPane=jp,e.SelectionState=Np,e.Tool=kp,e.ToggleTool=kp,e.Toolbar=Hp,e.ToolDropdown=Up,e.ToolGroup=Mp,e.ToolPanel=wp,e.ToolPrompt=zp,e.ToolSeparator=Vp,e.WorkflowPane=Gp,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=./substance.min.js.map