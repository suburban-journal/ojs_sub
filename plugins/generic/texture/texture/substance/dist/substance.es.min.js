class ChangeStore{constructor(e){this._changes=e||{}}getChanges(e,t,r,n){if("function"==typeof t?(n=t,t=0):"function"==typeof r&&(n=r,r=void 0),!(e&&t>=0&&n))throw new Error("Invalid arguments");let s=this._getVersion(e),o=this._getChanges(e);n(null,o=o.slice(t,r),s)}addChange(e,t,r){if(!e||!t)throw new Error("Invalid arguments");this._addChange(e,t),r(null,this._getVersion(e))}deleteChanges(e,t){t(null,this._deleteChanges(e).length)}getVersion(e,t){t(null,this._getVersion(e))}_deleteChanges(e){var t=this._getChanges(e);return delete this._changes[e],t}_getVersion(e){var t=this._changes[e];return t?t.length:0}_getChanges(e){return this._changes[e]||[]}_addChange(e,t){this._changes[e]||(this._changes[e]=[]),this._changes[e].push(t)}}function forEach(e,t){e&&(e.constructor.prototype.forEach?e.forEach(t):Object.keys(e).forEach(function(r){return t(e[r],r)}))}class SubstanceError extends Error{constructor(e,t){super(e,t),this.name=e,this.message=t.message,this.info=t.info,this.errorCode=t.errorCode,this.cause=t.cause,Error.captureStackTrace&&Error.captureStackTrace(this,SubstanceError)}inspect(){var e=[];return e.push(this.stack),this.info&&e.push(this.info+". "),this.cause&&(e.push("\nCaused by: "),this.cause.inspect?e.push(this.cause.inspect()):e.push(this.cause.toString())),e.join("")}}function isObject(e){const t=typeof e;return Boolean(e)&&("object"===t||"function"===t)}SubstanceError.fromJSON=function(e){return e?new SubstanceError(e.name,{message:e.message,info:e.info,errorCode:e.errorCode,cause:SubstanceError.fromJSON(e.cause)}):null};const DEBUG=!1;let count=0;const COUNT_MSG="%s listeners registered in the whole system.";class EventEmitter{emit(e){if(e in this.__events__){for(var t=this.__events__[e].slice(),r=Array.prototype.slice.call(arguments,1),n=0,s=t.length;n<s;n++){var o=t[n];o.method.apply(o.context,r)}return!0}return!1}on(e,t,r){_on.call(this,e,t,r)}off(e,t,r){1===arguments.length&&isObject(arguments[0])?_disconnect.call(this,arguments[0]):_off.apply(this,arguments)}_debugEvents(){console.log("### EventEmitter: ",this),forEach(this.__events__,(e,t)=>{console.log("- %s listeners for %s: ",e.length,t,e)})}get __events__(){return this.___events___||(this.___events___={}),this.___events___}}function _on(e,t,r){return validateMethod(t,r),(this.__events__.hasOwnProperty(e)?this.__events__[e]:this.__events__[e]=[]).push({method:t,context:r||null}),DEBUG&&(count++,console.info("_on()",e,t.name,r,this),console.info(COUNT_MSG,count)),this}function _off(e,t,r){if(0===arguments.length)return DEBUG&&(forEach(this.__events__,e=>{e.forEach(e=>{console.info("_off()",e.method.name,e.context,this)}),count-=e.length}),console.info(COUNT_MSG,count)),this.___events___={},this;if(1===arguments.length)return DEBUG&&(count-=(this.__events__[e]||[]).length,console.info(COUNT_MSG,count)),delete this.__events__[e],this;if(validateMethod(t,r),!(e in this.__events__&&this.__events__[e].length))return DEBUG&&console.info("NO MATCHING BINDINGS"),this;arguments.length<3&&(r=null);let n=this.__events__[e];for(let e=n.length-1;e>=0;e--){const s=n[e];s.method===t&&s.context===r&&(n.splice(e,1),DEBUG&&count--)}return 0===n.length&&delete this.__events__[e],DEBUG&&console.info(COUNT_MSG,count),this}function _disconnect(e){return forEach(this.__events__,(t,r)=>{for(let n=t.length-1;n>=0;n--)t[n]&&t[n].context===e&&_off.call(this,r,t[n].method,e)}),this}function validateMethod(e,t){if("string"==typeof e){if(void 0===t||null===t)throw new Error('Method name "'+e+'" has no context.');if(!(e in t))throw new Error('Method not found: "'+e+'"');if("function"!=typeof t[e])throw new Error('Property "'+e+'" is not a function')}else if("function"!=typeof e)throw new Error("Invalid callback. Function or method name expected.")}function uuid(e,t){e&&"-"!==e[e.length-1]&&(e=e.concat("-"));var r,n,s="0123456789abcdefghijklmnopqrstuvwxyz".split(""),o=[];if(t=t||32)for(r=0;r<t;r++)o[r]=s[0|16*Math.random()];else for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",r=0;r<36;r++)o[r]||(n=0|16*Math.random(),o[r]=s[19===r?3&n|8:n]);return(e||"")+o.join("")}class ServerRequest{constructor(e,t){this.message=e,this.ws=t,this.isAuthenticated=!1,this.isAuhorized=!1}setAuthenticated(e){this.isAuthenticated=!0,this.session=e}setAuthorized(e){this.isAuthorized=!0,this.authorizationData=e}setEnhanced(){this.isEnhanced=!0}}class ServerResponse{constructor(){this.isReady=!1,this.isEnhanced=!1,this.isSent=!1,this.err=null,this.data=null}error(e){this.err=e,this.isReady=!0}send(e){this.data=e,this.isReady=!0}setEnhanced(){this.isEnhanced=!0}setSent(){this.isSent=!0}}class Server extends EventEmitter{constructor(e){super(),this.config=e,this._onConnection=this._onConnection.bind(this)}bind(e){if(this.wss)throw new Error("Server is already bound to a websocket");this.wss=e,this._connections=new WeakMap,this._collaborators={},this.wss.on("connection",this._onConnection);let t=this.config.heartbeat;t&&(this._heartbeat=setInterval(this._sendHeartbeat.bind(this),t)),this._bound=!0}unbind(){if(!this._bound)throw new Error("Server is not yet bound to a websocket.");this.wss.off("connection",this._onConnection)}onConnection(){}onDisconnect(){}authenticate(e,t){e.setAuthenticated(),this.next(e,t)}authorize(e,t){e.setAuthorized(),this.next(e,t)}enhanceRequest(e,t){e.setEnhanced(),this.next(e,t)}execute(){throw new Error("This method needs to be specified")}enhanceResponse(e,t){t.setEnhanced(),this.next(e,t)}_onConnection(e){let t=uuid(),r={collaboratorId:t};this._connections.set(e,r),this._collaborators[t]={connection:e},e.on("message",this._onMessage.bind(this,e)),e.on("close",this._onClose.bind(this,e))}_onClose(e){let t=this._connections.get(e).collaboratorId;this.onDisconnect(t),delete this._collaborators[t],this._connections.delete(e)}__initial(e,t){return!e.isAuthenticated&&!e.isAuthorized&&!t.isReady}__authenticated(e,t){return e.isAuthenticated&&!e.isAuthorized&&!t.isReady}__authorized(e,t){return e.isAuthenticated&&e.isAuthorized&&!e.isEnhanced&&!t.isReady}__requestEnhanced(e,t){return e.isAuthenticated&&e.isAuthorized&&e.isEnhanced&&!t.isReady}__executed(e,t){return e.isAuthenticated&&e.isAuthorized&&t.isReady&&t.data&&!t.isEnhanced}__enhanced(e,t){return t.isReady&&t.isEnhanced&&!t.isSent}__error(e,t){return t.err&&!t.isSent}__done(e,t){return t.isSent}next(e,t){this.__initial(e,t)?this.authenticate(e,t):this.__authenticated(e,t)?this.authorize(e,t):this.__authorized(e,t)?this.enhanceRequest(e,t):this.__requestEnhanced(e,t)?this.execute(e,t):this.__executed(e,t)?this.enhanceResponse(e,t):this.__enhanced(e,t)?this.sendResponse(e,t):this.__error(e,t)?this.sendError(e,t):this.__done(e,t)}sendError(e,t){let r=e.message.collaboratorId,n=t.err;this.send(r,n),t.setSent(),this.next(e,t)}_sendHeartbeat(){Object.keys(this._collaborators).forEach(function(e){this.send(e,{type:"highfive",scope:"_internal"})}.bind(this))}sendResponse(e,t){let r=e.message.collaboratorId;this.send(r,t.data),t.setSent(),this.next(e,t)}_isWebsocketOpen(e){return e&&1===e.readyState}send(e,t){!t.scope&&this.config.scope&&(t.scope=this.config.scope);let r=this._collaborators[e].connection;this._isWebsocketOpen(r)?r.send(this.serializeMessage(t)):console.error("Server#send: Websocket for collaborator",e,"is no longer open",t)}broadCast(e,t){e.forEach(function(e){this.send(e,t)}.bind(this))}_processRequest(e){let t=new ServerResponse;this.next(e,t)}_onMessage(e,t){let r=this._connections.get(e);if((t=this.deserializeMessage(t)).scope===this.scope){t.collaboratorId=r.collaboratorId;let n=new ServerRequest(t,e);this._processRequest(n)}}serializeMessage(e){return JSON.stringify(e)}deserializeMessage(e){return JSON.parse(e)}}function map(e,t){if(!e)return[];if(t||(t=function(e){return e}),Array.isArray(e))return e.map(t);if(e instanceof Map){let r=[];for(let[n,s]of e)r.push(t(s,n));return r}if(e instanceof Set){let r=[],n=0;return e.forEach(e=>{r.push(t(e,n++))}),r}return Object.keys(e).map(function(r){return t(e[r],r)})}function isArray(e){return Array.isArray(e)}function clone(e){return isArray(e)?e.slice(0):isObject(e)?Object.assign({},e):e}const platform={inBrowser:!1,inNodeJS:!1,inElectron:!1,isIE:!1,isFF:!1,isOpera:!1,isWebkit:!1,isChromium:!1,version:-1,isWindows:!1,isMac:!1,devtools:!1,_reset:detect};function detect(){if("undefined"!=typeof window){platform.inBrowser=!0;const e=window.navigator.userAgent,t=window.navigator.vendor,r=e.indexOf("MSIE "),n=e.indexOf("Trident/"),s=e.indexOf("Edge/"),o=window.opr,i=window.chrome;r>0?(platform.isIE=!0,platform.version=10):n>0?(platform.isIE=!0,platform.version=11,platform.isTrident=!0):s>0&&(platform.isIE=!0,platform.isEdge=!0,platform.version=12,parseInt(e.substring(s+5,e.indexOf(".",s)),10)),platform.isFF=window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,platform.isWebkit=!platform.isFF&&!platform.isIE,platform.isOpera=void 0!==o,platform.isChromium=!!i&&"Google Inc."===t&&!platform.isOpera&&!platform.isEdge}else platform.inBrowser=!1;platform.inBrowser&&(platform.isWindows=void 0!==window.navigator&&window.navigator.appVersion&&-1!==window.navigator.appVersion.indexOf("Win"),platform.isMac=void 0!==window.navigator&&window.navigator.platform.indexOf("Mac")>=0),"undefined"!=typeof process&&(platform.inBrowser?platform.inElectron=!0:platform.inNodeJS=!0)}function cloneDeep(e){return isArray(e)?_cloneArrayDeep(e):platform.inBrowser&&e instanceof window.File?e:isObject(e)?_cloneObjectDeep(e):e}function _cloneObjectDeep(e){let t={};return forEach(e,(e,r)=>{t[r]=cloneDeep(e)}),t}function _cloneArrayDeep(e){return e.map(cloneDeep)}function getKeyForPath(e){return void 0===e._key&&Object.defineProperty(e,"_key",{value:e.join("."),writable:!1,enumerable:!1}),e._key}function isPlainObject(e){return Boolean(e)&&e.constructor==={}.constructor}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isEqual(e,t){if(e===t)return!0;if(isArray(e)&&isArray(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!isEqual(e[r],t[r]))return!1;return!0}if(isPlainObject(e)&&isPlainObject(t)){let r=Object.keys(e).sort();if(!isEqual(r,Object.keys(t).sort()))return!1;for(let n=0;n<r.length;n++){let s=r[n];if(!isEqual(e[s],t[s]))return!1}return!0}return!1}function isNil(e){return null===e||void 0===e}detect();var freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),Symbol$1=root.Symbol;function arrayMap(e,t){for(var r=-1,n=null==e?0:e.length,s=Array(n);++r<n;)s[r]=t(e[r],r,e);return s}var isArray$1=Array.isArray,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,nativeObjectToString=objectProto.toString,symToStringTag=Symbol$1?Symbol$1.toStringTag:void 0;function getRawTag(e){var t=hasOwnProperty.call(e,symToStringTag),r=e[symToStringTag];try{e[symToStringTag]=void 0;var n=!0}catch(e){}var s=nativeObjectToString.call(e);return n&&(t?e[symToStringTag]=r:delete e[symToStringTag]),s}var objectProto$1=Object.prototype,nativeObjectToString$1=objectProto$1.toString;function objectToString(e){return nativeObjectToString$1.call(e)}var nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag$1=Symbol$1?Symbol$1.toStringTag:void 0;function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag$1&&symToStringTag$1 in Object(e)?getRawTag(e):objectToString(e)}function isObjectLike(e){return null!=e&&"object"==typeof e}var symbolTag="[object Symbol]";function isSymbol(e){return"symbol"==typeof e||isObjectLike(e)&&baseGetTag(e)==symbolTag}var INFINITY=1/0,symbolProto=Symbol$1?Symbol$1.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;function baseToString(e){if("string"==typeof e)return e;if(isArray$1(e))return arrayMap(e,baseToString)+"";if(isSymbol(e))return symbolToString?symbolToString.call(e):"";var t=e+"";return"0"==t&&1/e==-INFINITY?"-0":t}function toString(e){return null==e?"":baseToString(e)}function baseSlice(e,t,r){var n=-1,s=e.length;t<0&&(t=-t>s?0:s+t),(r=r>s?s:r)<0&&(r+=s),s=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(s);++n<s;)o[n]=e[n+t];return o}function castSlice(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:baseSlice(e,t,r)}var rsAstralRange="\\ud800-\\udfff",rsComboMarksRange="\\u0300-\\u036f",reComboHalfMarksRange="\\ufe20-\\ufe2f",rsComboSymbolsRange="\\u20d0-\\u20ff",rsComboRange=rsComboMarksRange+reComboHalfMarksRange+rsComboSymbolsRange,rsVarRange="\\ufe0e\\ufe0f",rsZWJ="\\u200d",reHasUnicode=RegExp("["+rsZWJ+rsAstralRange+rsComboRange+rsVarRange+"]");function hasUnicode(e){return reHasUnicode.test(e)}function asciiToArray(e){return e.split("")}var rsAstralRange$1="\\ud800-\\udfff",rsComboMarksRange$1="\\u0300-\\u036f",reComboHalfMarksRange$1="\\ufe20-\\ufe2f",rsComboSymbolsRange$1="\\u20d0-\\u20ff",rsComboRange$1=rsComboMarksRange$1+reComboHalfMarksRange$1+rsComboSymbolsRange$1,rsVarRange$1="\\ufe0e\\ufe0f",rsAstral="["+rsAstralRange$1+"]",rsCombo="["+rsComboRange$1+"]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsModifier="(?:"+rsCombo+"|"+rsFitz+")",rsNonAstral="[^"+rsAstralRange$1+"]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsZWJ$1="\\u200d",reOptMod=rsModifier+"?",rsOptVar="["+rsVarRange$1+"]?",rsOptJoin="(?:"+rsZWJ$1+"(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")"+rsOptVar+reOptMod+")*",rsSeq=rsOptVar+reOptMod+rsOptJoin,rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")",reUnicode=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g");function unicodeToArray(e){return e.match(reUnicode)||[]}function stringToArray(e){return hasUnicode(e)?unicodeToArray(e):asciiToArray(e)}function createCaseFirst(e){return function(t){var r=hasUnicode(t=toString(t))?stringToArray(t):void 0,n=r?r[0]:t.charAt(0),s=r?castSlice(r,1).join(""):t.slice(1);return n[e]()+s}}var upperFirst=createCaseFirst("toUpperCase");function capitalize(e){return upperFirst(toString(e).toLowerCase())}function arrayReduce(e,t,r,n){var s=-1,o=null==e?0:e.length;for(n&&o&&(r=e[++s]);++s<o;)r=t(r,e[s],s,e);return r}function basePropertyOf(e){return function(t){return null==e?void 0:e[t]}}var deburredLetters={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"},deburrLetter=basePropertyOf(deburredLetters),reLatin=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,rsComboMarksRange$2="\\u0300-\\u036f",reComboHalfMarksRange$2="\\ufe20-\\ufe2f",rsComboSymbolsRange$2="\\u20d0-\\u20ff",rsComboRange$2=rsComboMarksRange$2+reComboHalfMarksRange$2+rsComboSymbolsRange$2,rsCombo$1="["+rsComboRange$2+"]",reComboMark=RegExp(rsCombo$1,"g");function deburr(e){return(e=toString(e))&&e.replace(reLatin,deburrLetter).replace(reComboMark,"")}var reAsciiWord=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function asciiWords(e){return e.match(reAsciiWord)||[]}var reHasUnicodeWord=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function hasUnicodeWord(e){return reHasUnicodeWord.test(e)}var rsAstralRange$2="\\ud800-\\udfff",rsComboMarksRange$3="\\u0300-\\u036f",reComboHalfMarksRange$3="\\ufe20-\\ufe2f",rsComboSymbolsRange$3="\\u20d0-\\u20ff",rsComboRange$3=rsComboMarksRange$3+reComboHalfMarksRange$3+rsComboSymbolsRange$3,rsDingbatRange="\\u2700-\\u27bf",rsLowerRange="a-z\\xdf-\\xf6\\xf8-\\xff",rsMathOpRange="\\xac\\xb1\\xd7\\xf7",rsNonCharRange="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",rsPunctuationRange="\\u2000-\\u206f",rsSpaceRange=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rsUpperRange="A-Z\\xc0-\\xd6\\xd8-\\xde",rsVarRange$2="\\ufe0e\\ufe0f",rsBreakRange=rsMathOpRange+rsNonCharRange+rsPunctuationRange+rsSpaceRange,rsApos="['’]",rsBreak="["+rsBreakRange+"]",rsCombo$2="["+rsComboRange$3+"]",rsDigits="\\d+",rsDingbat="["+rsDingbatRange+"]",rsLower="["+rsLowerRange+"]",rsMisc="[^"+rsAstralRange$2+rsBreakRange+rsDigits+rsDingbatRange+rsLowerRange+rsUpperRange+"]",rsFitz$1="\\ud83c[\\udffb-\\udfff]",rsModifier$1="(?:"+rsCombo$2+"|"+rsFitz$1+")",rsNonAstral$1="[^"+rsAstralRange$2+"]",rsRegional$1="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair$1="[\\ud800-\\udbff][\\udc00-\\udfff]",rsUpper="["+rsUpperRange+"]",rsZWJ$2="\\u200d",rsMiscLower="(?:"+rsLower+"|"+rsMisc+")",rsMiscUpper="(?:"+rsUpper+"|"+rsMisc+")",rsOptContrLower="(?:"+rsApos+"(?:d|ll|m|re|s|t|ve))?",rsOptContrUpper="(?:"+rsApos+"(?:D|LL|M|RE|S|T|VE))?",reOptMod$1=rsModifier$1+"?",rsOptVar$1="["+rsVarRange$2+"]?",rsOptJoin$1="(?:"+rsZWJ$2+"(?:"+[rsNonAstral$1,rsRegional$1,rsSurrPair$1].join("|")+")"+rsOptVar$1+reOptMod$1+")*",rsOrdLower="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",rsOrdUpper="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",rsSeq$1=rsOptVar$1+reOptMod$1+rsOptJoin$1,rsEmoji="(?:"+[rsDingbat,rsRegional$1,rsSurrPair$1].join("|")+")"+rsSeq$1,reUnicodeWord=RegExp([rsUpper+"?"+rsLower+"+"+rsOptContrLower+"(?="+[rsBreak,rsUpper,"$"].join("|")+")",rsMiscUpper+"+"+rsOptContrUpper+"(?="+[rsBreak,rsUpper+rsMiscLower,"$"].join("|")+")",rsUpper+"?"+rsMiscLower+"+"+rsOptContrLower,rsUpper+"+"+rsOptContrUpper,rsOrdUpper,rsOrdLower,rsDigits,rsEmoji].join("|"),"g");function unicodeWords(e){return e.match(reUnicodeWord)||[]}function words(e,t,r){return e=toString(e),void 0===(t=r?void 0:t)?hasUnicodeWord(e)?unicodeWords(e):asciiWords(e):e.match(t)||[]}var rsApos$1="['’]",reApos=RegExp(rsApos$1,"g");function createCompounder(e){return function(t){return arrayReduce(words(deburr(t).replace(reApos,"")),e,"")}}var camelCase=createCompounder(function(e,t,r){return t=t.toLowerCase(),e+(r?capitalize(t):t)});function isObject$1(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var now=function(){return root.Date.now()},NAN=NaN,reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber(e){if("number"==typeof e)return e;if(isSymbol(e))return NAN;if(isObject$1(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject$1(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(reTrim,"");var r=reIsBinary.test(e);return r||reIsOctal.test(e)?freeParseInt(e.slice(2),r?2:8):reIsBadHex.test(e)?NAN:+e}var FUNC_ERROR_TEXT="Expected a function",nativeMax=Math.max,nativeMin=Math.min;function debounce(e,t,r){var n,s,o,i,a,l,c=0,d=!1,h=!1,u=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);function p(t){var r=n,o=s;return n=s=void 0,c=t,i=e.apply(o,r)}function g(e){var r=e-l;return void 0===l||r>=t||r<0||h&&e-c>=o}function f(){var e=now();if(g(e))return m(e);a=setTimeout(f,function(e){var r=t-(e-l);return h?nativeMin(r,o-(e-c)):r}(e))}function m(e){return a=void 0,u&&n?p(e):(n=s=void 0,i)}function _(){var e=now(),r=g(e);if(n=arguments,s=this,l=e,r){if(void 0===a)return function(e){return c=e,a=setTimeout(f,t),d?p(e):i}(l);if(h)return a=setTimeout(f,t),p(l)}return void 0===a&&(a=setTimeout(f,t)),i}return t=toNumber(t)||0,isObject$1(r)&&(d=!!r.leading,o=(h="maxWait"in r)?nativeMax(toNumber(r.maxWait)||0,t):o,u="trailing"in r?!!r.trailing:u),_.cancel=function(){void 0!==a&&clearTimeout(a),c=0,n=l=s=a=void 0},_.flush=function(){return void 0===a?i:m(now())},_}var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey(e,t){if(isArray$1(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!isSymbol(e))||(reIsPlainProp.test(e)||!reIsDeepProp.test(e)||null!=t&&e in Object(t))}var asyncTag="[object AsyncFunction]",funcTag="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction(e){if(!isObject$1(e))return!1;var t=baseGetTag(e);return t==funcTag||t==genTag||t==asyncTag||t==proxyTag}var coreJsData=root["__core-js_shared__"],maskSrcKey=function(){var e=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function isMasked(e){return!!maskSrcKey&&maskSrcKey in e}var funcProto=Function.prototype,funcToString=funcProto.toString;function toSource(e){if(null!=e){try{return funcToString.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto$1=Function.prototype,objectProto$2=Object.prototype,funcToString$1=funcProto$1.toString,hasOwnProperty$1=objectProto$2.hasOwnProperty,reIsNative=RegExp("^"+funcToString$1.call(hasOwnProperty$1).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(e){return!(!isObject$1(e)||isMasked(e))&&(isFunction(e)?reIsNative:reIsHostCtor).test(toSource(e))}function getValue(e,t){return null==e?void 0:e[t]}function getNative(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}var nativeCreate=getNative(Object,"create");function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0}function hashDelete(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var HASH_UNDEFINED="__lodash_hash_undefined__",objectProto$3=Object.prototype,hasOwnProperty$2=objectProto$3.hasOwnProperty;function hashGet(e){var t=this.__data__;if(nativeCreate){var r=t[e];return r===HASH_UNDEFINED?void 0:r}return hasOwnProperty$2.call(t,e)?t[e]:void 0}var objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty;function hashHas(e){var t=this.__data__;return nativeCreate?void 0!==t[e]:hasOwnProperty$3.call(t,e)}var HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate&&void 0===t?HASH_UNDEFINED$1:t,this}function Hash(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function listCacheClear(){this.__data__=[],this.size=0}function eq(e,t){return e===t||e!=e&&t!=t}function assocIndexOf(e,t){for(var r=e.length;r--;)if(eq(e[r][0],t))return r;return-1}Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet;var arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete(e){var t=this.__data__,r=assocIndexOf(t,e);return!(r<0)&&(r==t.length-1?t.pop():splice.call(t,r,1),--this.size,!0)}function listCacheGet(e){var t=this.__data__,r=assocIndexOf(t,e);return r<0?void 0:t[r][1]}function listCacheHas(e){return assocIndexOf(this.__data__,e)>-1}function listCacheSet(e,t){var r=this.__data__,n=assocIndexOf(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function ListCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet;var Map$1=getNative(root,"Map");function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map$1||ListCache),string:new Hash}}function isKeyable(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function getMapData(e,t){var r=e.__data__;return isKeyable(t)?r["string"==typeof t?"string":"hash"]:r.map}function mapCacheDelete(e){var t=getMapData(this,e).delete(e);return this.size-=t?1:0,t}function mapCacheGet(e){return getMapData(this,e).get(e)}function mapCacheHas(e){return getMapData(this,e).has(e)}function mapCacheSet(e,t){var r=getMapData(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function MapCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet;var FUNC_ERROR_TEXT$1="Expected a function";function memoize(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT$1);var r=function(){var n=arguments,s=t?t.apply(this,n):n[0],o=r.cache;if(o.has(s))return o.get(s);var i=e.apply(this,n);return r.cache=o.set(s,i)||o,i};return r.cache=new(memoize.Cache||MapCache),r}memoize.Cache=MapCache;var MAX_MEMOIZE_SIZE=500;function memoizeCapped(e){var t=memoize(e,function(e){return r.size===MAX_MEMOIZE_SIZE&&r.clear(),e}),r=t.cache;return t}var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=memoizeCapped(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(rePropName,function(e,r,n,s){t.push(n?s.replace(reEscapeChar,"$1"):r||e)}),t});function castPath(e,t){return isArray$1(e)?e:isKey(e,t)?[e]:stringToPath(toString(e))}var INFINITY$1=1/0;function toKey(e){if("string"==typeof e||isSymbol(e))return e;var t=e+"";return"0"==t&&1/e==-INFINITY$1?"-0":t}function baseGet(e,t){for(var r=0,n=(t=castPath(t,e)).length;null!=e&&r<n;)e=e[toKey(t[r++])];return r&&r==n?e:void 0}function get(e,t,r){var n=null==e?void 0:baseGet(e,t);return void 0===n?r:n}function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function stackGet(e){return this.__data__.get(e)}function stackHas(e){return this.__data__.has(e)}var LARGE_ARRAY_SIZE=200;function stackSet(e,t){var r=this.__data__;if(r instanceof ListCache){var n=r.__data__;if(!Map$1||n.length<LARGE_ARRAY_SIZE-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache(n)}return r.set(e,t),this.size=r.size,this}function Stack(e){var t=this.__data__=new ListCache(e);this.size=t.size}Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var HASH_UNDEFINED$2="__lodash_hash_undefined__";function setCacheAdd(e){return this.__data__.set(e,HASH_UNDEFINED$2),this}function setCacheHas(e){return this.__data__.has(e)}function SetCache(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new MapCache;++t<r;)this.add(e[t])}function arraySome(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function cacheHas(e,t){return e.has(t)}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas;var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function equalArrays(e,t,r,n,s,o){var i=r&COMPARE_PARTIAL_FLAG,a=e.length,l=t.length;if(a!=l&&!(i&&l>a))return!1;var c=o.get(e);if(c&&o.get(t))return c==t;var d=-1,h=!0,u=r&COMPARE_UNORDERED_FLAG?new SetCache:void 0;for(o.set(e,t),o.set(t,e);++d<a;){var p=e[d],g=t[d];if(n)var f=i?n(g,p,d,t,e,o):n(p,g,d,e,t,o);if(void 0!==f){if(f)continue;h=!1;break}if(u){if(!arraySome(t,function(e,t){if(!cacheHas(u,t)&&(p===e||s(p,e,r,n,o)))return u.push(t)})){h=!1;break}}else if(p!==g&&!s(p,g,r,n,o)){h=!1;break}}return o.delete(e),o.delete(t),h}var Uint8Array=root.Uint8Array;function mapToArray(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function setToArray(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var COMPARE_PARTIAL_FLAG$1=1,COMPARE_UNORDERED_FLAG$1=2,boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",mapTag="[object Map]",numberTag="[object Number]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag$1="[object Symbol]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",symbolProto$1=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf=symbolProto$1?symbolProto$1.valueOf:void 0;function equalByTag(e,t,r,n,s,o,i){switch(r){case dataViewTag:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case arrayBufferTag:return!(e.byteLength!=t.byteLength||!o(new Uint8Array(e),new Uint8Array(t)));case boolTag:case dateTag:case numberTag:return eq(+e,+t);case errorTag:return e.name==t.name&&e.message==t.message;case regexpTag:case stringTag:return e==t+"";case mapTag:var a=mapToArray;case setTag:var l=n&COMPARE_PARTIAL_FLAG$1;if(a||(a=setToArray),e.size!=t.size&&!l)return!1;var c=i.get(e);if(c)return c==t;n|=COMPARE_UNORDERED_FLAG$1,i.set(e,t);var d=equalArrays(a(e),a(t),n,s,o,i);return i.delete(e),d;case symbolTag$1:if(symbolValueOf)return symbolValueOf.call(e)==symbolValueOf.call(t)}return!1}function arrayPush(e,t){for(var r=-1,n=t.length,s=e.length;++r<n;)e[s+r]=t[r];return e}function baseGetAllKeys(e,t,r){var n=t(e);return isArray$1(e)?n:arrayPush(n,r(e))}function arrayFilter(e,t){for(var r=-1,n=null==e?0:e.length,s=0,o=[];++r<n;){var i=e[r];t(i,r,e)&&(o[s++]=i)}return o}function stubArray(){return[]}var objectProto$5=Object.prototype,propertyIsEnumerable=objectProto$5.propertyIsEnumerable,nativeGetSymbols=Object.getOwnPropertySymbols,getSymbols=nativeGetSymbols?function(e){return null==e?[]:(e=Object(e),arrayFilter(nativeGetSymbols(e),function(t){return propertyIsEnumerable.call(e,t)}))}:stubArray;function baseTimes(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var argsTag="[object Arguments]";function baseIsArguments(e){return isObjectLike(e)&&baseGetTag(e)==argsTag}var objectProto$6=Object.prototype,hasOwnProperty$4=objectProto$6.hasOwnProperty,propertyIsEnumerable$1=objectProto$6.propertyIsEnumerable,isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike(e)&&hasOwnProperty$4.call(e,"callee")&&!propertyIsEnumerable$1.call(e,"callee")};function stubFalse(){return!1}var freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,Buffer=moduleExports?root.Buffer:void 0,nativeIsBuffer=Buffer?Buffer.isBuffer:void 0,isBuffer=nativeIsBuffer||stubFalse,MAX_SAFE_INTEGER=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(e,t){var r=typeof e;return!!(t=null==t?MAX_SAFE_INTEGER:t)&&("number"==r||"symbol"!=r&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}var MAX_SAFE_INTEGER$1=9007199254740991;function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER$1}var argsTag$1="[object Arguments]",arrayTag="[object Array]",boolTag$1="[object Boolean]",dateTag$1="[object Date]",errorTag$1="[object Error]",funcTag$1="[object Function]",mapTag$1="[object Map]",numberTag$1="[object Number]",objectTag="[object Object]",regexpTag$1="[object RegExp]",setTag$1="[object Set]",stringTag$1="[object String]",weakMapTag="[object WeakMap]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$1="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};function baseIsTypedArray(e){return isObjectLike(e)&&isLength(e.length)&&!!typedArrayTags[baseGetTag(e)]}function baseUnary(e){return function(t){return e(t)}}typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag$1]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag$1]=typedArrayTags[boolTag$1]=typedArrayTags[dataViewTag$1]=typedArrayTags[dateTag$1]=typedArrayTags[errorTag$1]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag$1]=typedArrayTags[numberTag$1]=typedArrayTags[objectTag]=typedArrayTags[regexpTag$1]=typedArrayTags[setTag$1]=typedArrayTags[stringTag$1]=typedArrayTags[weakMapTag]=!1;var freeExports$1="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$1=freeExports$1&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$1=freeModule$1&&freeModule$1.exports===freeExports$1,freeProcess=moduleExports$1&&freeGlobal.process,nodeUtil=function(){try{var e=freeModule$1&&freeModule$1.require&&freeModule$1.require("util").types;return e||freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}(),nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,objectProto$7=Object.prototype,hasOwnProperty$5=objectProto$7.hasOwnProperty;function arrayLikeKeys(e,t){var r=isArray$1(e),n=!r&&isArguments(e),s=!r&&!n&&isBuffer(e),o=!r&&!n&&!s&&isTypedArray(e),i=r||n||s||o,a=i?baseTimes(e.length,String):[],l=a.length;for(var c in e)!t&&!hasOwnProperty$5.call(e,c)||i&&("length"==c||s&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||isIndex(c,l))||a.push(c);return a}var objectProto$8=Object.prototype;function isPrototype(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||objectProto$8)}function overArg(e,t){return function(r){return e(t(r))}}var nativeKeys=overArg(Object.keys,Object),objectProto$9=Object.prototype,hasOwnProperty$6=objectProto$9.hasOwnProperty;function baseKeys(e){if(!isPrototype(e))return nativeKeys(e);var t=[];for(var r in Object(e))hasOwnProperty$6.call(e,r)&&"constructor"!=r&&t.push(r);return t}function isArrayLike(e){return null!=e&&isLength(e.length)&&!isFunction(e)}function keys(e){return isArrayLike(e)?arrayLikeKeys(e):baseKeys(e)}function getAllKeys(e){return baseGetAllKeys(e,keys,getSymbols)}var COMPARE_PARTIAL_FLAG$2=1,objectProto$10=Object.prototype,hasOwnProperty$7=objectProto$10.hasOwnProperty;function equalObjects(e,t,r,n,s,o){var i=r&COMPARE_PARTIAL_FLAG$2,a=getAllKeys(e),l=a.length;if(l!=getAllKeys(t).length&&!i)return!1;for(var c=l;c--;){var d=a[c];if(!(i?d in t:hasOwnProperty$7.call(t,d)))return!1}var h=o.get(e);if(h&&o.get(t))return h==t;var u=!0;o.set(e,t),o.set(t,e);for(var p=i;++c<l;){var g=e[d=a[c]],f=t[d];if(n)var m=i?n(f,g,d,t,e,o):n(g,f,d,e,t,o);if(!(void 0===m?g===f||s(g,f,r,n,o):m)){u=!1;break}p||(p="constructor"==d)}if(u&&!p){var _=e.constructor,y=t.constructor;_!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof _&&_ instanceof _&&"function"==typeof y&&y instanceof y)&&(u=!1)}return o.delete(e),o.delete(t),u}var DataView=getNative(root,"DataView"),Promise$1=getNative(root,"Promise"),Set$1=getNative(root,"Set"),WeakMap$1=getNative(root,"WeakMap"),mapTag$2="[object Map]",objectTag$1="[object Object]",promiseTag="[object Promise]",setTag$2="[object Set]",weakMapTag$1="[object WeakMap]",dataViewTag$2="[object DataView]",dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map$1),promiseCtorString=toSource(Promise$1),setCtorString=toSource(Set$1),weakMapCtorString=toSource(WeakMap$1),getTag=baseGetTag;(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag$2||Map$1&&getTag(new Map$1)!=mapTag$2||Promise$1&&getTag(Promise$1.resolve())!=promiseTag||Set$1&&getTag(new Set$1)!=setTag$2||WeakMap$1&&getTag(new WeakMap$1)!=weakMapTag$1)&&(getTag=function(e){var t=baseGetTag(e),r=t==objectTag$1?e.constructor:void 0,n=r?toSource(r):"";if(n)switch(n){case dataViewCtorString:return dataViewTag$2;case mapCtorString:return mapTag$2;case promiseCtorString:return promiseTag;case setCtorString:return setTag$2;case weakMapCtorString:return weakMapTag$1}return t});var getTag$1=getTag,COMPARE_PARTIAL_FLAG$3=1,argsTag$2="[object Arguments]",arrayTag$1="[object Array]",objectTag$2="[object Object]",objectProto$11=Object.prototype,hasOwnProperty$8=objectProto$11.hasOwnProperty;function baseIsEqualDeep(e,t,r,n,s,o){var i=isArray$1(e),a=isArray$1(t),l=i?arrayTag$1:getTag$1(e),c=a?arrayTag$1:getTag$1(t),d=(l=l==argsTag$2?objectTag$2:l)==objectTag$2,h=(c=c==argsTag$2?objectTag$2:c)==objectTag$2,u=l==c;if(u&&isBuffer(e)){if(!isBuffer(t))return!1;i=!0,d=!1}if(u&&!d)return o||(o=new Stack),i||isTypedArray(e)?equalArrays(e,t,r,n,s,o):equalByTag(e,t,l,r,n,s,o);if(!(r&COMPARE_PARTIAL_FLAG$3)){var p=d&&hasOwnProperty$8.call(e,"__wrapped__"),g=h&&hasOwnProperty$8.call(t,"__wrapped__");if(p||g){var f=p?e.value():e,m=g?t.value():t;return o||(o=new Stack),s(f,m,r,n,o)}}return!!u&&(o||(o=new Stack),equalObjects(e,t,r,n,s,o))}function baseIsEqual(e,t,r,n,s){return e===t||(null==e||null==t||!isObjectLike(e)&&!isObjectLike(t)?e!=e&&t!=t:baseIsEqualDeep(e,t,r,n,baseIsEqual,s))}var COMPARE_PARTIAL_FLAG$4=1,COMPARE_UNORDERED_FLAG$2=2;function baseIsMatch(e,t,r,n){var s=r.length,o=s,i=!n;if(null==e)return!o;for(e=Object(e);s--;){var a=r[s];if(i&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++s<o;){var l=(a=r[s])[0],c=e[l],d=a[1];if(i&&a[2]){if(void 0===c&&!(l in e))return!1}else{var h=new Stack;if(n)var u=n(c,d,l,e,t,h);if(!(void 0===u?baseIsEqual(d,c,COMPARE_PARTIAL_FLAG$4|COMPARE_UNORDERED_FLAG$2,n,h):u))return!1}}return!0}function isStrictComparable(e){return e==e&&!isObject$1(e)}function getMatchData(e){for(var t=keys(e),r=t.length;r--;){var n=t[r],s=e[n];t[r]=[n,s,isStrictComparable(s)]}return t}function matchesStrictComparable(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}}function baseMatches(e){var t=getMatchData(e);return 1==t.length&&t[0][2]?matchesStrictComparable(t[0][0],t[0][1]):function(r){return r===e||baseIsMatch(r,e,t)}}function baseHasIn(e,t){return null!=e&&t in Object(e)}function hasPath(e,t,r){for(var n=-1,s=(t=castPath(t,e)).length,o=!1;++n<s;){var i=toKey(t[n]);if(!(o=null!=e&&r(e,i)))break;e=e[i]}return o||++n!=s?o:!!(s=null==e?0:e.length)&&isLength(s)&&isIndex(i,s)&&(isArray$1(e)||isArguments(e))}function hasIn(e,t){return null!=e&&hasPath(e,t,baseHasIn)}var COMPARE_PARTIAL_FLAG$5=1,COMPARE_UNORDERED_FLAG$3=2;function baseMatchesProperty(e,t){return isKey(e)&&isStrictComparable(t)?matchesStrictComparable(toKey(e),t):function(r){var n=get(r,e);return void 0===n&&n===t?hasIn(r,e):baseIsEqual(t,n,COMPARE_PARTIAL_FLAG$5|COMPARE_UNORDERED_FLAG$3)}}function identity(e){return e}function baseProperty(e){return function(t){return null==t?void 0:t[e]}}function basePropertyDeep(e){return function(t){return baseGet(t,e)}}function property(e){return isKey(e)?baseProperty(toKey(e)):basePropertyDeep(e)}function baseIteratee(e){return"function"==typeof e?e:null==e?identity:"object"==typeof e?isArray$1(e)?baseMatchesProperty(e[0],e[1]):baseMatches(e):property(e)}function createFind(e){return function(t,r,n){var s=Object(t);if(!isArrayLike(t)){var o=baseIteratee(r,3);t=keys(t),r=function(e){return o(s[e],e,s)}}var i=e(t,r,n);return i>-1?s[o?t[i]:i]:void 0}}function baseFindIndex(e,t,r,n){for(var s=e.length,o=r+(n?1:-1);n?o--:++o<s;)if(t(e[o],o,e))return o;return-1}var INFINITY$2=1/0,MAX_INTEGER=1.7976931348623157e308;function toFinite(e){return e?(e=toNumber(e))===INFINITY$2||e===-INFINITY$2?(e<0?-1:1)*MAX_INTEGER:e==e?e:0:0===e?e:0}function toInteger(e){var t=toFinite(e),r=t%1;return t==t?r?t-r:t:0}var nativeMax$1=Math.max;function findIndex(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var s=null==r?0:toInteger(r);return s<0&&(s=nativeMax$1(n+s,0)),baseFindIndex(e,baseIteratee(t,3),s)}var find=createFind(findIndex);function isMatch(e,t){return e===t||baseIsMatch(e,t,getMatchData(t))}var defineProperty=function(){try{var e=getNative(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();function baseAssignValue(e,t,r){"__proto__"==t&&defineProperty?defineProperty(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function assignMergeValue(e,t,r){(void 0===r||eq(e[t],r))&&(void 0!==r||t in e)||baseAssignValue(e,t,r)}function createBaseFor(e){return function(t,r,n){for(var s=-1,o=Object(t),i=n(t),a=i.length;a--;){var l=i[e?a:++s];if(!1===r(o[l],l,o))break}return t}}var baseFor=createBaseFor(),freeExports$2="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$2=freeExports$2&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$2=freeModule$2&&freeModule$2.exports===freeExports$2,Buffer$1=moduleExports$2?root.Buffer:void 0,allocUnsafe=Buffer$1?Buffer$1.allocUnsafe:void 0;function cloneBuffer(e,t){if(t)return e.slice();var r=e.length,n=allocUnsafe?allocUnsafe(r):new e.constructor(r);return e.copy(n),n}function cloneArrayBuffer(e){var t=new e.constructor(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e)),t}function cloneTypedArray(e,t){var r=t?cloneArrayBuffer(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function copyArray(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}var objectCreate=Object.create,baseCreate=function(){function e(){}return function(t){if(!isObject$1(t))return{};if(objectCreate)return objectCreate(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),getPrototype=overArg(Object.getPrototypeOf,Object);function initCloneObject(e){return"function"!=typeof e.constructor||isPrototype(e)?{}:baseCreate(getPrototype(e))}function isArrayLikeObject(e){return isObjectLike(e)&&isArrayLike(e)}var objectTag$3="[object Object]",funcProto$2=Function.prototype,objectProto$12=Object.prototype,funcToString$2=funcProto$2.toString,hasOwnProperty$9=objectProto$12.hasOwnProperty,objectCtorString=funcToString$2.call(Object);function isPlainObject$1(e){if(!isObjectLike(e)||baseGetTag(e)!=objectTag$3)return!1;var t=getPrototype(e);if(null===t)return!0;var r=hasOwnProperty$9.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&funcToString$2.call(r)==objectCtorString}function safeGet(e,t){return"__proto__"==t?void 0:e[t]}var objectProto$13=Object.prototype,hasOwnProperty$10=objectProto$13.hasOwnProperty;function assignValue(e,t,r){var n=e[t];hasOwnProperty$10.call(e,t)&&eq(n,r)&&(void 0!==r||t in e)||baseAssignValue(e,t,r)}function copyObject(e,t,r,n){var s=!r;r||(r={});for(var o=-1,i=t.length;++o<i;){var a=t[o],l=n?n(r[a],e[a],a,r,e):void 0;void 0===l&&(l=e[a]),s?baseAssignValue(r,a,l):assignValue(r,a,l)}return r}function nativeKeysIn(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}var objectProto$14=Object.prototype,hasOwnProperty$11=objectProto$14.hasOwnProperty;function baseKeysIn(e){if(!isObject$1(e))return nativeKeysIn(e);var t=isPrototype(e),r=[];for(var n in e)("constructor"!=n||!t&&hasOwnProperty$11.call(e,n))&&r.push(n);return r}function keysIn(e){return isArrayLike(e)?arrayLikeKeys(e,!0):baseKeysIn(e)}function toPlainObject(e){return copyObject(e,keysIn(e))}function baseMergeDeep(e,t,r,n,s,o,i){var a=safeGet(e,r),l=safeGet(t,r),c=i.get(l);if(c)assignMergeValue(e,r,c);else{var d=o?o(a,l,r+"",e,t,i):void 0,h=void 0===d;if(h){var u=isArray$1(l),p=!u&&isBuffer(l),g=!u&&!p&&isTypedArray(l);d=l,u||p||g?isArray$1(a)?d=a:isArrayLikeObject(a)?d=copyArray(a):p?(h=!1,d=cloneBuffer(l,!0)):g?(h=!1,d=cloneTypedArray(l,!0)):d=[]:isPlainObject$1(l)||isArguments(l)?(d=a,isArguments(a)?d=toPlainObject(a):(!isObject$1(a)||n&&isFunction(a))&&(d=initCloneObject(l))):h=!1}h&&(i.set(l,d),s(d,l,n,o,i),i.delete(l)),assignMergeValue(e,r,d)}}function baseMerge(e,t,r,n,s){e!==t&&baseFor(t,function(o,i){if(isObject$1(o))s||(s=new Stack),baseMergeDeep(e,t,i,r,baseMerge,n,s);else{var a=n?n(safeGet(e,i),o,i+"",e,t,s):void 0;void 0===a&&(a=o),assignMergeValue(e,i,a)}},keysIn)}function apply(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var nativeMax$2=Math.max;function overRest(e,t,r){return t=nativeMax$2(void 0===t?e.length-1:t,0),function(){for(var n=arguments,s=-1,o=nativeMax$2(n.length-t,0),i=Array(o);++s<o;)i[s]=n[t+s];s=-1;for(var a=Array(t+1);++s<t;)a[s]=n[s];return a[t]=r(i),apply(e,this,a)}}function constant(e){return function(){return e}}var baseSetToString=defineProperty?function(e,t){return defineProperty(e,"toString",{configurable:!0,enumerable:!1,value:constant(t),writable:!0})}:identity,HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut(e){var t=0,r=0;return function(){var n=nativeNow(),s=HOT_SPAN-(n-r);if(r=n,s>0){if(++t>=HOT_COUNT)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var setToString=shortOut(baseSetToString);function baseRest(e,t){return setToString(overRest(e,t,identity),e+"")}function isIterateeCall(e,t,r){if(!isObject$1(r))return!1;var n=typeof t;return!!("number"==n?isArrayLike(r)&&isIndex(t,r.length):"string"==n&&t in r)&&eq(r[t],e)}function createAssigner(e){return baseRest(function(t,r){var n=-1,s=r.length,o=s>1?r[s-1]:void 0,i=s>2?r[2]:void 0;for(o=e.length>3&&"function"==typeof o?(s--,o):void 0,i&&isIterateeCall(r[0],r[1],i)&&(o=s<3?void 0:o,s=1),t=Object(t);++n<s;){var a=r[n];a&&e(t,a,n,o)}return t})}var merge=createAssigner(function(e,t,r){baseMerge(e,t,r)}),mergeWith=createAssigner(function(e,t,r,n){baseMerge(e,t,r,n)});function baseSet(e,t,r,n){if(!isObject$1(e))return e;for(var s=-1,o=(t=castPath(t,e)).length,i=o-1,a=e;null!=a&&++s<o;){var l=toKey(t[s]),c=r;if(s!=i){var d=a[l];void 0===(c=n?n(d,l,a):void 0)&&(c=isObject$1(d)?d:isIndex(t[s+1])?[]:{})}assignValue(a,l,c),a=a[l]}return e}function basePickBy(e,t,r){for(var n=-1,s=t.length,o={};++n<s;){var i=t[n],a=baseGet(e,i);r(a,i)&&baseSet(o,castPath(i,e),a)}return o}function basePick(e,t){return basePickBy(e,t,function(t,r){return hasIn(e,r)})}var spreadableSymbol=Symbol$1?Symbol$1.isConcatSpreadable:void 0;function isFlattenable(e){return isArray$1(e)||isArguments(e)||!!(spreadableSymbol&&e&&e[spreadableSymbol])}function baseFlatten(e,t,r,n,s){var o=-1,i=e.length;for(r||(r=isFlattenable),s||(s=[]);++o<i;){var a=e[o];t>0&&r(a)?t>1?baseFlatten(a,t-1,r,n,s):arrayPush(s,a):n||(s[s.length]=a)}return s}function flatten(e){return(null==e?0:e.length)?baseFlatten(e,1):[]}function flatRest(e){return setToString(overRest(e,void 0,flatten),e+"")}var pick=flatRest(function(e,t){return null==e?{}:basePick(e,t)});function setWith(e,t,r,n){return n="function"==typeof n?n:void 0,null==e?e:baseSet(e,t,r,n)}function baseIsNaN(e){return e!=e}function strictIndexOf(e,t,r){for(var n=r-1,s=e.length;++n<s;)if(e[n]===t)return n;return-1}function baseIndexOf(e,t,r){return t==t?strictIndexOf(e,t,r):baseFindIndex(e,baseIsNaN,r)}function arrayIncludes(e,t){return!!(null==e?0:e.length)&&baseIndexOf(e,t,0)>-1}function arrayIncludesWith(e,t,r){for(var n=-1,s=null==e?0:e.length;++n<s;)if(r(t,e[n]))return!0;return!1}function noop(){}var INFINITY$3=1/0,createSet=Set$1&&1/setToArray(new Set$1([,-0]))[1]==INFINITY$3?function(e){return new Set$1(e)}:noop,LARGE_ARRAY_SIZE$1=200;function baseUniq(e,t,r){var n=-1,s=arrayIncludes,o=e.length,i=!0,a=[],l=a;if(r)i=!1,s=arrayIncludesWith;else if(o>=LARGE_ARRAY_SIZE$1){var c=t?null:createSet(e);if(c)return setToArray(c);i=!1,s=cacheHas,l=new SetCache}else l=t?[]:a;e:for(;++n<o;){var d=e[n],h=t?t(d):d;if(d=r||0!==d?d:0,i&&h==h){for(var u=l.length;u--;)if(l[u]===h)continue e;t&&l.push(h),a.push(d)}else s(l,h,r)||(l!==a&&l.push(h),a.push(d))}return a}function uniq(e){return e&&e.length?baseUniq(e):[]}function last(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}function parent(e,t){return t.length<2?e:baseGet(e,baseSlice(t,0,-1))}function baseUnset(e,t){return null==(e=parent(e,t=castPath(t,e)))||delete e[toKey(last(t))]}function unset(e,t){return null==e||baseUnset(e,t)}var LARGE_ARRAY_SIZE$2=200;function baseDifference(e,t,r,n){var s=-1,o=arrayIncludes,i=!0,a=e.length,l=[],c=t.length;if(!a)return l;r&&(t=arrayMap(t,baseUnary(r))),n?(o=arrayIncludesWith,i=!1):t.length>=LARGE_ARRAY_SIZE$2&&(o=cacheHas,i=!1,t=new SetCache(t));e:for(;++s<a;){var d=e[s],h=null==r?d:r(d);if(d=n||0!==d?d:0,i&&h==h){for(var u=c;u--;)if(t[u]===h)continue e;l.push(d)}else o(t,h,n)||l.push(d)}return l}var without=baseRest(function(e,t){return isArrayLikeObject(e)?baseDifference(e,t):[]});function baseForOwn(e,t){return e&&baseFor(e,t,keys)}function createBaseEach(e,t){return function(r,n){if(null==r)return r;if(!isArrayLike(r))return e(r,n);for(var s=r.length,o=t?s:-1,i=Object(r);(t?o--:++o<s)&&!1!==n(i[o],o,i););return r}}var baseEach=createBaseEach(baseForOwn);function baseMap(e,t){var r=-1,n=isArrayLike(e)?Array(e.length):[];return baseEach(e,function(e,s,o){n[++r]=t(e,s,o)}),n}function baseSortBy(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}function compareAscending(e,t){if(e!==t){var r=void 0!==e,n=null===e,s=e==e,o=isSymbol(e),i=void 0!==t,a=null===t,l=t==t,c=isSymbol(t);if(!a&&!c&&!o&&e>t||o&&i&&l&&!a&&!c||n&&i&&l||!r&&l||!s)return 1;if(!n&&!o&&!c&&e<t||c&&r&&s&&!n&&!o||a&&r&&s||!i&&s||!l)return-1}return 0}function compareMultiple(e,t,r){for(var n=-1,s=e.criteria,o=t.criteria,i=s.length,a=r.length;++n<i;){var l=compareAscending(s[n],o[n]);if(l)return n>=a?l:l*("desc"==r[n]?-1:1)}return e.index-t.index}function baseOrderBy(e,t,r){var n=-1;return t=arrayMap(t.length?t:[identity],baseUnary(baseIteratee)),baseSortBy(baseMap(e,function(e,r,s){return{criteria:arrayMap(t,function(t){return t(e)}),index:++n,value:e}}),function(e,t){return compareMultiple(e,t,r)})}function orderBy(e,t,r,n){return null==e?[]:(isArray$1(t)||(t=null==t?[]:[t]),isArray$1(r=n?void 0:r)||(r=null==r?[]:[r]),baseOrderBy(e,t,r))}class PathObject{constructor(e){e&&(this.__root__=e)}contains(e){return Boolean(this.getRoot()[e])}getRoot(){return this.__root__?this.__root__:this}get(e){if(e){if(isString(e)){let t=e;return this.getRoot()[t]}if(arguments.length>1&&(e=Array.prototype.slice(arguments,0)),!isArray(e))throw new Error("Illegal argument for PathObject.get()");return get(this.getRoot(),e)}}set(e,t){if(!e)throw new Error("Illegal argument: PathObject.set(>path<, value) - path is mandatory.");if(isString(e)){let r=e;this.getRoot()[r]=t}else setWith(this.getRoot(),e,t)}delete(e){if(isString(e)){let t=e;delete this.getRoot()[t]}else if(1===e.length)delete this.getRoot()[e[0]];else{if(!unset(this.getRoot(),e))throw new Error("Could not delete property at path"+e)}}clear(){var e=this.getRoot();for(var t in e)e.hasOwnProperty(t)&&delete e[t]}}PathObject.prototype._isPathObject=!0;class Conflict extends Error{constructor(e,t){super("Conflict: "+JSON.stringify(e)+" vs "+JSON.stringify(t)),this.a=e,this.b=t}}const INSERT="insert",DELETE="delete";class TextOperation{constructor(e){if(!e||void 0===e.type||void 0===e.pos||void 0===e.str)throw new Error("Illegal argument: insufficient data.");if(this.type=e.type,this.pos=e.pos,this.str=e.str,!this.isInsert()&&!this.isDelete())throw new Error("Illegal type.");if(!isString(this.str))throw new Error("Illegal argument: expecting string.");if(!isNumber(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}apply(e){if(this.isEmpty())return e;if(this.type===INSERT){if(e.length<this.pos)throw new Error("Provided string is too short.");return e.splice?e.splice(this.pos,0,this.str):e.slice(0,this.pos).concat(this.str).concat(e.slice(this.pos))}if(e.length<this.pos+this.str.length)throw new Error("Provided string is too short.");return e.splice?e.splice(this.pos,this.str.length):e.slice(0,this.pos).concat(e.slice(this.pos+this.str.length))}clone(){return new TextOperation(this)}isNOP(){return"NOP"===this.type||0===this.str.length}isInsert(){return this.type===INSERT}isDelete(){return this.type===DELETE}getLength(){return this.str.length}invert(){var e={type:this.isInsert()?DELETE:INSERT,pos:this.pos,str:this.str};return new TextOperation(e)}hasConflict(e){return _hasConflict(this,e)}isEmpty(){return 0===this.str.length}toJSON(){return{type:this.type,pos:this.pos,str:this.str}}toString(){return["(",this.isInsert()?INSERT:DELETE,",",this.pos,",'",this.str,"')"].join("")}get _isOperation(){return!0}get _isTextOperation(){return!0}static transform(e,t,r){return transform(e,t,r)}static hasConflict(e,t){return _hasConflict(e,t)}static Insert(e,t){return new TextOperation({type:INSERT,pos:e,str:t})}static Delete(e,t){return new TextOperation({type:DELETE,pos:e,str:t})}static fromJSON(e){return new TextOperation(e)}static get INSERT(){return INSERT}static get DELETE(){return DELETE}}function _hasConflict(e,t){return e.type===INSERT&&t.type===INSERT?e.pos===t.pos:e.type===DELETE&&t.type===DELETE?!(e.pos>=t.pos+t.str.length||t.pos>=e.pos+e.str.length):(e.type===DELETE?(r=e,n=t):(r=t,n=e),n.pos>=r.pos&&n.pos<r.pos+r.str.length);var r,n}function transformInsertInsert(e,t){e.pos===t.pos?t.pos+=e.str.length:e.pos<t.pos?t.pos+=e.str.length:e.pos+=t.str.length}function transformDeleteDelete(e,t,r){if(e.pos>t.pos)return transformDeleteDelete(t,e,!r);if(e.pos===t.pos&&e.str.length>t.str.length)return transformDeleteDelete(t,e,!r);if(t.pos<e.pos+e.str.length){var n=t.pos-e.pos,s=e.str.length-n,o=n+t.str.length;e.str=e.str.slice(0,n)+e.str.slice(o),t.str=t.str.slice(s),t.pos-=n}else t.pos-=e.str.length}function transformInsertDelete(e,t){if(e.type===DELETE)return transformInsertDelete(t,e);if(e.pos<=t.pos)t.pos+=e.str.length;else if(e.pos>=t.pos+t.str.length)e.pos-=t.str.length;else{var r=e.pos-t.pos;t.str=t.str.slice(0,r)+e.str+t.str.slice(r),e.str=""}}function transform(e,t,r){if((r=r||{})["no-conflict"]&&_hasConflict(e,t))throw new Conflict(e,t);return e.type===INSERT&&t.type===INSERT?transformInsertInsert(e,t):e.type===DELETE&&t.type===DELETE?transformDeleteDelete(e,t,!0):transformInsertDelete(e,t),[e,t]}const NOP="NOP",DELETE$1="delete",INSERT$1="insert";class ArrayOperation{constructor(e){if(!e||!e.type)throw new Error("Illegal argument: insufficient data.");if(this.type=e.type,this.type!==NOP){if(this.type!==INSERT$1&&this.type!==DELETE$1)throw new Error("Illegal type.");if(this.pos=e.pos,this.val=e.val,!isNumber(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}}apply(e){if(this.type===NOP)return e;if(this.type===INSERT$1){if(e.length<this.pos)throw new Error("Provided array is too small.");return e.splice(this.pos,0,this.val),e}if(e.length<this.pos)throw new Error("Provided array is too small.");if(!isEqual(e[this.pos],this.val))throw Error("Unexpected value at position "+this.pos+". Expected "+this.val+", found "+e[this.pos]);return e.splice(this.pos,1),e}clone(){var e={type:this.type,pos:this.pos,val:cloneDeep(this.val)};return new ArrayOperation(e)}invert(){var e=this.toJSON();return this.type===NOP?e.type=NOP:this.type===INSERT$1?e.type=DELETE$1:e.type=INSERT$1,new ArrayOperation(e)}hasConflict(e){return ArrayOperation.hasConflict(this,e)}toJSON(){var e={type:this.type};return this.type===NOP?e:(e.pos=this.pos,e.val=cloneDeep(this.val),e)}isInsert(){return this.type===INSERT$1}isDelete(){return this.type===DELETE$1}getOffset(){return this.pos}getValue(){return this.val}isNOP(){return this.type===NOP}toString(){return["(",this.isInsert()?INSERT$1:DELETE$1,",",this.getOffset(),",'",this.getValue(),"')"].join("")}get _isOperation(){return!0}get _isArrayOperation(){return!0}static transform(e,t,r){return transform$1(e,t,r)}static hasConflict(e,t){return hasConflict(e,t)}static Insert(e,t){return new ArrayOperation({type:INSERT$1,pos:e,val:t})}static Delete(e,t){return new ArrayOperation({type:DELETE$1,pos:e,val:t})}static Nop(){return new ArrayOperation({type:NOP})}static fromJSON(e){return new ArrayOperation(e)}static get NOP(){return NOP}static get DELETE(){return DELETE$1}static get INSERT(){return INSERT$1}}function hasConflict(e,t){return e.type!==NOP&&t.type!==NOP&&(e.type===INSERT$1&&t.type===INSERT$1&&e.pos===t.pos)}function transformInsertInsert$1(e,t){e.pos===t.pos?t.pos+=1:e.pos<t.pos?t.pos+=1:e.pos+=1}function transformDeleteDelete$1(e,t,r={}){e.pos===t.pos?(e.val!==t.val&&console.error("FIXME: transforming array delete-delete at the same position but with different values."),r.rebase||(t.type=NOP,e.type=NOP)):e.pos<t.pos?t.pos-=1:e.pos-=1}function transformInsertDelete$1(e,t,r={}){e.type===DELETE$1&&([e,t]=[t,e]),r.rebase?e.pos<t.pos?t.pos+=1:e.pos>t.pos&&(e.pos-=1):e.pos<=t.pos?t.pos+=1:e.pos-=1}var transform$1=function(e,t,r={}){if(r["no-conflict"]&&hasConflict(e,t))throw new Conflict(e,t);return e.type===NOP||t.type===NOP||(e.type===INSERT$1&&t.type===INSERT$1?transformInsertInsert$1(e,t,r):e.type===DELETE$1&&t.type===DELETE$1?transformDeleteDelete$1(e,t,r):transformInsertDelete$1(e,t,r)),[e,t]};const SHIFT="shift";class CoordinateOperation{constructor(e){if(!e||void 0===e.type)throw new Error("Illegal argument: insufficient data.");if(this.type=e.type,this.val=e.val,!this.isShift())throw new Error("Illegal type.");if(!isNumber(this.val))throw new Error("Illegal argument: expecting number as shift value.")}apply(e){return e.offset=e.offset+this.val,e}isShift(){return this.type===SHIFT}isNOP(){switch(this.type){case SHIFT:return 0===this.val;default:return!1}}clone(){return new CoordinateOperation(this)}invert(){let e;switch(this.type){case SHIFT:e={type:SHIFT,val:-this.val};break;default:throw new Error("Invalid type.")}return new CoordinateOperation(e)}hasConflict(){return!1}toJSON(){return{type:this.type,val:this.val}}toString(){return["(",this.type,",",this.val,"')"].join("")}get _isOperation(){return!0}get _isCoordinateOperation(){return!0}static transform(e,t,r){return transform$2(e,t,r)}static fromJSON(e){return new CoordinateOperation(e)}static Shift(e){return new CoordinateOperation({type:SHIFT,val:e})}static get SHIFT(){return SHIFT}}function transformShiftShift(e,t,r){r.rebase||(e.val+=t.val,t.val+=e.val)}function transform$2(e,t,r={}){if(e.type!==SHIFT||t.type!==SHIFT)throw new Error("Illegal type");return transformShiftShift(e,t,r),[e,t]}const NOP$1="NOP",CREATE="create",DELETE$2="delete",UPDATE="update",SET="set";class ObjectOperation{constructor(e){if(!e)throw new Error("Data of ObjectOperation is missing.");if(!e.type)throw new Error("Invalid data: type is mandatory.");if(this.type=e.type,e.type!==NOP$1){if(this.path=e.path,!e.path)throw new Error("Invalid data: path is mandatory.");if(this.type===CREATE||this.type===DELETE$2){if(!e.val)throw new Error("Invalid data: value is missing.");this.val=e.val}else if(this.type===UPDATE){if(!e.diff)throw new Error("Invalid data: diff is mandatory for update operation.");if(this.diff=e.diff,e.diff._isTextOperation)this.propertyType="string";else if(e.diff._isArrayOperation)this.propertyType="array";else{if(!e.diff._isCoordinateOperation)throw new Error("Invalid data: unsupported operation type for incremental update.");this.propertyType="coordinate"}}else{if(this.type!==SET)throw new Error("Invalid type: "+e.type);this.val=e.val,this.original=e.original}}}apply(e){if(this.type===NOP$1)return e;var t;if(t=e._isPathObject?e:new PathObject(e),this.type===CREATE)return t.set(this.path,cloneDeep(this.val)),e;if(this.type===DELETE$2)t.delete(this.path,"strict");else if(this.type===UPDATE){var r=this.diff;switch(this.propertyType){case"array":{let e=t.get(this.path);r.apply(e);break}case"string":{let e=t.get(this.path);isNil(e)&&(e=""),e=r.apply(e),t.set(this.path,e);break}case"coordinate":{let e=t.get(this.path);if(!e)throw new Error("No coordinate with path "+this.path);r.apply(e);break}default:throw new Error("Unsupported property type for incremental update: "+this.propertyType)}}else{if(this.type!==SET)throw new Error("Invalid type.");t.set(this.path,cloneDeep(this.val))}return e}clone(){var e={type:this.type,path:this.path};return this.val&&(e.val=cloneDeep(this.val)),this.diff&&(e.diff=this.diff.clone()),new ObjectOperation(e)}isNOP(){return this.type===NOP$1||(this.type===UPDATE?this.diff.isNOP():void 0)}isCreate(){return this.type===CREATE}isDelete(){return this.type===DELETE$2}isUpdate(e){return e?this.type===UPDATE&&this.propertyType===e:this.type===UPDATE}isSet(){return this.type===SET}invert(){if(this.type===NOP$1)return new ObjectOperation({type:NOP$1});var e=new ObjectOperation(this);return this.type===CREATE?e.type=DELETE$2:this.type===DELETE$2?e.type=CREATE:this.type===UPDATE?e.diff=this.diff.clone().invert():(e.val=this.original,e.original=this.val),e}hasConflict(e){return ObjectOperation.hasConflict(this,e)}toJSON(){if(this.type===NOP$1)return{type:NOP$1};var e={type:this.type,path:this.path};if(this.type===CREATE||this.type===DELETE$2)e.val=this.val;else if(this.type===UPDATE){if(this.diff._isTextOperation)e.propertyType="string";else if(this.diff._isArrayOperation)e.propertyType="array";else{if(!this.diff._isCoordinateOperation)throw new Error("Invalid property type.");e.propertyType="coordinate"}e.diff=this.diff.toJSON()}else e.val=this.val,e.original=this.original;return e}getType(){return this.type}getPath(){return this.path}getValue(){return this.val}getOldValue(){return this.original}getValueOp(){return this.diff}toString(){switch(this.type){case CREATE:return["(+,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case DELETE$2:return["(-,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case UPDATE:return["(>>,",JSON.stringify(this.path),this.propertyType,this.diff.toString(),")"].join("");case SET:return["(=,",JSON.stringify(this.path),this.val,this.original,")"].join("");case NOP$1:return"NOP";default:throw new Error("Invalid type")}}static transform(e,t,r){return transform$3(e,t,r)}static hasConflict(e,t){return hasConflict$1(e,t)}static Create(e,t){var r;return r=isString(e)?[e]:e,new ObjectOperation({type:CREATE,path:r,val:t})}static Delete(e,t){var r;return r=isString(e)?[e]:e,new ObjectOperation({type:DELETE$2,path:r,val:t})}static Update(e,t){return new ObjectOperation({type:UPDATE,path:e,diff:t})}static Set(e,t,r){return new ObjectOperation({type:SET,path:e,val:cloneDeep(r),original:cloneDeep(t)})}static fromJSON(e){return"update"===(e=cloneDeep(e)).type&&(e.diff=_deserializeDiffOp(e.propertyType,e.diff)),new ObjectOperation(e)}static get NOP(){return NOP$1}static get CREATE(){return CREATE}static get DELETE(){return DELETE$2}static get UPDATE(){return UPDATE}static get SET(){return SET}get _isOperation(){return!0}get _isObjectOperation(){return!0}}function hasConflict$1(e,t){return e.type!==NOP$1&&t.type!==NOP$1&&isEqual(e.path,t.path)}function transformDeleteDelete$2(e,t,r={}){r.rebase||(e.type=NOP$1,t.type=NOP$1)}function transformCreateCreate(e,t,r={}){if(!r.rebase)throw new Error("Can not transform two concurring creates of the same property")}function transformDeleteCreate(e,t,r={}){if(!r.rebase)throw new Error("Illegal state: can not create and delete a value at the same time.")}function _transformDeleteUpdate(e,t,r,n={}){if(!n.rebase){if(e.type!==DELETE$2)return _transformDeleteUpdate(t,e,!0,n);let s=_deserializeDiffOp(t.propertyType,t.diff);r?(e.val=s.apply(e.val),t.type=NOP$1):(e.type=NOP$1,t.type=CREATE,t.val=s.apply(e.val))}}function transformDeleteUpdate(e,t,r={}){return _transformDeleteUpdate(e,t,!1,r)}function transformCreateUpdate(){throw new Error("Can not transform a concurring create and update of the same property")}function transformUpdateUpdate(e,t,r={}){let n,s=_deserializeDiffOp(e.propertyType,e.diff),o=_deserializeDiffOp(t.propertyType,t.diff);switch(t.propertyType){case"string":n=TextOperation.transform(s,o,r);break;case"array":n=ArrayOperation.transform(s,o,r);break;case"coordinate":n=CoordinateOperation.transform(s,o,r);break;default:throw new Error("Unsupported property type for incremental update")}e.diff=n[0],t.diff=n[1]}function _deserializeDiffOp(e,t){if(t._isOperation)return t;switch(e){case"string":return TextOperation.fromJSON(t);case"array":return ArrayOperation.fromJSON(t);case"coordinate":return CoordinateOperation.fromJSON(t);default:throw new Error("Unsupported property type for incremental update.")}}function transformCreateSet(e,t,r={}){if(!r.rebase)throw new Error("Illegal state: can not create and set a value at the same time.")}function _transformDeleteSet(e,t,r,n={}){if(e.type!==DELETE$2)return _transformDeleteSet(t,e,!0,n);n.rebase||(r?(e.val=t.val,t.type=NOP$1):(e.type=NOP$1,t.type=CREATE,t.original=void 0))}function transformDeleteSet(e,t,r={}){return _transformDeleteSet(e,t,!1,r)}function transformUpdateSet(e,t,r={}){if(!r.rebase)throw new Error("Unresolvable conflict: update + set.")}function transformSetSet(e,t,r={}){r.rebase||(e.type=NOP$1,t.original=e.val)}const _NOP=0,_CREATE=1,_DELETE=2,_UPDATE=4,_SET=8,CODE=(()=>{const e={};return e[NOP$1]=0,e[CREATE]=1,e[DELETE$2]=2,e[UPDATE]=4,e[SET]=8,e})(),__transform__=(()=>{const e={};return e[2]=transformDeleteDelete$2,e[3]=transformDeleteCreate,e[6]=transformDeleteUpdate,e[1]=transformCreateCreate,e[5]=transformCreateUpdate,e[4]=transformUpdateUpdate,e[9]=transformCreateSet,e[10]=transformDeleteSet,e[12]=transformUpdateSet,e[8]=transformSetSet,e})();function transform$3(e,t,r={}){if(r["no-conflict"]&&hasConflict$1(e,t))throw new Conflict(e,t);return e.isNOP()||t.isNOP()?[e,t]:(isEqual(e.path,t.path)&&__transform__[CODE[e.type]|CODE[t.type]](e,t,r),[e,t])}class OperationSerializer{constructor(){this.SEPARATOR="\t"}serialize(e){var t=[];switch(e.type){case"create":t.push("c"),t.push(e.val.id),t.push(e.val);break;case"delete":t.push("d"),t.push(e.val.id),t.push(e.val);break;case"set":t.push("s"),t.push(e.path.join(".")),t.push(e.val),t.push(e.original);break;case"update":t.push("u"),t.push(e.path.join(".")),Array.prototype.push.apply(t,this.serializePrimitiveOp(e.diff));break;default:throw new Error("Unsupported operation type.")}return t}serializePrimitiveOp(e){var t=[];if(e._isTextOperation)e.isInsert()?t.push("t+"):e.isDelete()&&t.push("t-"),t.push(e.pos),t.push(e.str);else if(e._isArrayOperation)e.isInsert()?t.push("a+"):e.isDelete()&&t.push("a-"),t.push(e.pos),t.push(e.val);else{if(!e._isCoordinateOperation)throw new Error("Unsupported operation type.");if(!e.isShift())throw new Error("Unsupported CoordinateOperation type.");t.push("c>>"),t.push(e.pos),t.push(e.val)}return t}deserialize(e,t){t||(t=new Tokenizer(e,this.SEPARATOR));var r,n,s,o,i,a=t.getString();switch(a){case"c":n=t.getPath(),s=t.getObject(),r=ObjectOperation.Create(n,s);break;case"d":n=t.getPath(),s=t.getObject(),r=ObjectOperation.Delete(n,s);break;case"s":n=t.getPath(),s=t.getAny(),o=t.getAny(),r=ObjectOperation.Set(n,o,s);break;case"u":n=t.getPath(),i=this.deserializePrimitiveOp(e,t),r=ObjectOperation.Update(n,i);break;default:throw new Error("Illegal type for ObjectOperation: "+a)}return r}deserializePrimitiveOp(e,t){t||(t=new Tokenizer(e,this.SEPARATOR));var r,n,s,o=t.getString();switch(o){case"t+":n=t.getNumber(),s=t.getString(),r=TextOperation.Insert(n,s);break;case"t-":n=t.getNumber(),s=t.getString(),r=TextOperation.Delete(n,s);break;case"a+":n=t.getNumber(),s=t.getAny(),r=ArrayOperation.Insert(n,s);break;case"a-":n=t.getNumber(),s=t.getAny(),r=ArrayOperation.Delete(n,s);break;case"c>>":s=t.getNumber(),r=CoordinateOperation.Shift(s);break;default:throw new Error("Unsupported operation type: "+o)}return r}}class Tokenizer{constructor(e,t){isArray(arguments[0])?this.tokens=arguments[0]:this.tokens=e.split(t),this.pos=-1}error(e){throw new Error("Parsing error: "+e+"\n"+this.tokens[this.pos])}getString(){this.pos++;var e=this.tokens[this.pos];return'"'===e[0]&&(e=e.slice(1,-1)),e}getNumber(){this.pos++;var e=this.tokens[this.pos];try{return isNumber(e)?e:parseInt(this.tokens[this.pos],10)}catch(e){this.error("expected number")}}getObject(){this.pos++;var e=this.tokens[this.pos];try{return isObject(e)?e:JSON.parse(this.tokens[this.pos])}catch(e){this.error("expected object")}}getAny(){return this.pos++,this.tokens[this.pos]}getPath(){return this.getString().split(".")}}function last$1(e){return e[e.length-1]}OperationSerializer.Tokenizer=Tokenizer;class Selection{constructor(){var e={};Object.defineProperty(this,"_internal",{enumerable:!1,value:e}),e.doc=null}clone(){var e=this._clone();return this._internal.doc&&e.attach(this._internal.doc),e}getDocument(){var e=this._internal.doc;if(!e)throw new Error("Selection is not attached to a document.");return e}isAttached(){return Boolean(this._internal.doc)}attach(e){return this._internal.doc=e,this}isNull(){return!1}isPropertySelection(){return!1}isContainerSelection(){return!1}isNodeSelection(){return!1}isCustomSelection(){return!1}isCollapsed(){return!0}isReverse(){return!1}getType(){throw new Error("Selection.getType() is abstract.")}get type(){return this.getType()}equals(e){return this===e||!!e&&(this.isNull()===e.isNull()&&this.getType()===e.getType())}toString(){return"null"}toJSON(){throw new Error("This method is abstract.")}createWith(e){let t=this.constructor,r=this.toJSON();return Object.assign(r,e),t.fromJSON(r)}get _isSelection(){return!0}static get nullSelection(){return NULL_SELECTION}}class NullSelection extends Selection{isNull(){return!0}getType(){return"null"}toJSON(){return null}clone(){return this}}const NULL_SELECTION=Object.freeze(new NullSelection);function isArrayEqual(e,t){if(e===t)return!0;if(!isArray(e)||!isArray(t))return!1;if(e.length!==t.length)return!1;let r=e.length;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}class Coordinate{constructor(e,t){if("SKIP"!==arguments[0]){if(1===arguments.length){let e=arguments[0];this.path=e.path,this.offset=e.offset}else this.path=e,this.offset=t;if(!isArray(this.path))throw new Error("Invalid arguments: path should be an array.");if(!isNumber(this.offset)||this.offset<0)throw new Error("Invalid arguments: offset must be a positive number.")}}equals(e){return e===this||isArrayEqual(e.path,this.path)&&e.offset===this.offset}withCharPos(e){return new Coordinate(this.path,e)}getNodeId(){return this.path[0]}getPath(){return this.path}getOffset(){return this.offset}toJSON(){return{path:this.path.slice(),offset:this.offset}}clone(){return new Coordinate(this.toJSON())}toString(){return"("+this.path.join(".")+", "+this.offset+")"}isPropertyCoordinate(){return this.path.length>1}isNodeCoordinate(){return 1===this.path.length}hasSamePath(e){return isArrayEqual(this.path,e.path)}isEqual(e){return!!e&&(this.offset===e.offset&&this.hasSamePath(e))}get _isCoordinate(){return!0}}class PropertySelection extends Selection{constructor(e,t,r,n,s,o){if(super(),1===arguments.length){let i=arguments[0];e=i.path,t=i.startOffset,r=i.endOffset,n=i.reverse,s=i.containerPath,o=i.surfaceId}if(!e||!isNumber(t))throw new Error("Invalid arguments: `path` and `startOffset` are mandatory");this.start=new Coordinate(e,t),this.end=new Coordinate(e,isNumber(r)?r:t),this.reverse=Boolean(n),this.containerPath=s,this.surfaceId=o}get path(){return this.start.path}get startOffset(){return this.start.offset}get endOffset(){return this.end.offset}toJSON(){return{type:"property",path:this.start.path,startOffset:this.start.offset,endOffset:this.end.offset,reverse:this.reverse,containerPath:this.containerPath,surfaceId:this.surfaceId}}isPropertySelection(){return!0}getType(){return"property"}isNull(){return!1}isCollapsed(){return this.start.offset===this.end.offset}isReverse(){return this.reverse}equals(e){return Selection.prototype.equals.call(this,e)&&this.start.equals(e.start)&&this.end.equals(e.end)}toString(){return["PropertySelection(",JSON.stringify(this.path),", ",this.start.offset," -> ",this.end.offset,this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")}collapse(e){var t;return t="left"===e?this.start.offset:this.end.offset,this.createWithNewRange(t,t)}getPath(){return this.start.path}getNodeId(){return this.start.path[0]}isInsideOf(e,t){return!e.isNull()&&(e.isContainerSelection()?e.contains(this,t):t?isArrayEqual(this.path,e.path)&&this.start.offset>e.start.offset&&this.end.offset<e.end.offset:isArrayEqual(this.path,e.path)&&this.start.offset>=e.start.offset&&this.end.offset<=e.end.offset)}contains(e,t){return!e.isNull()&&e.isInsideOf(this,t)}overlaps(e,t){return!e.isNull()&&(e.isContainerSelection()?e.overlaps(this):!!isArrayEqual(this.path,e.path)&&(t?!(this.start.offset>=e.end.offset||this.end.offset<=e.start.offset):!(this.start.offset>e.end.offset||this.end.offset<e.start.offset)))}isRightAlignedWith(e){return!e.isNull()&&(e.isContainerSelection()?e.isRightAlignedWith(this):isArrayEqual(this.path,e.path)&&this.end.offset===e.end.offset)}isLeftAlignedWith(e){return!e.isNull()&&(e.isContainerSelection()?e.isLeftAlignedWith(this):isArrayEqual(this.path,e.path)&&this.start.offset===e.start.offset)}expand(e){if(e.isNull())return this;if(e.isContainerSelection())return e.expand(this);if(!isArrayEqual(this.path,e.path))throw new Error("Can not expand PropertySelection to a different property.");var t=Math.min(this.start.offset,e.start.offset),r=Math.max(this.end.offset,e.end.offset);return this.createWithNewRange(t,r)}truncateWith(e){if(e.isNull())return this;if(e.isInsideOf(this,"strict"))throw new Error("Can not truncate with a contained selections");if(!this.overlaps(e))return this;let t,r,n,s;if(e.isPropertySelection())t=e.start.offset,r=e.end.offset;else{if(!e.isContainerSelection())return this;t=isArrayEqual(e.start.path,this.start.path)?e.start.offset:this.start.offset,r=isArrayEqual(e.end.path,this.start.path)?e.end.offset:this.end.offset}if(this.start.offset>t&&this.end.offset>r)n=r,s=this.end.offset;else if(this.start.offset<t&&this.end.offset<r)n=this.start.offset,s=t;else if(this.start.offset===t){if(this.end.offset<=r)return Selection.nullSelection;n=r,s=this.end.offset}else{if(this.end.offset!==r){if(e.contains(this))return Selection.nullSelection;throw new Error("Illegal state.")}if(this.start.offset>=t)return Selection.nullSelection;n=this.start.offset,s=t}return this.createWithNewRange(n,s)}createWithNewRange(e,t){var r=new PropertySelection(this.path,e,t,!1,this.containerPath,this.surfaceId),n=this._internal.doc;return n&&r.attach(n),r}_clone(){return new PropertySelection(this.start.path,this.start.offset,this.end.offset,this.reverse,this.containerPath,this.surfaceId)}}function compareCoordinates(e,t,r,n){if(r.hasSamePath(n))return Math.sign(r.offset-n.offset);{let s=_getContainerAddress(e,t,r),o=_getContainerAddress(e,t,n),i=Math.min(s.length,o.length);for(let e=0;e<i;e++){let t=s[e],r=o[e];if(t<r)return-1;if(t>r)return 1}return s.length===o.length?Math.sign(r.offset-n.offset):(console.error("FIXME: unexpected case in compareCoordinates()"),0)}}function _getContainerAddress(e,t,r){let n=t[0],s=r.path[0],o=e.get(s).getXpath(),i=[];for(;o;){if(o.id===n)return i;i.unshift(o.pos||0),o=o.prev}}function isCoordinateBefore(e,t,r,n,s){let o=compareCoordinates(e,t,r,n);return s?o<0:o<=0}PropertySelection.fromJSON=function(e){return new PropertySelection(e)};class ContainerSelection extends Selection{constructor(e,t,r,n,s,o,i){if(super(),1===arguments.length){let a=arguments[0];e=a.containerPath,t=a.startPath,r=a.startOffset,n=a.endPath,s=a.endOffset,o=a.reverse,i=a.surfaceId}if(this.containerPath=e,!this.containerPath)throw new Error("Invalid arguments: `containerPath` is mandatory");this.start=new Coordinate(t,r),this.end=new Coordinate(isNil(n)?t:n,isNil(s)?r:s),this.reverse=Boolean(o),this.surfaceId=i}get startPath(){return console.warn("DEPRECATED: use sel.start.path instead."),this.start.path}get startOffset(){return console.warn("DEPRECATED: use sel.start.offset instead."),this.start.offset}get endPath(){return console.warn("DEPRECATED: use sel.end.path instead."),this.end.path}get endOffset(){return console.warn("DEPRECATED: use sel.end.offset instead."),this.end.offset}toJSON(){return{type:"container",containerPath:this.containerPath,startPath:this.start.path,startOffset:this.start.offset,endPath:this.end.path,endOffset:this.end.offset,reverse:this.reverse,surfaceId:this.surfaceId}}isContainerSelection(){return!0}getType(){return"container"}isNull(){return!1}isCollapsed(){return this.start.equals(this.end)}isReverse(){return this.reverse}equals(e){return Selection.prototype.equals.call(this,e)&&isArrayEqual(this.containerPath,e.containerPath)&&this.start.equals(e.start)&&this.end.equals(e.end)}toString(){return["ContainerSelection(",this.containerPath,", ",JSON.stringify(this.start.path),", ",this.start.offset," -> ",JSON.stringify(this.end.path),", ",this.end.offset,this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")}isInsideOf(e,t){return!e.isNull()&&(this._isCoordinateBefore(e.start,this.start,t)&&this._isCoordinateBefore(this.end,e.end,t))}contains(e,t){return!e.isNull()&&(this._isCoordinateBefore(this.start,e.start,t)&&this._isCoordinateBefore(e.end,this.end,t))}containsNode(e){let t=this.containerPath,r=this.getDocument(),n=new Coordinate([e],0),s=compareCoordinates(r,t,n,this.start),o=compareCoordinates(r,t,n,this.end);return s>=0&&o<0}overlaps(e){return!this._isCoordinateBefore(this.end,e.start,!1)||this._isCoordinateBefore(e.end,this.start,!1)}isLeftAlignedWith(e){return this.start.isEqual(e.start)}isRightAlignedWith(e){return this.end.isEqual(e.end)}collapse(e){let t;return _createNewSelection(this,t="left"===e?this.start:this.end,t)}expand(e){let t,r;return _createNewSelection(this,t=this.start.isEqual(e.start)?new Coordinate(this.start.path,Math.min(this.start.offset,e.start.offset)):this._isCoordinateBefore(e.start,this.start,!1)?new Coordinate(e.start.path,e.start.offset):this.start,r=this.end.isEqual(e.end)?new Coordinate(this.end.path,Math.max(this.end.offset,e.end.offset)):this._isCoordinateBefore(this.end,e.end,!1)?new Coordinate(e.end.path,e.end.offset):this.end)}truncateWith(e){if(e.isInsideOf(this,"strict"))throw new Error("Can not truncate with a contained selections");if(!this.overlaps(e))return this;let t,r;if(this._isCoordinateBefore(e.start,this.start,"strict")&&this._isCoordinateBefore(e.end,this.end,"strict"))t=e.end,r=this.end;else if(this._isCoordinateBefore(this.start,e.start,"strict")&&this._isCoordinateBefore(this.end,e.end,"strict"))t=this.start,r=e.start;else if(this.start.isEqual(e.start)){if(!this._isCoordinateBefore(e.end,this.end,"strict"))return Selection.nullSelection;t=e.end,r=this.end}else{if(!this.end.isEqual(e.end)){if(this.isInsideOf(e))return Selection.nullSelection;throw new Error("Could not determine coordinates for truncate. Check input")}if(!this._isCoordinateBefore(this.start,e.start,"strict"))return Selection.nullSelection;t=this.start,r=e.start}return _createNewSelection(this,t,r)}splitIntoPropertySelections(){return this.getFragments().filter(e=>e instanceof Selection.Fragment).map(e=>new PropertySelection(e.path,e.startOffset,e.endOffset,!1,this.containerPath,this.surfaceId))}_getContainerContent(){return this.getDocument().get(this.containerPath)}_clone(){return new ContainerSelection(this)}_isCoordinateBefore(e,t,r){return isCoordinateBefore(this.getDocument(),this.containerPath,e,t,r)}get path(){throw new Error("ContainerSelection has no path property. Use startPath and endPath instead")}get _isContainerSelection(){return!0}static fromJSON(e){return new ContainerSelection(e)}}function _createNewSelection(e,t,r){let n;n=t===r?new PropertySelection({path:t.path,startOffset:t.offset,endOffset:t.offset,containerPath:e.containerPath,surfaceId:e.surfaceId}):new ContainerSelection(e.containerPath,t.path,t.offset,r.path,r.offset,!1,e.surfaceId);const s=e._internal.doc;return s&&n.attach(s),n}class NodeSelection extends Selection{constructor(e,t,r,n,s){if(super(),1===arguments.length){let o=arguments[0];e=o.containerPath,t=o.nodeId,r=o.mode,n=o.reverse,s=o.surfaceId}if(!isArray(e))throw new Error("'containerPath' is mandatory.");if(!isString(t))throw new Error("'nodeId' is mandatory.");r=r||"full",this.containerPath=e,this.nodeId=t,this.mode=r,this.reverse=Boolean(n),this.surfaceId=s,this.start=new Coordinate([t],0),this.end=new Coordinate([t],1)}equals(e){return super.equals(e)&&this.nodeId===e.nodeId&&this.mode===e.mode}isNodeSelection(){return!0}getType(){return"node"}getNodeId(){return this.nodeId}isFull(){return"full"===this.mode}isBefore(){return"before"===this.mode}isAfter(){return"after"===this.mode}isCollapsed(){return"full"!==this.mode}toJSON(){return{type:"node",nodeId:this.nodeId,mode:this.mode,reverse:this.reverse,containerPath:this.containerPath,surfaceId:this.surfaceId}}toString(){return["NodeSelection(",this.containerPath,".",this.nodeId,", ",this.mode,", ",this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")}collapse(e){if("left"===e)return this.isBefore()?this:new NodeSelection(this.containerPath,this.nodeId,"before",this.reverse,this.surfaceId);if("right"===e)return this.isAfter()?this:new NodeSelection(this.containerPath,this.nodeId,"after",this.reverse,this.surfaceId);throw new Error("'direction' must be either 'left' or 'right'")}_getCoordinate(){return"before"===this.mode?new Coordinate([this.nodeId],0):"after"===this.mode?new Coordinate([this.nodeId],1):void 0}_clone(){return new NodeSelection(this)}static fromJSON(e){return new NodeSelection(e)}get _isNodeSelection(){return!0}}class CustomSelection extends Selection{constructor(e,t,r,n){if(super(),1===arguments.length){let s=arguments[0];e=s.customType,t=s.data,r=s.nodeId,n=s.surfaceId}if(!e)throw new Error("'customType' is required");if(!r)throw new Error("'nodeId' is required");this.customType=e,this.data=t||{},this.nodeId=r,this.surfaceId=n}isCustomSelection(){return!0}getType(){return"custom"}getCustomType(){return this.customType}getNodeId(){return this.nodeId}toJSON(){let e={type:"custom",customType:this.customType,nodeId:this.nodeId,data:cloneDeep(this.data)};return this.surfaceId&&(e.surfaceId=this.surfaceId),e}toString(){return["CustomSelection(",this.customType,", ",JSON.stringify(this.data),")"].join("")}equals(e){return Selection.prototype.equals.call(this,e)&&e.isCustomSelection()&&isEqual(this.data,e.data)}_clone(){return new CustomSelection(this)}get _isCustomSelection(){return!0}static fromJSON(e){return new CustomSelection(e)}}function getContainerRoot(e,t,r){let n=e.get(r),s=t[0];for(;n;){let e=n.getParent();if(e&&e.id===s)return n;n=e}}function getContainerPosition(e,t,r){return getContainerRoot(e,t,r).getPosition()}function fromJSON(e){if(!e)return Selection.nullSelection;switch(e.type){case"property":return PropertySelection.fromJSON(e);case"container":return ContainerSelection.fromJSON(e);case"node":return NodeSelection.fromJSON(e);case"custom":return CustomSelection.fromJSON(e);default:return Selection.nullSelection}}function isFirst(e,t,r){if(r.isNodeCoordinate())return 0===r.offset;let n=getContainerRoot(e,t,r.path[0]);if(n.isText())return 0===r.offset;if(n.isList()){let e=r.path[0];return n.items[0]===e&&0===r.offset}return!1}function isLast(e,t,r){if(r.isNodeCoordinate())return r.offset>0;let n=getContainerRoot(e,t,r.path[0]);if(n.isText())return r.offset>=n.getLength();if(n.isList()){let t=r.path[0],s=e.get(t);return last$1(n.items)===t&&r.offset===s.getLength()}return!1}function isEntirelySelected(e,t,r,n){let{isEntirelySelected:s}=_getRangeInfo(e,t,r,n);return s}function _getRangeInfo(e,t,r,n){let s=!0,o=!0;return(t.isText()||t.isListItem())&&(r&&0!==r.offset&&(s=!1),n&&n.offset<t.getLength()&&(o=!1)),{isFirst:s,isLast:o,isEntirelySelected:s&&o}}function setCursor(e,t,r,n){if(t.isText()){let s=0;if("after"===n){s=t.getText().length}e.setSelection({type:"property",path:t.getPath(),startOffset:s,containerPath:r})}else if(t.isList()){let s,o;"after"===n?o=(s=t.getLastItem()).getLength():(s=t.getFirstItem(),o=0),e.setSelection({type:"property",path:s.getPath(),startOffset:o,containerPath:r})}else e.setSelection({type:"node",containerPath:r,nodeId:t.id})}function selectNode(e,t,r){e.setSelection(createNodeSelection({doc:e,nodeId:t,containerPath:r}))}function createNodeSelection({doc:e,nodeId:t,containerPath:r,mode:n,reverse:s,surfaceId:o}){let i=e.get(t);if(!i)return Selection.nullSelection;if((i=getContainerRoot(e,r,t)).isText())return new PropertySelection({path:i.getPath(),startOffset:"after"===n?i.getLength():0,endOffset:"before"===n?0:i.getLength(),reverse:s,containerPath:r,surfaceId:o});if(i.isList()&&i.getLength()>0){let e=i.getFirstItem(),t=i.getLastItem(),a={path:e.getPath(),offset:0},l={path:t.getPath(),offset:t.getLength()};return"after"===n?a=l:"before"===n&&(l=a),new ContainerSelection({startPath:a.path,startOffset:a.offset,endPath:l.path,endOffset:l.offset,reverse:s,containerPath:r,surfaceId:o})}return new NodeSelection({nodeId:t,mode:n,reverse:s,containerPath:r,surfaceId:o})}function stepIntoIsolatedNode(e,t){if(t.grabFocus())return!0;let r=t.find(".sc-surface");if(r){if(r._isTextPropertyEditor){const t=e.getDocument(),n=r.getPath(),s=t.get(n,"strict");return e.setSelection({type:"property",path:n,startOffset:s.length,surfaceId:r.id}),!0}if(r._isContainerEditor){let t=e.getDocument(),n=r.getContainerPath(),s=t.get();if(s.length>0){setCursor(e,t.get(s[0]),n,"after")}return!0}}return!1}function augmentSelection(e,t){return e&&t&&!e.surfaceId&&!t.isNull()&&(e.containerPath=e.containerPath||t.containerPath,e.surfaceId=e.surfaceId||t.surfaceId),e}function getNodeIdsCoveredByContainerSelection(e,t){let r=t.containerPath,n=getContainerPosition(e,r,t.start.path[0]),s=getContainerPosition(e,r,t.end.path[0]);return e.get(r).slice(n,s+1)}var selectionHelpers=Object.freeze({fromJSON:fromJSON,isFirst:isFirst,isLast:isLast,isEntirelySelected:isEntirelySelected,setCursor:setCursor,selectNode:selectNode,createNodeSelection:createNodeSelection,stepIntoIsolatedNode:stepIntoIsolatedNode,augmentSelection:augmentSelection,getNodeIdsCoveredByContainerSelection:getNodeIdsCoveredByContainerSelection}),annotationHelpers={insertedText:insertedText,deletedText:deletedText,transferAnnotations:transferAnnotations,expandAnnotation:expandAnnotation,fuseAnnotation:fuseAnnotation,truncateAnnotation:truncateAnnotation};function insertedText(e,t,r){if(r){var n=e.getIndex("annotations").get(t.path);for(let c=0;c<n.length;c++){let d=n[c];var s=t.offset,o=d.start.offset,i=d.end.offset,a=o,l=i;(s<o||s===o)&&(a+=r),(s<i||s===i&&!d.isInlineNode())&&(l+=r),a!==o&&e.set([d.id,"start","offset"],a),l!==i&&e.set([d.id,"end","offset"],l)}}}function deletedText(e,t,r,n){if(r!==n){var s=e.getIndex("annotations").get(t),o=n-r;for(let t=0;t<s.length;t++){let u=s[t];var i=r,a=n,l=u.start.offset,c=u.end.offset,d=l,h=c;a<=l?(d-=o,h-=o,e.set([u.id,"start","offset"],d),e.set([u.id,"end","offset"],h)):(i<=l&&(d=l-Math.min(a-i,l-i)),i<=c&&(h=c-Math.min(a-i,c-i)),l!==c&&d===h?e.delete(u.id):(l!==d&&e.set([u.id,"start","offset"],d),c!==h&&e.set([u.id,"end","offset"],h)))}}}function transferAnnotations(e,t,r,n,s){var o=e.getIndex("annotations").get(t,r);for(let t=0;t<o.length;t++){let c=o[t];var i=r>c.start.offset&&r<c.end.offset,a=c.start.offset,l=c.end.offset;if(i){if(c.canSplit()){let t=c.toJSON();t.id=uuid(c.type+"_"),t.start.path=n,t.start.offset=s,t.end.path=n,t.end.offset=s+c.end.offset-r,e.create(t)}let t=c.start.offset,o=r;o===t?e.delete(c.id):(t!==a&&e.set([c.id,"start","offset"],t),o!==l&&e.set([c.id,"end","offset"],o))}else c.start.offset>=r&&(e.set([c.id,"start","path"],n),e.set([c.id,"start","offset"],s+c.start.offset-r),e.set([c.id,"end","path"],n),e.set([c.id,"end","offset"],s+c.end.offset-r))}}function truncateAnnotation(e,t,r){if(!r||!r._isSelection)throw new Error('Argument "selection" is required.');if(!t||!t.isAnnotation())throw new Error('Argument "anno" is required and must be an annotation.');let n=t.getSelection().truncateWith(r);return t._updateRange(e,n),t}function expandAnnotation(e,t,r){if(!r||!r._isSelection)throw new Error('Argument "selection" is required.');if(!t||!t.isAnnotation())throw new Error('Argument "anno" is required and must be an annotation.');let n=t.getSelection().expand(r);return t._updateRange(e,n),t}function fuseAnnotation(e,t){if(!isArray(t)||t.length<2)throw new Error("fuseAnnotation(): at least two annotations are necessary.");let r,n;t.forEach(function(e,t){if(0===t)r=e.getSelection(),n=e.type;else{if(e.type!==n)throw new Error("fuseAnnotation(): all annotations must be of the same type.");r=r.expand(e.getSelection())}});for(var s=1;s<t.length;s++)e.delete(t[s].id);expandAnnotation(e,t[0],r),e.setSelection(r)}class NodeIndex{select(e){throw new Error("This method is abstract.")}clear(){throw new Error("This method is abstract")}create(e){throw new Error("This method is abstract.")}delete(e){throw new Error("This method is abstract.")}set(e,t,r,n){this.update(e,t,r,n)}update(e,t,r,n){throw new Error("This method is abstract.")}reset(e){this.clear(),this._initialize(e)}clone(){return new(0,this.constructor)}_initialize(e){forEach(e.getNodes(),function(e){this.select(e)&&this.create(e)}.bind(this))}}NodeIndex.create=function(e){var t=Object.assign(new NodeIndex,e);return t.clone=function(){return NodeIndex.create(e)},t},NodeIndex.filterByType=function(e){return function(t){return t.isInstanceOf(e)}};class DocumentIndex extends NodeIndex{}function isFunction$1(e){return"function"==typeof e}function filter(e,t){if(!e)return[];if(e.constructor.prototype.filter&&isFunction$1(e.constructor.prototype.filter))return e.filter(t);let r=[];return forEach(e,(e,n)=>{t(e,n)&&r.push(e)}),r}function flatten$1(e){return Array.prototype.concat.apply([],e)}function flattenOften(e,t){if(!(t>0))throw new Error("'max' must be a positive number");let r=e.length;e=flatten$1(e);let n=1;for(;n<t&&r<e.length;)r=e.length,e=flatten$1(e),n++;return e}function getPropertyAnnotationsForSelection(e,t,r){if(r=r||{},!t.isPropertySelection())return[];let n=t.getPath(),s=e.getIndex("annotations").get(n,t.start.offset,t.end.offset);return r.type&&(s=filter(s,DocumentIndex.filterByType(r.type))),s}function getContainerAnnotationsForSelection(e,t,r,n){if(!r)throw new Error("'containerPath' is required.");n=n||{};let s=e.getIndex("container-annotations"),o=[];return s&&(o=filter(o=s.get(r,n.type),function(e){return t.overlaps(e.getSelection())})),o}function isContainerAnnotation(e,t){return e.getSchema().isInstanceOf(t,"@container-annotation")}function getTextForSelection(e,t){if(!t||t.isNull())return"";if(t.isPropertySelection()){return e.get(t.start.path).substring(t.start.offset,t.end.offset)}if(t.isContainerSelection()){let r=[],n=getNodeIdsCoveredByContainerSelection(e,t),s=n.length;for(let o=0;o<s;o++){let i=n[o],a=e.get(i);if(a.isText()){let e=a.getText();o===s-1&&(e=e.slice(0,t.end.offset)),0===o&&(e=e.slice(t.start.offset)),r.push(e)}}return r.join("\n")}}function getMarkersForSelection(e,t){if(!t||!t.isPropertySelection())return[];const r=t.getPath();return filter(e.getIndex("markers").get(r),function(e){return e.containsSelection(t)})}function deleteNode(e,t){return console.error("DEPRECATED: use documentHelpers.deepDeleteNode() instead"),deepDeleteNode(e,t)}function deepDeleteNode(e,t){if(!t)return void console.warn("Invalid arguments");if(isString(t)&&(t=e.get(t)),t.isText()){let r=e.getIndex("annotations").get(t.id);for(let t=0;t<r.length;t++)e.delete(r[t].id)}let r=t.getSchema();e.delete(t.id),r.getOwnedProperties().forEach(r=>{let n=t[r.name];if(r.isArray()){let t=n;t.length>0&&(isArray(t[0])&&(t=flattenOften(t,2)),t.forEach(t=>{deepDeleteNode(e,e.get(t))}))}else deepDeleteNode(e,e.get(n))})}function copyNode(e){let t=[],r=e.getDocument(),n=e.getSchema();for(let r of n)if(r.isReference()&&r.isOwned()||"file"===r.type){let n=e[r.name];t.push(s(n))}return t.push(e.toJSON()),forEach(e.getDocument().getIndex("annotations").get([e.id]),function(e){t.push(e.toJSON())}),flatten$1(t).filter(Boolean);function s(e){if(!e)return null;if(isArray(e))return flatten$1(e.map(s));{let t=e;if(!t)return null;let n=r.get(t);if(!n)return;return copyNode(n)}}}function deleteTextRange(e,t,r){t||(t={path:r.path,offset:0});let n=t.path,s=e.get(n);if(r||(r={path:t.path,offset:s.length}),!isArrayEqual(t.path,r.path))throw new Error("start and end must be on one property");let o=t.offset;if(o<0)throw new Error("start offset must be >= 0");let i=r.offset;if(i>s.length)throw new Error("end offset must be smaller than the text length");e.update(n,{type:"delete",start:o,end:i}),e.getAnnotations(n).forEach(function(t){let r=t.start.offset,n=t.end.offset;n<=o||(r>=i?(e.update([t.id,"start"],{type:"shift",value:o-i}),e.update([t.id,"end"],{type:"shift",value:o-i})):r>=o&&n<=i?e.delete(t.id):r>=o&&n>=i?(r>o&&e.update([t.id,"start"],{type:"shift",value:o-r}),e.update([t.id,"end"],{type:"shift",value:o-i})):r<=o&&n<=i?e.update([t.id,"end"],{type:"shift",value:o-n}):r<o&&n>=i?e.update([t.id,"end"],{type:"shift",value:o-i}):console.warn("TODO: handle annotation update case."))})}function deleteListRange(e,t,r,n,s={}){let o,i;e!==t.getDocument()&&(t=e.get(t.id)),r?o=e.get(r.path[0]):r={path:(o=t.getItemAt(0)).getPath(),offset:0},n?i=e.get(n.path[0]):n={path:(i=t.getLastItem()).getPath(),offset:i.getLength()};let a=t.getItemPosition(o),l=t.getItemPosition(i);if(a===l)return void deleteTextRange(e,r,n);a>l&&([r,n]=[n,r],[a,l]=[l,a],[o,i]=[i,o]);let c=isEntirelySelected(e,o,r,null),d=isEntirelySelected(e,i,null,n);d?(t.removeItemAt(l),deepDeleteNode(e,i)):deleteTextRange(e,null,n);let h=t.getItems();for(let r=l-1;r>a;r--){let n=h[r];t.removeItemAt(r),deepDeleteNode(e,n)}c&&s.deleteEmptyFirstItem?(t.removeItemAt(a),deepDeleteNode(e,o)):deleteTextRange(e,r,null),c||d||mergeListItems(e,t.id,a)}function setText(e,t,r){return e.get(t).length>0&&deleteTextRange(e,{path:t,offset:0}),e.update(t,{type:"insert",start:0,text:r}),this}function mergeListItems(e,t,r){let n=e.get(t),s=n.getItemAt(r),o=s.getPath(),i=s.getLength(),a=n.getItemAt(r+1),l=a.getPath();n.removeItemAt(r+1),e.update(o,{type:"insert",start:i,text:a.getText()}),annotationHelpers.transferAnnotations(e,l,0,o,i),deepDeleteNode(e,a)}const SNIPPET_ID="snippet",TEXT_SNIPPET_ID="text-snippet";function insertAt(e,t,r,n){e.update(t,{type:"insert",pos:r,value:n})}function append(e,t,r){insertAt(e,t,e.get(t).length,r)}function removeAt(e,t,r){let n=e.update(t,{type:"delete",pos:r});if(n&&n.diff)return n.diff.val}function remove(e,t,r){let n=e.get(t).indexOf(r);return n>=0&&removeAt(e,t,n)}function getNodesForPath(e,t){return getNodesForIds(e,e.get(t))}function getNodesForIds(e,t){return t.map(t=>e.get(t,"strict"))}function getNodeAt(e,t,r){let n=e.get(t);return e.get(n[r])}function getPreviousNode(e,t,r){if(r>0)return getNodeAt(e,t,r-1)}function getNextNode(e,t,r){return getNodeAt(e,t,r+1)}function getChildren(e){const t=e.getDocument(),r=e.id,n=e.getSchema();let s=[];for(let o of n){const n=o.name;if(o.isText()){forEach(t.getAnnotations([r,n]),e=>s.push(e))}else if(o.isReference()&&o.isOwned()){let r=e[n];r&&(o.isArray()?s=s.concat(r.map(e=>t.get(e))):s.push(t.get(r)))}}return s}function getParent(e){if(e._isAnnotation){let t=e,r=t.start.path[0];return t.getDocument().get(r)}return e.getParent()}function createNodeFromJson(e,t){if(!t)throw new Error("'data' is mandatory");if(!t.type)throw new Error("'data.type' is mandatory");if(!isFunction$1(e.create))throw new Error("First argument must be document or tx");let r=t.type,n=e.getSchema().getNodeSchema(r),s={type:r,id:t.id};for(let r of n){const n=r.name;if(!t.hasOwnProperty(n))continue;let o=t[n];if(r.isReference())if(r.isArray())s[n]=o.map(t=>createNodeFromJson(e,t).id);else{let t=createNodeFromJson(e,o);s[n]=t.id}else s[r.name]=o}return e.create(s)}var documentHelpers=Object.freeze({getPropertyAnnotationsForSelection:getPropertyAnnotationsForSelection,getContainerAnnotationsForSelection:getContainerAnnotationsForSelection,isContainerAnnotation:isContainerAnnotation,getTextForSelection:getTextForSelection,getMarkersForSelection:getMarkersForSelection,deleteNode:deleteNode,deepDeleteNode:deepDeleteNode,copyNode:copyNode,deleteTextRange:deleteTextRange,deleteListRange:deleteListRange,setText:setText,mergeListItems:mergeListItems,SNIPPET_ID:SNIPPET_ID,TEXT_SNIPPET_ID:TEXT_SNIPPET_ID,insertAt:insertAt,append:append,removeAt:removeAt,remove:remove,getNodesForPath:getNodesForPath,getNodesForIds:getNodesForIds,getNodeAt:getNodeAt,getPreviousNode:getPreviousNode,getNextNode:getNextNode,getChildren:getChildren,getParent:getParent,createNodeFromJson:createNodeFromJson,compareCoordinates:compareCoordinates,isCoordinateBefore:isCoordinateBefore,getContainerRoot:getContainerRoot,getContainerPosition:getContainerPosition});class DocumentChange{constructor(e,t,r){if(1===arguments.length&&isPlainObject(arguments[0])){let e=arguments[0];this.sha=e.sha,this.timestamp=e.timestamp,this.before=e.before||{},this.ops=e.ops,this.info=e.info,this.after=e.after||{}}else{if(3!==arguments.length)throw new Error("Illegal arguments.");this.sha=uuid(),this.info={},this.timestamp=Date.now(),this.ops=e.slice(0),this.before=t||{},this.after=r||{}}this.updated=null,this.created=null,this.deleted=null}_extractInformation(e){if(this._extracted)return;let t=this.ops,r={},n={},s={},o=[];function i(t){switch(t.type){case"create":case"delete":{let e=t.val;e.hasOwnProperty("start")&&e.start.path&&(s[getKeyForPath(e.start.path)]=!0),e.hasOwnProperty("end")&&e.end.path&&(s[getKeyForPath(e.end.path)]=!0);break}case"update":case"set":{let r=e.get(t.path[0]);r&&(r.isPropertyAnnotation()?s[getKeyForPath(r.start.path)]=!0:r.isContainerAnnotation()&&o.push(r));break}}}for(let e=0;e<t.length;e++){let o=t[e];"create"===o.type&&(r[o.val.id]=o.val,delete n[o.val.id]),"delete"===o.type&&(delete r[o.val.id],n[o.val.id]=o.val),"set"!==o.type&&"update"!==o.type||(s[getKeyForPath(o.path)]=!0,s[o.path[0]]=!0),i(o)}o.forEach(t=>{let r=getContainerPosition(e,t.containerPath,t.start.path[0]),o=getContainerPosition(e,t.containerPath,t.end.path[0]),i=e.get(t.containerPath);for(let t=r;t<=o;t++){let r,o=e.get(i[t]);r=o.isText()?o.getPath():[o.id],n[o.id]||(s[getKeyForPath(r)]=!0)}}),Object.keys(n).length>0&&forEach(s,function(e,t){let r=t.split(".")[0];n[r]&&delete s[t]}),this.created=r,this.deleted=n,this.updated=s,this._extracted=!0}invert(){let e=this.toJSON();e.ops=[];let t=e.before;e.before=e.after,e.after=t;let r=DocumentChange.fromJSON(e),n=[];for(let e=this.ops.length-1;e>=0;e--)n.push(this.ops[e].invert());return r.ops=n,r}hasUpdated(e){let t;return t=isString(e)?e:getKeyForPath(e),this.updated[t]}hasDeleted(e){return this.deleted[e]}serialize(){let e=new OperationSerializer,t=this.toJSON();return t.ops=this.ops.map(function(t){return e.serialize(t)}),JSON.stringify(t)}clone(){return DocumentChange.fromJSON(this.toJSON())}toJSON(){let e={sha:this.sha,before:clone(this.before),ops:map(this.ops,function(e){return e.toJSON()}),info:this.info,after:clone(this.after)};e.after.selection=void 0,e.before.selection=void 0;let t=this.before.selection;return t&&t._isSelection&&(e.before.selection=t.toJSON()),(t=this.after.selection)&&t._isSelection&&(e.after.selection=t.toJSON()),e}}function transformDocumentChange(e,t,r={}){_transformBatch(e,t,r)}function transformSelection(e,t,r){let n=e.clone();return _transformSelectionInplace(n,t,r)?n:e}function _transformSingle(e,t,r={}){let n=r.immutableLeft,s=r.immutableRight;for(let o=0;o<e.ops.length;o++)for(let i=0;i<t.ops.length;i++){let a=e.ops[o],l=t.ops[i];n&&(a=a.clone()),s&&(l=l.clone()),ObjectOperation.transform(a,l,r)}n||(e.before&&_transformSelectionInplace(e.before.selection,t,r),e.after&&_transformSelectionInplace(e.after.selection,t,r)),s||(t.before&&_transformSelectionInplace(t.before.selection,e,r),t.after&&_transformSelectionInplace(t.after.selection,e,r))}function _transformBatch(e,t,r={}){isArray(e)||(e=[e]),isArray(t)||(t=[t]);for(let n=0;n<e.length;n++){let s=e[n];for(let e=0;e<t.length;e++){_transformSingle(s,t[e],r)}}}function _transformSelectionInplace(e,t,r={}){if(!e||!e.isPropertySelection()&&!e.isContainerSelection())return!1;let n=t.ops,s=!1,o=e.isCollapsed();for(let t=0;t<n.length;t++){let i=n[t];s|=_transformCoordinateInplace(e.start,i,r),o?(e.isContainerSelection()&&(e.end.path=e.start.path),e.end.offset=e.start.offset):s|=_transformCoordinateInplace(e.end,i,r)}return s}function _transformCoordinateInplace(e,t,r){if(!isEqual(t.path,e.path))return!1;let n=!1;if("update"===t.type&&"string"===t.propertyType){let r,s=t.diff;s.isInsert()&&s.pos<=e.offset?(r=e.offset+s.str.length,e.offset=r,n=!0):s.isDelete()&&s.pos<=e.offset&&(r=Math.max(s.pos,e.offset-s.str.length),e.offset=r,n=!0)}return n}DocumentChange.deserialize=function(e){let t=new OperationSerializer,r=JSON.parse(e);return r.ops=r.ops.map(function(e){return t.deserialize(e)}),r.before.selection&&(r.before.selection=fromJSON(r.before.selection)),r.after.selection&&(r.after.selection=fromJSON(r.after.selection)),new DocumentChange(r)},DocumentChange.fromJSON=function(e){let t=cloneDeep(e);return t.ops=e.ops.map(function(e){return ObjectOperation.fromJSON(e)}),t.before.selection=fromJSON(e.before.selection),t.after.selection=fromJSON(e.after.selection),new DocumentChange(t)};var operationHelpers=Object.freeze({transformDocumentChange:transformDocumentChange,transformSelection:transformSelection});class CollabEngine extends EventEmitter{constructor(e){super(),this.documentEngine=e,this._collaborators={}}_register(e,t,r){let n=this._collaborators[e];n||(n=this._collaborators[e]={collaboratorId:e,documents:{}}),n.info=r,n.documents[t]={}}_unregister(e,t){let r=this._collaborators[e];delete r.documents[t],0===Object.keys(r.documents).length&&delete this._collaborators[e]}getDocumentIds(e){let t=this._collaborators[e];return t?Object.keys(t.documents):[]}getCollaborators(e,t){let r={};return forEach(this._collaborators,function(n){if(n.documents[e]&&n.collaboratorId!==t){let e={collaboratorId:n.collaboratorId};e=Object.assign({},n.info,e),r[n.collaboratorId]=e}}),r}getCollaboratorIds(e,t){return map(this.getCollaborators(e,t),function(e){return e.collaboratorId})}sync({documentId:e,version:t,change:r,collaboratorId:n},s){this._sync({documentId:e,version:t,change:r},function(t,r){if(t)return s(t);this._register(n,e),s(null,r)}.bind(this))}_sync({documentId:e,version:t,change:r},n){this.documentEngine.getVersion(e,(s,o)=>{if(s)return n(s);t>o?n(new SubstanceError("InvalidVersionError",{message:"Client version greater than server version"})):r&&o===t?this._syncFF({documentId:e,version:t,change:r},n):r&&o>t?this._syncRB({documentId:e,version:t,change:r},n):r?console.warn("Unhandled case"):this._syncPullOnly({documentId:e,version:t,change:r},n)})}_syncPullOnly({documentId:e,version:t,change:r},n){this.documentEngine.getChanges(e,t,(e,s)=>{if(e)return n(e);let o;if(s.length>0){let e=[];s.forEach(t=>{e=e.concat(t.ops)}),o=new DocumentChange(e,{},{}),o=this.serializeChange(o)}n(null,{serverChange:o,change:r,version:t})})}_syncFF({documentId:e,change:t},r){this.documentEngine.addChange(e,t,(e,n)=>{if(e)return r(e);r(null,{change:t,serverChange:null,version:n})})}_syncRB({documentId:e,change:t,version:r},n){this._rebaseChange({documentId:e,change:t,version:r},function(r,s){if(r)return n(r);this.documentEngine.addChange(e,t,function(e,t){if(e)return n(e);n(null,{change:s.change,serverChange:s.serverChange,version:t})})}.bind(this))}_rebaseChange({documentId:e,change:t,version:r},n){this.documentEngine.getChanges(e,r,function(e,r,s){if(e)return n(e);let o=r.map(this.deserializeChange),i=this.deserializeChange(t);transformDocumentChange(i,o);let a=o.reduce(function(e,t){return e.concat(t.ops)},[]),l=new DocumentChange(a,{},{});n(null,{change:this.serializeChange(i),serverChange:this.serializeChange(l),version:s})}.bind(this))}disconnect(e){this._unregister(e.collaboratorId,e.documentId)}serializeChange(e){return e.toJSON()}deserializeChange(e){return DocumentChange.fromJSON(e)}}class CollabServer extends Server{constructor(e){super(e),this.scope="substance/collab",this.configurator=e.configurator,this.documentEngine=this.configurator.getDocumentEngine(),this.collabEngine=new CollabEngine(this.documentEngine)}_error(e,t,r){console.error(r),t.error({scope:this.scope,type:"error",error:{name:e.message.type+"Error",cause:{name:r.name}},documentId:e.message.documentId}),this.next(e,t)}authenticate(e,t){this.config.authenticate?this.config.authenticate(e,(r,n)=>{if(r)return console.error(r),void this._error(e,t,new SubstanceError("AuthenticationError",{cause:r}));e.setAuthenticated(n),this.next(e,t)}):super.authenticate.apply(this,arguments)}enhanceRequest(e,t){this.config.enhanceRequest?this.config.enhanceRequest(e,r=>{if(r)return console.error("enhanceRequest returned an error",r),void this._error(e,t,r);e.setEnhanced(),this.next(e,t)}):super.enhanceRequest.apply(this,arguments)}onDisconnect(e){this.collabEngine.getDocumentIds(e).forEach(function(t){this._disconnectDocument(e,t)}.bind(this))}execute(e,t){let r=e.message,n=this[r.type];n?n.call(this,e,t):console.error("Method",r.type,"not implemented for CollabServer")}sync(e,t){let r=e.message;this.collabEngine.sync(r,(n,s)=>{if(n)return void this._error(e,t,n);let o=this.collabEngine.getCollaborators(r.documentId,r.collaboratorId);t.send({scope:this.scope,type:"syncDone",documentId:r.documentId,version:s.version,serverChange:s.serverChange}),forEach(o,e=>{this.send(e.collaboratorId,{scope:this.scope,type:"update",documentId:r.documentId,version:s.version,change:s.change})}),this.next(e,t)})}disconnect(e,t){let r=e.message,n=r.collaboratorId,s=r.documentId;this._disconnectDocument(n,s),t.send({scope:this.scope,type:"disconnectDone",documentId:r.documentId}),this.next(e,t)}_disconnectDocument(e,t){this.collabEngine.disconnect({documentId:t,collaboratorId:e})}}function request(e,t,r,n){var s=new XMLHttpRequest;s.open(e,t,!0),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.onload=function(){if(!(s.status>=200&&s.status<400))return n(new Error("Request failed. Returned status: "+s.status));var e=s.responseText;isJson(e)&&(e=JSON.parse(e)),n(null,e)},r?s.send(JSON.stringify(r)):s.send()}function isJson(e){try{JSON.parse(e)}catch(e){return!1}return!0}class DocumentClient{constructor(e){this.config=e}createDocument(e,t){request("POST",this.config.httpUrl,e,t)}getDocument(e,t){request("GET",this.config.httpUrl+e,null,t)}deleteDocument(e,t){request("DELETE",this.config.httpUrl+e,null,t)}}class ClientConnection extends EventEmitter{constructor(e){super(),this.config=e,this._onMessage=this._onMessage.bind(this),this._onConnectionOpen=this._onConnectionOpen.bind(this),this._onConnectionClose=this._onConnectionClose.bind(this),this._connect()}_createWebSocket(){throw SubstanceError("AbstractMethodError")}_connect(){this.ws=this._createWebSocket(),this.ws.addEventListener("open",this._onConnectionOpen),this.ws.addEventListener("close",this._onConnectionClose),this.ws.addEventListener("message",this._onMessage)}_disconnect(){this.ws.removeEventListener("message",this._onMessage),this.ws.removeEventListener("open",this._onConnectionOpen),this.ws.removeEventListener("close",this._onConnectionClose),this.ws=null}_onConnectionOpen(){this.emit("open")}_onConnectionClose(){this._disconnect(),this.emit("close"),console.info("websocket connection closed. Attempting to reconnect in 5s."),setTimeout(function(){this._connect()}.bind(this),5e3)}_onMessage(e){e=this.deserializeMessage(e.data),this.emit("message",e)}send(e){this.isOpen()?this.ws.send(this.serializeMessage(e)):console.warn("Message could not be sent. Connection is not open.",e)}isOpen(){return this.ws&&1===this.ws.readyState}serializeMessage(e){return JSON.stringify(e)}deserializeMessage(e){return JSON.parse(e)}}class WebSocketConnection extends ClientConnection{_createWebSocket(){return new window.WebSocket(this.config.wsUrl)}}function computeSnapshot(e,t){let r=(e=cloneDeep(e)).nodes;return t.forEach(e=>{e.ops.forEach(e=>{try{ObjectOperation.fromJSON(e).apply(r)}catch(t){console.error(t,e)}})}),e}const EMPTY_DOC={nodes:{}};class SnapshotEngine{constructor(e){this.changeStore=e.changeStore,this.snapshotStore=e.snapshotStore}getSnapshot(e,t,r){let n=EMPTY_DOC;this._getClosestSnapshot(e,t,(s,o,i)=>{if(s)return r(s);if(o&&t===i)return r(null,o,t);let a;a=o?i:0,o&&(n=o),this.changeStore.getChanges(e,a,t,(e,s)=>e?r(e):s.length<t-a?r(new Error("Changes missing for reconstructing version "+t)):(n=computeSnapshot(n,s),void r(null,n,t)))})}createSnapshot(e,t,r){this.getSnapshot(e,t,(n,s)=>{if(n)return r(n);this.snapshotStore.saveSnapshot(e,t,s,r)})}_getClosestSnapshot(e,t,r){let n;this.snapshotStore.getVersions(e,(s,o)=>{if(s)return r(s);if(0===o.length)return r(null,void 0);if(o.indexOf(t)>=0)n=t;else{let e=o.filter(function(e){return parseInt(e,10)<t});n=Math.max.apply(null,e)}if(!n)return r(null,void 0);this.snapshotStore.getSnapshot(e,n,r)})}}class DocumentEngine extends EventEmitter{constructor(e){super(),this.changeStore=e.changeStore,this.snapshotStore=e.snapshotStore,this.snapshotFrequency=e.snapshotFrequency||1,this.snapshotEngine=new SnapshotEngine({changeStore:this.changeStore,snapshotStore:this.snapshotStore})}createDocument(e,t,r){this.addChange(e,t,r)}getDocument(e,t,r){if("function"==typeof t&&(r=t,t=void 0),!e)throw new Error("Invalid Arguments");void 0===t?this.getVersion(e,(t,n)=>{if(t)return r(t);this.snapshotEngine.getSnapshot(e,n,r)}):this.snapshotEngine.getSnapshot(e,t,r)}deleteDocument(e,t){this.changeStore.deleteChanges(e,e=>{if(e)return t(new Error("Deleting changes failed"))})}documentExists(e,t){this.getVersion(e,(e,r)=>{if(e)return t(e);t(null,r>=0)})}getChanges(e,t,r,n){this.changeStore.getChanges(e,t,r,n)}getVersion(e,t){this.changeStore.getVersion(e,t)}requestSnapshot(e,t,r){t%this.snapshotFrequency==0?this.snapshotEngine.createSnapshot(e,t,r):r(null)}addChange(e,t,r){this.changeStore.addChange(e,t,(t,n)=>{if(t)return r(t);this.requestSnapshot(e,n,()=>{r(null,n)})})}}class CollabServerConfigurator{constructor(){this.config={heartbeat:3e4,documentStore:void 0,changeStore:void 0,snapshotStore:void 0}}setHost(e){this.config.host=e}setPort(e){this.config.port=e}setDocumentStore(e){this.config.documentStore=e}setChangeStore(e){this.config.changeStore=e}setSnapshotStore(e){this.config.snapshotStore=e}getHost(){return this.config.host}getPort(){return this.config.port}getDocumentStore(){return this.config.documentStore}getChangeStore(){return this.config.changeStore}getSnapshotStore(){return this.config.snapshotStore}getDocumentEngine(){return this.documentEngine||(this.documentEngine=new DocumentEngine({documentStore:this.config.documentStore,changeStore:this.config.changeStore,snapshotStore:this.config.snapshotStore})),this.documentEngine}import(e,t){return e.configure(this,t||{}),this}}class CollabClient extends EventEmitter{constructor(e){super(),this.config=e,this.connection=e.connection,this.scope="substance/collab",this._onMessage=this._onMessage.bind(this),this._onConnectionOpen=this._onConnectionOpen.bind(this),this._onConnectionClose=this._onConnectionClose.bind(this),this.connection.on("open",this._onConnectionOpen),this.connection.on("close",this._onConnectionClose),this.connection.on("message",this._onMessage)}_onConnectionClose(){this.emit("disconnected")}_onConnectionOpen(){this.emit("connected")}_onMessage(e){e.scope===this.scope?this.emit("message",e):"_internal"!==e.scope&&console.info("Message ignored. Not sent in hub scope",e)}send(e){this.connection.isOpen()?(e.scope=this.scope,this.config.enhanceMessage&&(e=this.config.enhanceMessage(e)),this.connection.send(e)):console.warn("Message could not be sent. Connection not open.",e)}isConnected(){return this.connection.isOpen()}dispose(){this.connection.off(this)}}class SnapshotStore{constructor(e){this._snapshots=e||{}}getVersions(e,t){t(null,this._getVersions(e))}getSnapshot(e,t,r){if(3===!arguments.length)throw new Error("Invalid Arguments");let n=this._snapshots[e];if(!n)return r(null,void 0);let s=n[t];s?r(null,s,t):r(null,void 0)}saveSnapshot(e,t,r,n){if(!e||!t||!r)throw new Error("Invalid arguments");let s=this._snapshots[e];s||(s=this._snapshots[e]={}),s[t]=r,n(null,s[t])}deleteSnapshot(e,t,r){let n=this._snapshots[e];if(!n||!n[t])return r(new Error("Snapshot does not exist and can not be deleted"));let s=this._snapshots[e][t];delete this._snapshots[e][t],r(null,s)}_getVersions(e){let t=this._snapshots[e];return t?Object.keys(t):[]}}var CollabServerPackage={name:"collab-server",configure:function(e){e.setChangeStore(new ChangeStore),e.setSnapshotStore(new SnapshotStore)}};class DocumentServer{constructor(e){this.configurator=e.configurator,this.engine=this.configurator.getDocumentEngine(),this.path="/api/documents"}bind(e){e.post(this.path,this._createDocument.bind(this)),e.get(this.path+"/:id",this._getDocument.bind(this)),e.delete(this.path+"/:id",this._deleteDocument.bind(this))}_createDocument(e,t,r){const{documentId:n,change:s}=e.body;this.engine.createDocument(n,s,function(e,n){if(e)return r(e);t.json(n)})}_getDocument(e,t,r){const n=e.params.id;this.engine.getDocument(n,function(e,n,s){if(e)return r(e);t.json({data:n,version:s})})}_deleteDocument(e,t,r){let n=e.params.id;this.engine.deleteDocument(n,function(e,n){if(e)return r(e);t.json(n)})}}function extend(...e){return Object.assign(...e)}class ArrayIterator{constructor(e){this.arr=e,this.pos=-1}get _isArrayIterator(){return!0}hasNext(){return this.pos<this.arr.length-1}next(){return this.pos+=1,this.arr[this.pos]}back(){return this.pos>=0&&(this.pos-=1),this}peek(){return this.arr[this.pos+1]}}function findIndex$1(e,t){if(!isFunction$1(t))return e.indexOf(t);for(let r=0;r<e.length;r++)if(t(e[r]))return r;return-1}class DOMEventListener{constructor(e,t,r){if(!isString(e)||!isFunction$1(t))throw new Error("Illegal arguments: 'eventName' must be a String, and 'handler' must be a Function.");var n=t,s=(r=r||{}).context,o=Boolean(r.capture);s&&(t=t.bind(s)),!0===r.once&&(t=_once(this,t)),this.eventName=e,this.originalHandler=n,this.handler=t,this.capture=o,this.context=s,this.options=r,this._el=null}get _isDOMEventListener(){return!0}static findIndex(e,t,r){return arguments[1]._isDOMEventListener?e.indexOf(arguments[1]):findIndex$1(e,_matches.bind(null,{eventName:t,originalHandler:r}))}}function _matches(e,t){return e.eventName===t.eventName&&e.originalHandler===t.originalHandler}function _once(e,t){return function(r){t(r),e._el.removeEventListener(e)}}const NOT_IMPLEMENTED="This method is not implemented.";class DOMElement{getNativeElement(){throw new Error(NOT_IMPLEMENTED)}isTextNode(){return!1}isElementNode(){return!1}isCommentNode(){return!1}isDocumentNode(){return!1}getTagName(){throw new Error(NOT_IMPLEMENTED)}setTagName(e){throw new Error(NOT_IMPLEMENTED)}getId(){return this.getAttribute("id")}setId(e){return this.setAttribute("id",e),this}hasClass(e){throw new Error(NOT_IMPLEMENTED)}addClass(e){throw new Error(NOT_IMPLEMENTED)}removeClass(e){throw new Error(NOT_IMPLEMENTED)}hasAttribute(e){return Boolean(this.getAttribute(e))}attr(){if(1===arguments.length){if(isString(arguments[0]))return this.getAttribute(arguments[0]);isObject(arguments[0])&&forEach(arguments[0],function(e,t){this.setAttribute(t,e)}.bind(this))}else 2===arguments.length&&this.setAttribute(arguments[0],arguments[1]);return this}removeAttr(e){var t=e.split(/\s+/);return 1===t.length?this.removeAttribute(e):t.forEach(function(e){this.removeAttribute(e)}.bind(this)),this}getAttribute(e){throw new Error(NOT_IMPLEMENTED)}setAttribute(e,t){throw new Error(NOT_IMPLEMENTED)}removeAttribute(e){throw new Error(NOT_IMPLEMENTED)}getAttributes(){throw new Error(NOT_IMPLEMENTED)}htmlProp(){if(1===arguments.length){if(isString(arguments[0]))return this.getProperty(arguments[0]);isObject(arguments[0])&&forEach(arguments[0],function(e,t){this.setProperty(t,e)}.bind(this))}else 2===arguments.length&&this.setProperty(arguments[0],arguments[1]);return this}getProperty(e){throw new Error(NOT_IMPLEMENTED)}setProperty(e,t){throw new Error(NOT_IMPLEMENTED)}val(e){return 0===arguments.length?this.getValue():(this.setValue(e),this)}getValue(){return this.getProperty("value")}setValue(e){return this.setProperty("value",e),this}css(){if(1===arguments.length){if(isString(arguments[0]))return this.getStyle(arguments[0]);if(!isObject(arguments[0]))throw new Error("Illegal arguments.");forEach(arguments[0],function(e,t){this.setStyle(t,e)}.bind(this))}else{if(2!==arguments.length)throw new Error("Illegal arguments.");this.setStyle(arguments[0],arguments[1])}return this}getStyle(e){throw new Error(NOT_IMPLEMENTED)}setStyle(e,t){throw new Error(NOT_IMPLEMENTED)}text(e){return 0===arguments.length?this.getTextContent():(this.setTextContent(e),this)}getTextContent(){throw new Error(NOT_IMPLEMENTED)}setTextContent(e){throw new Error(NOT_IMPLEMENTED)}html(e){return 0===arguments.length?this.getInnerHTML():(this.setInnerHTML(e),this)}getInnerHTML(){throw new Error(NOT_IMPLEMENTED)}getInnerXML(){return this.getInnerHTML()}setInnerHTML(e){throw new Error(NOT_IMPLEMENTED)}setInnerXML(e){return this.setInnerHTML(e)}getOuterHTML(){throw new Error(NOT_IMPLEMENTED)}getOuterXML(){return this.getOuterHTML()}on(e,t,r,n){if(!isString(e))throw new Error('Illegal argument: "event" must be a String.');if(n=n||{},r&&(n.context=r),!t||!isFunction$1(t))throw new Error("Illegal argument: invalid handler function for event "+e);return this.addEventListener(e,t,n),this}off(e,t){if(1!==arguments.length||isString(e))this.removeEventListener(e,t);else{let e=arguments[0];this.getEventListeners().filter(function(t){return t.context===e}).forEach(function(e){this.removeEventListener(e)}.bind(this))}return this}addEventListener(e,t,r={}){let n;return n=1===arguments.length&&arguments[0]?arguments[0]:this._createEventListener(e,t,r),this.eventListeners||(this.eventListeners=[]),n._el=this,this.eventListeners.push(n),this._addEventListenerNative(n),this}_createEventListener(e,t,r){return new DOMEventListener(e,t,r)}_addEventListenerNative(e){}removeEventListener(e,t){if(!this.eventListeners)return;let r=null,n=DOMEventListener.findIndex(this.eventListeners,e,t);return r=this.eventListeners[n],n>-1&&(this.eventListeners.splice(n,1),r._el=null,this._removeEventListenerNative(r)),this}_removeEventListenerNative(e){}removeAllEventListeners(){if(this.eventListeners){for(let e=0;e<this.eventListeners.length;e++){let t=this.eventListeners[e];t._el=null,this._removeEventListenerNative(t)}delete this.eventListeners}}getEventListeners(){return this.eventListeners||[]}getNodeType(){throw new Error(NOT_IMPLEMENTED)}getContentType(){throw new Error(NOT_IMPLEMENTED)}getChildCount(){throw new Error(NOT_IMPLEMENTED)}getChildNodes(){throw new Error(NOT_IMPLEMENTED)}getChildren(){throw new Error(NOT_IMPLEMENTED)}getChildAt(e){throw new Error(NOT_IMPLEMENTED)}getChildIndex(e){throw new Error(NOT_IMPLEMENTED)}getChildNodeIterator(){return new ArrayIterator(this.getChildNodes())}getLastChild(){throw new Error(NOT_IMPLEMENTED)}getFirstChild(){throw new Error(NOT_IMPLEMENTED)}getNextSibling(){throw new Error(NOT_IMPLEMENTED)}getPreviousSibling(){throw new Error(NOT_IMPLEMENTED)}clone(e){throw new Error(NOT_IMPLEMENTED)}createElement(e){throw new Error(NOT_IMPLEMENTED)}createTextNode(e){throw new Error(NOT_IMPLEMENTED)}createComment(e){throw new Error(NOT_IMPLEMENTED)}createProcessingInstruction(e,t){throw new Error(NOT_IMPLEMENTED)}createCDATASection(e){throw new Error(NOT_IMPLEMENTED)}is(e){throw new Error(NOT_IMPLEMENTED)}getParent(){throw new Error(NOT_IMPLEMENTED)}getOwnerDocument(){throw new Error(NOT_IMPLEMENTED)}getDoctype(){throw new Error("NOT_IMPLEMENTED")}setDoctype(e,t,r){throw new Error("NOT_IMPLEMENTED")}setDocType(...e){return console.error("DEPRECATED: use setDoctype() instead"),this.setDoctype(...e)}find(e){throw new Error(NOT_IMPLEMENTED)}findAll(e){throw new Error(NOT_IMPLEMENTED)}append(e){if(1===arguments.length){if(!isArray(e)){let t=e;return this.appendChild(t)}e=e.slice()}else e=arguments;return e&&Array.prototype.forEach.call(e,this.appendChild.bind(this)),this}appendChild(e){throw new Error(NOT_IMPLEMENTED)}insertAt(e,t){throw new Error(NOT_IMPLEMENTED)}insertBefore(e,t){throw new Error(NOT_IMPLEMENTED)}removeAt(e){throw new Error(NOT_IMPLEMENTED)}removeChild(e){throw new Error(NOT_IMPLEMENTED)}replaceChild(e,t){throw new Error(NOT_IMPLEMENTED)}remove(){var e=this.getParent();e&&e.removeChild(this)}empty(){throw new Error(NOT_IMPLEMENTED)}serialize(){return this.getOuterHTML()}isInDocument(){let e=this;for(;e;){if(e.isDocumentNode())return!0;e=e.getParent()}}focus(){return this}select(){return this}blur(){return this}click(){return this}getWidth(){return 0}getHeight(){return 0}getOuterHeight(e){return 0}getOffset(){return{top:0,left:0}}getPosition(){return{top:0,left:0}}getElementFactory(){return this.createElement.bind(this)}emit(e,t){throw new Error(NOT_IMPLEMENTED)}get id(){return this.getId()}set id(e){this.setId(e)}get tagName(){return this.getTagName()}set tagName(e){this.setTagName(e)}get nodeName(){return this.getTagName()}get nodeType(){return this.getNodeType()}get className(){return this.getAttribute("class")}set className(e){this.setAttribute("class",e)}get textContent(){return this.getTextContent()}set textContent(e){this.setTextContent(e)}get innerHTML(){return this.getInnerHTML()}set innerHTML(e){this.setInnerHTML(e)}get outerHTML(){return this.getOuterHTML()}get firstChild(){return this.getFirstChild()}get lastChild(){return this.getLastChild()}get nextSibling(){return this.getNextSibling()}get previousSibling(){return this.getPreviousSibling()}get parentNode(){return this.getParent()}get height(){return this.getHeight()}get width(){return this.getWidth()}get value(){return this.getValue()}set value(e){return this.setValue(e)}get _isDOMElement(){return!0}static get pxStyles(){return PX_STYLES}static get EMPTY_HTML(){return EMPTY_HTML}}const PX_STYLES={top:!0,bottom:!0,left:!0,right:!0,height:!0,width:!0},EMPTY_HTML="<html><head></head><body></body></html>",SIGNATURE=uuid("_BrowserDOMElement");function _attach(e,t){if(!t._isBrowserDOMElement)throw new Error("Invalid argument");if(e.hasOwnProperty(SIGNATURE))throw new Error("Already attached");e[SIGNATURE]=t}function _detach(e){delete e[SIGNATURE]}function _unwrap(e){return e[SIGNATURE]}class BrowserDOMElement extends DOMElement{constructor(e){super(),console.assert(e instanceof window.Node,"Expecting native DOM node."),this.el=e,_attach(e,this)}getNativeElement(){return this.el}getNodeType(){switch(this.el.nodeType){case window.Node.TEXT_NODE:return"text";case window.Node.ELEMENT_NODE:return"element";case window.Node.DOCUMENT_NODE:return"document";case window.Node.COMMENT_NODE:return"comment";case window.Node.PROCESSING_INSTRUCTION_NODE:return"directive";case window.Node.CDATA_SECTION_NODE:return"cdata"}}getDoctype(){return this.isDocumentNode()?this.el.doctype:this.getOwnerDocument().getDoctype()}setDoctype(e,t,r){let n=this._getNativeOwnerDocument(),s=n.doctype,o=n.implementation.createDocumentType(e,t,r);s?s.parentNode.replaceChild(o,s):n.insertBefore(o,n.firstChild)}isTextNode(){return this.el.nodeType===window.Node.TEXT_NODE}isElementNode(){return this.el.nodeType===window.Node.ELEMENT_NODE}isCommentNode(){return this.el.nodeType===window.Node.COMMENT_NODE}isDocumentNode(){return this.el.nodeType===window.Node.DOCUMENT_NODE}hasClass(e){return this.el.classList.contains(e)}addClass(e){return this.el.classList.add(e),this}removeClass(e){return this.el.classList.remove(e),this}hasAttribute(e){return this.el.hasAttribute(e)}getAttribute(e){if(this.el.hasAttribute(e))return this.el.getAttribute(e)}setAttribute(e,t){return this.el.setAttribute(e,String(t)),this}removeAttribute(e){return this.el.removeAttribute(e),this}getAttributes(){return this.el.attributes._mapAdapter||(this.el.attributes._mapAdapter=new AttributesMapAdapter(this.el.attributes)),this.el.attributes._mapAdapter}getProperty(e){return this.el[e]}setProperty(e,t){if(this._isXML())throw new Error("setProperty() is only supported for HTML elements.");return this.el[e]=t,this}getTagName(){return this._isXML()?this.el.tagName:this.el.tagName?this.el.tagName.toLowerCase():void 0}setTagName(e){let t,r=this.createElement(e),n=this.el.attributes,s=n.length;for(t=0;t<s;t++){let e=n.item(t);r.setAttribute(e.name,e.value)}return this.eventListeners&&this.eventListeners.forEach(function(e){r.addEventListener(e.eventName,e.handler,e.capture)}),r.append(this.getChildNodes()),this._replaceNativeEl(r.getNativeElement()),this}getId(){return this.el.id}setId(e){return this.el.id=e,this}getStyle(e){let t=this.el.style[e];if(!t){t=this.getComputedStyle()[e]}return t}getComputedStyle(){return window.getComputedStyle(this.el)}setStyle(e,t){return DOMElement.pxStyles[e]&&isNumber(t)&&(t+="px"),this.el.style[e]=t,this}getTextContent(){return this.el.textContent}setTextContent(e){return this.el.textContent=e,this}getInnerHTML(){if(this._isXML()){let e=new window.XMLSerializer;return Array.prototype.map.call(this.el.childNodes,t=>e.serializeToString(t)).join("")}return this.el.innerHTML}setInnerHTML(e){return this.el.innerHTML=e,this}getOuterHTML(){if(this._isXML()){return(new window.XMLSerializer).serializeToString(this.el)}return this.el.outerHTML}_addEventListenerNative(e){this.el.addEventListener(e.eventName,e.handler,e.capture)}_removeEventListenerNative(e){this.el.removeEventListener(e.eventName,e.handler)}getEventListeners(){return this.eventListeners||[]}getChildCount(){return this.el.childNodes.length}getChildNodes(){let e=[];for(let t=this.el.firstChild;t;t=t.nextSibling)e.push(BrowserDOMElement.wrap(t));return e}getChildNodeIterator(){return new BrowserChildNodeIterator(this.el)}get childNodes(){return this.getChildNodes()}getChildren(){let e=[];for(let t=this.el.firstChild;t;t=t.nextSibling)t.nodeType===window.Node.ELEMENT_NODE&&e.push(BrowserDOMElement.wrap(t));return e}get children(){return this.getChildren()}getChildAt(e){return BrowserDOMElement.wrap(this.el.childNodes[e])}getChildIndex(e){if(!e._isBrowserDOMElement)throw new Error("Expecting a BrowserDOMElement instance.");return Array.prototype.indexOf.call(this.el.childNodes,e.el)}getFirstChild(){let e=this.el.firstChild;return e?BrowserDOMElement.wrap(e):null}getLastChild(){var e=this.el.lastChild;return e?BrowserDOMElement.wrap(e):null}getNextSibling(){let e=this.el.nextSibling;return e?BrowserDOMElement.wrap(e):null}getPreviousSibling(){let e=this.el.previousSibling;return e?BrowserDOMElement.wrap(e):null}clone(e){let t=this.el.cloneNode(e);return BrowserDOMElement.wrap(t)}createDocument(e,t){return BrowserDOMElement.createDocument(e,t)}createElement(e){let t=this._getNativeOwnerDocument().createElement(e);return BrowserDOMElement.wrap(t)}createTextNode(e){let t=this._getNativeOwnerDocument().createTextNode(e);return BrowserDOMElement.wrap(t)}createComment(e){let t=this._getNativeOwnerDocument().createComment(e);return BrowserDOMElement.wrap(t)}createProcessingInstruction(e,t){let r=this._getNativeOwnerDocument().createProcessingInstruction(e,t);return BrowserDOMElement.wrap(r)}createCDATASection(e){let t=this._getNativeOwnerDocument().createCDATASection(e);return BrowserDOMElement.wrap(t)}is(e){let t=this.el;return!!this.isElementNode()&&matches(t,e)}getParent(){let e=this.el.parentNode;return e?BrowserDOMElement.wrap(e):null}getOwnerDocument(){return BrowserDOMElement.wrap(this._getNativeOwnerDocument())}get ownerDocument(){return this.getOwnerDocument()}_getNativeOwnerDocument(){return this.isDocumentNode()?this.el:this.el.ownerDocument}find(e){let t=null;return this.el.querySelector&&(t=this.el.querySelector(e)),t?BrowserDOMElement.wrap(t):null}findAll(e){let t=[];return this.el.querySelectorAll&&(t=this.el.querySelectorAll(e)),Array.prototype.map.call(t,function(e){return BrowserDOMElement.wrap(e)})}_normalizeChild(e){if(isNil(e))return e;if(e instanceof window.Node?e=BrowserDOMElement.wrap(e):!e._isBrowserDOMElement||e instanceof BrowserDOMElement?(isString(e)||isNumber(e))&&(e=this.createTextNode(e)):e=BrowserDOMElement.wrap(e),!e||!e._isBrowserDOMElement)throw new Error("Illegal child type.");return console.assert(_unwrap(e.el)===e,"The backlink to the wrapper should be consistent"),e.getNativeElement()}appendChild(e){let t=this._normalizeChild(e);return t&&this.el.appendChild(t),this}insertAt(e,t){let r=this._normalizeChild(t),n=this.el.childNodes;return e>=n.length?this.el.appendChild(r):this.el.insertBefore(r,n[e]),this}insertBefore(e,t){if(isNil(t))return this.appendChild(e);if(!t._isBrowserDOMElement)throw new Error('insertBefore(): Illegal arguments. "before" must be a BrowserDOMElement instance.');var r=this._normalizeChild(e);return r&&this.el.insertBefore(r,t.el),this}removeAt(e){return this.el.removeChild(this.el.childNodes[e]),this}removeChild(e){if(!e||!e._isBrowserDOMElement)throw new Error("removeChild(): Illegal arguments. Expecting a BrowserDOMElement instance.");return this.el.removeChild(e.el),this}replaceChild(e,t){if(!(t&&e&&t._isBrowserDOMElement&&e._isBrowserDOMElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");return this.el.replaceChild(t.el,e.el),this}empty(){let e=this.el;for(;e.lastChild;)e.removeChild(e.lastChild);return this}remove(){return this.el.parentNode&&this.el.parentNode.removeChild(this.el),this}serialize(){let e=this.el.outerHTML;if(isString(e))return e;return(new window.XMLSerializer).serializeToString(this.el)}isInDocument(){let e=this.el;for(;e;){if(e.nodeType===window.Node.DOCUMENT_NODE)return!0;e=e.parentNode}}_replaceNativeEl(e){console.assert(e instanceof window.Node,"Expecting a native element.");let t=this.el,r=t.parentNode;r&&r.replaceChild(e,t),this.el=e,_detach(t),_detach(e),_attach(e,this)}_getChildNodeCount(){return this.el.childNodes.length}focus(e){return this.el.focus(e),this}select(){return this.el.select(),this}blur(){return this.el.blur(),this}click(){return this.el.click(),!0}getWidth(){let e=this.el.getClientRects()[0];return e?e.width:0}getHeight(){let e=this.el.getClientRects()[0];return e?e.height:0}getOffset(){let e=this.el.getBoundingClientRect();return{top:e.top+document.body.scrollTop,left:e.left+document.body.scrollLeft}}getPosition(){return{left:this.el.offsetLeft,top:this.el.offsetTop}}getOuterHeight(e){let t=this.el.offsetHeight;if(e){let e=this.getComputedStyle();t+=parseInt(e.marginTop,10)+parseInt(e.marginBottom,10)}return t}getContentType(){return this._getNativeOwnerDocument().contentType}_isXML(){return"application/xml"===this.getContentType()}emit(e,t){let r;r=t?new window.CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0}):new window.Event(e,{bubbles:!0,cancelable:!0}),this.el.dispatchEvent(r)}}BrowserDOMElement.prototype._isBrowserDOMElement=!0,BrowserDOMElement.createDocument=function(e,t={}){let r;if("xml"===e){let e,n=[];t.version&&n.push(`version="${t.version}"`),t.encoding&&n.push(`encoding="${t.encoding}"`),e=n.length>0?`<?xml ${n.join(" ")}?><dummy/>`:"<dummy/>",(r=(new window.DOMParser).parseFromString(e,"application/xml")).removeChild(r.firstChild)}else r=(new window.DOMParser).parseFromString(DOMElement.EMPTY_HTML,"text/html");return BrowserDOMElement.wrap(r)},BrowserDOMElement.parseMarkup=function(e,t,r={}){if(!e)return BrowserDOMElement.createDocument(t);let n;r.snippet&&(e=`<div id='__snippet__'>${e}</div>`);let s=new window.DOMParser;if("html"===t?n=BrowserDOMElement.wrap(o(s.parseFromString(e,"text/html"))):"xml"===t&&(n=BrowserDOMElement.wrap(o(s.parseFromString(e,"application/xml")))),r.snippet){let e=n.find("#__snippet__").childNodes;return 1===e.length?e[0]:e}return n;function o(e){if(e){let t=e.querySelector("parsererror");if(t)throw new Error("ParserError: "+BrowserDOMElement.wrap(t).outerHTML)}return e}},BrowserDOMElement.wrap=BrowserDOMElement.wrapNativeElement=function(e){if(!e)return null;{let t=_unwrap(e);if(t)return t;if(e instanceof window.Node)return new BrowserDOMElement(e);if(e._isBrowserDOMElement)return e;if(e===window)return BrowserDOMElement.getBrowserWindow()}},BrowserDOMElement.unwrap=function(e){return _unwrap(e)};class BrowserWindow{constructor(){this.el=window,_attach(window,this)}get _isBrowserDOMElement(){return!0}}function matches(e,t){let r=window.Element.prototype;return(r.matches||r.matchesSelector||r.msMatchesSelector||r.webkitMatchesSelector).call(e,t)}BrowserWindow.prototype.getNativeElement=BrowserDOMElement.prototype.getNativeElement,BrowserWindow.prototype.on=BrowserDOMElement.prototype.on,BrowserWindow.prototype.off=BrowserDOMElement.prototype.off,BrowserWindow.prototype.addEventListener=BrowserDOMElement.prototype.addEventListener,BrowserWindow.prototype.removeEventListener=BrowserDOMElement.prototype.removeEventListener,BrowserWindow.prototype._createEventListener=BrowserDOMElement.prototype._createEventListener,BrowserWindow.prototype._addEventListenerNative=BrowserDOMElement.prototype._addEventListenerNative,BrowserWindow.prototype._removeEventListenerNative=BrowserDOMElement.prototype._removeEventListenerNative,BrowserWindow.prototype.getEventListeners=BrowserDOMElement.prototype.getEventListeners,BrowserDOMElement.getBrowserWindow=function(){return window[SIGNATURE]?window[SIGNATURE]:new BrowserWindow(window)},BrowserDOMElement.isReverse=function(e,t,r,n){if(r&&e){BrowserDOMElement.isReverse._r1||(BrowserDOMElement.isReverse._r1=window.document.createRange(),BrowserDOMElement.isReverse._r2=window.document.createRange());const s=BrowserDOMElement.isReverse._r1,o=BrowserDOMElement.isReverse._r2;if(s.setStart(e.getNativeElement(),t),o.setStart(r.getNativeElement(),n),1===s.compareBoundaryPoints(window.Range.START_TO_START,o))return!0}return!1},BrowserDOMElement.getWindowSelection=function(){let e=window.getSelection();return{anchorNode:BrowserDOMElement.wrap(e.anchorNode),anchorOffset:e.anchorOffset,focusNode:BrowserDOMElement.wrap(e.focusNode),focusOffset:e.focusOffset}};class AttributesMapAdapter{constructor(e){this.attributes=e}get size(){return this.attributes.length}get(e){let t=this.attributes.getNamedItem(e);if(t)return t.value}set(e,t){this.attributes.setNamedItem(e,t)}forEach(e){const t=this.size;for(let r=0;r<t;r++){const t=this.attributes.item(r);e(t.value,t.name)}}map(e){let t=[];return this.forEach((r,n)=>{t.push(e(r,n))}),t}keys(){return this.map((e,t)=>t)}values(){return this.map(e=>e)}entries(){return this.map((e,t)=>[t,e])}}class BrowserChildNodeIterator{constructor(e){this._next=e.firstChild,this._curr=null}hasNext(){return Boolean(this._next)}next(){let e=this._next;return this._curr=e,this._next=e.nextSibling,BrowserDOMElement.wrap(e)}back(){this._next=this._curr,this._curr=this._curr.previousSibling}peek(){return BrowserDOMElement.wrap(this._curr)}}var inBrowser=platform.inBrowser,domelementtype={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata",Doctype:"doctype",isTag:function(e){return"tag"===e.type||"script"===e.type||"style"===e.type}},boolbase={trueFunc:function(){return!0},falseFunc:function(){return!1}},parse_1=parse,re_nthElement=/^([+\-]?\d*n)?\s*(?:([+\-]?)\s*(\d+))?$/;function parse(e){if("even"===(e=e.trim().toLowerCase()))return[2,0];if("odd"===e)return[2,1];var t,r=e.match(re_nthElement);if(!r)throw new SyntaxError("n-th rule couldn't be parsed ('"+e+"')");return r[1]?(t=parseInt(r[1],10),isNaN(t)&&(t="-"===r[1].charAt(0)?-1:1)):t=0,[t,r[3]?parseInt((r[2]||"")+r[3],10):0]}var compile_1=compile,trueFunc=boolbase.trueFunc,falseFunc=boolbase.falseFunc;function compile(e){var t=e[0],r=e[1]-1;if(r<0&&t<=0)return falseFunc;if(-1===t)return function(e){return e<=r};if(0===t)return function(e){return e===r};if(1===t)return r<0?trueFunc:function(e){return e>=r};var n=r%t;return n<0&&(n+=t),t>1?function(e){return e>=r&&e%t===n}:(t*=-1,function(e){return e<=r&&e%t===n})}var nthCheck=function(e){return compile_1(parse_1(e))},parse_1$1=parse_1,compile_1$1=compile_1;nthCheck.parse=parse_1$1,nthCheck.compile=compile_1$1;var cssWhat=parse$1,re_name=/^(?:\\.|[\w\-\u00c0-\uFFFF])+/,re_escape=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,re_attr=/^\s*((?:\\.|[\w\u00c0-\uFFFF\-])+)\s*(?:(\S?)=\s*(?:(['"])(.*?)\3|(#?(?:\\.|[\w\u00c0-\uFFFF\-])*)|)|)\s*(i)?\]/,actionTypes={__proto__:null,undefined:"exists","":"equals","~":"element","^":"start",$:"end","*":"any","!":"not","|":"hyphen"},simpleSelectors={__proto__:null,">":"child","<":"parent","~":"sibling","+":"adjacent"},attribSelectors={__proto__:null,"#":["id","equals"],".":["class","element"]},unpackPseudos={__proto__:null,has:!0,not:!0,matches:!0},stripQuotesFromPseudos={__proto__:null,contains:!0,icontains:!0},quotes={__proto__:null,'"':!0,"'":!0};function funescape(e,t,r){var n="0x"+t-65536;return n!=n||r?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)}function unescapeCSS(e){return e.replace(re_escape,funescape)}function isWhitespace(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function parse$1(e,t){var r=[];if(""!==(e=parseSelector(r,e+"",t)))throw new SyntaxError("Unmatched selector: "+e);return r}function parseSelector(e,t,r){var n,s,o,i,a=[],l=!1;function c(){var e=t.match(re_name)[0];return t=t.substr(e.length),unescapeCSS(e)}function d(e){for(;isWhitespace(t.charAt(e));)e++;t=t.substr(e)}for(d(0);""!==t;)if(isWhitespace(s=t.charAt(0)))l=!0,d(1);else if(s in simpleSelectors)a.push({type:simpleSelectors[s]}),l=!1,d(1);else if(","===s){if(0===a.length)throw new SyntaxError("empty sub-selector");e.push(a),a=[],l=!1,d(1)}else if(l&&(a.length>0&&a.push({type:"descendant"}),l=!1),"*"===s)t=t.substr(1),a.push({type:"universal"});else if(s in attribSelectors)t=t.substr(1),a.push({type:"attribute",name:attribSelectors[s][0],action:attribSelectors[s][1],value:c(),ignoreCase:!1});else if("["===s){if(!(n=(t=t.substr(1)).match(re_attr)))throw new SyntaxError("Malformed attribute selector: "+t);t=t.substr(n[0].length),o=unescapeCSS(n[1]),r&&("lowerCaseAttributeNames"in r?!r.lowerCaseAttributeNames:r.xmlMode)||(o=o.toLowerCase()),a.push({type:"attribute",name:o,action:actionTypes[n[2]],value:unescapeCSS(n[4]||n[5]||""),ignoreCase:!!n[6]})}else if(":"===s){if(":"===t.charAt(1)){t=t.substr(2),a.push({type:"pseudo-element",name:c().toLowerCase()});continue}if(t=t.substr(1),o=c().toLowerCase(),n=null,"("===t.charAt(0))if(o in unpackPseudos){var h=(i=t.charAt(1))in quotes;if(t=parseSelector(n=[],t=t.substr(h+1),r),h){if(t.charAt(0)!==i)throw new SyntaxError("unmatched quotes in :"+o);t=t.substr(1)}if(")"!==t.charAt(0))throw new SyntaxError("missing closing parenthesis in :"+o+" "+t);t=t.substr(1)}else{for(var u=1,p=1;p>0&&u<t.length;u++)"("===t.charAt(u)?p++:")"===t.charAt(u)&&p--;if(p)throw new SyntaxError("parenthesis not matched");n=t.substr(1,u-2),t=t.substr(u),o in stripQuotesFromPseudos&&((i=n.charAt(0))===n.slice(-1)&&i in quotes&&(n=n.slice(1,-1)),n=unescapeCSS(n))}a.push({type:"pseudo",name:o,data:n})}else{if(!re_name.test(t))return a.length&&"descendant"===a[a.length-1].type&&a.pop(),addToken(e,a),t;o=c(),r&&("lowerCaseTags"in r?!r.lowerCaseTags:r.xmlMode)||(o=o.toLowerCase()),a.push({type:"tag",name:o})}return addToken(e,a),t}function addToken(e,t){if(e.length>0&&0===t.length)throw new SyntaxError("empty sub-selector");e.push(t)}const _encodeXMLContent=(e=>{let t=getInverseObj({amp:"&",gt:">",lt:"<"});return getInverse(t,getInverseReplacer(t))})(),_encodeXMLAttr=(e=>{let t=getInverseObj({quot:'"'});return getInverse(t,getInverseReplacer(t))})();function getInverseObj(e){return Object.keys(e).sort().reduce(function(t,r){return t[e[r]]="&"+r+";",t},{})}function getInverseReplacer(e){let t=[],r=[];return Object.keys(e).forEach(function(e){1===e.length?t.push("\\"+e):r.push(e)}),r.unshift("["+t.join("")+"]"),new RegExp(r.join("|"),"g")}const RE_NON_ASCII=/[^\0-\x7F]/g,RE_ASTRAL_SYMBOLS=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;function singleCharReplacer(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"}function astralReplacer(e){return"&#x"+(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)-56320+65536).toString(16).toUpperCase()+";"}function getInverse(e,t){function r(t){return e[t]}return function(e){return e.replace(t,r).replace(RE_ASTRAL_SYMBOLS,astralReplacer).replace(RE_NON_ASCII,singleCharReplacer)}}const booleanAttributes={__proto__:null,allowfullscreen:!0,async:!0,autofocus:!0,autoplay:!0,checked:!0,controls:!0,default:!0,defer:!0,disabled:!0,hidden:!0,ismap:!0,loop:!0,multiple:!0,muted:!0,open:!0,readonly:!0,required:!0,reversed:!0,scoped:!0,seamless:!0,selected:!0,typemustmatch:!0},unencodedElements={__proto__:null,style:!0,script:!0,xmp:!0,iframe:!0,noembed:!0,noframes:!0,plaintext:!0,noscript:!0},singleTag={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};class DomUtils{isTag(e){return domelementtype.isTag(e)}removeElement(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){var t=e.parent.childNodes;let r=t.lastIndexOf(e);if(r<0)throw new Error("Invalid state");t.splice(r,1),e.parent=null}}replaceElement(e,t){t.parent&&this.removeElement(t);var r=t.prev=e.prev;r&&(r.next=t);var n=t.next=e.next;n&&(n.prev=t);var s=t.parent=e.parent;if(s){var o=s.childNodes;let r=o.lastIndexOf(e);if(r<0)throw new Error("Invalid state");o[r]=t}}appendChild(e,t){if(t.parent&&this.removeElement(t),t.parent=e,1!==e.childNodes.push(t)){var r=e.childNodes[e.childNodes.length-2];r.next=t,t.prev=r,t.next=null}}append(e,t){t.parent&&this.removeElement(t);let r=e.parent,n=e.next;if(t.next=n,t.prev=e,e.next=t,t.parent=r,n){if(n.prev=t,r){var s=r.childNodes;let e=s.lastIndexOf(n);if(e<0)throw new Error("Invalid state");s.splice(e,0,t)}}else r&&r.childNodes.push(t)}prepend(e,t){t.parent&&this.removeElement(t);var r=e.parent;if(r){var n=r.childNodes;let s=n.lastIndexOf(e);if(s<0)throw new Error("Invalid state");n.splice(s,0,t)}e.prev&&(e.prev.next=t),t.parent=r,t.prev=e.prev,t.next=e,e.prev=t}filter(e,t,r,n){return Array.isArray(t)||(t=[t]),"number"==typeof n&&isFinite(n)||(n=1/0),this.find(e,t,!1!==r,n)}find(e,t,r,n){let s,o=[];for(var i=0,a=t.length;i<a&&!(e(t[i])&&(o.push(t[i]),--n<=0))&&(s=this.getChildren(t[i]),!(r&&s&&s.length>0&&(s=this.find(e,s,r,n),o=o.concat(s),(n-=s.length)<=0)));i++);return o}findOneChild(e,t){for(var r=0,n=t.length;r<n;r++)if(e(t[r]))return t[r];return null}findOne(e,t){for(var r=null,n=0,s=t.length;n<s&&!r;n++){const s=t[n];if(this.isTag(s))if(e(s))r=s;else{const t=this.getChildren(s);t.length>0&&(r=this.findOne(e,t))}}return r}existsOne(e,t){for(var r=0,n=t.length;r<n;r++){const n=t[r];if(!this.isTag(n))continue;if(e(n))return!0;const s=this.getChildren(n);if(s.length>0&&this.existsOne(e,s))return!0}return!1}findAll(e,t){for(var r=[],n=0,s=t.length;n<s;n++){const s=t[n];if(!this.isTag(s))continue;e(s)&&r.push(s);const o=this.getChildren(s);o.length>0&&(r=r.concat(this.findAll(e,o)))}return r}getAttributes(e){let t=e.getAttributes();if(t instanceof Map)return Array.from(t);if(t&&t.forEach){let e=[];return t.forEach((t,r)=>{e.push([r,t])}),e}return[]}formatAttribs(e,t={}){let r=[];return this.getAttributes(e).forEach(([e,n])=>{!n&&booleanAttributes[e]?r.push(e):r.push(e+'="'+(t.decodeEntities?_encodeXMLAttr(n):n)+'"')}),r.join(" ")}render(e,t){Array.isArray(e)||(e=[e]),t=t||{};let r=[];for(var n=0;n<e.length;n++){let s=e[n];switch(s.type){case"root":case"document":s._xmlInstruction&&r.push(this.render(s._xmlInstruction,t)),r.push(this.render(this.getChildren(s),t));break;case domelementtype.Tag:case domelementtype.Script:case domelementtype.Style:r.push(this.renderTag(s,t));break;case domelementtype.CDATA:r.push(this.renderCdata(s));break;case domelementtype.Comment:r.push(this.renderComment(s));break;case domelementtype.Directive:r.push(this.renderDirective(s));break;case domelementtype.Doctype:r.push(this.renderDoctype(s));break;case domelementtype.Text:r.push(this.renderText(s,t));break;default:throw new Error("Not implement yet: render of element type "+s.type)}}return r.join("")}renderTag(e,t){const r=this.getName(e);"svg"===r&&(t={decodeEntities:t.decodeEntities,xmlMode:!0});let n="<"+r,s=this.formatAttribs(e,t);s&&(n+=" "+s);const o=this.getChildren(e);return t.xmlMode&&0===o.length?n+="/>":(n+=">",o.length>0&&(n+=this.render(o,t)),singleTag[r]&&!t.xmlMode||(n+="</"+r+">")),n}renderDirective(e){return"<?"+this.getName(e)+" "+this.getData(e)+"?>"}renderDoctype(e){const{name:t,publicId:r,systemId:n}=this.getData(e);let s=["DOCTYPE",t];return r&&(s.push("PUBLIC"),s.push('"'+r+'"'),n&&s.push('"'+n+'"')),"<!"+s.join(" ")+">"}renderText(e,t){let r=this.getText(e);if(t.decodeEntities){const t=this.getParent(e);t&&this.getName(t)in unencodedElements||(r=_encodeXMLContent(r))}return r}renderCdata(e){return"<![CDATA["+this.getData(e)+"]]>"}renderComment(e){return"\x3c!--"+this.getData(e)+"--\x3e"}getInnerHTML(e,t){return this.getChildren(e).map(e=>this.render(e,t)).join("")}getOuterHTML(e,t){return this.render(e,t)}getData(e){return e.data}getText(e,t){if(Array.isArray(e))return e.map(e=>this.getText(e,t)).join("");switch(e.type){case domelementtype.Tag:case domelementtype.Script:case domelementtype.Style:return this.getText(this.getChildren(e),!0);case domelementtype.Text:case domelementtype.CDATA:return e.data;case domelementtype.Comment:return t?"":e.data;default:return""}}getChildren(e){return e.childNodes}getParent(e){return e.parent}getSiblings(e){var t=this.getParent(e);return t?this.getChildren(t):[e]}getAttributeValue(e,t){return e.getAttribute(t)}hasAttrib(e,t){return e.hasAttribute(t)}getName(e){return e.name}getNameWithoutNS(e){return e.nameWithoutNS}}const domUtils=new DomUtils;domUtils.DomUtils=DomUtils;var universal=50,tag=30,attribute=1,pseudo=0,descendant=-1,child=-1,parent$1=-1,sibling=-1,adjacent=-1,procedure={universal:universal,tag:tag,attribute:attribute,pseudo:pseudo,descendant:descendant,child:child,parent:parent$1,sibling:sibling,adjacent:adjacent},procedure$1=Object.freeze({universal:universal,tag:tag,attribute:attribute,pseudo:pseudo,descendant:descendant,child:child,parent:parent$1,sibling:sibling,adjacent:adjacent,default:procedure}),procedure$2=procedure$1&&procedure||procedure$1,sort=sortByProcedure,attributes={__proto__:null,exists:10,equals:8,not:7,start:6,end:6,any:5,hyphen:4,element:4};function sortByProcedure(e){for(var t=e.map(getProcedure),r=1;r<e.length;r++){var n=t[r];if(!(n<0))for(var s=r-1;s>=0&&n<t[s];s--){var o=e[s+1];e[s+1]=e[s],e[s]=o,t[s+1]=t[s],t[s]=n}}}function getProcedure(e){var t=procedure$2[e.type];if(t===procedure$2.attribute)(t=attributes[e.action])===attributes.equals&&"id"===e.name&&(t=9),e.ignoreCase&&(t>>=1);else if(t===procedure$2.pseudo)if(e.data)if("has"===e.name||"contains"===e.name)t=0;else if("matches"===e.name||"not"===e.name){t=0;for(var r=0;r<e.data.length;r++)if(1===e.data[r].length){var n=getProcedure(e.data[r][0]);if(0===n){t=0;break}n>t&&(t=n)}e.data.length>1&&t>0&&(t-=1)}else t=1;else t=3;return t}var falseFunc$1=boolbase.falseFunc,reChars=/[-[\]{}()*+?.,\\^$|#\s]/g;function factory(e){var t={__proto__:null,equals:function(t,r){var n=r.name,s=r.value;return r.ignoreCase?(s=s.toLowerCase(),function(r){var o=e.getAttributeValue(r,n);return null!=o&&o.toLowerCase()===s&&t(r)}):function(r){return e.getAttributeValue(r,n)===s&&t(r)}},hyphen:function(t,r){var n=r.name,s=r.value,o=s.length;return r.ignoreCase?(s=s.toLowerCase(),function(r){var i=e.getAttributeValue(r,n);return null!=i&&(i.length===o||"-"===i.charAt(o))&&i.substr(0,o).toLowerCase()===s&&t(r)}):function(r){var i=e.getAttributeValue(r,n);return null!=i&&i.substr(0,o)===s&&(i.length===o||"-"===i.charAt(o))&&t(r)}},element:function(t,r){var n=r.name,s=r.value;if("class"===r.name){let e=r.value;return/\s/.test(e)?function(){return!1}:function(r){let n=r.classes;return n&&n.has(e)&&t(r)}}if(/\s/.test(s))return falseFunc$1;var o="(?:^|\\s)"+(s=s.replace(reChars,"\\$&"))+"(?:$|\\s)",i=r.ignoreCase?"i":"",a=new RegExp(o,i);return function(r){var s=e.getAttributeValue(r,n);return null!=s&&a.test(s)&&t(r)}},exists:function(t,r){var n=r.name;return function(r){return e.hasAttrib(r,n)&&t(r)}},start:function(t,r){var n=r.name,s=r.value,o=s.length;return 0===o?falseFunc$1:r.ignoreCase?(s=s.toLowerCase(),function(r){var i=e.getAttributeValue(r,n);return null!=i&&i.substr(0,o).toLowerCase()===s&&t(r)}):function(r){var i=e.getAttributeValue(r,n);return null!=i&&i.substr(0,o)===s&&t(r)}},end:function(t,r){var n=r.name,s=r.value,o=-s.length;return 0===o?falseFunc$1:r.ignoreCase?(s=s.toLowerCase(),function(r){var i=e.getAttributeValue(r,n);return null!=i&&i.substr(o).toLowerCase()===s&&t(r)}):function(r){var i=e.getAttributeValue(r,n);return null!=i&&i.substr(o)===s&&t(r)}},any:function(t,r){var n=r.name,s=r.value;if(""===s)return falseFunc$1;if(r.ignoreCase){var o=new RegExp(s.replace(reChars,"\\$&"),"i");return function(r){var s=e.getAttributeValue(r,n);return null!=s&&o.test(s)&&t(r)}}return function(r){var o=e.getAttributeValue(r,n);return null!=o&&o.indexOf(s)>=0&&t(r)}},not:function(t,r){var n=r.name,s=r.value;return""===s?function(r){return!!e.getAttributeValue(r,n)&&t(r)}:r.ignoreCase?(s=s.toLowerCase(),function(r){var o=e.getAttributeValue(r,n);return null!=o&&o.toLowerCase()!==s&&t(r)}):function(r){return e.getAttributeValue(r,n)!==s&&t(r)}}};return{compile:function(e,r,n){if(n&&n.strict&&(r.ignoreCase||"not"===r.action))throw new Error("Unsupported attribute selector");return t[r.action](e,r)},rules:t}}var attributes$1=factory;function generalFactory(e,t){return{__proto__:null,attribute:attributes$1(e).compile,pseudo:t.compile,tag:function(t,r){var n=r.name;return function(r){return e.getNameWithoutNS(r)===n&&t(r)}},descendant:function(t){return function(r){for(var n=!1;!n&&(r=e.getParent(r));)n=t(r);return n}},_flexibleDescendant:function(t){return function(r){for(var n=t(r);!n&&(r=e.getParent(r));)n=t(r);return n}},parent:function(t,r,n){if(n&&n.strict)throw new Error("Parent selector isn't part of CSS3");return function(t){return e.getChildren(t).some(s)};function s(r){return e.isTag(r)&&t(r)}},child:function(t){return function(r){var n=e.getParent(r);return!!n&&t(n)}},sibling:function(t){return function(r){for(var n=e.getSiblings(r),s=0;s<n.length;s++)if(e.isTag(n[s])){if(n[s]===r)break;if(t(n[s]))return!0}return!1}},adjacent:function(t){return function(r){for(var n,s=e.getSiblings(r),o=0;o<s.length;o++)if(e.isTag(s[o])){if(s[o]===r)break;n=s[o]}return!!n&&t(n)}},universal:function(e){return e}}}var general=generalFactory,trueFunc$1=boolbase.trueFunc,falseFunc$1$1=boolbase.falseFunc;function filtersFactory(e){var t=attributes$1(e).rules.equals;function r(e,r){var n={name:e,value:r};return function(e){return t(e,n)}}function n(t){return function(r){return!!e.getParent(r)&&t(r)}}var s={contains:function(t,r){return function(n){return t(n)&&e.getText(n).indexOf(r)>=0}},icontains:function(t,r){var n=r.toLowerCase();return function(r){return t(r)&&e.getText(r).toLowerCase().indexOf(n)>=0}},"nth-child":function(t,r){var s=nthCheck(r);return s===falseFunc$1$1?s:s===trueFunc$1?n(t):function(r){for(var n=e.getSiblings(r),o=0,i=0;o<n.length;o++)if(e.isTag(n[o])){if(n[o]===r)break;i++}return s(i)&&t(r)}},"nth-last-child":function(t,r){var s=nthCheck(r);return s===falseFunc$1$1?s:s===trueFunc$1?n(t):function(r){for(var n=e.getSiblings(r),o=0,i=n.length-1;i>=0;i--)if(e.isTag(n[i])){if(n[i]===r)break;o++}return s(o)&&t(r)}},"nth-of-type":function(t,r){var s=nthCheck(r);return s===falseFunc$1$1?s:s===trueFunc$1?n(t):function(r){for(var n=e.getSiblings(r),o=0,i=0;i<n.length;i++)if(e.isTag(n[i])){if(n[i]===r)break;e.getName(n[i])===e.getName(r)&&o++}return s(o)&&t(r)}},"nth-last-of-type":function(t,r){var s=nthCheck(r);return s===falseFunc$1$1?s:s===trueFunc$1?n(t):function(r){for(var n=e.getSiblings(r),o=0,i=n.length-1;i>=0;i--)if(e.isTag(n[i])){if(n[i]===r)break;e.getName(n[i])===e.getName(r)&&o++}return s(o)&&t(r)}},root:function(t){return function(r){return!e.getParent(r)&&t(r)}},scope:function(t,r,n,o){return o&&0!==o.length?1===o.length?function(r){return n=o[0],s=r,("function"==typeof e.equals?e.equals(n,s):n===s)&&t(r);var n,s}:function(e){return o.indexOf(e)>=0&&t(e)}:s.root(t)},checkbox:r("type","checkbox"),file:r("type","file"),password:r("type","password"),radio:r("type","radio"),reset:r("type","reset"),image:r("type","image"),submit:r("type","submit")};return s}function pseudosFactory(e){var t={empty:function(t){return!e.getChildren(t).some(function(t){return e.isTag(t)||"text"===t.type})},"first-child":function(t){return function(t){for(var r=0;t&&r<t.length;r++)if(e.isTag(t[r]))return t[r]}(e.getSiblings(t))===t},"last-child":function(t){for(var r=e.getSiblings(t),n=r.length-1;n>=0;n--){if(r[n]===t)return!0;if(e.isTag(r[n]))break}return!1},"first-of-type":function(t){for(var r=e.getSiblings(t),n=0;n<r.length;n++)if(e.isTag(r[n])){if(r[n]===t)return!0;if(e.getName(r[n])===e.getName(t))break}return!1},"last-of-type":function(t){for(var r=e.getSiblings(t),n=r.length-1;n>=0;n--)if(e.isTag(r[n])){if(r[n]===t)return!0;if(e.getName(r[n])===e.getName(t))break}return!1},"only-of-type":function(t){for(var r=e.getSiblings(t),n=0,s=r.length;n<s;n++)if(e.isTag(r[n])){if(r[n]===t)continue;if(e.getName(r[n])===e.getName(t))return!1}return!0},"only-child":function(t){for(var r=e.getSiblings(t),n=0;n<r.length;n++)if(e.isTag(r[n])&&r[n]!==t)return!1;return!0},link:function(t){return e.hasAttrib(t,"href")},visited:falseFunc$1$1,selected:function(t){if(e.hasAttrib(t,"selected"))return!0;if("option"!==e.getName(t))return!1;var r=e.getParent(t);if(!r||"select"!==e.getName(r)||e.hasAttrib(r,"multiple"))return!1;for(var n=e.getChildren(r),s=!1,o=0;o<n.length;o++)if(e.isTag(n[o]))if(n[o]===t)s=!0;else{if(!s)return!1;if(e.hasAttrib(n[o],"selected"))return!1}return s},disabled:function(t){return e.hasAttrib(t,"disabled")},enabled:function(t){return!e.hasAttrib(t,"disabled")},checked:function(r){return e.hasAttrib(r,"checked")||t.selected(r)},required:function(t){return e.hasAttrib(t,"required")},optional:function(t){return!e.hasAttrib(t,"required")},parent:function(e){return!t.empty(e)},header:function(t){var r=e.getName(t);return"h1"===r||"h2"===r||"h3"===r||"h4"===r||"h5"===r||"h6"===r},button:function(t){var r=e.getName(t);return"button"===r||"input"===r&&"button"===e.getAttributeValue(t,"type")},input:function(t){var r=e.getName(t);return"input"===r||"textarea"===r||"select"===r||"button"===r},text:function(t){var r;return"input"===e.getName(t)&&(!(r=e.getAttributeValue(t,"type"))||"text"===r.toLowerCase())}};return t}function verifyArgs(e,t,r){if(null===r){if(e.length>1&&"scope"!==t)throw new Error("pseudo-selector :"+t+" requires an argument")}else if(1===e.length)throw new Error("pseudo-selector :"+t+" doesn't have any arguments")}var re_CSS3=/^(?:(?:nth|last|first|only)-(?:child|of-type)|root|empty|(?:en|dis)abled|checked|not)$/;function factory$1(e){var t=pseudosFactory(e),r=filtersFactory(e);return{compile:function(e,n,s,o){var i=n.name,a=n.data;if(s&&s.strict&&!re_CSS3.test(i))throw new Error(":"+i+" isn't part of CSS3");if("function"==typeof r[i])return verifyArgs(r[i],i,a),r[i](e,a,s,o);if("function"==typeof t[i]){var l=t[i];return verifyArgs(l,i,a),e===trueFunc$1?l:function(t){return l(t,a)&&e(t)}}throw new Error("unmatched pseudo-class :"+i)},filters:r,pseudos:t}}var pseudos=factory$1,compile$1=compileFactory,trueFunc$1$1=boolbase.trueFunc,falseFunc$2=boolbase.falseFunc;function compileFactory(e){var t=pseudos(e),r=t.filters,n=general(e,t);function s(e,t,r){return o(i(e,t,r))}function o(t){return function(r){return e.isTag(r)&&t(r)}}function i(e,t,r){return u(cssWhat(e,t),t,r)}function a(e){return"pseudo"===e.type&&("scope"===e.name||Array.isArray(e.data)&&e.data.some(function(e){return e.some(a)}))}var l={type:"descendant"},c={type:"_flexibleDescendant"},d={type:"pseudo",name:"scope"},h={};function u(t,r,s){(t=t.filter(function(e){return e.length>0})).forEach(sort);var o=Array.isArray(s);(s=r&&r.context||s)&&!o&&(s=[s]),function(t,r){var n=!!r&&!!r.length&&r.every(function(t){return t===h||!!e.getParent(t)});t.forEach(function(e){if(e.length>0&&p(e[0])&&"descendant"!==e[0].type);else{if(!n||a(e))return;e.unshift(l)}e.unshift(d)})}(t,s);var i=!1,u=t.map(function(e){if(e[0]&&e[1]&&"scope"===e[0].name){var t=e[1].type;o&&"descendant"===t?e[1]=c:"adjacent"!==t&&"sibling"!==t||(i=!0)}return function(e,t,r){return e.reduce(function(e,s){return e===falseFunc$2?e:n[s.type](e,s,t,r)},t&&t.rootFunc||trueFunc$1$1)}(e,r,s)}).reduce(g,falseFunc$2);return u.shouldTestNextSiblings=i,u}function p(e){return procedure$2[e.type]<0}function g(e,t){return t===falseFunc$2||e===trueFunc$1$1?e:e===falseFunc$2||t===trueFunc$1$1?t:function(r){return e(r)||t(r)}}function f(e){return e.some(p)}return r.not=function(e,t,r,n){var s={xmlMode:!(!r||!r.xmlMode),strict:!(!r||!r.strict)};if(s.strict&&(t.length>1||t.some(f)))throw new Error("complex selectors in :not aren't allowed in strict mode");var o=u(t,s,n);return o===falseFunc$2?e:o===trueFunc$1$1?falseFunc$2:function(t){return!o(t)&&e(t)}},r.has=function(t,r,n){var s={xmlMode:!(!n||!n.xmlMode),strict:!(!n||!n.strict)},i=r.some(f)?[h]:null,a=u(r,s,i);return a===falseFunc$2?falseFunc$2:a===trueFunc$1$1?function(r){return e.getChildren(r).some(e.isTag)&&t(r)}:(a=o(a),i?function(r){return t(r)&&(i[0]=r,e.existsOne(a,e.getChildren(r)))}:function(r){return t(r)&&e.existsOne(a,e.getChildren(r))})},r.matches=function(e,t,r,n){return u(t,{xmlMode:!(!r||!r.xmlMode),strict:!(!r||!r.strict),rootFunc:e},n)},s.compileToken=u,s.compileUnsafe=i,s.Pseudos=t,s}var cssSelect=CSSselect,falseFunc$3=boolbase.falseFunc,defaultCompile=compile$1(domUtils);function adapterCompile(e){return e.__compile__||(e.__compile__=compile$1(e)),e.__compile__}function getSelectorFunc(e){return function(t,r,n){(n=n||{}).adapter=n.adapter||domUtils;var s=adapterCompile(n.adapter);return"function"!=typeof t&&(t=s.compileUnsafe(t,n,r)),t.shouldTestNextSiblings&&(r=appendNextSiblings(n&&n.context||r,n.adapter)),r=Array.isArray(r)?n.adapter.removeSubsets(r):n.adapter.getChildren(r),e(t,r,n)}}function getNextSiblings(e,t){var r=t.getSiblings(e);if(!Array.isArray(r))return[];for(r=r.slice(0);r.shift()!==e;);return r}function appendNextSiblings(e,t){Array.isArray(e)||(e=[e]);for(var r=e.slice(0),n=0,s=e.length;n<s;n++){var o=getNextSiblings(r[n],t);r.push.apply(r,o)}return r}var selectAll=getSelectorFunc(function(e,t,r){return e!==falseFunc$3&&t&&0!==t.length?r.adapter.findAll(e,t):[]}),selectOne=getSelectorFunc(function(e,t,r){return e!==falseFunc$3&&t&&0!==t.length?r.adapter.findOne(e,t):null});function is(e,t,r){(r=r||{}).adapter=r.adapter||domUtils;var n=adapterCompile(r.adapter);return("function"==typeof t?t:n(t,r))(e)}function CSSselect(e,t,r){return selectAll(e,t,r)}CSSselect.compile=defaultCompile,CSSselect.filters=defaultCompile.Pseudos.filters,CSSselect.pseudos=defaultCompile.Pseudos.pseudos,CSSselect.selectAll=selectAll,CSSselect.selectOne=selectOne,CSSselect.is=is,CSSselect.parse=defaultCompile,CSSselect.iterate=selectAll,CSSselect._compileUnsafe=defaultCompile.compileUnsafe,CSSselect._compileToken=defaultCompile.compileToken;var amp="&",apos="'",gt=">",lt="<",quot='"',xmlJSON={amp:amp,apos:apos,gt:gt,lt:lt,quot:quot},xml=Object.freeze({amp:amp,apos:apos,gt:gt,lt:lt,quot:quot,default:xmlJSON}),Aacute="Á",aacute="á",Abreve="Ă",abreve="ă",ac="∾",acd="∿",acE="∾̳",Acirc="Â",acirc="â",acute="´",Acy="А",acy="а",AElig="Æ",aelig="æ",af="⁡",Afr="𝔄",afr="𝔞",Agrave="À",agrave="à",alefsym="ℵ",aleph="ℵ",Alpha="Α",alpha="α",Amacr="Ā",amacr="ā",amalg="⨿",amp$1="&",AMP="&",andand="⩕",And="⩓",and="∧",andd="⩜",andslope="⩘",andv="⩚",ang="∠",ange="⦤",angle="∠",angmsdaa="⦨",angmsdab="⦩",angmsdac="⦪",angmsdad="⦫",angmsdae="⦬",angmsdaf="⦭",angmsdag="⦮",angmsdah="⦯",angmsd="∡",angrt="∟",angrtvb="⊾",angrtvbd="⦝",angsph="∢",angst="Å",angzarr="⍼",Aogon="Ą",aogon="ą",Aopf="𝔸",aopf="𝕒",apacir="⩯",ap="≈",apE="⩰",ape="≊",apid="≋",apos$1="'",ApplyFunction="⁡",approx="≈",approxeq="≊",Aring="Å",aring="å",Ascr="𝒜",ascr="𝒶",Assign="≔",ast="*",asymp="≈",asympeq="≍",Atilde="Ã",atilde="ã",Auml="Ä",auml="ä",awconint="∳",awint="⨑",backcong="≌",backepsilon="϶",backprime="‵",backsim="∽",backsimeq="⋍",Backslash="∖",Barv="⫧",barvee="⊽",barwed="⌅",Barwed="⌆",barwedge="⌅",bbrk="⎵",bbrktbrk="⎶",bcong="≌",Bcy="Б",bcy="б",bdquo="„",becaus="∵",because="∵",Because="∵",bemptyv="⦰",bepsi="϶",bernou="ℬ",Bernoullis="ℬ",Beta="Β",beta="β",beth="ℶ",between="≬",Bfr="𝔅",bfr="𝔟",bigcap="⋂",bigcirc="◯",bigcup="⋃",bigodot="⨀",bigoplus="⨁",bigotimes="⨂",bigsqcup="⨆",bigstar="★",bigtriangledown="▽",bigtriangleup="△",biguplus="⨄",bigvee="⋁",bigwedge="⋀",bkarow="⤍",blacklozenge="⧫",blacksquare="▪",blacktriangle="▴",blacktriangledown="▾",blacktriangleleft="◂",blacktriangleright="▸",blank="␣",blk12="▒",blk14="░",blk34="▓",block="█",bne="=⃥",bnequiv="≡⃥",bNot="⫭",bnot="⌐",Bopf="𝔹",bopf="𝕓",bot="⊥",bottom="⊥",bowtie="⋈",boxbox="⧉",boxdl="┐",boxdL="╕",boxDl="╖",boxDL="╗",boxdr="┌",boxdR="╒",boxDr="╓",boxDR="╔",boxh="─",boxH="═",boxhd="┬",boxHd="╤",boxhD="╥",boxHD="╦",boxhu="┴",boxHu="╧",boxhU="╨",boxHU="╩",boxminus="⊟",boxplus="⊞",boxtimes="⊠",boxul="┘",boxuL="╛",boxUl="╜",boxUL="╝",boxur="└",boxuR="╘",boxUr="╙",boxUR="╚",boxv="│",boxV="║",boxvh="┼",boxvH="╪",boxVh="╫",boxVH="╬",boxvl="┤",boxvL="╡",boxVl="╢",boxVL="╣",boxvr="├",boxvR="╞",boxVr="╟",boxVR="╠",bprime="‵",breve="˘",Breve="˘",brvbar="¦",bscr="𝒷",Bscr="ℬ",bsemi="⁏",bsim="∽",bsime="⋍",bsolb="⧅",bsol="\\",bsolhsub="⟈",bull="•",bullet="•",bump="≎",bumpE="⪮",bumpe="≏",Bumpeq="≎",bumpeq="≏",Cacute="Ć",cacute="ć",capand="⩄",capbrcup="⩉",capcap="⩋",cap="∩",Cap="⋒",capcup="⩇",capdot="⩀",CapitalDifferentialD="ⅅ",caps="∩︀",caret="⁁",caron="ˇ",Cayleys="ℭ",ccaps="⩍",Ccaron="Č",ccaron="č",Ccedil="Ç",ccedil="ç",Ccirc="Ĉ",ccirc="ĉ",Cconint="∰",ccups="⩌",ccupssm="⩐",Cdot="Ċ",cdot="ċ",cedil="¸",Cedilla="¸",cemptyv="⦲",cent="¢",centerdot="·",CenterDot="·",cfr="𝔠",Cfr="ℭ",CHcy="Ч",chcy="ч",check="✓",checkmark="✓",Chi="Χ",chi="χ",circ="ˆ",circeq="≗",circlearrowleft="↺",circlearrowright="↻",circledast="⊛",circledcirc="⊚",circleddash="⊝",CircleDot="⊙",circledR="®",circledS="Ⓢ",CircleMinus="⊖",CirclePlus="⊕",CircleTimes="⊗",cir="○",cirE="⧃",cire="≗",cirfnint="⨐",cirmid="⫯",cirscir="⧂",ClockwiseContourIntegral="∲",CloseCurlyDoubleQuote="”",CloseCurlyQuote="’",clubs="♣",clubsuit="♣",colon=":",Colon="∷",Colone="⩴",colone="≔",coloneq="≔",comma=",",commat="@",comp="∁",compfn="∘",complement="∁",complexes="ℂ",cong="≅",congdot="⩭",Congruent="≡",conint="∮",Conint="∯",ContourIntegral="∮",copf="𝕔",Copf="ℂ",coprod="∐",Coproduct="∐",copy="©",COPY="©",copysr="℗",CounterClockwiseContourIntegral="∳",crarr="↵",cross="✗",Cross="⨯",Cscr="𝒞",cscr="𝒸",csub="⫏",csube="⫑",csup="⫐",csupe="⫒",ctdot="⋯",cudarrl="⤸",cudarrr="⤵",cuepr="⋞",cuesc="⋟",cularr="↶",cularrp="⤽",cupbrcap="⩈",cupcap="⩆",CupCap="≍",cup="∪",Cup="⋓",cupcup="⩊",cupdot="⊍",cupor="⩅",cups="∪︀",curarr="↷",curarrm="⤼",curlyeqprec="⋞",curlyeqsucc="⋟",curlyvee="⋎",curlywedge="⋏",curren="¤",curvearrowleft="↶",curvearrowright="↷",cuvee="⋎",cuwed="⋏",cwconint="∲",cwint="∱",cylcty="⌭",dagger="†",Dagger="‡",daleth="ℸ",darr="↓",Darr="↡",dArr="⇓",dash="‐",Dashv="⫤",dashv="⊣",dbkarow="⤏",dblac="˝",Dcaron="Ď",dcaron="ď",Dcy="Д",dcy="д",ddagger="‡",ddarr="⇊",DD="ⅅ",dd="ⅆ",DDotrahd="⤑",ddotseq="⩷",deg="°",Del="∇",Delta="Δ",delta="δ",demptyv="⦱",dfisht="⥿",Dfr="𝔇",dfr="𝔡",dHar="⥥",dharl="⇃",dharr="⇂",DiacriticalAcute="´",DiacriticalDot="˙",DiacriticalDoubleAcute="˝",DiacriticalGrave="`",DiacriticalTilde="˜",diam="⋄",diamond="⋄",Diamond="⋄",diamondsuit="♦",diams="♦",die="¨",DifferentialD="ⅆ",digamma="ϝ",disin="⋲",div="÷",divide="÷",divideontimes="⋇",divonx="⋇",DJcy="Ђ",djcy="ђ",dlcorn="⌞",dlcrop="⌍",dollar="$",Dopf="𝔻",dopf="𝕕",Dot="¨",dot="˙",DotDot="⃜",doteq="≐",doteqdot="≑",DotEqual="≐",dotminus="∸",dotplus="∔",dotsquare="⊡",doublebarwedge="⌆",DoubleContourIntegral="∯",DoubleDot="¨",DoubleDownArrow="⇓",DoubleLeftArrow="⇐",DoubleLeftRightArrow="⇔",DoubleLeftTee="⫤",DoubleLongLeftArrow="⟸",DoubleLongLeftRightArrow="⟺",DoubleLongRightArrow="⟹",DoubleRightArrow="⇒",DoubleRightTee="⊨",DoubleUpArrow="⇑",DoubleUpDownArrow="⇕",DoubleVerticalBar="∥",DownArrowBar="⤓",downarrow="↓",DownArrow="↓",Downarrow="⇓",DownArrowUpArrow="⇵",DownBreve="̑",downdownarrows="⇊",downharpoonleft="⇃",downharpoonright="⇂",DownLeftRightVector="⥐",DownLeftTeeVector="⥞",DownLeftVectorBar="⥖",DownLeftVector="↽",DownRightTeeVector="⥟",DownRightVectorBar="⥗",DownRightVector="⇁",DownTeeArrow="↧",DownTee="⊤",drbkarow="⤐",drcorn="⌟",drcrop="⌌",Dscr="𝒟",dscr="𝒹",DScy="Ѕ",dscy="ѕ",dsol="⧶",Dstrok="Đ",dstrok="đ",dtdot="⋱",dtri="▿",dtrif="▾",duarr="⇵",duhar="⥯",dwangle="⦦",DZcy="Џ",dzcy="џ",dzigrarr="⟿",Eacute="É",eacute="é",easter="⩮",Ecaron="Ě",ecaron="ě",Ecirc="Ê",ecirc="ê",ecir="≖",ecolon="≕",Ecy="Э",ecy="э",eDDot="⩷",Edot="Ė",edot="ė",eDot="≑",ee="ⅇ",efDot="≒",Efr="𝔈",efr="𝔢",eg="⪚",Egrave="È",egrave="è",egs="⪖",egsdot="⪘",el="⪙",Element="∈",elinters="⏧",ell="ℓ",els="⪕",elsdot="⪗",Emacr="Ē",emacr="ē",empty="∅",emptyset="∅",EmptySmallSquare="◻",emptyv="∅",EmptyVerySmallSquare="▫",emsp13=" ",emsp14=" ",emsp=" ",ENG="Ŋ",eng="ŋ",ensp=" ",Eogon="Ę",eogon="ę",Eopf="𝔼",eopf="𝕖",epar="⋕",eparsl="⧣",eplus="⩱",epsi="ε",Epsilon="Ε",epsilon="ε",epsiv="ϵ",eqcirc="≖",eqcolon="≕",eqsim="≂",eqslantgtr="⪖",eqslantless="⪕",Equal="⩵",equals="=",EqualTilde="≂",equest="≟",Equilibrium="⇌",equiv="≡",equivDD="⩸",eqvparsl="⧥",erarr="⥱",erDot="≓",escr="ℯ",Escr="ℰ",esdot="≐",Esim="⩳",esim="≂",Eta="Η",eta="η",ETH="Ð",eth="ð",Euml="Ë",euml="ë",euro="€",excl="!",exist="∃",Exists="∃",expectation="ℰ",exponentiale="ⅇ",ExponentialE="ⅇ",fallingdotseq="≒",Fcy="Ф",fcy="ф",female="♀",ffilig="ﬃ",fflig="ﬀ",ffllig="ﬄ",Ffr="𝔉",ffr="𝔣",filig="ﬁ",FilledSmallSquare="◼",FilledVerySmallSquare="▪",fjlig="fj",flat="♭",fllig="ﬂ",fltns="▱",fnof="ƒ",Fopf="𝔽",fopf="𝕗",forall="∀",ForAll="∀",fork="⋔",forkv="⫙",Fouriertrf="ℱ",fpartint="⨍",frac12="½",frac13="⅓",frac14="¼",frac15="⅕",frac16="⅙",frac18="⅛",frac23="⅔",frac25="⅖",frac34="¾",frac35="⅗",frac38="⅜",frac45="⅘",frac56="⅚",frac58="⅝",frac78="⅞",frasl="⁄",frown="⌢",fscr="𝒻",Fscr="ℱ",gacute="ǵ",Gamma="Γ",gamma="γ",Gammad="Ϝ",gammad="ϝ",gap="⪆",Gbreve="Ğ",gbreve="ğ",Gcedil="Ģ",Gcirc="Ĝ",gcirc="ĝ",Gcy="Г",gcy="г",Gdot="Ġ",gdot="ġ",ge="≥",gE="≧",gEl="⪌",gel="⋛",geq="≥",geqq="≧",geqslant="⩾",gescc="⪩",ges="⩾",gesdot="⪀",gesdoto="⪂",gesdotol="⪄",gesl="⋛︀",gesles="⪔",Gfr="𝔊",gfr="𝔤",gg="≫",Gg="⋙",ggg="⋙",gimel="ℷ",GJcy="Ѓ",gjcy="ѓ",gla="⪥",gl="≷",glE="⪒",glj="⪤",gnap="⪊",gnapprox="⪊",gne="⪈",gnE="≩",gneq="⪈",gneqq="≩",gnsim="⋧",Gopf="𝔾",gopf="𝕘",grave="`",GreaterEqual="≥",GreaterEqualLess="⋛",GreaterFullEqual="≧",GreaterGreater="⪢",GreaterLess="≷",GreaterSlantEqual="⩾",GreaterTilde="≳",Gscr="𝒢",gscr="ℊ",gsim="≳",gsime="⪎",gsiml="⪐",gtcc="⪧",gtcir="⩺",gt$1=">",GT=">",Gt="≫",gtdot="⋗",gtlPar="⦕",gtquest="⩼",gtrapprox="⪆",gtrarr="⥸",gtrdot="⋗",gtreqless="⋛",gtreqqless="⪌",gtrless="≷",gtrsim="≳",gvertneqq="≩︀",gvnE="≩︀",Hacek="ˇ",hairsp=" ",half="½",hamilt="ℋ",HARDcy="Ъ",hardcy="ъ",harrcir="⥈",harr="↔",hArr="⇔",harrw="↭",Hat="^",hbar="ℏ",Hcirc="Ĥ",hcirc="ĥ",hearts="♥",heartsuit="♥",hellip="…",hercon="⊹",hfr="𝔥",Hfr="ℌ",HilbertSpace="ℋ",hksearow="⤥",hkswarow="⤦",hoarr="⇿",homtht="∻",hookleftarrow="↩",hookrightarrow="↪",hopf="𝕙",Hopf="ℍ",horbar="―",HorizontalLine="─",hscr="𝒽",Hscr="ℋ",hslash="ℏ",Hstrok="Ħ",hstrok="ħ",HumpDownHump="≎",HumpEqual="≏",hybull="⁃",hyphen="‐",Iacute="Í",iacute="í",ic="⁣",Icirc="Î",icirc="î",Icy="И",icy="и",Idot="İ",IEcy="Е",iecy="е",iexcl="¡",iff="⇔",ifr="𝔦",Ifr="ℑ",Igrave="Ì",igrave="ì",ii="ⅈ",iiiint="⨌",iiint="∭",iinfin="⧜",iiota="℩",IJlig="Ĳ",ijlig="ĳ",Imacr="Ī",imacr="ī",image="ℑ",ImaginaryI="ⅈ",imagline="ℐ",imagpart="ℑ",imath="ı",Im="ℑ",imof="⊷",imped="Ƶ",Implies="⇒",incare="℅",infin="∞",infintie="⧝",inodot="ı",intcal="⊺",int="∫",Int="∬",integers="ℤ",Integral="∫",intercal="⊺",Intersection="⋂",intlarhk="⨗",intprod="⨼",InvisibleComma="⁣",InvisibleTimes="⁢",IOcy="Ё",iocy="ё",Iogon="Į",iogon="į",Iopf="𝕀",iopf="𝕚",Iota="Ι",iota="ι",iprod="⨼",iquest="¿",iscr="𝒾",Iscr="ℐ",isin="∈",isindot="⋵",isinE="⋹",isins="⋴",isinsv="⋳",isinv="∈",it="⁢",Itilde="Ĩ",itilde="ĩ",Iukcy="І",iukcy="і",Iuml="Ï",iuml="ï",Jcirc="Ĵ",jcirc="ĵ",Jcy="Й",jcy="й",Jfr="𝔍",jfr="𝔧",jmath="ȷ",Jopf="𝕁",jopf="𝕛",Jscr="𝒥",jscr="𝒿",Jsercy="Ј",jsercy="ј",Jukcy="Є",jukcy="є",Kappa="Κ",kappa="κ",kappav="ϰ",Kcedil="Ķ",kcedil="ķ",Kcy="К",kcy="к",Kfr="𝔎",kfr="𝔨",kgreen="ĸ",KHcy="Х",khcy="х",KJcy="Ќ",kjcy="ќ",Kopf="𝕂",kopf="𝕜",Kscr="𝒦",kscr="𝓀",lAarr="⇚",Lacute="Ĺ",lacute="ĺ",laemptyv="⦴",lagran="ℒ",Lambda="Λ",lambda="λ",lang="⟨",Lang="⟪",langd="⦑",langle="⟨",lap="⪅",Laplacetrf="ℒ",laquo="«",larrb="⇤",larrbfs="⤟",larr="←",Larr="↞",lArr="⇐",larrfs="⤝",larrhk="↩",larrlp="↫",larrpl="⤹",larrsim="⥳",larrtl="↢",latail="⤙",lAtail="⤛",lat="⪫",late="⪭",lates="⪭︀",lbarr="⤌",lBarr="⤎",lbbrk="❲",lbrace="{",lbrack="[",lbrke="⦋",lbrksld="⦏",lbrkslu="⦍",Lcaron="Ľ",lcaron="ľ",Lcedil="Ļ",lcedil="ļ",lceil="⌈",lcub="{",Lcy="Л",lcy="л",ldca="⤶",ldquo="“",ldquor="„",ldrdhar="⥧",ldrushar="⥋",ldsh="↲",le="≤",lE="≦",LeftAngleBracket="⟨",LeftArrowBar="⇤",leftarrow="←",LeftArrow="←",Leftarrow="⇐",LeftArrowRightArrow="⇆",leftarrowtail="↢",LeftCeiling="⌈",LeftDoubleBracket="⟦",LeftDownTeeVector="⥡",LeftDownVectorBar="⥙",LeftDownVector="⇃",LeftFloor="⌊",leftharpoondown="↽",leftharpoonup="↼",leftleftarrows="⇇",leftrightarrow="↔",LeftRightArrow="↔",Leftrightarrow="⇔",leftrightarrows="⇆",leftrightharpoons="⇋",leftrightsquigarrow="↭",LeftRightVector="⥎",LeftTeeArrow="↤",LeftTee="⊣",LeftTeeVector="⥚",leftthreetimes="⋋",LeftTriangleBar="⧏",LeftTriangle="⊲",LeftTriangleEqual="⊴",LeftUpDownVector="⥑",LeftUpTeeVector="⥠",LeftUpVectorBar="⥘",LeftUpVector="↿",LeftVectorBar="⥒",LeftVector="↼",lEg="⪋",leg="⋚",leq="≤",leqq="≦",leqslant="⩽",lescc="⪨",les="⩽",lesdot="⩿",lesdoto="⪁",lesdotor="⪃",lesg="⋚︀",lesges="⪓",lessapprox="⪅",lessdot="⋖",lesseqgtr="⋚",lesseqqgtr="⪋",LessEqualGreater="⋚",LessFullEqual="≦",LessGreater="≶",lessgtr="≶",LessLess="⪡",lesssim="≲",LessSlantEqual="⩽",LessTilde="≲",lfisht="⥼",lfloor="⌊",Lfr="𝔏",lfr="𝔩",lg="≶",lgE="⪑",lHar="⥢",lhard="↽",lharu="↼",lharul="⥪",lhblk="▄",LJcy="Љ",ljcy="љ",llarr="⇇",ll="≪",Ll="⋘",llcorner="⌞",Lleftarrow="⇚",llhard="⥫",lltri="◺",Lmidot="Ŀ",lmidot="ŀ",lmoustache="⎰",lmoust="⎰",lnap="⪉",lnapprox="⪉",lne="⪇",lnE="≨",lneq="⪇",lneqq="≨",lnsim="⋦",loang="⟬",loarr="⇽",lobrk="⟦",longleftarrow="⟵",LongLeftArrow="⟵",Longleftarrow="⟸",longleftrightarrow="⟷",LongLeftRightArrow="⟷",Longleftrightarrow="⟺",longmapsto="⟼",longrightarrow="⟶",LongRightArrow="⟶",Longrightarrow="⟹",looparrowleft="↫",looparrowright="↬",lopar="⦅",Lopf="𝕃",lopf="𝕝",loplus="⨭",lotimes="⨴",lowast="∗",lowbar="_",LowerLeftArrow="↙",LowerRightArrow="↘",loz="◊",lozenge="◊",lozf="⧫",lpar="(",lparlt="⦓",lrarr="⇆",lrcorner="⌟",lrhar="⇋",lrhard="⥭",lrm="‎",lrtri="⊿",lsaquo="‹",lscr="𝓁",Lscr="ℒ",lsh="↰",Lsh="↰",lsim="≲",lsime="⪍",lsimg="⪏",lsqb="[",lsquo="‘",lsquor="‚",Lstrok="Ł",lstrok="ł",ltcc="⪦",ltcir="⩹",lt$1="<",LT="<",Lt="≪",ltdot="⋖",lthree="⋋",ltimes="⋉",ltlarr="⥶",ltquest="⩻",ltri="◃",ltrie="⊴",ltrif="◂",ltrPar="⦖",lurdshar="⥊",luruhar="⥦",lvertneqq="≨︀",lvnE="≨︀",macr="¯",male="♂",malt="✠",maltese="✠",map$1="↦",mapsto="↦",mapstodown="↧",mapstoleft="↤",mapstoup="↥",marker="▮",mcomma="⨩",Mcy="М",mcy="м",mdash="—",mDDot="∺",measuredangle="∡",MediumSpace=" ",Mellintrf="ℳ",Mfr="𝔐",mfr="𝔪",mho="℧",micro="µ",midast="*",midcir="⫰",mid="∣",middot="·",minusb="⊟",minus="−",minusd="∸",minusdu="⨪",MinusPlus="∓",mlcp="⫛",mldr="…",mnplus="∓",models="⊧",Mopf="𝕄",mopf="𝕞",mp="∓",mscr="𝓂",Mscr="ℳ",mstpos="∾",Mu="Μ",mu="μ",multimap="⊸",mumap="⊸",nabla="∇",Nacute="Ń",nacute="ń",nang="∠⃒",nap="≉",napE="⩰̸",napid="≋̸",napos="ŉ",napprox="≉",natural="♮",naturals="ℕ",natur="♮",nbsp=" ",nbump="≎̸",nbumpe="≏̸",ncap="⩃",Ncaron="Ň",ncaron="ň",Ncedil="Ņ",ncedil="ņ",ncong="≇",ncongdot="⩭̸",ncup="⩂",Ncy="Н",ncy="н",ndash="–",nearhk="⤤",nearr="↗",neArr="⇗",nearrow="↗",ne="≠",nedot="≐̸",NegativeMediumSpace="​",NegativeThickSpace="​",NegativeThinSpace="​",NegativeVeryThinSpace="​",nequiv="≢",nesear="⤨",nesim="≂̸",NestedGreaterGreater="≫",NestedLessLess="≪",NewLine="\n",nexist="∄",nexists="∄",Nfr="𝔑",nfr="𝔫",ngE="≧̸",nge="≱",ngeq="≱",ngeqq="≧̸",ngeqslant="⩾̸",nges="⩾̸",nGg="⋙̸",ngsim="≵",nGt="≫⃒",ngt="≯",ngtr="≯",nGtv="≫̸",nharr="↮",nhArr="⇎",nhpar="⫲",ni="∋",nis="⋼",nisd="⋺",niv="∋",NJcy="Њ",njcy="њ",nlarr="↚",nlArr="⇍",nldr="‥",nlE="≦̸",nle="≰",nleftarrow="↚",nLeftarrow="⇍",nleftrightarrow="↮",nLeftrightarrow="⇎",nleq="≰",nleqq="≦̸",nleqslant="⩽̸",nles="⩽̸",nless="≮",nLl="⋘̸",nlsim="≴",nLt="≪⃒",nlt="≮",nltri="⋪",nltrie="⋬",nLtv="≪̸",nmid="∤",NoBreak="⁠",NonBreakingSpace=" ",nopf="𝕟",Nopf="ℕ",Not="⫬",not="¬",NotCongruent="≢",NotCupCap="≭",NotDoubleVerticalBar="∦",NotElement="∉",NotEqual="≠",NotEqualTilde="≂̸",NotExists="∄",NotGreater="≯",NotGreaterEqual="≱",NotGreaterFullEqual="≧̸",NotGreaterGreater="≫̸",NotGreaterLess="≹",NotGreaterSlantEqual="⩾̸",NotGreaterTilde="≵",NotHumpDownHump="≎̸",NotHumpEqual="≏̸",notin="∉",notindot="⋵̸",notinE="⋹̸",notinva="∉",notinvb="⋷",notinvc="⋶",NotLeftTriangleBar="⧏̸",NotLeftTriangle="⋪",NotLeftTriangleEqual="⋬",NotLess="≮",NotLessEqual="≰",NotLessGreater="≸",NotLessLess="≪̸",NotLessSlantEqual="⩽̸",NotLessTilde="≴",NotNestedGreaterGreater="⪢̸",NotNestedLessLess="⪡̸",notni="∌",notniva="∌",notnivb="⋾",notnivc="⋽",NotPrecedes="⊀",NotPrecedesEqual="⪯̸",NotPrecedesSlantEqual="⋠",NotReverseElement="∌",NotRightTriangleBar="⧐̸",NotRightTriangle="⋫",NotRightTriangleEqual="⋭",NotSquareSubset="⊏̸",NotSquareSubsetEqual="⋢",NotSquareSuperset="⊐̸",NotSquareSupersetEqual="⋣",NotSubset="⊂⃒",NotSubsetEqual="⊈",NotSucceeds="⊁",NotSucceedsEqual="⪰̸",NotSucceedsSlantEqual="⋡",NotSucceedsTilde="≿̸",NotSuperset="⊃⃒",NotSupersetEqual="⊉",NotTilde="≁",NotTildeEqual="≄",NotTildeFullEqual="≇",NotTildeTilde="≉",NotVerticalBar="∤",nparallel="∦",npar="∦",nparsl="⫽⃥",npart="∂̸",npolint="⨔",npr="⊀",nprcue="⋠",nprec="⊀",npreceq="⪯̸",npre="⪯̸",nrarrc="⤳̸",nrarr="↛",nrArr="⇏",nrarrw="↝̸",nrightarrow="↛",nRightarrow="⇏",nrtri="⋫",nrtrie="⋭",nsc="⊁",nsccue="⋡",nsce="⪰̸",Nscr="𝒩",nscr="𝓃",nshortmid="∤",nshortparallel="∦",nsim="≁",nsime="≄",nsimeq="≄",nsmid="∤",nspar="∦",nsqsube="⋢",nsqsupe="⋣",nsub="⊄",nsubE="⫅̸",nsube="⊈",nsubset="⊂⃒",nsubseteq="⊈",nsubseteqq="⫅̸",nsucc="⊁",nsucceq="⪰̸",nsup="⊅",nsupE="⫆̸",nsupe="⊉",nsupset="⊃⃒",nsupseteq="⊉",nsupseteqq="⫆̸",ntgl="≹",Ntilde="Ñ",ntilde="ñ",ntlg="≸",ntriangleleft="⋪",ntrianglelefteq="⋬",ntriangleright="⋫",ntrianglerighteq="⋭",Nu="Ν",nu="ν",num="#",numero="№",numsp=" ",nvap="≍⃒",nvdash="⊬",nvDash="⊭",nVdash="⊮",nVDash="⊯",nvge="≥⃒",nvgt=">⃒",nvHarr="⤄",nvinfin="⧞",nvlArr="⤂",nvle="≤⃒",nvlt="<⃒",nvltrie="⊴⃒",nvrArr="⤃",nvrtrie="⊵⃒",nvsim="∼⃒",nwarhk="⤣",nwarr="↖",nwArr="⇖",nwarrow="↖",nwnear="⤧",Oacute="Ó",oacute="ó",oast="⊛",Ocirc="Ô",ocirc="ô",ocir="⊚",Ocy="О",ocy="о",odash="⊝",Odblac="Ő",odblac="ő",odiv="⨸",odot="⊙",odsold="⦼",OElig="Œ",oelig="œ",ofcir="⦿",Ofr="𝔒",ofr="𝔬",ogon="˛",Ograve="Ò",ograve="ò",ogt="⧁",ohbar="⦵",ohm="Ω",oint="∮",olarr="↺",olcir="⦾",olcross="⦻",oline="‾",olt="⧀",Omacr="Ō",omacr="ō",Omega="Ω",omega="ω",Omicron="Ο",omicron="ο",omid="⦶",ominus="⊖",Oopf="𝕆",oopf="𝕠",opar="⦷",OpenCurlyDoubleQuote="“",OpenCurlyQuote="‘",operp="⦹",oplus="⊕",orarr="↻",Or="⩔",or="∨",ord="⩝",order="ℴ",orderof="ℴ",ordf="ª",ordm="º",origof="⊶",oror="⩖",orslope="⩗",orv="⩛",oS="Ⓢ",Oscr="𝒪",oscr="ℴ",Oslash="Ø",oslash="ø",osol="⊘",Otilde="Õ",otilde="õ",otimesas="⨶",Otimes="⨷",otimes="⊗",Ouml="Ö",ouml="ö",ovbar="⌽",OverBar="‾",OverBrace="⏞",OverBracket="⎴",OverParenthesis="⏜",para="¶",parallel="∥",par="∥",parsim="⫳",parsl="⫽",part="∂",PartialD="∂",Pcy="П",pcy="п",percnt="%",period=".",permil="‰",perp="⊥",pertenk="‱",Pfr="𝔓",pfr="𝔭",Phi="Φ",phi="φ",phiv="ϕ",phmmat="ℳ",phone="☎",Pi="Π",pi="π",pitchfork="⋔",piv="ϖ",planck="ℏ",planckh="ℎ",plankv="ℏ",plusacir="⨣",plusb="⊞",pluscir="⨢",plus="+",plusdo="∔",plusdu="⨥",pluse="⩲",PlusMinus="±",plusmn="±",plussim="⨦",plustwo="⨧",pm="±",Poincareplane="ℌ",pointint="⨕",popf="𝕡",Popf="ℙ",pound="£",prap="⪷",Pr="⪻",pr="≺",prcue="≼",precapprox="⪷",prec="≺",preccurlyeq="≼",Precedes="≺",PrecedesEqual="⪯",PrecedesSlantEqual="≼",PrecedesTilde="≾",preceq="⪯",precnapprox="⪹",precneqq="⪵",precnsim="⋨",pre="⪯",prE="⪳",precsim="≾",prime="′",Prime="″",primes="ℙ",prnap="⪹",prnE="⪵",prnsim="⋨",prod="∏",Product="∏",profalar="⌮",profline="⌒",profsurf="⌓",prop="∝",Proportional="∝",Proportion="∷",propto="∝",prsim="≾",prurel="⊰",Pscr="𝒫",pscr="𝓅",Psi="Ψ",psi="ψ",puncsp=" ",Qfr="𝔔",qfr="𝔮",qint="⨌",qopf="𝕢",Qopf="ℚ",qprime="⁗",Qscr="𝒬",qscr="𝓆",quaternions="ℍ",quatint="⨖",quest="?",questeq="≟",quot$1='"',QUOT='"',rAarr="⇛",race="∽̱",Racute="Ŕ",racute="ŕ",radic="√",raemptyv="⦳",rang="⟩",Rang="⟫",rangd="⦒",range="⦥",rangle="⟩",raquo="»",rarrap="⥵",rarrb="⇥",rarrbfs="⤠",rarrc="⤳",rarr="→",Rarr="↠",rArr="⇒",rarrfs="⤞",rarrhk="↪",rarrlp="↬",rarrpl="⥅",rarrsim="⥴",Rarrtl="⤖",rarrtl="↣",rarrw="↝",ratail="⤚",rAtail="⤜",ratio="∶",rationals="ℚ",rbarr="⤍",rBarr="⤏",RBarr="⤐",rbbrk="❳",rbrace="}",rbrack="]",rbrke="⦌",rbrksld="⦎",rbrkslu="⦐",Rcaron="Ř",rcaron="ř",Rcedil="Ŗ",rcedil="ŗ",rceil="⌉",rcub="}",Rcy="Р",rcy="р",rdca="⤷",rdldhar="⥩",rdquo="”",rdquor="”",rdsh="↳",real="ℜ",realine="ℛ",realpart="ℜ",reals="ℝ",Re="ℜ",rect="▭",reg="®",REG="®",ReverseElement="∋",ReverseEquilibrium="⇋",ReverseUpEquilibrium="⥯",rfisht="⥽",rfloor="⌋",rfr="𝔯",Rfr="ℜ",rHar="⥤",rhard="⇁",rharu="⇀",rharul="⥬",Rho="Ρ",rho="ρ",rhov="ϱ",RightAngleBracket="⟩",RightArrowBar="⇥",rightarrow="→",RightArrow="→",Rightarrow="⇒",RightArrowLeftArrow="⇄",rightarrowtail="↣",RightCeiling="⌉",RightDoubleBracket="⟧",RightDownTeeVector="⥝",RightDownVectorBar="⥕",RightDownVector="⇂",RightFloor="⌋",rightharpoondown="⇁",rightharpoonup="⇀",rightleftarrows="⇄",rightleftharpoons="⇌",rightrightarrows="⇉",rightsquigarrow="↝",RightTeeArrow="↦",RightTee="⊢",RightTeeVector="⥛",rightthreetimes="⋌",RightTriangleBar="⧐",RightTriangle="⊳",RightTriangleEqual="⊵",RightUpDownVector="⥏",RightUpTeeVector="⥜",RightUpVectorBar="⥔",RightUpVector="↾",RightVectorBar="⥓",RightVector="⇀",ring="˚",risingdotseq="≓",rlarr="⇄",rlhar="⇌",rlm="‏",rmoustache="⎱",rmoust="⎱",rnmid="⫮",roang="⟭",roarr="⇾",robrk="⟧",ropar="⦆",ropf="𝕣",Ropf="ℝ",roplus="⨮",rotimes="⨵",RoundImplies="⥰",rpar=")",rpargt="⦔",rppolint="⨒",rrarr="⇉",Rrightarrow="⇛",rsaquo="›",rscr="𝓇",Rscr="ℛ",rsh="↱",Rsh="↱",rsqb="]",rsquo="’",rsquor="’",rthree="⋌",rtimes="⋊",rtri="▹",rtrie="⊵",rtrif="▸",rtriltri="⧎",RuleDelayed="⧴",ruluhar="⥨",rx="℞",Sacute="Ś",sacute="ś",sbquo="‚",scap="⪸",Scaron="Š",scaron="š",Sc="⪼",sc="≻",sccue="≽",sce="⪰",scE="⪴",Scedil="Ş",scedil="ş",Scirc="Ŝ",scirc="ŝ",scnap="⪺",scnE="⪶",scnsim="⋩",scpolint="⨓",scsim="≿",Scy="С",scy="с",sdotb="⊡",sdot="⋅",sdote="⩦",searhk="⤥",searr="↘",seArr="⇘",searrow="↘",sect="§",semi=";",seswar="⤩",setminus="∖",setmn="∖",sext="✶",Sfr="𝔖",sfr="𝔰",sfrown="⌢",sharp="♯",SHCHcy="Щ",shchcy="щ",SHcy="Ш",shcy="ш",ShortDownArrow="↓",ShortLeftArrow="←",shortmid="∣",shortparallel="∥",ShortRightArrow="→",ShortUpArrow="↑",shy="­",Sigma="Σ",sigma="σ",sigmaf="ς",sigmav="ς",sim="∼",simdot="⩪",sime="≃",simeq="≃",simg="⪞",simgE="⪠",siml="⪝",simlE="⪟",simne="≆",simplus="⨤",simrarr="⥲",slarr="←",SmallCircle="∘",smallsetminus="∖",smashp="⨳",smeparsl="⧤",smid="∣",smile="⌣",smt="⪪",smte="⪬",smtes="⪬︀",SOFTcy="Ь",softcy="ь",solbar="⌿",solb="⧄",sol="/",Sopf="𝕊",sopf="𝕤",spades="♠",spadesuit="♠",spar="∥",sqcap="⊓",sqcaps="⊓︀",sqcup="⊔",sqcups="⊔︀",Sqrt="√",sqsub="⊏",sqsube="⊑",sqsubset="⊏",sqsubseteq="⊑",sqsup="⊐",sqsupe="⊒",sqsupset="⊐",sqsupseteq="⊒",square="□",Square="□",SquareIntersection="⊓",SquareSubset="⊏",SquareSubsetEqual="⊑",SquareSuperset="⊐",SquareSupersetEqual="⊒",SquareUnion="⊔",squarf="▪",squ="□",squf="▪",srarr="→",Sscr="𝒮",sscr="𝓈",ssetmn="∖",ssmile="⌣",sstarf="⋆",Star="⋆",star="☆",starf="★",straightepsilon="ϵ",straightphi="ϕ",strns="¯",sub="⊂",Sub="⋐",subdot="⪽",subE="⫅",sube="⊆",subedot="⫃",submult="⫁",subnE="⫋",subne="⊊",subplus="⪿",subrarr="⥹",subset="⊂",Subset="⋐",subseteq="⊆",subseteqq="⫅",SubsetEqual="⊆",subsetneq="⊊",subsetneqq="⫋",subsim="⫇",subsub="⫕",subsup="⫓",succapprox="⪸",succ="≻",succcurlyeq="≽",Succeeds="≻",SucceedsEqual="⪰",SucceedsSlantEqual="≽",SucceedsTilde="≿",succeq="⪰",succnapprox="⪺",succneqq="⪶",succnsim="⋩",succsim="≿",SuchThat="∋",sum="∑",Sum="∑",sung="♪",sup1="¹",sup2="²",sup3="³",sup="⊃",Sup="⋑",supdot="⪾",supdsub="⫘",supE="⫆",supe="⊇",supedot="⫄",Superset="⊃",SupersetEqual="⊇",suphsol="⟉",suphsub="⫗",suplarr="⥻",supmult="⫂",supnE="⫌",supne="⊋",supplus="⫀",supset="⊃",Supset="⋑",supseteq="⊇",supseteqq="⫆",supsetneq="⊋",supsetneqq="⫌",supsim="⫈",supsub="⫔",supsup="⫖",swarhk="⤦",swarr="↙",swArr="⇙",swarrow="↙",swnwar="⤪",szlig="ß",Tab="\t",target="⌖",Tau="Τ",tau="τ",tbrk="⎴",Tcaron="Ť",tcaron="ť",Tcedil="Ţ",tcedil="ţ",Tcy="Т",tcy="т",tdot="⃛",telrec="⌕",Tfr="𝔗",tfr="𝔱",there4="∴",therefore="∴",Therefore="∴",Theta="Θ",theta="θ",thetasym="ϑ",thetav="ϑ",thickapprox="≈",thicksim="∼",ThickSpace="  ",ThinSpace=" ",thinsp=" ",thkap="≈",thksim="∼",THORN="Þ",thorn="þ",tilde="˜",Tilde="∼",TildeEqual="≃",TildeFullEqual="≅",TildeTilde="≈",timesbar="⨱",timesb="⊠",times="×",timesd="⨰",tint="∭",toea="⤨",topbot="⌶",topcir="⫱",top="⊤",Topf="𝕋",topf="𝕥",topfork="⫚",tosa="⤩",tprime="‴",trade="™",TRADE="™",triangle="▵",triangledown="▿",triangleleft="◃",trianglelefteq="⊴",triangleq="≜",triangleright="▹",trianglerighteq="⊵",tridot="◬",trie="≜",triminus="⨺",TripleDot="⃛",triplus="⨹",trisb="⧍",tritime="⨻",trpezium="⏢",Tscr="𝒯",tscr="𝓉",TScy="Ц",tscy="ц",TSHcy="Ћ",tshcy="ћ",Tstrok="Ŧ",tstrok="ŧ",twixt="≬",twoheadleftarrow="↞",twoheadrightarrow="↠",Uacute="Ú",uacute="ú",uarr="↑",Uarr="↟",uArr="⇑",Uarrocir="⥉",Ubrcy="Ў",ubrcy="ў",Ubreve="Ŭ",ubreve="ŭ",Ucirc="Û",ucirc="û",Ucy="У",ucy="у",udarr="⇅",Udblac="Ű",udblac="ű",udhar="⥮",ufisht="⥾",Ufr="𝔘",ufr="𝔲",Ugrave="Ù",ugrave="ù",uHar="⥣",uharl="↿",uharr="↾",uhblk="▀",ulcorn="⌜",ulcorner="⌜",ulcrop="⌏",ultri="◸",Umacr="Ū",umacr="ū",uml="¨",UnderBar="_",UnderBrace="⏟",UnderBracket="⎵",UnderParenthesis="⏝",Union="⋃",UnionPlus="⊎",Uogon="Ų",uogon="ų",Uopf="𝕌",uopf="𝕦",UpArrowBar="⤒",uparrow="↑",UpArrow="↑",Uparrow="⇑",UpArrowDownArrow="⇅",updownarrow="↕",UpDownArrow="↕",Updownarrow="⇕",UpEquilibrium="⥮",upharpoonleft="↿",upharpoonright="↾",uplus="⊎",UpperLeftArrow="↖",UpperRightArrow="↗",upsi="υ",Upsi="ϒ",upsih="ϒ",Upsilon="Υ",upsilon="υ",UpTeeArrow="↥",UpTee="⊥",upuparrows="⇈",urcorn="⌝",urcorner="⌝",urcrop="⌎",Uring="Ů",uring="ů",urtri="◹",Uscr="𝒰",uscr="𝓊",utdot="⋰",Utilde="Ũ",utilde="ũ",utri="▵",utrif="▴",uuarr="⇈",Uuml="Ü",uuml="ü",uwangle="⦧",vangrt="⦜",varepsilon="ϵ",varkappa="ϰ",varnothing="∅",varphi="ϕ",varpi="ϖ",varpropto="∝",varr="↕",vArr="⇕",varrho="ϱ",varsigma="ς",varsubsetneq="⊊︀",varsubsetneqq="⫋︀",varsupsetneq="⊋︀",varsupsetneqq="⫌︀",vartheta="ϑ",vartriangleleft="⊲",vartriangleright="⊳",vBar="⫨",Vbar="⫫",vBarv="⫩",Vcy="В",vcy="в",vdash="⊢",vDash="⊨",Vdash="⊩",VDash="⊫",Vdashl="⫦",veebar="⊻",vee="∨",Vee="⋁",veeeq="≚",vellip="⋮",verbar="|",Verbar="‖",vert="|",Vert="‖",VerticalBar="∣",VerticalLine="|",VerticalSeparator="❘",VerticalTilde="≀",VeryThinSpace=" ",Vfr="𝔙",vfr="𝔳",vltri="⊲",vnsub="⊂⃒",vnsup="⊃⃒",Vopf="𝕍",vopf="𝕧",vprop="∝",vrtri="⊳",Vscr="𝒱",vscr="𝓋",vsubnE="⫋︀",vsubne="⊊︀",vsupnE="⫌︀",vsupne="⊋︀",Vvdash="⊪",vzigzag="⦚",Wcirc="Ŵ",wcirc="ŵ",wedbar="⩟",wedge="∧",Wedge="⋀",wedgeq="≙",weierp="℘",Wfr="𝔚",wfr="𝔴",Wopf="𝕎",wopf="𝕨",wp="℘",wr="≀",wreath="≀",Wscr="𝒲",wscr="𝓌",xcap="⋂",xcirc="◯",xcup="⋃",xdtri="▽",Xfr="𝔛",xfr="𝔵",xharr="⟷",xhArr="⟺",Xi="Ξ",xi="ξ",xlarr="⟵",xlArr="⟸",xmap="⟼",xnis="⋻",xodot="⨀",Xopf="𝕏",xopf="𝕩",xoplus="⨁",xotime="⨂",xrarr="⟶",xrArr="⟹",Xscr="𝒳",xscr="𝓍",xsqcup="⨆",xuplus="⨄",xutri="△",xvee="⋁",xwedge="⋀",Yacute="Ý",yacute="ý",YAcy="Я",yacy="я",Ycirc="Ŷ",ycirc="ŷ",Ycy="Ы",ycy="ы",yen="¥",Yfr="𝔜",yfr="𝔶",YIcy="Ї",yicy="ї",Yopf="𝕐",yopf="𝕪",Yscr="𝒴",yscr="𝓎",YUcy="Ю",yucy="ю",yuml="ÿ",Yuml="Ÿ",Zacute="Ź",zacute="ź",Zcaron="Ž",zcaron="ž",Zcy="З",zcy="з",Zdot="Ż",zdot="ż",zeetrf="ℨ",ZeroWidthSpace="​",Zeta="Ζ",zeta="ζ",zfr="𝔷",Zfr="ℨ",ZHcy="Ж",zhcy="ж",zigrarr="⇝",zopf="𝕫",Zopf="ℤ",Zscr="𝒵",zscr="𝓏",zwj="‍",zwnj="‌",entitiesJSON={Aacute:Aacute,aacute:aacute,Abreve:Abreve,abreve:abreve,ac:ac,acd:acd,acE:acE,Acirc:Acirc,acirc:acirc,acute:acute,Acy:Acy,acy:acy,AElig:AElig,aelig:aelig,af:af,Afr:Afr,afr:afr,Agrave:Agrave,agrave:agrave,alefsym:alefsym,aleph:aleph,Alpha:Alpha,alpha:alpha,Amacr:Amacr,amacr:amacr,amalg:amalg,amp:amp$1,AMP:AMP,andand:andand,And:And,and:and,andd:andd,andslope:andslope,andv:andv,ang:ang,ange:ange,angle:angle,angmsdaa:angmsdaa,angmsdab:angmsdab,angmsdac:angmsdac,angmsdad:angmsdad,angmsdae:angmsdae,angmsdaf:angmsdaf,angmsdag:angmsdag,angmsdah:angmsdah,angmsd:angmsd,angrt:angrt,angrtvb:angrtvb,angrtvbd:angrtvbd,angsph:angsph,angst:angst,angzarr:angzarr,Aogon:Aogon,aogon:aogon,Aopf:Aopf,aopf:aopf,apacir:apacir,ap:ap,apE:apE,ape:ape,apid:apid,apos:apos$1,ApplyFunction:ApplyFunction,approx:approx,approxeq:approxeq,Aring:Aring,aring:aring,Ascr:Ascr,ascr:ascr,Assign:Assign,ast:ast,asymp:asymp,asympeq:asympeq,Atilde:Atilde,atilde:atilde,Auml:Auml,auml:auml,awconint:awconint,awint:awint,backcong:backcong,backepsilon:backepsilon,backprime:backprime,backsim:backsim,backsimeq:backsimeq,Backslash:Backslash,Barv:Barv,barvee:barvee,barwed:barwed,Barwed:Barwed,barwedge:barwedge,bbrk:bbrk,bbrktbrk:bbrktbrk,bcong:bcong,Bcy:Bcy,bcy:bcy,bdquo:bdquo,becaus:becaus,because:because,Because:Because,bemptyv:bemptyv,bepsi:bepsi,bernou:bernou,Bernoullis:Bernoullis,Beta:Beta,beta:beta,beth:beth,between:between,Bfr:Bfr,bfr:bfr,bigcap:bigcap,bigcirc:bigcirc,bigcup:bigcup,bigodot:bigodot,bigoplus:bigoplus,bigotimes:bigotimes,bigsqcup:bigsqcup,bigstar:bigstar,bigtriangledown:bigtriangledown,bigtriangleup:bigtriangleup,biguplus:biguplus,bigvee:bigvee,bigwedge:bigwedge,bkarow:bkarow,blacklozenge:blacklozenge,blacksquare:blacksquare,blacktriangle:blacktriangle,blacktriangledown:blacktriangledown,blacktriangleleft:blacktriangleleft,blacktriangleright:blacktriangleright,blank:blank,blk12:blk12,blk14:blk14,blk34:blk34,block:block,bne:bne,bnequiv:bnequiv,bNot:bNot,bnot:bnot,Bopf:Bopf,bopf:bopf,bot:bot,bottom:bottom,bowtie:bowtie,boxbox:boxbox,boxdl:boxdl,boxdL:boxdL,boxDl:boxDl,boxDL:boxDL,boxdr:boxdr,boxdR:boxdR,boxDr:boxDr,boxDR:boxDR,boxh:boxh,boxH:boxH,boxhd:boxhd,boxHd:boxHd,boxhD:boxhD,boxHD:boxHD,boxhu:boxhu,boxHu:boxHu,boxhU:boxhU,boxHU:boxHU,boxminus:boxminus,boxplus:boxplus,boxtimes:boxtimes,boxul:boxul,boxuL:boxuL,boxUl:boxUl,boxUL:boxUL,boxur:boxur,boxuR:boxuR,boxUr:boxUr,boxUR:boxUR,boxv:boxv,boxV:boxV,boxvh:boxvh,boxvH:boxvH,boxVh:boxVh,boxVH:boxVH,boxvl:boxvl,boxvL:boxvL,boxVl:boxVl,boxVL:boxVL,boxvr:boxvr,boxvR:boxvR,boxVr:boxVr,boxVR:boxVR,bprime:bprime,breve:breve,Breve:Breve,brvbar:brvbar,bscr:bscr,Bscr:Bscr,bsemi:bsemi,bsim:bsim,bsime:bsime,bsolb:bsolb,bsol:bsol,bsolhsub:bsolhsub,bull:bull,bullet:bullet,bump:bump,bumpE:bumpE,bumpe:bumpe,Bumpeq:Bumpeq,bumpeq:bumpeq,Cacute:Cacute,cacute:cacute,capand:capand,capbrcup:capbrcup,capcap:capcap,cap:cap,Cap:Cap,capcup:capcup,capdot:capdot,CapitalDifferentialD:CapitalDifferentialD,caps:caps,caret:caret,caron:caron,Cayleys:Cayleys,ccaps:ccaps,Ccaron:Ccaron,ccaron:ccaron,Ccedil:Ccedil,ccedil:ccedil,Ccirc:Ccirc,ccirc:ccirc,Cconint:Cconint,ccups:ccups,ccupssm:ccupssm,Cdot:Cdot,cdot:cdot,cedil:cedil,Cedilla:Cedilla,cemptyv:cemptyv,cent:cent,centerdot:centerdot,CenterDot:CenterDot,cfr:cfr,Cfr:Cfr,CHcy:CHcy,chcy:chcy,check:check,checkmark:checkmark,Chi:Chi,chi:chi,circ:circ,circeq:circeq,circlearrowleft:circlearrowleft,circlearrowright:circlearrowright,circledast:circledast,circledcirc:circledcirc,circleddash:circleddash,CircleDot:CircleDot,circledR:circledR,circledS:circledS,CircleMinus:CircleMinus,CirclePlus:CirclePlus,CircleTimes:CircleTimes,cir:cir,cirE:cirE,cire:cire,cirfnint:cirfnint,cirmid:cirmid,cirscir:cirscir,ClockwiseContourIntegral:ClockwiseContourIntegral,CloseCurlyDoubleQuote:CloseCurlyDoubleQuote,CloseCurlyQuote:CloseCurlyQuote,clubs:clubs,clubsuit:clubsuit,colon:colon,Colon:Colon,Colone:Colone,colone:colone,coloneq:coloneq,comma:comma,commat:commat,comp:comp,compfn:compfn,complement:complement,complexes:complexes,cong:cong,congdot:congdot,Congruent:Congruent,conint:conint,Conint:Conint,ContourIntegral:ContourIntegral,copf:copf,Copf:Copf,coprod:coprod,Coproduct:Coproduct,copy:copy,COPY:COPY,copysr:copysr,CounterClockwiseContourIntegral:CounterClockwiseContourIntegral,crarr:crarr,cross:cross,Cross:Cross,Cscr:Cscr,cscr:cscr,csub:csub,csube:csube,csup:csup,csupe:csupe,ctdot:ctdot,cudarrl:cudarrl,cudarrr:cudarrr,cuepr:cuepr,cuesc:cuesc,cularr:cularr,cularrp:cularrp,cupbrcap:cupbrcap,cupcap:cupcap,CupCap:CupCap,cup:cup,Cup:Cup,cupcup:cupcup,cupdot:cupdot,cupor:cupor,cups:cups,curarr:curarr,curarrm:curarrm,curlyeqprec:curlyeqprec,curlyeqsucc:curlyeqsucc,curlyvee:curlyvee,curlywedge:curlywedge,curren:curren,curvearrowleft:curvearrowleft,curvearrowright:curvearrowright,cuvee:cuvee,cuwed:cuwed,cwconint:cwconint,cwint:cwint,cylcty:cylcty,dagger:dagger,Dagger:Dagger,daleth:daleth,darr:darr,Darr:Darr,dArr:dArr,dash:dash,Dashv:Dashv,dashv:dashv,dbkarow:dbkarow,dblac:dblac,Dcaron:Dcaron,dcaron:dcaron,Dcy:Dcy,dcy:dcy,ddagger:ddagger,ddarr:ddarr,DD:DD,dd:dd,DDotrahd:DDotrahd,ddotseq:ddotseq,deg:deg,Del:Del,Delta:Delta,delta:delta,demptyv:demptyv,dfisht:dfisht,Dfr:Dfr,dfr:dfr,dHar:dHar,dharl:dharl,dharr:dharr,DiacriticalAcute:DiacriticalAcute,DiacriticalDot:DiacriticalDot,DiacriticalDoubleAcute:DiacriticalDoubleAcute,DiacriticalGrave:DiacriticalGrave,DiacriticalTilde:DiacriticalTilde,diam:diam,diamond:diamond,Diamond:Diamond,diamondsuit:diamondsuit,diams:diams,die:die,DifferentialD:DifferentialD,digamma:digamma,disin:disin,div:div,divide:divide,divideontimes:divideontimes,divonx:divonx,DJcy:DJcy,djcy:djcy,dlcorn:dlcorn,dlcrop:dlcrop,dollar:dollar,Dopf:Dopf,dopf:dopf,Dot:Dot,dot:dot,DotDot:DotDot,doteq:doteq,doteqdot:doteqdot,DotEqual:DotEqual,dotminus:dotminus,dotplus:dotplus,dotsquare:dotsquare,doublebarwedge:doublebarwedge,DoubleContourIntegral:DoubleContourIntegral,DoubleDot:DoubleDot,DoubleDownArrow:DoubleDownArrow,DoubleLeftArrow:DoubleLeftArrow,DoubleLeftRightArrow:DoubleLeftRightArrow,DoubleLeftTee:DoubleLeftTee,DoubleLongLeftArrow:DoubleLongLeftArrow,DoubleLongLeftRightArrow:DoubleLongLeftRightArrow,DoubleLongRightArrow:DoubleLongRightArrow,DoubleRightArrow:DoubleRightArrow,DoubleRightTee:DoubleRightTee,DoubleUpArrow:DoubleUpArrow,DoubleUpDownArrow:DoubleUpDownArrow,DoubleVerticalBar:DoubleVerticalBar,DownArrowBar:DownArrowBar,downarrow:downarrow,DownArrow:DownArrow,Downarrow:Downarrow,DownArrowUpArrow:DownArrowUpArrow,DownBreve:DownBreve,downdownarrows:downdownarrows,downharpoonleft:downharpoonleft,downharpoonright:downharpoonright,DownLeftRightVector:DownLeftRightVector,DownLeftTeeVector:DownLeftTeeVector,DownLeftVectorBar:DownLeftVectorBar,DownLeftVector:DownLeftVector,DownRightTeeVector:DownRightTeeVector,DownRightVectorBar:DownRightVectorBar,DownRightVector:DownRightVector,DownTeeArrow:DownTeeArrow,DownTee:DownTee,drbkarow:drbkarow,drcorn:drcorn,drcrop:drcrop,Dscr:Dscr,dscr:dscr,DScy:DScy,dscy:dscy,dsol:dsol,Dstrok:Dstrok,dstrok:dstrok,dtdot:dtdot,dtri:dtri,dtrif:dtrif,duarr:duarr,duhar:duhar,dwangle:dwangle,DZcy:DZcy,dzcy:dzcy,dzigrarr:dzigrarr,Eacute:Eacute,eacute:eacute,easter:easter,Ecaron:Ecaron,ecaron:ecaron,Ecirc:Ecirc,ecirc:ecirc,ecir:ecir,ecolon:ecolon,Ecy:Ecy,ecy:ecy,eDDot:eDDot,Edot:Edot,edot:edot,eDot:eDot,ee:ee,efDot:efDot,Efr:Efr,efr:efr,eg:eg,Egrave:Egrave,egrave:egrave,egs:egs,egsdot:egsdot,el:el,Element:Element,elinters:elinters,ell:ell,els:els,elsdot:elsdot,Emacr:Emacr,emacr:emacr,empty:empty,emptyset:emptyset,EmptySmallSquare:EmptySmallSquare,emptyv:emptyv,EmptyVerySmallSquare:EmptyVerySmallSquare,emsp13:emsp13,emsp14:emsp14,emsp:emsp,ENG:ENG,eng:eng,ensp:ensp,Eogon:Eogon,eogon:eogon,Eopf:Eopf,eopf:eopf,epar:epar,eparsl:eparsl,eplus:eplus,epsi:epsi,Epsilon:Epsilon,epsilon:epsilon,epsiv:epsiv,eqcirc:eqcirc,eqcolon:eqcolon,eqsim:eqsim,eqslantgtr:eqslantgtr,eqslantless:eqslantless,Equal:Equal,equals:equals,EqualTilde:EqualTilde,equest:equest,Equilibrium:Equilibrium,equiv:equiv,equivDD:equivDD,eqvparsl:eqvparsl,erarr:erarr,erDot:erDot,escr:escr,Escr:Escr,esdot:esdot,Esim:Esim,esim:esim,Eta:Eta,eta:eta,ETH:ETH,eth:eth,Euml:Euml,euml:euml,euro:euro,excl:excl,exist:exist,Exists:Exists,expectation:expectation,exponentiale:exponentiale,ExponentialE:ExponentialE,fallingdotseq:fallingdotseq,Fcy:Fcy,fcy:fcy,female:female,ffilig:ffilig,fflig:fflig,ffllig:ffllig,Ffr:Ffr,ffr:ffr,filig:filig,FilledSmallSquare:FilledSmallSquare,FilledVerySmallSquare:FilledVerySmallSquare,fjlig:fjlig,flat:flat,fllig:fllig,fltns:fltns,fnof:fnof,Fopf:Fopf,fopf:fopf,forall:forall,ForAll:ForAll,fork:fork,forkv:forkv,Fouriertrf:Fouriertrf,fpartint:fpartint,frac12:frac12,frac13:frac13,frac14:frac14,frac15:frac15,frac16:frac16,frac18:frac18,frac23:frac23,frac25:frac25,frac34:frac34,frac35:frac35,frac38:frac38,frac45:frac45,frac56:frac56,frac58:frac58,frac78:frac78,frasl:frasl,frown:frown,fscr:fscr,Fscr:Fscr,gacute:gacute,Gamma:Gamma,gamma:gamma,Gammad:Gammad,gammad:gammad,gap:gap,Gbreve:Gbreve,gbreve:gbreve,Gcedil:Gcedil,Gcirc:Gcirc,gcirc:gcirc,Gcy:Gcy,gcy:gcy,Gdot:Gdot,gdot:gdot,ge:ge,gE:gE,gEl:gEl,gel:gel,geq:geq,geqq:geqq,geqslant:geqslant,gescc:gescc,ges:ges,gesdot:gesdot,gesdoto:gesdoto,gesdotol:gesdotol,gesl:gesl,gesles:gesles,Gfr:Gfr,gfr:gfr,gg:gg,Gg:Gg,ggg:ggg,gimel:gimel,GJcy:GJcy,gjcy:gjcy,gla:gla,gl:gl,glE:glE,glj:glj,gnap:gnap,gnapprox:gnapprox,gne:gne,gnE:gnE,gneq:gneq,gneqq:gneqq,gnsim:gnsim,Gopf:Gopf,gopf:gopf,grave:grave,GreaterEqual:GreaterEqual,GreaterEqualLess:GreaterEqualLess,GreaterFullEqual:GreaterFullEqual,GreaterGreater:GreaterGreater,GreaterLess:GreaterLess,GreaterSlantEqual:GreaterSlantEqual,GreaterTilde:GreaterTilde,Gscr:Gscr,gscr:gscr,gsim:gsim,gsime:gsime,gsiml:gsiml,gtcc:gtcc,gtcir:gtcir,gt:gt$1,GT:GT,Gt:Gt,gtdot:gtdot,gtlPar:gtlPar,gtquest:gtquest,gtrapprox:gtrapprox,gtrarr:gtrarr,gtrdot:gtrdot,gtreqless:gtreqless,gtreqqless:gtreqqless,gtrless:gtrless,gtrsim:gtrsim,gvertneqq:gvertneqq,gvnE:gvnE,Hacek:Hacek,hairsp:hairsp,half:half,hamilt:hamilt,HARDcy:HARDcy,hardcy:hardcy,harrcir:harrcir,harr:harr,hArr:hArr,harrw:harrw,Hat:Hat,hbar:hbar,Hcirc:Hcirc,hcirc:hcirc,hearts:hearts,heartsuit:heartsuit,hellip:hellip,hercon:hercon,hfr:hfr,Hfr:Hfr,HilbertSpace:HilbertSpace,hksearow:hksearow,hkswarow:hkswarow,hoarr:hoarr,homtht:homtht,hookleftarrow:hookleftarrow,hookrightarrow:hookrightarrow,hopf:hopf,Hopf:Hopf,horbar:horbar,HorizontalLine:HorizontalLine,hscr:hscr,Hscr:Hscr,hslash:hslash,Hstrok:Hstrok,hstrok:hstrok,HumpDownHump:HumpDownHump,HumpEqual:HumpEqual,hybull:hybull,hyphen:hyphen,Iacute:Iacute,iacute:iacute,ic:ic,Icirc:Icirc,icirc:icirc,Icy:Icy,icy:icy,Idot:Idot,IEcy:IEcy,iecy:iecy,iexcl:iexcl,iff:iff,ifr:ifr,Ifr:Ifr,Igrave:Igrave,igrave:igrave,ii:ii,iiiint:iiiint,iiint:iiint,iinfin:iinfin,iiota:iiota,IJlig:IJlig,ijlig:ijlig,Imacr:Imacr,imacr:imacr,image:image,ImaginaryI:ImaginaryI,imagline:imagline,imagpart:imagpart,imath:imath,Im:Im,imof:imof,imped:imped,Implies:Implies,incare:incare,infin:infin,infintie:infintie,inodot:inodot,intcal:intcal,int:int,Int:Int,integers:integers,Integral:Integral,intercal:intercal,Intersection:Intersection,intlarhk:intlarhk,intprod:intprod,InvisibleComma:InvisibleComma,InvisibleTimes:InvisibleTimes,IOcy:IOcy,iocy:iocy,Iogon:Iogon,iogon:iogon,Iopf:Iopf,iopf:iopf,Iota:Iota,iota:iota,iprod:iprod,iquest:iquest,iscr:iscr,Iscr:Iscr,isin:isin,isindot:isindot,isinE:isinE,isins:isins,isinsv:isinsv,isinv:isinv,it:it,Itilde:Itilde,itilde:itilde,Iukcy:Iukcy,iukcy:iukcy,Iuml:Iuml,iuml:iuml,Jcirc:Jcirc,jcirc:jcirc,Jcy:Jcy,jcy:jcy,Jfr:Jfr,jfr:jfr,jmath:jmath,Jopf:Jopf,jopf:jopf,Jscr:Jscr,jscr:jscr,Jsercy:Jsercy,jsercy:jsercy,Jukcy:Jukcy,jukcy:jukcy,Kappa:Kappa,kappa:kappa,kappav:kappav,Kcedil:Kcedil,kcedil:kcedil,Kcy:Kcy,kcy:kcy,Kfr:Kfr,kfr:kfr,kgreen:kgreen,KHcy:KHcy,khcy:khcy,KJcy:KJcy,kjcy:kjcy,Kopf:Kopf,kopf:kopf,Kscr:Kscr,kscr:kscr,lAarr:lAarr,Lacute:Lacute,lacute:lacute,laemptyv:laemptyv,lagran:lagran,Lambda:Lambda,lambda:lambda,lang:lang,Lang:Lang,langd:langd,langle:langle,lap:lap,Laplacetrf:Laplacetrf,laquo:laquo,larrb:larrb,larrbfs:larrbfs,larr:larr,Larr:Larr,lArr:lArr,larrfs:larrfs,larrhk:larrhk,larrlp:larrlp,larrpl:larrpl,larrsim:larrsim,larrtl:larrtl,latail:latail,lAtail:lAtail,lat:lat,late:late,lates:lates,lbarr:lbarr,lBarr:lBarr,lbbrk:lbbrk,lbrace:lbrace,lbrack:lbrack,lbrke:lbrke,lbrksld:lbrksld,lbrkslu:lbrkslu,Lcaron:Lcaron,lcaron:lcaron,Lcedil:Lcedil,lcedil:lcedil,lceil:lceil,lcub:lcub,Lcy:Lcy,lcy:lcy,ldca:ldca,ldquo:ldquo,ldquor:ldquor,ldrdhar:ldrdhar,ldrushar:ldrushar,ldsh:ldsh,le:le,lE:lE,LeftAngleBracket:LeftAngleBracket,LeftArrowBar:LeftArrowBar,leftarrow:leftarrow,LeftArrow:LeftArrow,Leftarrow:Leftarrow,LeftArrowRightArrow:LeftArrowRightArrow,leftarrowtail:leftarrowtail,LeftCeiling:LeftCeiling,LeftDoubleBracket:LeftDoubleBracket,LeftDownTeeVector:LeftDownTeeVector,LeftDownVectorBar:LeftDownVectorBar,LeftDownVector:LeftDownVector,LeftFloor:LeftFloor,leftharpoondown:leftharpoondown,leftharpoonup:leftharpoonup,leftleftarrows:leftleftarrows,leftrightarrow:leftrightarrow,LeftRightArrow:LeftRightArrow,Leftrightarrow:Leftrightarrow,leftrightarrows:leftrightarrows,leftrightharpoons:leftrightharpoons,leftrightsquigarrow:leftrightsquigarrow,LeftRightVector:LeftRightVector,LeftTeeArrow:LeftTeeArrow,LeftTee:LeftTee,LeftTeeVector:LeftTeeVector,leftthreetimes:leftthreetimes,LeftTriangleBar:LeftTriangleBar,LeftTriangle:LeftTriangle,LeftTriangleEqual:LeftTriangleEqual,LeftUpDownVector:LeftUpDownVector,LeftUpTeeVector:LeftUpTeeVector,LeftUpVectorBar:LeftUpVectorBar,LeftUpVector:LeftUpVector,LeftVectorBar:LeftVectorBar,LeftVector:LeftVector,lEg:lEg,leg:leg,leq:leq,leqq:leqq,leqslant:leqslant,lescc:lescc,les:les,lesdot:lesdot,lesdoto:lesdoto,lesdotor:lesdotor,lesg:lesg,lesges:lesges,lessapprox:lessapprox,lessdot:lessdot,lesseqgtr:lesseqgtr,lesseqqgtr:lesseqqgtr,LessEqualGreater:LessEqualGreater,LessFullEqual:LessFullEqual,LessGreater:LessGreater,lessgtr:lessgtr,LessLess:LessLess,lesssim:lesssim,LessSlantEqual:LessSlantEqual,LessTilde:LessTilde,lfisht:lfisht,lfloor:lfloor,Lfr:Lfr,lfr:lfr,lg:lg,lgE:lgE,lHar:lHar,lhard:lhard,lharu:lharu,lharul:lharul,lhblk:lhblk,LJcy:LJcy,ljcy:ljcy,llarr:llarr,ll:ll,Ll:Ll,llcorner:llcorner,Lleftarrow:Lleftarrow,llhard:llhard,lltri:lltri,Lmidot:Lmidot,lmidot:lmidot,lmoustache:lmoustache,lmoust:lmoust,lnap:lnap,lnapprox:lnapprox,lne:lne,lnE:lnE,lneq:lneq,lneqq:lneqq,lnsim:lnsim,loang:loang,loarr:loarr,lobrk:lobrk,longleftarrow:longleftarrow,LongLeftArrow:LongLeftArrow,Longleftarrow:Longleftarrow,longleftrightarrow:longleftrightarrow,LongLeftRightArrow:LongLeftRightArrow,Longleftrightarrow:Longleftrightarrow,longmapsto:longmapsto,longrightarrow:longrightarrow,LongRightArrow:LongRightArrow,Longrightarrow:Longrightarrow,looparrowleft:looparrowleft,looparrowright:looparrowright,lopar:lopar,Lopf:Lopf,lopf:lopf,loplus:loplus,lotimes:lotimes,lowast:lowast,lowbar:lowbar,LowerLeftArrow:LowerLeftArrow,LowerRightArrow:LowerRightArrow,loz:loz,lozenge:lozenge,lozf:lozf,lpar:lpar,lparlt:lparlt,lrarr:lrarr,lrcorner:lrcorner,lrhar:lrhar,lrhard:lrhard,lrm:lrm,lrtri:lrtri,lsaquo:lsaquo,lscr:lscr,Lscr:Lscr,lsh:lsh,Lsh:Lsh,lsim:lsim,lsime:lsime,lsimg:lsimg,lsqb:lsqb,lsquo:lsquo,lsquor:lsquor,Lstrok:Lstrok,lstrok:lstrok,ltcc:ltcc,ltcir:ltcir,lt:lt$1,LT:LT,Lt:Lt,ltdot:ltdot,lthree:lthree,ltimes:ltimes,ltlarr:ltlarr,ltquest:ltquest,ltri:ltri,ltrie:ltrie,ltrif:ltrif,ltrPar:ltrPar,lurdshar:lurdshar,luruhar:luruhar,lvertneqq:lvertneqq,lvnE:lvnE,macr:macr,male:male,malt:malt,maltese:maltese,map:map$1,mapsto:mapsto,mapstodown:mapstodown,mapstoleft:mapstoleft,mapstoup:mapstoup,marker:marker,mcomma:mcomma,Mcy:Mcy,mcy:mcy,mdash:mdash,mDDot:mDDot,measuredangle:measuredangle,MediumSpace:MediumSpace,Mellintrf:Mellintrf,Mfr:Mfr,mfr:mfr,mho:mho,micro:micro,midast:midast,midcir:midcir,mid:mid,middot:middot,minusb:minusb,minus:minus,minusd:minusd,minusdu:minusdu,MinusPlus:MinusPlus,mlcp:mlcp,mldr:mldr,mnplus:mnplus,models:models,Mopf:Mopf,mopf:mopf,mp:mp,mscr:mscr,Mscr:Mscr,mstpos:mstpos,Mu:Mu,mu:mu,multimap:multimap,mumap:mumap,nabla:nabla,Nacute:Nacute,nacute:nacute,nang:nang,nap:nap,napE:napE,napid:napid,napos:napos,napprox:napprox,natural:natural,naturals:naturals,natur:natur,nbsp:nbsp,nbump:nbump,nbumpe:nbumpe,ncap:ncap,Ncaron:Ncaron,ncaron:ncaron,Ncedil:Ncedil,ncedil:ncedil,ncong:ncong,ncongdot:ncongdot,ncup:ncup,Ncy:Ncy,ncy:ncy,ndash:ndash,nearhk:nearhk,nearr:nearr,neArr:neArr,nearrow:nearrow,ne:ne,nedot:nedot,NegativeMediumSpace:NegativeMediumSpace,NegativeThickSpace:NegativeThickSpace,NegativeThinSpace:NegativeThinSpace,NegativeVeryThinSpace:NegativeVeryThinSpace,nequiv:nequiv,nesear:nesear,nesim:nesim,NestedGreaterGreater:NestedGreaterGreater,NestedLessLess:NestedLessLess,NewLine:NewLine,nexist:nexist,nexists:nexists,Nfr:Nfr,nfr:nfr,ngE:ngE,nge:nge,ngeq:ngeq,ngeqq:ngeqq,ngeqslant:ngeqslant,nges:nges,nGg:nGg,ngsim:ngsim,nGt:nGt,ngt:ngt,ngtr:ngtr,nGtv:nGtv,nharr:nharr,nhArr:nhArr,nhpar:nhpar,ni:ni,nis:nis,nisd:nisd,niv:niv,NJcy:NJcy,njcy:njcy,nlarr:nlarr,nlArr:nlArr,nldr:nldr,nlE:nlE,nle:nle,nleftarrow:nleftarrow,nLeftarrow:nLeftarrow,nleftrightarrow:nleftrightarrow,nLeftrightarrow:nLeftrightarrow,nleq:nleq,nleqq:nleqq,nleqslant:nleqslant,nles:nles,nless:nless,nLl:nLl,nlsim:nlsim,nLt:nLt,nlt:nlt,nltri:nltri,nltrie:nltrie,nLtv:nLtv,nmid:nmid,NoBreak:NoBreak,NonBreakingSpace:NonBreakingSpace,nopf:nopf,Nopf:Nopf,Not:Not,not:not,NotCongruent:NotCongruent,NotCupCap:NotCupCap,NotDoubleVerticalBar:NotDoubleVerticalBar,NotElement:NotElement,NotEqual:NotEqual,NotEqualTilde:NotEqualTilde,NotExists:NotExists,NotGreater:NotGreater,NotGreaterEqual:NotGreaterEqual,NotGreaterFullEqual:NotGreaterFullEqual,NotGreaterGreater:NotGreaterGreater,NotGreaterLess:NotGreaterLess,NotGreaterSlantEqual:NotGreaterSlantEqual,NotGreaterTilde:NotGreaterTilde,NotHumpDownHump:NotHumpDownHump,NotHumpEqual:NotHumpEqual,notin:notin,notindot:notindot,notinE:notinE,notinva:notinva,notinvb:notinvb,notinvc:notinvc,NotLeftTriangleBar:NotLeftTriangleBar,NotLeftTriangle:NotLeftTriangle,NotLeftTriangleEqual:NotLeftTriangleEqual,NotLess:NotLess,NotLessEqual:NotLessEqual,NotLessGreater:NotLessGreater,NotLessLess:NotLessLess,NotLessSlantEqual:NotLessSlantEqual,NotLessTilde:NotLessTilde,NotNestedGreaterGreater:NotNestedGreaterGreater,NotNestedLessLess:NotNestedLessLess,notni:notni,notniva:notniva,notnivb:notnivb,notnivc:notnivc,NotPrecedes:NotPrecedes,NotPrecedesEqual:NotPrecedesEqual,NotPrecedesSlantEqual:NotPrecedesSlantEqual,NotReverseElement:NotReverseElement,NotRightTriangleBar:NotRightTriangleBar,NotRightTriangle:NotRightTriangle,NotRightTriangleEqual:NotRightTriangleEqual,NotSquareSubset:NotSquareSubset,NotSquareSubsetEqual:NotSquareSubsetEqual,NotSquareSuperset:NotSquareSuperset,NotSquareSupersetEqual:NotSquareSupersetEqual,NotSubset:NotSubset,NotSubsetEqual:NotSubsetEqual,NotSucceeds:NotSucceeds,NotSucceedsEqual:NotSucceedsEqual,NotSucceedsSlantEqual:NotSucceedsSlantEqual,NotSucceedsTilde:NotSucceedsTilde,NotSuperset:NotSuperset,NotSupersetEqual:NotSupersetEqual,NotTilde:NotTilde,NotTildeEqual:NotTildeEqual,NotTildeFullEqual:NotTildeFullEqual,NotTildeTilde:NotTildeTilde,NotVerticalBar:NotVerticalBar,nparallel:nparallel,npar:npar,nparsl:nparsl,npart:npart,npolint:npolint,npr:npr,nprcue:nprcue,nprec:nprec,npreceq:npreceq,npre:npre,nrarrc:nrarrc,nrarr:nrarr,nrArr:nrArr,nrarrw:nrarrw,nrightarrow:nrightarrow,nRightarrow:nRightarrow,nrtri:nrtri,nrtrie:nrtrie,nsc:nsc,nsccue:nsccue,nsce:nsce,Nscr:Nscr,nscr:nscr,nshortmid:nshortmid,nshortparallel:nshortparallel,nsim:nsim,nsime:nsime,nsimeq:nsimeq,nsmid:nsmid,nspar:nspar,nsqsube:nsqsube,nsqsupe:nsqsupe,nsub:nsub,nsubE:nsubE,nsube:nsube,nsubset:nsubset,nsubseteq:nsubseteq,nsubseteqq:nsubseteqq,nsucc:nsucc,nsucceq:nsucceq,nsup:nsup,nsupE:nsupE,nsupe:nsupe,nsupset:nsupset,nsupseteq:nsupseteq,nsupseteqq:nsupseteqq,ntgl:ntgl,Ntilde:Ntilde,ntilde:ntilde,ntlg:ntlg,ntriangleleft:ntriangleleft,ntrianglelefteq:ntrianglelefteq,ntriangleright:ntriangleright,ntrianglerighteq:ntrianglerighteq,Nu:Nu,nu:nu,num:num,numero:numero,numsp:numsp,nvap:nvap,nvdash:nvdash,nvDash:nvDash,nVdash:nVdash,nVDash:nVDash,nvge:nvge,nvgt:nvgt,nvHarr:nvHarr,nvinfin:nvinfin,nvlArr:nvlArr,nvle:nvle,nvlt:nvlt,nvltrie:nvltrie,nvrArr:nvrArr,nvrtrie:nvrtrie,nvsim:nvsim,nwarhk:nwarhk,nwarr:nwarr,nwArr:nwArr,nwarrow:nwarrow,nwnear:nwnear,Oacute:Oacute,oacute:oacute,oast:oast,Ocirc:Ocirc,ocirc:ocirc,ocir:ocir,Ocy:Ocy,ocy:ocy,odash:odash,Odblac:Odblac,odblac:odblac,odiv:odiv,odot:odot,odsold:odsold,OElig:OElig,oelig:oelig,ofcir:ofcir,Ofr:Ofr,ofr:ofr,ogon:ogon,Ograve:Ograve,ograve:ograve,ogt:ogt,ohbar:ohbar,ohm:ohm,oint:oint,olarr:olarr,olcir:olcir,olcross:olcross,oline:oline,olt:olt,Omacr:Omacr,omacr:omacr,Omega:Omega,omega:omega,Omicron:Omicron,omicron:omicron,omid:omid,ominus:ominus,Oopf:Oopf,oopf:oopf,opar:opar,OpenCurlyDoubleQuote:OpenCurlyDoubleQuote,OpenCurlyQuote:OpenCurlyQuote,operp:operp,oplus:oplus,orarr:orarr,Or:Or,or:or,ord:ord,order:order,orderof:orderof,ordf:ordf,ordm:ordm,origof:origof,oror:oror,orslope:orslope,orv:orv,oS:oS,Oscr:Oscr,oscr:oscr,Oslash:Oslash,oslash:oslash,osol:osol,Otilde:Otilde,otilde:otilde,otimesas:otimesas,Otimes:Otimes,otimes:otimes,Ouml:Ouml,ouml:ouml,ovbar:ovbar,OverBar:OverBar,OverBrace:OverBrace,OverBracket:OverBracket,OverParenthesis:OverParenthesis,para:para,parallel:parallel,par:par,parsim:parsim,parsl:parsl,part:part,PartialD:PartialD,Pcy:Pcy,pcy:pcy,percnt:percnt,period:period,permil:permil,perp:perp,pertenk:pertenk,Pfr:Pfr,pfr:pfr,Phi:Phi,phi:phi,phiv:phiv,phmmat:phmmat,phone:phone,Pi:Pi,pi:pi,pitchfork:pitchfork,piv:piv,planck:planck,planckh:planckh,plankv:plankv,plusacir:plusacir,plusb:plusb,pluscir:pluscir,plus:plus,plusdo:plusdo,plusdu:plusdu,pluse:pluse,PlusMinus:PlusMinus,plusmn:plusmn,plussim:plussim,plustwo:plustwo,pm:pm,Poincareplane:Poincareplane,pointint:pointint,popf:popf,Popf:Popf,pound:pound,prap:prap,Pr:Pr,pr:pr,prcue:prcue,precapprox:precapprox,prec:prec,preccurlyeq:preccurlyeq,Precedes:Precedes,PrecedesEqual:PrecedesEqual,PrecedesSlantEqual:PrecedesSlantEqual,PrecedesTilde:PrecedesTilde,preceq:preceq,precnapprox:precnapprox,precneqq:precneqq,precnsim:precnsim,pre:pre,prE:prE,precsim:precsim,prime:prime,Prime:Prime,primes:primes,prnap:prnap,prnE:prnE,prnsim:prnsim,prod:prod,Product:Product,profalar:profalar,profline:profline,profsurf:profsurf,prop:prop,Proportional:Proportional,Proportion:Proportion,propto:propto,prsim:prsim,prurel:prurel,Pscr:Pscr,pscr:pscr,Psi:Psi,psi:psi,puncsp:puncsp,Qfr:Qfr,qfr:qfr,qint:qint,qopf:qopf,Qopf:Qopf,qprime:qprime,Qscr:Qscr,qscr:qscr,quaternions:quaternions,quatint:quatint,quest:quest,questeq:questeq,quot:quot$1,QUOT:QUOT,rAarr:rAarr,race:race,Racute:Racute,racute:racute,radic:radic,raemptyv:raemptyv,rang:rang,Rang:Rang,rangd:rangd,range:range,rangle:rangle,raquo:raquo,rarrap:rarrap,rarrb:rarrb,rarrbfs:rarrbfs,rarrc:rarrc,rarr:rarr,Rarr:Rarr,rArr:rArr,rarrfs:rarrfs,rarrhk:rarrhk,rarrlp:rarrlp,rarrpl:rarrpl,rarrsim:rarrsim,Rarrtl:Rarrtl,rarrtl:rarrtl,rarrw:rarrw,ratail:ratail,rAtail:rAtail,ratio:ratio,rationals:rationals,rbarr:rbarr,rBarr:rBarr,RBarr:RBarr,rbbrk:rbbrk,rbrace:rbrace,rbrack:rbrack,rbrke:rbrke,rbrksld:rbrksld,rbrkslu:rbrkslu,Rcaron:Rcaron,rcaron:rcaron,Rcedil:Rcedil,rcedil:rcedil,rceil:rceil,rcub:rcub,Rcy:Rcy,rcy:rcy,rdca:rdca,rdldhar:rdldhar,rdquo:rdquo,rdquor:rdquor,rdsh:rdsh,real:real,realine:realine,realpart:realpart,reals:reals,Re:Re,rect:rect,reg:reg,REG:REG,ReverseElement:ReverseElement,ReverseEquilibrium:ReverseEquilibrium,ReverseUpEquilibrium:ReverseUpEquilibrium,rfisht:rfisht,rfloor:rfloor,rfr:rfr,Rfr:Rfr,rHar:rHar,rhard:rhard,rharu:rharu,rharul:rharul,Rho:Rho,rho:rho,rhov:rhov,RightAngleBracket:RightAngleBracket,RightArrowBar:RightArrowBar,rightarrow:rightarrow,RightArrow:RightArrow,Rightarrow:Rightarrow,RightArrowLeftArrow:RightArrowLeftArrow,rightarrowtail:rightarrowtail,RightCeiling:RightCeiling,RightDoubleBracket:RightDoubleBracket,RightDownTeeVector:RightDownTeeVector,RightDownVectorBar:RightDownVectorBar,RightDownVector:RightDownVector,RightFloor:RightFloor,rightharpoondown:rightharpoondown,rightharpoonup:rightharpoonup,rightleftarrows:rightleftarrows,rightleftharpoons:rightleftharpoons,rightrightarrows:rightrightarrows,rightsquigarrow:rightsquigarrow,RightTeeArrow:RightTeeArrow,RightTee:RightTee,RightTeeVector:RightTeeVector,rightthreetimes:rightthreetimes,RightTriangleBar:RightTriangleBar,RightTriangle:RightTriangle,RightTriangleEqual:RightTriangleEqual,RightUpDownVector:RightUpDownVector,RightUpTeeVector:RightUpTeeVector,RightUpVectorBar:RightUpVectorBar,RightUpVector:RightUpVector,RightVectorBar:RightVectorBar,RightVector:RightVector,ring:ring,risingdotseq:risingdotseq,rlarr:rlarr,rlhar:rlhar,rlm:rlm,rmoustache:rmoustache,rmoust:rmoust,rnmid:rnmid,roang:roang,roarr:roarr,robrk:robrk,ropar:ropar,ropf:ropf,Ropf:Ropf,roplus:roplus,rotimes:rotimes,RoundImplies:RoundImplies,rpar:rpar,rpargt:rpargt,rppolint:rppolint,rrarr:rrarr,Rrightarrow:Rrightarrow,rsaquo:rsaquo,rscr:rscr,Rscr:Rscr,rsh:rsh,Rsh:Rsh,rsqb:rsqb,rsquo:rsquo,rsquor:rsquor,rthree:rthree,rtimes:rtimes,rtri:rtri,rtrie:rtrie,rtrif:rtrif,rtriltri:rtriltri,RuleDelayed:RuleDelayed,ruluhar:ruluhar,rx:rx,Sacute:Sacute,sacute:sacute,sbquo:sbquo,scap:scap,Scaron:Scaron,scaron:scaron,Sc:Sc,sc:sc,sccue:sccue,sce:sce,scE:scE,Scedil:Scedil,scedil:scedil,Scirc:Scirc,scirc:scirc,scnap:scnap,scnE:scnE,scnsim:scnsim,scpolint:scpolint,scsim:scsim,Scy:Scy,scy:scy,sdotb:sdotb,sdot:sdot,sdote:sdote,searhk:searhk,searr:searr,seArr:seArr,searrow:searrow,sect:sect,semi:semi,seswar:seswar,setminus:setminus,setmn:setmn,sext:sext,Sfr:Sfr,sfr:sfr,sfrown:sfrown,sharp:sharp,SHCHcy:SHCHcy,shchcy:shchcy,SHcy:SHcy,shcy:shcy,ShortDownArrow:ShortDownArrow,ShortLeftArrow:ShortLeftArrow,shortmid:shortmid,shortparallel:shortparallel,ShortRightArrow:ShortRightArrow,ShortUpArrow:ShortUpArrow,shy:shy,Sigma:Sigma,sigma:sigma,sigmaf:sigmaf,sigmav:sigmav,sim:sim,simdot:simdot,sime:sime,simeq:simeq,simg:simg,simgE:simgE,siml:siml,simlE:simlE,simne:simne,simplus:simplus,simrarr:simrarr,slarr:slarr,SmallCircle:SmallCircle,smallsetminus:smallsetminus,smashp:smashp,smeparsl:smeparsl,smid:smid,smile:smile,smt:smt,smte:smte,smtes:smtes,SOFTcy:SOFTcy,softcy:softcy,solbar:solbar,solb:solb,sol:sol,Sopf:Sopf,sopf:sopf,spades:spades,spadesuit:spadesuit,spar:spar,sqcap:sqcap,sqcaps:sqcaps,sqcup:sqcup,sqcups:sqcups,Sqrt:Sqrt,sqsub:sqsub,sqsube:sqsube,sqsubset:sqsubset,sqsubseteq:sqsubseteq,sqsup:sqsup,sqsupe:sqsupe,sqsupset:sqsupset,sqsupseteq:sqsupseteq,square:square,Square:Square,SquareIntersection:SquareIntersection,SquareSubset:SquareSubset,SquareSubsetEqual:SquareSubsetEqual,SquareSuperset:SquareSuperset,SquareSupersetEqual:SquareSupersetEqual,SquareUnion:SquareUnion,squarf:squarf,squ:squ,squf:squf,srarr:srarr,Sscr:Sscr,sscr:sscr,ssetmn:ssetmn,ssmile:ssmile,sstarf:sstarf,Star:Star,star:star,starf:starf,straightepsilon:straightepsilon,straightphi:straightphi,strns:strns,sub:sub,Sub:Sub,subdot:subdot,subE:subE,sube:sube,subedot:subedot,submult:submult,subnE:subnE,subne:subne,subplus:subplus,subrarr:subrarr,subset:subset,Subset:Subset,subseteq:subseteq,subseteqq:subseteqq,SubsetEqual:SubsetEqual,subsetneq:subsetneq,subsetneqq:subsetneqq,subsim:subsim,subsub:subsub,subsup:subsup,succapprox:succapprox,succ:succ,succcurlyeq:succcurlyeq,Succeeds:Succeeds,SucceedsEqual:SucceedsEqual,SucceedsSlantEqual:SucceedsSlantEqual,SucceedsTilde:SucceedsTilde,succeq:succeq,succnapprox:succnapprox,succneqq:succneqq,succnsim:succnsim,succsim:succsim,SuchThat:SuchThat,sum:sum,Sum:Sum,sung:sung,sup1:sup1,sup2:sup2,sup3:sup3,sup:sup,Sup:Sup,supdot:supdot,supdsub:supdsub,supE:supE,supe:supe,supedot:supedot,Superset:Superset,SupersetEqual:SupersetEqual,suphsol:suphsol,suphsub:suphsub,suplarr:suplarr,supmult:supmult,supnE:supnE,supne:supne,supplus:supplus,supset:supset,Supset:Supset,supseteq:supseteq,supseteqq:supseteqq,supsetneq:supsetneq,supsetneqq:supsetneqq,supsim:supsim,supsub:supsub,supsup:supsup,swarhk:swarhk,swarr:swarr,swArr:swArr,swarrow:swarrow,swnwar:swnwar,szlig:szlig,Tab:Tab,target:target,Tau:Tau,tau:tau,tbrk:tbrk,Tcaron:Tcaron,tcaron:tcaron,Tcedil:Tcedil,tcedil:tcedil,Tcy:Tcy,tcy:tcy,tdot:tdot,telrec:telrec,Tfr:Tfr,tfr:tfr,there4:there4,therefore:therefore,Therefore:Therefore,Theta:Theta,theta:theta,thetasym:thetasym,thetav:thetav,thickapprox:thickapprox,thicksim:thicksim,ThickSpace:ThickSpace,ThinSpace:ThinSpace,thinsp:thinsp,thkap:thkap,thksim:thksim,THORN:THORN,thorn:thorn,tilde:tilde,Tilde:Tilde,TildeEqual:TildeEqual,TildeFullEqual:TildeFullEqual,TildeTilde:TildeTilde,timesbar:timesbar,timesb:timesb,times:times,timesd:timesd,tint:tint,toea:toea,topbot:topbot,topcir:topcir,top:top,Topf:Topf,topf:topf,topfork:topfork,tosa:tosa,tprime:tprime,trade:trade,TRADE:TRADE,triangle:triangle,triangledown:triangledown,triangleleft:triangleleft,trianglelefteq:trianglelefteq,triangleq:triangleq,triangleright:triangleright,trianglerighteq:trianglerighteq,tridot:tridot,trie:trie,triminus:triminus,TripleDot:TripleDot,triplus:triplus,trisb:trisb,tritime:tritime,trpezium:trpezium,Tscr:Tscr,tscr:tscr,TScy:TScy,tscy:tscy,TSHcy:TSHcy,tshcy:tshcy,Tstrok:Tstrok,tstrok:tstrok,twixt:twixt,twoheadleftarrow:twoheadleftarrow,twoheadrightarrow:twoheadrightarrow,Uacute:Uacute,uacute:uacute,uarr:uarr,Uarr:Uarr,uArr:uArr,Uarrocir:Uarrocir,Ubrcy:Ubrcy,ubrcy:ubrcy,Ubreve:Ubreve,ubreve:ubreve,Ucirc:Ucirc,ucirc:ucirc,Ucy:Ucy,ucy:ucy,udarr:udarr,Udblac:Udblac,udblac:udblac,udhar:udhar,ufisht:ufisht,Ufr:Ufr,ufr:ufr,Ugrave:Ugrave,ugrave:ugrave,uHar:uHar,uharl:uharl,uharr:uharr,uhblk:uhblk,ulcorn:ulcorn,ulcorner:ulcorner,ulcrop:ulcrop,ultri:ultri,Umacr:Umacr,umacr:umacr,uml:uml,UnderBar:UnderBar,UnderBrace:UnderBrace,UnderBracket:UnderBracket,UnderParenthesis:UnderParenthesis,Union:Union,UnionPlus:UnionPlus,Uogon:Uogon,uogon:uogon,Uopf:Uopf,uopf:uopf,UpArrowBar:UpArrowBar,uparrow:uparrow,UpArrow:UpArrow,Uparrow:Uparrow,UpArrowDownArrow:UpArrowDownArrow,updownarrow:updownarrow,UpDownArrow:UpDownArrow,Updownarrow:Updownarrow,UpEquilibrium:UpEquilibrium,upharpoonleft:upharpoonleft,upharpoonright:upharpoonright,uplus:uplus,UpperLeftArrow:UpperLeftArrow,UpperRightArrow:UpperRightArrow,upsi:upsi,Upsi:Upsi,upsih:upsih,Upsilon:Upsilon,upsilon:upsilon,UpTeeArrow:UpTeeArrow,UpTee:UpTee,upuparrows:upuparrows,urcorn:urcorn,urcorner:urcorner,urcrop:urcrop,Uring:Uring,uring:uring,urtri:urtri,Uscr:Uscr,uscr:uscr,utdot:utdot,Utilde:Utilde,utilde:utilde,utri:utri,utrif:utrif,uuarr:uuarr,Uuml:Uuml,uuml:uuml,uwangle:uwangle,vangrt:vangrt,varepsilon:varepsilon,varkappa:varkappa,varnothing:varnothing,varphi:varphi,varpi:varpi,varpropto:varpropto,varr:varr,vArr:vArr,varrho:varrho,varsigma:varsigma,varsubsetneq:varsubsetneq,varsubsetneqq:varsubsetneqq,varsupsetneq:varsupsetneq,varsupsetneqq:varsupsetneqq,vartheta:vartheta,vartriangleleft:vartriangleleft,vartriangleright:vartriangleright,vBar:vBar,Vbar:Vbar,vBarv:vBarv,Vcy:Vcy,vcy:vcy,vdash:vdash,vDash:vDash,Vdash:Vdash,VDash:VDash,Vdashl:Vdashl,veebar:veebar,vee:vee,Vee:Vee,veeeq:veeeq,vellip:vellip,verbar:verbar,Verbar:Verbar,vert:vert,Vert:Vert,VerticalBar:VerticalBar,VerticalLine:VerticalLine,VerticalSeparator:VerticalSeparator,VerticalTilde:VerticalTilde,VeryThinSpace:VeryThinSpace,Vfr:Vfr,vfr:vfr,vltri:vltri,vnsub:vnsub,vnsup:vnsup,Vopf:Vopf,vopf:vopf,vprop:vprop,vrtri:vrtri,Vscr:Vscr,vscr:vscr,vsubnE:vsubnE,vsubne:vsubne,vsupnE:vsupnE,vsupne:vsupne,Vvdash:Vvdash,vzigzag:vzigzag,Wcirc:Wcirc,wcirc:wcirc,wedbar:wedbar,wedge:wedge,Wedge:Wedge,wedgeq:wedgeq,weierp:weierp,Wfr:Wfr,wfr:wfr,Wopf:Wopf,wopf:wopf,wp:wp,wr:wr,wreath:wreath,Wscr:Wscr,wscr:wscr,xcap:xcap,xcirc:xcirc,xcup:xcup,xdtri:xdtri,Xfr:Xfr,xfr:xfr,xharr:xharr,xhArr:xhArr,Xi:Xi,xi:xi,xlarr:xlarr,xlArr:xlArr,xmap:xmap,xnis:xnis,xodot:xodot,Xopf:Xopf,xopf:xopf,xoplus:xoplus,xotime:xotime,xrarr:xrarr,xrArr:xrArr,Xscr:Xscr,xscr:xscr,xsqcup:xsqcup,xuplus:xuplus,xutri:xutri,xvee:xvee,xwedge:xwedge,Yacute:Yacute,yacute:yacute,YAcy:YAcy,yacy:yacy,Ycirc:Ycirc,ycirc:ycirc,Ycy:Ycy,ycy:ycy,yen:yen,Yfr:Yfr,yfr:yfr,YIcy:YIcy,yicy:yicy,Yopf:Yopf,yopf:yopf,Yscr:Yscr,yscr:yscr,YUcy:YUcy,yucy:yucy,yuml:yuml,Yuml:Yuml,Zacute:Zacute,zacute:zacute,Zcaron:Zcaron,zcaron:zcaron,Zcy:Zcy,zcy:zcy,Zdot:Zdot,zdot:zdot,zeetrf:zeetrf,ZeroWidthSpace:ZeroWidthSpace,Zeta:Zeta,zeta:zeta,zfr:zfr,Zfr:Zfr,ZHcy:ZHcy,zhcy:zhcy,zigrarr:zigrarr,zopf:zopf,Zopf:Zopf,Zscr:Zscr,zscr:zscr,zwj:zwj,zwnj:zwnj,in:"∈",Map:"⤅"},entities=Object.freeze({Aacute:Aacute,aacute:aacute,Abreve:Abreve,abreve:abreve,ac:ac,acd:acd,acE:acE,Acirc:Acirc,acirc:acirc,acute:acute,Acy:Acy,acy:acy,AElig:AElig,aelig:aelig,af:af,Afr:Afr,afr:afr,Agrave:Agrave,agrave:agrave,alefsym:alefsym,aleph:aleph,Alpha:Alpha,alpha:alpha,Amacr:Amacr,amacr:amacr,amalg:amalg,amp:amp$1,AMP:AMP,andand:andand,And:And,and:and,andd:andd,andslope:andslope,andv:andv,ang:ang,ange:ange,angle:angle,angmsdaa:angmsdaa,angmsdab:angmsdab,angmsdac:angmsdac,angmsdad:angmsdad,angmsdae:angmsdae,angmsdaf:angmsdaf,angmsdag:angmsdag,angmsdah:angmsdah,angmsd:angmsd,angrt:angrt,angrtvb:angrtvb,angrtvbd:angrtvbd,angsph:angsph,angst:angst,angzarr:angzarr,Aogon:Aogon,aogon:aogon,Aopf:Aopf,aopf:aopf,apacir:apacir,ap:ap,apE:apE,ape:ape,apid:apid,apos:apos$1,ApplyFunction:ApplyFunction,approx:approx,approxeq:approxeq,Aring:Aring,aring:aring,Ascr:Ascr,ascr:ascr,Assign:Assign,ast:ast,asymp:asymp,asympeq:asympeq,Atilde:Atilde,atilde:atilde,Auml:Auml,auml:auml,awconint:awconint,awint:awint,backcong:backcong,backepsilon:backepsilon,backprime:backprime,backsim:backsim,backsimeq:backsimeq,Backslash:Backslash,Barv:Barv,barvee:barvee,barwed:barwed,Barwed:Barwed,barwedge:barwedge,bbrk:bbrk,bbrktbrk:bbrktbrk,bcong:bcong,Bcy:Bcy,bcy:bcy,bdquo:bdquo,becaus:becaus,because:because,Because:Because,bemptyv:bemptyv,bepsi:bepsi,bernou:bernou,Bernoullis:Bernoullis,Beta:Beta,beta:beta,beth:beth,between:between,Bfr:Bfr,bfr:bfr,bigcap:bigcap,bigcirc:bigcirc,bigcup:bigcup,bigodot:bigodot,bigoplus:bigoplus,bigotimes:bigotimes,bigsqcup:bigsqcup,bigstar:bigstar,bigtriangledown:bigtriangledown,bigtriangleup:bigtriangleup,biguplus:biguplus,bigvee:bigvee,bigwedge:bigwedge,bkarow:bkarow,blacklozenge:blacklozenge,blacksquare:blacksquare,blacktriangle:blacktriangle,blacktriangledown:blacktriangledown,blacktriangleleft:blacktriangleleft,blacktriangleright:blacktriangleright,blank:blank,blk12:blk12,blk14:blk14,blk34:blk34,block:block,bne:bne,bnequiv:bnequiv,bNot:bNot,bnot:bnot,Bopf:Bopf,bopf:bopf,bot:bot,bottom:bottom,bowtie:bowtie,boxbox:boxbox,boxdl:boxdl,boxdL:boxdL,boxDl:boxDl,boxDL:boxDL,boxdr:boxdr,boxdR:boxdR,boxDr:boxDr,boxDR:boxDR,boxh:boxh,boxH:boxH,boxhd:boxhd,boxHd:boxHd,boxhD:boxhD,boxHD:boxHD,boxhu:boxhu,boxHu:boxHu,boxhU:boxhU,boxHU:boxHU,boxminus:boxminus,boxplus:boxplus,boxtimes:boxtimes,boxul:boxul,boxuL:boxuL,boxUl:boxUl,boxUL:boxUL,boxur:boxur,boxuR:boxuR,boxUr:boxUr,boxUR:boxUR,boxv:boxv,boxV:boxV,boxvh:boxvh,boxvH:boxvH,boxVh:boxVh,boxVH:boxVH,boxvl:boxvl,boxvL:boxvL,boxVl:boxVl,boxVL:boxVL,boxvr:boxvr,boxvR:boxvR,boxVr:boxVr,boxVR:boxVR,bprime:bprime,breve:breve,Breve:Breve,brvbar:brvbar,bscr:bscr,Bscr:Bscr,bsemi:bsemi,bsim:bsim,bsime:bsime,bsolb:bsolb,bsol:bsol,bsolhsub:bsolhsub,bull:bull,bullet:bullet,bump:bump,bumpE:bumpE,bumpe:bumpe,Bumpeq:Bumpeq,bumpeq:bumpeq,Cacute:Cacute,cacute:cacute,capand:capand,capbrcup:capbrcup,capcap:capcap,cap:cap,Cap:Cap,capcup:capcup,capdot:capdot,CapitalDifferentialD:CapitalDifferentialD,caps:caps,caret:caret,caron:caron,Cayleys:Cayleys,ccaps:ccaps,Ccaron:Ccaron,ccaron:ccaron,Ccedil:Ccedil,ccedil:ccedil,Ccirc:Ccirc,ccirc:ccirc,Cconint:Cconint,ccups:ccups,ccupssm:ccupssm,Cdot:Cdot,cdot:cdot,cedil:cedil,Cedilla:Cedilla,cemptyv:cemptyv,cent:cent,centerdot:centerdot,CenterDot:CenterDot,cfr:cfr,Cfr:Cfr,CHcy:CHcy,chcy:chcy,check:check,checkmark:checkmark,Chi:Chi,chi:chi,circ:circ,circeq:circeq,circlearrowleft:circlearrowleft,circlearrowright:circlearrowright,circledast:circledast,circledcirc:circledcirc,circleddash:circleddash,CircleDot:CircleDot,circledR:circledR,circledS:circledS,CircleMinus:CircleMinus,CirclePlus:CirclePlus,CircleTimes:CircleTimes,cir:cir,cirE:cirE,cire:cire,cirfnint:cirfnint,cirmid:cirmid,cirscir:cirscir,ClockwiseContourIntegral:ClockwiseContourIntegral,CloseCurlyDoubleQuote:CloseCurlyDoubleQuote,CloseCurlyQuote:CloseCurlyQuote,clubs:clubs,clubsuit:clubsuit,colon:colon,Colon:Colon,Colone:Colone,colone:colone,coloneq:coloneq,comma:comma,commat:commat,comp:comp,compfn:compfn,complement:complement,complexes:complexes,cong:cong,congdot:congdot,Congruent:Congruent,conint:conint,Conint:Conint,ContourIntegral:ContourIntegral,copf:copf,Copf:Copf,coprod:coprod,Coproduct:Coproduct,copy:copy,COPY:COPY,copysr:copysr,CounterClockwiseContourIntegral:CounterClockwiseContourIntegral,crarr:crarr,cross:cross,Cross:Cross,Cscr:Cscr,cscr:cscr,csub:csub,csube:csube,csup:csup,csupe:csupe,ctdot:ctdot,cudarrl:cudarrl,cudarrr:cudarrr,cuepr:cuepr,cuesc:cuesc,cularr:cularr,cularrp:cularrp,cupbrcap:cupbrcap,cupcap:cupcap,CupCap:CupCap,cup:cup,Cup:Cup,cupcup:cupcup,cupdot:cupdot,cupor:cupor,cups:cups,curarr:curarr,curarrm:curarrm,curlyeqprec:curlyeqprec,curlyeqsucc:curlyeqsucc,curlyvee:curlyvee,curlywedge:curlywedge,curren:curren,curvearrowleft:curvearrowleft,curvearrowright:curvearrowright,cuvee:cuvee,cuwed:cuwed,cwconint:cwconint,cwint:cwint,cylcty:cylcty,dagger:dagger,Dagger:Dagger,daleth:daleth,darr:darr,Darr:Darr,dArr:dArr,dash:dash,Dashv:Dashv,dashv:dashv,dbkarow:dbkarow,dblac:dblac,Dcaron:Dcaron,dcaron:dcaron,Dcy:Dcy,dcy:dcy,ddagger:ddagger,ddarr:ddarr,DD:DD,dd:dd,DDotrahd:DDotrahd,ddotseq:ddotseq,deg:deg,Del:Del,Delta:Delta,delta:delta,demptyv:demptyv,dfisht:dfisht,Dfr:Dfr,dfr:dfr,dHar:dHar,dharl:dharl,dharr:dharr,DiacriticalAcute:DiacriticalAcute,DiacriticalDot:DiacriticalDot,DiacriticalDoubleAcute:DiacriticalDoubleAcute,DiacriticalGrave:DiacriticalGrave,DiacriticalTilde:DiacriticalTilde,diam:diam,diamond:diamond,Diamond:Diamond,diamondsuit:diamondsuit,diams:diams,die:die,DifferentialD:DifferentialD,digamma:digamma,disin:disin,div:div,divide:divide,divideontimes:divideontimes,divonx:divonx,DJcy:DJcy,djcy:djcy,dlcorn:dlcorn,dlcrop:dlcrop,dollar:dollar,Dopf:Dopf,dopf:dopf,Dot:Dot,dot:dot,DotDot:DotDot,doteq:doteq,doteqdot:doteqdot,DotEqual:DotEqual,dotminus:dotminus,dotplus:dotplus,dotsquare:dotsquare,doublebarwedge:doublebarwedge,DoubleContourIntegral:DoubleContourIntegral,DoubleDot:DoubleDot,DoubleDownArrow:DoubleDownArrow,DoubleLeftArrow:DoubleLeftArrow,DoubleLeftRightArrow:DoubleLeftRightArrow,DoubleLeftTee:DoubleLeftTee,DoubleLongLeftArrow:DoubleLongLeftArrow,DoubleLongLeftRightArrow:DoubleLongLeftRightArrow,DoubleLongRightArrow:DoubleLongRightArrow,DoubleRightArrow:DoubleRightArrow,DoubleRightTee:DoubleRightTee,DoubleUpArrow:DoubleUpArrow,DoubleUpDownArrow:DoubleUpDownArrow,DoubleVerticalBar:DoubleVerticalBar,DownArrowBar:DownArrowBar,downarrow:downarrow,DownArrow:DownArrow,Downarrow:Downarrow,DownArrowUpArrow:DownArrowUpArrow,DownBreve:DownBreve,downdownarrows:downdownarrows,downharpoonleft:downharpoonleft,downharpoonright:downharpoonright,DownLeftRightVector:DownLeftRightVector,DownLeftTeeVector:DownLeftTeeVector,DownLeftVectorBar:DownLeftVectorBar,DownLeftVector:DownLeftVector,DownRightTeeVector:DownRightTeeVector,DownRightVectorBar:DownRightVectorBar,DownRightVector:DownRightVector,DownTeeArrow:DownTeeArrow,DownTee:DownTee,drbkarow:drbkarow,drcorn:drcorn,drcrop:drcrop,Dscr:Dscr,dscr:dscr,DScy:DScy,dscy:dscy,dsol:dsol,Dstrok:Dstrok,dstrok:dstrok,dtdot:dtdot,dtri:dtri,dtrif:dtrif,duarr:duarr,duhar:duhar,dwangle:dwangle,DZcy:DZcy,dzcy:dzcy,dzigrarr:dzigrarr,Eacute:Eacute,eacute:eacute,easter:easter,Ecaron:Ecaron,ecaron:ecaron,Ecirc:Ecirc,ecirc:ecirc,ecir:ecir,ecolon:ecolon,Ecy:Ecy,ecy:ecy,eDDot:eDDot,Edot:Edot,edot:edot,eDot:eDot,ee:ee,efDot:efDot,Efr:Efr,efr:efr,eg:eg,Egrave:Egrave,egrave:egrave,egs:egs,egsdot:egsdot,el:el,Element:Element,elinters:elinters,ell:ell,els:els,elsdot:elsdot,Emacr:Emacr,emacr:emacr,empty:empty,emptyset:emptyset,EmptySmallSquare:EmptySmallSquare,emptyv:emptyv,EmptyVerySmallSquare:EmptyVerySmallSquare,emsp13:emsp13,emsp14:emsp14,emsp:emsp,ENG:ENG,eng:eng,ensp:ensp,Eogon:Eogon,eogon:eogon,Eopf:Eopf,eopf:eopf,epar:epar,eparsl:eparsl,eplus:eplus,epsi:epsi,Epsilon:Epsilon,epsilon:epsilon,epsiv:epsiv,eqcirc:eqcirc,eqcolon:eqcolon,eqsim:eqsim,eqslantgtr:eqslantgtr,eqslantless:eqslantless,Equal:Equal,equals:equals,EqualTilde:EqualTilde,equest:equest,Equilibrium:Equilibrium,equiv:equiv,equivDD:equivDD,eqvparsl:eqvparsl,erarr:erarr,erDot:erDot,escr:escr,Escr:Escr,esdot:esdot,Esim:Esim,esim:esim,Eta:Eta,eta:eta,ETH:ETH,eth:eth,Euml:Euml,euml:euml,euro:euro,excl:excl,exist:exist,Exists:Exists,expectation:expectation,exponentiale:exponentiale,ExponentialE:ExponentialE,fallingdotseq:fallingdotseq,Fcy:Fcy,fcy:fcy,female:female,ffilig:ffilig,fflig:fflig,ffllig:ffllig,Ffr:Ffr,ffr:ffr,filig:filig,FilledSmallSquare:FilledSmallSquare,FilledVerySmallSquare:FilledVerySmallSquare,fjlig:fjlig,flat:flat,fllig:fllig,fltns:fltns,fnof:fnof,Fopf:Fopf,fopf:fopf,forall:forall,ForAll:ForAll,fork:fork,forkv:forkv,Fouriertrf:Fouriertrf,fpartint:fpartint,frac12:frac12,frac13:frac13,frac14:frac14,frac15:frac15,frac16:frac16,frac18:frac18,frac23:frac23,frac25:frac25,frac34:frac34,frac35:frac35,frac38:frac38,frac45:frac45,frac56:frac56,frac58:frac58,frac78:frac78,frasl:frasl,frown:frown,fscr:fscr,Fscr:Fscr,gacute:gacute,Gamma:Gamma,gamma:gamma,Gammad:Gammad,gammad:gammad,gap:gap,Gbreve:Gbreve,gbreve:gbreve,Gcedil:Gcedil,Gcirc:Gcirc,gcirc:gcirc,Gcy:Gcy,gcy:gcy,Gdot:Gdot,gdot:gdot,ge:ge,gE:gE,gEl:gEl,gel:gel,geq:geq,geqq:geqq,geqslant:geqslant,gescc:gescc,ges:ges,gesdot:gesdot,gesdoto:gesdoto,gesdotol:gesdotol,gesl:gesl,gesles:gesles,Gfr:Gfr,gfr:gfr,gg:gg,Gg:Gg,ggg:ggg,gimel:gimel,GJcy:GJcy,gjcy:gjcy,gla:gla,gl:gl,glE:glE,glj:glj,gnap:gnap,gnapprox:gnapprox,gne:gne,gnE:gnE,gneq:gneq,gneqq:gneqq,gnsim:gnsim,Gopf:Gopf,gopf:gopf,grave:grave,GreaterEqual:GreaterEqual,GreaterEqualLess:GreaterEqualLess,GreaterFullEqual:GreaterFullEqual,GreaterGreater:GreaterGreater,GreaterLess:GreaterLess,GreaterSlantEqual:GreaterSlantEqual,GreaterTilde:GreaterTilde,Gscr:Gscr,gscr:gscr,gsim:gsim,gsime:gsime,gsiml:gsiml,gtcc:gtcc,gtcir:gtcir,gt:gt$1,GT:GT,Gt:Gt,gtdot:gtdot,gtlPar:gtlPar,gtquest:gtquest,gtrapprox:gtrapprox,gtrarr:gtrarr,gtrdot:gtrdot,gtreqless:gtreqless,gtreqqless:gtreqqless,gtrless:gtrless,gtrsim:gtrsim,gvertneqq:gvertneqq,gvnE:gvnE,Hacek:Hacek,hairsp:hairsp,half:half,hamilt:hamilt,HARDcy:HARDcy,hardcy:hardcy,harrcir:harrcir,harr:harr,hArr:hArr,harrw:harrw,Hat:Hat,hbar:hbar,Hcirc:Hcirc,hcirc:hcirc,hearts:hearts,heartsuit:heartsuit,hellip:hellip,hercon:hercon,hfr:hfr,Hfr:Hfr,HilbertSpace:HilbertSpace,hksearow:hksearow,hkswarow:hkswarow,hoarr:hoarr,homtht:homtht,hookleftarrow:hookleftarrow,hookrightarrow:hookrightarrow,hopf:hopf,Hopf:Hopf,horbar:horbar,HorizontalLine:HorizontalLine,hscr:hscr,Hscr:Hscr,hslash:hslash,Hstrok:Hstrok,hstrok:hstrok,HumpDownHump:HumpDownHump,HumpEqual:HumpEqual,hybull:hybull,hyphen:hyphen,Iacute:Iacute,iacute:iacute,ic:ic,Icirc:Icirc,icirc:icirc,Icy:Icy,icy:icy,Idot:Idot,IEcy:IEcy,iecy:iecy,iexcl:iexcl,iff:iff,ifr:ifr,Ifr:Ifr,Igrave:Igrave,igrave:igrave,ii:ii,iiiint:iiiint,iiint:iiint,iinfin:iinfin,iiota:iiota,IJlig:IJlig,ijlig:ijlig,Imacr:Imacr,imacr:imacr,image:image,ImaginaryI:ImaginaryI,imagline:imagline,imagpart:imagpart,imath:imath,Im:Im,imof:imof,imped:imped,Implies:Implies,incare:incare,infin:infin,infintie:infintie,inodot:inodot,intcal:intcal,int:int,Int:Int,integers:integers,Integral:Integral,intercal:intercal,Intersection:Intersection,intlarhk:intlarhk,intprod:intprod,InvisibleComma:InvisibleComma,InvisibleTimes:InvisibleTimes,IOcy:IOcy,iocy:iocy,Iogon:Iogon,iogon:iogon,Iopf:Iopf,iopf:iopf,Iota:Iota,iota:iota,iprod:iprod,iquest:iquest,iscr:iscr,Iscr:Iscr,isin:isin,isindot:isindot,isinE:isinE,isins:isins,isinsv:isinsv,isinv:isinv,it:it,Itilde:Itilde,itilde:itilde,Iukcy:Iukcy,iukcy:iukcy,Iuml:Iuml,iuml:iuml,Jcirc:Jcirc,jcirc:jcirc,Jcy:Jcy,jcy:jcy,Jfr:Jfr,jfr:jfr,jmath:jmath,Jopf:Jopf,jopf:jopf,Jscr:Jscr,jscr:jscr,Jsercy:Jsercy,jsercy:jsercy,Jukcy:Jukcy,jukcy:jukcy,Kappa:Kappa,kappa:kappa,kappav:kappav,Kcedil:Kcedil,kcedil:kcedil,Kcy:Kcy,kcy:kcy,Kfr:Kfr,kfr:kfr,kgreen:kgreen,KHcy:KHcy,khcy:khcy,KJcy:KJcy,kjcy:kjcy,Kopf:Kopf,kopf:kopf,Kscr:Kscr,kscr:kscr,lAarr:lAarr,Lacute:Lacute,lacute:lacute,laemptyv:laemptyv,lagran:lagran,Lambda:Lambda,lambda:lambda,lang:lang,Lang:Lang,langd:langd,langle:langle,lap:lap,Laplacetrf:Laplacetrf,laquo:laquo,larrb:larrb,larrbfs:larrbfs,larr:larr,Larr:Larr,lArr:lArr,larrfs:larrfs,larrhk:larrhk,larrlp:larrlp,larrpl:larrpl,larrsim:larrsim,larrtl:larrtl,latail:latail,lAtail:lAtail,lat:lat,late:late,lates:lates,lbarr:lbarr,lBarr:lBarr,lbbrk:lbbrk,lbrace:lbrace,lbrack:lbrack,lbrke:lbrke,lbrksld:lbrksld,lbrkslu:lbrkslu,Lcaron:Lcaron,lcaron:lcaron,Lcedil:Lcedil,lcedil:lcedil,lceil:lceil,lcub:lcub,Lcy:Lcy,lcy:lcy,ldca:ldca,ldquo:ldquo,ldquor:ldquor,ldrdhar:ldrdhar,ldrushar:ldrushar,ldsh:ldsh,le:le,lE:lE,LeftAngleBracket:LeftAngleBracket,LeftArrowBar:LeftArrowBar,leftarrow:leftarrow,LeftArrow:LeftArrow,Leftarrow:Leftarrow,LeftArrowRightArrow:LeftArrowRightArrow,leftarrowtail:leftarrowtail,LeftCeiling:LeftCeiling,LeftDoubleBracket:LeftDoubleBracket,LeftDownTeeVector:LeftDownTeeVector,LeftDownVectorBar:LeftDownVectorBar,LeftDownVector:LeftDownVector,LeftFloor:LeftFloor,leftharpoondown:leftharpoondown,leftharpoonup:leftharpoonup,leftleftarrows:leftleftarrows,leftrightarrow:leftrightarrow,LeftRightArrow:LeftRightArrow,Leftrightarrow:Leftrightarrow,leftrightarrows:leftrightarrows,leftrightharpoons:leftrightharpoons,leftrightsquigarrow:leftrightsquigarrow,LeftRightVector:LeftRightVector,LeftTeeArrow:LeftTeeArrow,LeftTee:LeftTee,LeftTeeVector:LeftTeeVector,leftthreetimes:leftthreetimes,LeftTriangleBar:LeftTriangleBar,LeftTriangle:LeftTriangle,LeftTriangleEqual:LeftTriangleEqual,LeftUpDownVector:LeftUpDownVector,LeftUpTeeVector:LeftUpTeeVector,LeftUpVectorBar:LeftUpVectorBar,LeftUpVector:LeftUpVector,LeftVectorBar:LeftVectorBar,LeftVector:LeftVector,lEg:lEg,leg:leg,leq:leq,leqq:leqq,leqslant:leqslant,lescc:lescc,les:les,lesdot:lesdot,lesdoto:lesdoto,lesdotor:lesdotor,lesg:lesg,lesges:lesges,lessapprox:lessapprox,lessdot:lessdot,lesseqgtr:lesseqgtr,lesseqqgtr:lesseqqgtr,LessEqualGreater:LessEqualGreater,LessFullEqual:LessFullEqual,LessGreater:LessGreater,lessgtr:lessgtr,LessLess:LessLess,lesssim:lesssim,LessSlantEqual:LessSlantEqual,LessTilde:LessTilde,lfisht:lfisht,lfloor:lfloor,Lfr:Lfr,lfr:lfr,lg:lg,lgE:lgE,lHar:lHar,lhard:lhard,lharu:lharu,lharul:lharul,lhblk:lhblk,LJcy:LJcy,ljcy:ljcy,llarr:llarr,ll:ll,Ll:Ll,llcorner:llcorner,Lleftarrow:Lleftarrow,llhard:llhard,lltri:lltri,Lmidot:Lmidot,lmidot:lmidot,lmoustache:lmoustache,lmoust:lmoust,lnap:lnap,lnapprox:lnapprox,lne:lne,lnE:lnE,lneq:lneq,lneqq:lneqq,lnsim:lnsim,loang:loang,loarr:loarr,lobrk:lobrk,longleftarrow:longleftarrow,LongLeftArrow:LongLeftArrow,Longleftarrow:Longleftarrow,longleftrightarrow:longleftrightarrow,LongLeftRightArrow:LongLeftRightArrow,Longleftrightarrow:Longleftrightarrow,longmapsto:longmapsto,longrightarrow:longrightarrow,LongRightArrow:LongRightArrow,Longrightarrow:Longrightarrow,looparrowleft:looparrowleft,looparrowright:looparrowright,lopar:lopar,Lopf:Lopf,lopf:lopf,loplus:loplus,lotimes:lotimes,lowast:lowast,lowbar:lowbar,LowerLeftArrow:LowerLeftArrow,LowerRightArrow:LowerRightArrow,loz:loz,lozenge:lozenge,lozf:lozf,lpar:lpar,lparlt:lparlt,lrarr:lrarr,lrcorner:lrcorner,lrhar:lrhar,lrhard:lrhard,lrm:lrm,lrtri:lrtri,lsaquo:lsaquo,lscr:lscr,Lscr:Lscr,lsh:lsh,Lsh:Lsh,lsim:lsim,lsime:lsime,lsimg:lsimg,lsqb:lsqb,lsquo:lsquo,lsquor:lsquor,Lstrok:Lstrok,lstrok:lstrok,ltcc:ltcc,ltcir:ltcir,lt:lt$1,LT:LT,Lt:Lt,ltdot:ltdot,lthree:lthree,ltimes:ltimes,ltlarr:ltlarr,ltquest:ltquest,ltri:ltri,ltrie:ltrie,ltrif:ltrif,ltrPar:ltrPar,lurdshar:lurdshar,luruhar:luruhar,lvertneqq:lvertneqq,lvnE:lvnE,macr:macr,male:male,malt:malt,maltese:maltese,map:map$1,mapsto:mapsto,mapstodown:mapstodown,mapstoleft:mapstoleft,mapstoup:mapstoup,marker:marker,mcomma:mcomma,Mcy:Mcy,mcy:mcy,mdash:mdash,mDDot:mDDot,measuredangle:measuredangle,MediumSpace:MediumSpace,Mellintrf:Mellintrf,Mfr:Mfr,mfr:mfr,mho:mho,micro:micro,midast:midast,midcir:midcir,mid:mid,middot:middot,minusb:minusb,minus:minus,minusd:minusd,minusdu:minusdu,MinusPlus:MinusPlus,mlcp:mlcp,mldr:mldr,mnplus:mnplus,models:models,Mopf:Mopf,mopf:mopf,mp:mp,mscr:mscr,Mscr:Mscr,mstpos:mstpos,Mu:Mu,mu:mu,multimap:multimap,mumap:mumap,nabla:nabla,Nacute:Nacute,nacute:nacute,nang:nang,nap:nap,napE:napE,napid:napid,napos:napos,napprox:napprox,natural:natural,naturals:naturals,natur:natur,nbsp:nbsp,nbump:nbump,nbumpe:nbumpe,ncap:ncap,Ncaron:Ncaron,ncaron:ncaron,Ncedil:Ncedil,ncedil:ncedil,ncong:ncong,ncongdot:ncongdot,ncup:ncup,Ncy:Ncy,ncy:ncy,ndash:ndash,nearhk:nearhk,nearr:nearr,neArr:neArr,nearrow:nearrow,ne:ne,nedot:nedot,NegativeMediumSpace:NegativeMediumSpace,NegativeThickSpace:NegativeThickSpace,NegativeThinSpace:NegativeThinSpace,NegativeVeryThinSpace:NegativeVeryThinSpace,nequiv:nequiv,nesear:nesear,nesim:nesim,NestedGreaterGreater:NestedGreaterGreater,NestedLessLess:NestedLessLess,NewLine:NewLine,nexist:nexist,nexists:nexists,Nfr:Nfr,nfr:nfr,ngE:ngE,nge:nge,ngeq:ngeq,ngeqq:ngeqq,ngeqslant:ngeqslant,nges:nges,nGg:nGg,ngsim:ngsim,nGt:nGt,ngt:ngt,ngtr:ngtr,nGtv:nGtv,nharr:nharr,nhArr:nhArr,nhpar:nhpar,ni:ni,nis:nis,nisd:nisd,niv:niv,NJcy:NJcy,njcy:njcy,nlarr:nlarr,nlArr:nlArr,nldr:nldr,nlE:nlE,nle:nle,nleftarrow:nleftarrow,nLeftarrow:nLeftarrow,nleftrightarrow:nleftrightarrow,nLeftrightarrow:nLeftrightarrow,nleq:nleq,nleqq:nleqq,nleqslant:nleqslant,nles:nles,nless:nless,nLl:nLl,nlsim:nlsim,nLt:nLt,nlt:nlt,nltri:nltri,nltrie:nltrie,nLtv:nLtv,nmid:nmid,NoBreak:NoBreak,NonBreakingSpace:NonBreakingSpace,nopf:nopf,Nopf:Nopf,Not:Not,not:not,NotCongruent:NotCongruent,NotCupCap:NotCupCap,NotDoubleVerticalBar:NotDoubleVerticalBar,NotElement:NotElement,NotEqual:NotEqual,NotEqualTilde:NotEqualTilde,NotExists:NotExists,NotGreater:NotGreater,NotGreaterEqual:NotGreaterEqual,NotGreaterFullEqual:NotGreaterFullEqual,NotGreaterGreater:NotGreaterGreater,NotGreaterLess:NotGreaterLess,NotGreaterSlantEqual:NotGreaterSlantEqual,NotGreaterTilde:NotGreaterTilde,NotHumpDownHump:NotHumpDownHump,NotHumpEqual:NotHumpEqual,notin:notin,notindot:notindot,notinE:notinE,notinva:notinva,notinvb:notinvb,notinvc:notinvc,NotLeftTriangleBar:NotLeftTriangleBar,NotLeftTriangle:NotLeftTriangle,NotLeftTriangleEqual:NotLeftTriangleEqual,NotLess:NotLess,NotLessEqual:NotLessEqual,NotLessGreater:NotLessGreater,NotLessLess:NotLessLess,NotLessSlantEqual:NotLessSlantEqual,NotLessTilde:NotLessTilde,NotNestedGreaterGreater:NotNestedGreaterGreater,NotNestedLessLess:NotNestedLessLess,notni:notni,notniva:notniva,notnivb:notnivb,notnivc:notnivc,NotPrecedes:NotPrecedes,NotPrecedesEqual:NotPrecedesEqual,NotPrecedesSlantEqual:NotPrecedesSlantEqual,NotReverseElement:NotReverseElement,NotRightTriangleBar:NotRightTriangleBar,NotRightTriangle:NotRightTriangle,NotRightTriangleEqual:NotRightTriangleEqual,NotSquareSubset:NotSquareSubset,NotSquareSubsetEqual:NotSquareSubsetEqual,NotSquareSuperset:NotSquareSuperset,NotSquareSupersetEqual:NotSquareSupersetEqual,NotSubset:NotSubset,NotSubsetEqual:NotSubsetEqual,NotSucceeds:NotSucceeds,NotSucceedsEqual:NotSucceedsEqual,NotSucceedsSlantEqual:NotSucceedsSlantEqual,NotSucceedsTilde:NotSucceedsTilde,NotSuperset:NotSuperset,NotSupersetEqual:NotSupersetEqual,NotTilde:NotTilde,NotTildeEqual:NotTildeEqual,NotTildeFullEqual:NotTildeFullEqual,NotTildeTilde:NotTildeTilde,NotVerticalBar:NotVerticalBar,nparallel:nparallel,npar:npar,nparsl:nparsl,npart:npart,npolint:npolint,npr:npr,nprcue:nprcue,nprec:nprec,npreceq:npreceq,npre:npre,nrarrc:nrarrc,nrarr:nrarr,nrArr:nrArr,nrarrw:nrarrw,nrightarrow:nrightarrow,nRightarrow:nRightarrow,nrtri:nrtri,nrtrie:nrtrie,nsc:nsc,nsccue:nsccue,nsce:nsce,Nscr:Nscr,nscr:nscr,nshortmid:nshortmid,nshortparallel:nshortparallel,nsim:nsim,nsime:nsime,nsimeq:nsimeq,nsmid:nsmid,nspar:nspar,nsqsube:nsqsube,nsqsupe:nsqsupe,nsub:nsub,nsubE:nsubE,nsube:nsube,nsubset:nsubset,nsubseteq:nsubseteq,nsubseteqq:nsubseteqq,nsucc:nsucc,nsucceq:nsucceq,nsup:nsup,nsupE:nsupE,nsupe:nsupe,nsupset:nsupset,nsupseteq:nsupseteq,nsupseteqq:nsupseteqq,ntgl:ntgl,Ntilde:Ntilde,ntilde:ntilde,ntlg:ntlg,ntriangleleft:ntriangleleft,ntrianglelefteq:ntrianglelefteq,ntriangleright:ntriangleright,ntrianglerighteq:ntrianglerighteq,Nu:Nu,nu:nu,num:num,numero:numero,numsp:numsp,nvap:nvap,nvdash:nvdash,nvDash:nvDash,nVdash:nVdash,nVDash:nVDash,nvge:nvge,nvgt:nvgt,nvHarr:nvHarr,nvinfin:nvinfin,nvlArr:nvlArr,nvle:nvle,nvlt:nvlt,nvltrie:nvltrie,nvrArr:nvrArr,nvrtrie:nvrtrie,nvsim:nvsim,nwarhk:nwarhk,nwarr:nwarr,nwArr:nwArr,nwarrow:nwarrow,nwnear:nwnear,Oacute:Oacute,oacute:oacute,oast:oast,Ocirc:Ocirc,ocirc:ocirc,ocir:ocir,Ocy:Ocy,ocy:ocy,odash:odash,Odblac:Odblac,odblac:odblac,odiv:odiv,odot:odot,odsold:odsold,OElig:OElig,oelig:oelig,ofcir:ofcir,Ofr:Ofr,ofr:ofr,ogon:ogon,Ograve:Ograve,ograve:ograve,ogt:ogt,ohbar:ohbar,ohm:ohm,oint:oint,olarr:olarr,olcir:olcir,olcross:olcross,oline:oline,olt:olt,Omacr:Omacr,omacr:omacr,Omega:Omega,omega:omega,Omicron:Omicron,omicron:omicron,omid:omid,ominus:ominus,Oopf:Oopf,oopf:oopf,opar:opar,OpenCurlyDoubleQuote:OpenCurlyDoubleQuote,OpenCurlyQuote:OpenCurlyQuote,operp:operp,oplus:oplus,orarr:orarr,Or:Or,or:or,ord:ord,order:order,orderof:orderof,ordf:ordf,ordm:ordm,origof:origof,oror:oror,orslope:orslope,orv:orv,oS:oS,Oscr:Oscr,oscr:oscr,Oslash:Oslash,oslash:oslash,osol:osol,Otilde:Otilde,otilde:otilde,otimesas:otimesas,Otimes:Otimes,otimes:otimes,Ouml:Ouml,ouml:ouml,ovbar:ovbar,OverBar:OverBar,OverBrace:OverBrace,OverBracket:OverBracket,OverParenthesis:OverParenthesis,para:para,parallel:parallel,par:par,parsim:parsim,parsl:parsl,part:part,PartialD:PartialD,Pcy:Pcy,pcy:pcy,percnt:percnt,period:period,permil:permil,perp:perp,pertenk:pertenk,Pfr:Pfr,pfr:pfr,Phi:Phi,phi:phi,phiv:phiv,phmmat:phmmat,phone:phone,Pi:Pi,pi:pi,pitchfork:pitchfork,piv:piv,planck:planck,planckh:planckh,plankv:plankv,plusacir:plusacir,plusb:plusb,pluscir:pluscir,plus:plus,plusdo:plusdo,plusdu:plusdu,pluse:pluse,PlusMinus:PlusMinus,plusmn:plusmn,plussim:plussim,plustwo:plustwo,pm:pm,Poincareplane:Poincareplane,pointint:pointint,popf:popf,Popf:Popf,pound:pound,prap:prap,Pr:Pr,pr:pr,prcue:prcue,precapprox:precapprox,prec:prec,preccurlyeq:preccurlyeq,Precedes:Precedes,PrecedesEqual:PrecedesEqual,PrecedesSlantEqual:PrecedesSlantEqual,PrecedesTilde:PrecedesTilde,preceq:preceq,precnapprox:precnapprox,precneqq:precneqq,precnsim:precnsim,pre:pre,prE:prE,precsim:precsim,prime:prime,Prime:Prime,primes:primes,prnap:prnap,prnE:prnE,prnsim:prnsim,prod:prod,Product:Product,profalar:profalar,profline:profline,profsurf:profsurf,prop:prop,Proportional:Proportional,Proportion:Proportion,propto:propto,prsim:prsim,prurel:prurel,Pscr:Pscr,pscr:pscr,Psi:Psi,psi:psi,puncsp:puncsp,Qfr:Qfr,qfr:qfr,qint:qint,qopf:qopf,Qopf:Qopf,qprime:qprime,Qscr:Qscr,qscr:qscr,quaternions:quaternions,quatint:quatint,quest:quest,questeq:questeq,quot:quot$1,QUOT:QUOT,rAarr:rAarr,race:race,Racute:Racute,racute:racute,radic:radic,raemptyv:raemptyv,rang:rang,Rang:Rang,rangd:rangd,range:range,rangle:rangle,raquo:raquo,rarrap:rarrap,rarrb:rarrb,rarrbfs:rarrbfs,rarrc:rarrc,rarr:rarr,Rarr:Rarr,rArr:rArr,rarrfs:rarrfs,rarrhk:rarrhk,rarrlp:rarrlp,rarrpl:rarrpl,rarrsim:rarrsim,Rarrtl:Rarrtl,rarrtl:rarrtl,rarrw:rarrw,ratail:ratail,rAtail:rAtail,ratio:ratio,rationals:rationals,rbarr:rbarr,rBarr:rBarr,RBarr:RBarr,rbbrk:rbbrk,rbrace:rbrace,rbrack:rbrack,rbrke:rbrke,rbrksld:rbrksld,rbrkslu:rbrkslu,Rcaron:Rcaron,rcaron:rcaron,Rcedil:Rcedil,rcedil:rcedil,rceil:rceil,rcub:rcub,Rcy:Rcy,rcy:rcy,rdca:rdca,rdldhar:rdldhar,rdquo:rdquo,rdquor:rdquor,rdsh:rdsh,real:real,realine:realine,realpart:realpart,reals:reals,Re:Re,rect:rect,reg:reg,REG:REG,ReverseElement:ReverseElement,ReverseEquilibrium:ReverseEquilibrium,ReverseUpEquilibrium:ReverseUpEquilibrium,rfisht:rfisht,rfloor:rfloor,rfr:rfr,Rfr:Rfr,rHar:rHar,rhard:rhard,rharu:rharu,rharul:rharul,Rho:Rho,rho:rho,rhov:rhov,RightAngleBracket:RightAngleBracket,RightArrowBar:RightArrowBar,rightarrow:rightarrow,RightArrow:RightArrow,Rightarrow:Rightarrow,RightArrowLeftArrow:RightArrowLeftArrow,rightarrowtail:rightarrowtail,RightCeiling:RightCeiling,RightDoubleBracket:RightDoubleBracket,RightDownTeeVector:RightDownTeeVector,RightDownVectorBar:RightDownVectorBar,RightDownVector:RightDownVector,RightFloor:RightFloor,rightharpoondown:rightharpoondown,rightharpoonup:rightharpoonup,rightleftarrows:rightleftarrows,rightleftharpoons:rightleftharpoons,rightrightarrows:rightrightarrows,rightsquigarrow:rightsquigarrow,RightTeeArrow:RightTeeArrow,RightTee:RightTee,RightTeeVector:RightTeeVector,rightthreetimes:rightthreetimes,RightTriangleBar:RightTriangleBar,RightTriangle:RightTriangle,RightTriangleEqual:RightTriangleEqual,RightUpDownVector:RightUpDownVector,RightUpTeeVector:RightUpTeeVector,RightUpVectorBar:RightUpVectorBar,RightUpVector:RightUpVector,RightVectorBar:RightVectorBar,RightVector:RightVector,ring:ring,risingdotseq:risingdotseq,rlarr:rlarr,rlhar:rlhar,rlm:rlm,rmoustache:rmoustache,rmoust:rmoust,rnmid:rnmid,roang:roang,roarr:roarr,robrk:robrk,ropar:ropar,ropf:ropf,Ropf:Ropf,roplus:roplus,rotimes:rotimes,RoundImplies:RoundImplies,rpar:rpar,rpargt:rpargt,rppolint:rppolint,rrarr:rrarr,Rrightarrow:Rrightarrow,rsaquo:rsaquo,rscr:rscr,Rscr:Rscr,rsh:rsh,Rsh:Rsh,rsqb:rsqb,rsquo:rsquo,rsquor:rsquor,rthree:rthree,rtimes:rtimes,rtri:rtri,rtrie:rtrie,rtrif:rtrif,rtriltri:rtriltri,RuleDelayed:RuleDelayed,ruluhar:ruluhar,rx:rx,Sacute:Sacute,sacute:sacute,sbquo:sbquo,scap:scap,Scaron:Scaron,scaron:scaron,Sc:Sc,sc:sc,sccue:sccue,sce:sce,scE:scE,Scedil:Scedil,scedil:scedil,Scirc:Scirc,scirc:scirc,scnap:scnap,scnE:scnE,scnsim:scnsim,scpolint:scpolint,scsim:scsim,Scy:Scy,scy:scy,sdotb:sdotb,sdot:sdot,sdote:sdote,searhk:searhk,searr:searr,seArr:seArr,searrow:searrow,sect:sect,semi:semi,seswar:seswar,setminus:setminus,setmn:setmn,sext:sext,Sfr:Sfr,sfr:sfr,sfrown:sfrown,sharp:sharp,SHCHcy:SHCHcy,shchcy:shchcy,SHcy:SHcy,shcy:shcy,ShortDownArrow:ShortDownArrow,ShortLeftArrow:ShortLeftArrow,shortmid:shortmid,shortparallel:shortparallel,ShortRightArrow:ShortRightArrow,ShortUpArrow:ShortUpArrow,shy:shy,Sigma:Sigma,sigma:sigma,sigmaf:sigmaf,sigmav:sigmav,sim:sim,simdot:simdot,sime:sime,simeq:simeq,simg:simg,simgE:simgE,siml:siml,simlE:simlE,simne:simne,simplus:simplus,simrarr:simrarr,slarr:slarr,SmallCircle:SmallCircle,smallsetminus:smallsetminus,smashp:smashp,smeparsl:smeparsl,smid:smid,smile:smile,smt:smt,smte:smte,smtes:smtes,SOFTcy:SOFTcy,softcy:softcy,solbar:solbar,solb:solb,sol:sol,Sopf:Sopf,sopf:sopf,spades:spades,spadesuit:spadesuit,spar:spar,sqcap:sqcap,sqcaps:sqcaps,sqcup:sqcup,sqcups:sqcups,Sqrt:Sqrt,sqsub:sqsub,sqsube:sqsube,sqsubset:sqsubset,sqsubseteq:sqsubseteq,sqsup:sqsup,sqsupe:sqsupe,sqsupset:sqsupset,sqsupseteq:sqsupseteq,square:square,Square:Square,SquareIntersection:SquareIntersection,SquareSubset:SquareSubset,SquareSubsetEqual:SquareSubsetEqual,SquareSuperset:SquareSuperset,SquareSupersetEqual:SquareSupersetEqual,SquareUnion:SquareUnion,squarf:squarf,squ:squ,squf:squf,srarr:srarr,Sscr:Sscr,sscr:sscr,ssetmn:ssetmn,ssmile:ssmile,sstarf:sstarf,Star:Star,star:star,starf:starf,straightepsilon:straightepsilon,straightphi:straightphi,strns:strns,sub:sub,Sub:Sub,subdot:subdot,subE:subE,sube:sube,subedot:subedot,submult:submult,subnE:subnE,subne:subne,subplus:subplus,subrarr:subrarr,subset:subset,Subset:Subset,subseteq:subseteq,subseteqq:subseteqq,SubsetEqual:SubsetEqual,subsetneq:subsetneq,subsetneqq:subsetneqq,subsim:subsim,subsub:subsub,subsup:subsup,succapprox:succapprox,succ:succ,succcurlyeq:succcurlyeq,Succeeds:Succeeds,SucceedsEqual:SucceedsEqual,SucceedsSlantEqual:SucceedsSlantEqual,SucceedsTilde:SucceedsTilde,succeq:succeq,succnapprox:succnapprox,succneqq:succneqq,succnsim:succnsim,succsim:succsim,SuchThat:SuchThat,sum:sum,Sum:Sum,sung:sung,sup1:sup1,sup2:sup2,sup3:sup3,sup:sup,Sup:Sup,supdot:supdot,supdsub:supdsub,supE:supE,supe:supe,supedot:supedot,Superset:Superset,SupersetEqual:SupersetEqual,suphsol:suphsol,suphsub:suphsub,suplarr:suplarr,supmult:supmult,supnE:supnE,supne:supne,supplus:supplus,supset:supset,Supset:Supset,supseteq:supseteq,supseteqq:supseteqq,supsetneq:supsetneq,supsetneqq:supsetneqq,supsim:supsim,supsub:supsub,supsup:supsup,swarhk:swarhk,swarr:swarr,swArr:swArr,swarrow:swarrow,swnwar:swnwar,szlig:szlig,Tab:Tab,target:target,Tau:Tau,tau:tau,tbrk:tbrk,Tcaron:Tcaron,tcaron:tcaron,Tcedil:Tcedil,tcedil:tcedil,Tcy:Tcy,tcy:tcy,tdot:tdot,telrec:telrec,Tfr:Tfr,tfr:tfr,there4:there4,therefore:therefore,Therefore:Therefore,Theta:Theta,theta:theta,thetasym:thetasym,thetav:thetav,thickapprox:thickapprox,thicksim:thicksim,ThickSpace:ThickSpace,ThinSpace:ThinSpace,thinsp:thinsp,thkap:thkap,thksim:thksim,THORN:THORN,thorn:thorn,tilde:tilde,Tilde:Tilde,TildeEqual:TildeEqual,TildeFullEqual:TildeFullEqual,TildeTilde:TildeTilde,timesbar:timesbar,timesb:timesb,times:times,timesd:timesd,tint:tint,toea:toea,topbot:topbot,topcir:topcir,top:top,Topf:Topf,topf:topf,topfork:topfork,tosa:tosa,tprime:tprime,trade:trade,TRADE:TRADE,triangle:triangle,triangledown:triangledown,triangleleft:triangleleft,trianglelefteq:trianglelefteq,triangleq:triangleq,triangleright:triangleright,trianglerighteq:trianglerighteq,tridot:tridot,trie:trie,triminus:triminus,TripleDot:TripleDot,triplus:triplus,trisb:trisb,tritime:tritime,trpezium:trpezium,Tscr:Tscr,tscr:tscr,TScy:TScy,tscy:tscy,TSHcy:TSHcy,tshcy:tshcy,Tstrok:Tstrok,tstrok:tstrok,twixt:twixt,twoheadleftarrow:twoheadleftarrow,twoheadrightarrow:twoheadrightarrow,Uacute:Uacute,uacute:uacute,uarr:uarr,Uarr:Uarr,uArr:uArr,Uarrocir:Uarrocir,Ubrcy:Ubrcy,ubrcy:ubrcy,Ubreve:Ubreve,ubreve:ubreve,Ucirc:Ucirc,ucirc:ucirc,Ucy:Ucy,ucy:ucy,udarr:udarr,Udblac:Udblac,udblac:udblac,udhar:udhar,ufisht:ufisht,Ufr:Ufr,ufr:ufr,Ugrave:Ugrave,ugrave:ugrave,uHar:uHar,uharl:uharl,uharr:uharr,uhblk:uhblk,ulcorn:ulcorn,ulcorner:ulcorner,ulcrop:ulcrop,ultri:ultri,Umacr:Umacr,umacr:umacr,uml:uml,UnderBar:UnderBar,UnderBrace:UnderBrace,UnderBracket:UnderBracket,UnderParenthesis:UnderParenthesis,Union:Union,UnionPlus:UnionPlus,Uogon:Uogon,uogon:uogon,Uopf:Uopf,uopf:uopf,UpArrowBar:UpArrowBar,uparrow:uparrow,UpArrow:UpArrow,Uparrow:Uparrow,UpArrowDownArrow:UpArrowDownArrow,updownarrow:updownarrow,UpDownArrow:UpDownArrow,Updownarrow:Updownarrow,UpEquilibrium:UpEquilibrium,upharpoonleft:upharpoonleft,upharpoonright:upharpoonright,uplus:uplus,UpperLeftArrow:UpperLeftArrow,UpperRightArrow:UpperRightArrow,upsi:upsi,Upsi:Upsi,upsih:upsih,Upsilon:Upsilon,upsilon:upsilon,UpTeeArrow:UpTeeArrow,UpTee:UpTee,upuparrows:upuparrows,urcorn:urcorn,urcorner:urcorner,urcrop:urcrop,Uring:Uring,uring:uring,urtri:urtri,Uscr:Uscr,uscr:uscr,utdot:utdot,Utilde:Utilde,utilde:utilde,utri:utri,utrif:utrif,uuarr:uuarr,Uuml:Uuml,uuml:uuml,uwangle:uwangle,vangrt:vangrt,varepsilon:varepsilon,varkappa:varkappa,varnothing:varnothing,varphi:varphi,varpi:varpi,varpropto:varpropto,varr:varr,vArr:vArr,varrho:varrho,varsigma:varsigma,varsubsetneq:varsubsetneq,varsubsetneqq:varsubsetneqq,varsupsetneq:varsupsetneq,varsupsetneqq:varsupsetneqq,vartheta:vartheta,vartriangleleft:vartriangleleft,vartriangleright:vartriangleright,vBar:vBar,Vbar:Vbar,vBarv:vBarv,Vcy:Vcy,vcy:vcy,vdash:vdash,vDash:vDash,Vdash:Vdash,VDash:VDash,Vdashl:Vdashl,veebar:veebar,vee:vee,Vee:Vee,veeeq:veeeq,vellip:vellip,verbar:verbar,Verbar:Verbar,vert:vert,Vert:Vert,VerticalBar:VerticalBar,VerticalLine:VerticalLine,VerticalSeparator:VerticalSeparator,VerticalTilde:VerticalTilde,VeryThinSpace:VeryThinSpace,Vfr:Vfr,vfr:vfr,vltri:vltri,vnsub:vnsub,vnsup:vnsup,Vopf:Vopf,vopf:vopf,vprop:vprop,vrtri:vrtri,Vscr:Vscr,vscr:vscr,vsubnE:vsubnE,vsubne:vsubne,vsupnE:vsupnE,vsupne:vsupne,Vvdash:Vvdash,vzigzag:vzigzag,Wcirc:Wcirc,wcirc:wcirc,wedbar:wedbar,wedge:wedge,Wedge:Wedge,wedgeq:wedgeq,weierp:weierp,Wfr:Wfr,wfr:wfr,Wopf:Wopf,wopf:wopf,wp:wp,wr:wr,wreath:wreath,Wscr:Wscr,wscr:wscr,xcap:xcap,xcirc:xcirc,xcup:xcup,xdtri:xdtri,Xfr:Xfr,xfr:xfr,xharr:xharr,xhArr:xhArr,Xi:Xi,xi:xi,xlarr:xlarr,xlArr:xlArr,xmap:xmap,xnis:xnis,xodot:xodot,Xopf:Xopf,xopf:xopf,xoplus:xoplus,xotime:xotime,xrarr:xrarr,xrArr:xrArr,Xscr:Xscr,xscr:xscr,xsqcup:xsqcup,xuplus:xuplus,xutri:xutri,xvee:xvee,xwedge:xwedge,Yacute:Yacute,yacute:yacute,YAcy:YAcy,yacy:yacy,Ycirc:Ycirc,ycirc:ycirc,Ycy:Ycy,ycy:ycy,yen:yen,Yfr:Yfr,yfr:yfr,YIcy:YIcy,yicy:yicy,Yopf:Yopf,yopf:yopf,Yscr:Yscr,yscr:yscr,YUcy:YUcy,yucy:yucy,yuml:yuml,Yuml:Yuml,Zacute:Zacute,zacute:zacute,Zcaron:Zcaron,zcaron:zcaron,Zcy:Zcy,zcy:zcy,Zdot:Zdot,zdot:zdot,zeetrf:zeetrf,ZeroWidthSpace:ZeroWidthSpace,Zeta:Zeta,zeta:zeta,zfr:zfr,Zfr:Zfr,ZHcy:ZHcy,zhcy:zhcy,zigrarr:zigrarr,zopf:zopf,Zopf:Zopf,Zscr:Zscr,zscr:zscr,zwj:zwj,zwnj:zwnj,default:entitiesJSON}),require$$0=xml&&xmlJSON||xml,require$$1=entities&&entitiesJSON||entities,inverseXML=getInverseObj$1(require$$0),xmlReplacer=getInverseReplacer$1(inverseXML),XML=getInverse$1(inverseXML,xmlReplacer),inverseHTML=getInverseObj$1(require$$1),htmlReplacer=getInverseReplacer$1(inverseHTML),HTML=getInverse$1(inverseHTML,htmlReplacer);function getInverseObj$1(e){return Object.keys(e).sort().reduce(function(t,r){return t[e[r]]="&"+r+";",t},{})}function getInverseReplacer$1(e){var t=[],r=[];return Object.keys(e).forEach(function(e){1===e.length?t.push("\\"+e):r.push(e)}),r.unshift("["+t.join("")+"]"),new RegExp(r.join("|"),"g")}var re_nonASCII=/[^\0-\x7F]/g,re_astralSymbols=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;function singleCharReplacer$1(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"}function astralReplacer$1(e){return"&#x"+(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)-56320+65536).toString(16).toUpperCase()+";"}function getInverse$1(e,t){function r(t){return e[t]}return function(e){return e.replace(t,r).replace(re_astralSymbols,astralReplacer$1).replace(re_nonASCII,singleCharReplacer$1)}}var re_xmlChars=getInverseReplacer$1(inverseXML);function escapeXML(e){return e.replace(re_xmlChars,singleCharReplacer$1).replace(re_astralSymbols,astralReplacer$1).replace(re_nonASCII,singleCharReplacer$1)}var escape=escapeXML,encode={XML:XML,HTML:HTML,escape:escape},decode={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376},decode$1=Object.freeze({default:decode}),decodeMap=decode$1&&decode||decode$1,decode_codepoint=decodeCodePoint;function decodeCodePoint(e){if(e>=55296&&e<=57343||e>1114111)return"�";e in decodeMap&&(e=decodeMap[e]);var t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+=String.fromCharCode(e)}var Aacute$1="Á",aacute$1="á",Acirc$1="Â",acirc$1="â",acute$1="´",AElig$1="Æ",aelig$1="æ",Agrave$1="À",agrave$1="à",amp$2="&",AMP$1="&",Aring$1="Å",aring$1="å",Atilde$1="Ã",atilde$1="ã",Auml$1="Ä",auml$1="ä",brvbar$1="¦",Ccedil$1="Ç",ccedil$1="ç",cedil$1="¸",cent$1="¢",copy$1="©",COPY$1="©",curren$1="¤",deg$1="°",divide$1="÷",Eacute$1="É",eacute$1="é",Ecirc$1="Ê",ecirc$1="ê",Egrave$1="È",egrave$1="è",ETH$1="Ð",eth$1="ð",Euml$1="Ë",euml$1="ë",frac12$1="½",frac14$1="¼",frac34$1="¾",gt$2=">",GT$1=">",Iacute$1="Í",iacute$1="í",Icirc$1="Î",icirc$1="î",iexcl$1="¡",Igrave$1="Ì",igrave$1="ì",iquest$1="¿",Iuml$1="Ï",iuml$1="ï",laquo$1="«",lt$2="<",LT$1="<",macr$1="¯",micro$1="µ",middot$1="·",nbsp$1=" ",not$1="¬",Ntilde$1="Ñ",ntilde$1="ñ",Oacute$1="Ó",oacute$1="ó",Ocirc$1="Ô",ocirc$1="ô",Ograve$1="Ò",ograve$1="ò",ordf$1="ª",ordm$1="º",Oslash$1="Ø",oslash$1="ø",Otilde$1="Õ",otilde$1="õ",Ouml$1="Ö",ouml$1="ö",para$1="¶",plusmn$1="±",pound$1="£",quot$2='"',QUOT$1='"',raquo$1="»",reg$1="®",REG$1="®",sect$1="§",shy$1="­",sup1$1="¹",sup2$1="²",sup3$1="³",szlig$1="ß",THORN$1="Þ",thorn$1="þ",times$1="×",Uacute$1="Ú",uacute$1="ú",Ucirc$1="Û",ucirc$1="û",Ugrave$1="Ù",ugrave$1="ù",uml$1="¨",Uuml$1="Ü",uuml$1="ü",Yacute$1="Ý",yacute$1="ý",yen$1="¥",yuml$1="ÿ",legacyJSON={Aacute:Aacute$1,aacute:aacute$1,Acirc:Acirc$1,acirc:acirc$1,acute:acute$1,AElig:AElig$1,aelig:aelig$1,Agrave:Agrave$1,agrave:agrave$1,amp:amp$2,AMP:AMP$1,Aring:Aring$1,aring:aring$1,Atilde:Atilde$1,atilde:atilde$1,Auml:Auml$1,auml:auml$1,brvbar:brvbar$1,Ccedil:Ccedil$1,ccedil:ccedil$1,cedil:cedil$1,cent:cent$1,copy:copy$1,COPY:COPY$1,curren:curren$1,deg:deg$1,divide:divide$1,Eacute:Eacute$1,eacute:eacute$1,Ecirc:Ecirc$1,ecirc:ecirc$1,Egrave:Egrave$1,egrave:egrave$1,ETH:ETH$1,eth:eth$1,Euml:Euml$1,euml:euml$1,frac12:frac12$1,frac14:frac14$1,frac34:frac34$1,gt:gt$2,GT:GT$1,Iacute:Iacute$1,iacute:iacute$1,Icirc:Icirc$1,icirc:icirc$1,iexcl:iexcl$1,Igrave:Igrave$1,igrave:igrave$1,iquest:iquest$1,Iuml:Iuml$1,iuml:iuml$1,laquo:laquo$1,lt:lt$2,LT:LT$1,macr:macr$1,micro:micro$1,middot:middot$1,nbsp:nbsp$1,not:not$1,Ntilde:Ntilde$1,ntilde:ntilde$1,Oacute:Oacute$1,oacute:oacute$1,Ocirc:Ocirc$1,ocirc:ocirc$1,Ograve:Ograve$1,ograve:ograve$1,ordf:ordf$1,ordm:ordm$1,Oslash:Oslash$1,oslash:oslash$1,Otilde:Otilde$1,otilde:otilde$1,Ouml:Ouml$1,ouml:ouml$1,para:para$1,plusmn:plusmn$1,pound:pound$1,quot:quot$2,QUOT:QUOT$1,raquo:raquo$1,reg:reg$1,REG:REG$1,sect:sect$1,shy:shy$1,sup1:sup1$1,sup2:sup2$1,sup3:sup3$1,szlig:szlig$1,THORN:THORN$1,thorn:thorn$1,times:times$1,Uacute:Uacute$1,uacute:uacute$1,Ucirc:Ucirc$1,ucirc:ucirc$1,Ugrave:Ugrave$1,ugrave:ugrave$1,uml:uml$1,Uuml:Uuml$1,uuml:uuml$1,Yacute:Yacute$1,yacute:yacute$1,yen:yen$1,yuml:yuml$1},_entities={encodeXML:encode.XML,decodeCodepoint:decode_codepoint,entitiesJSON:entitiesJSON,legacyJSON:legacyJSON,xmlJSON:xmlJSON},_entities_decodeCodepoint=_entities.decodeCodepoint,_entities_decodeCodepoint$1=Object.freeze({default:_entities_decodeCodepoint}),_entities_entitiesJSON=_entities.entitiesJSON,_entities_entitiesJSON$1=Object.freeze({default:_entities_entitiesJSON}),_entities_legacyJSON=_entities.legacyJSON,_entities_legacyJSON$1=Object.freeze({default:_entities_legacyJSON}),_entities_xmlJSON=_entities.xmlJSON,_entities_xmlJSON$1=Object.freeze({default:_entities_xmlJSON}),decodeCodePoint$1=_entities_decodeCodepoint$1&&_entities_decodeCodepoint||_entities_decodeCodepoint$1,entityMap=_entities_entitiesJSON$1&&_entities_entitiesJSON||_entities_entitiesJSON$1,legacyMap=_entities_legacyJSON$1&&_entities_legacyJSON||_entities_legacyJSON$1,xmlMap=_entities_xmlJSON$1&&_entities_xmlJSON||_entities_xmlJSON$1,Tokenizer_1=Tokenizer$1,i=0,TEXT=i++,BEFORE_TAG_NAME=i++,IN_TAG_NAME=i++,IN_SELF_CLOSING_TAG=i++,BEFORE_CLOSING_TAG_NAME=i++,IN_CLOSING_TAG_NAME=i++,AFTER_CLOSING_TAG_NAME=i++,BEFORE_ATTRIBUTE_NAME=i++,IN_ATTRIBUTE_NAME=i++,AFTER_ATTRIBUTE_NAME=i++,BEFORE_ATTRIBUTE_VALUE=i++,IN_ATTRIBUTE_VALUE_DQ=i++,IN_ATTRIBUTE_VALUE_SQ=i++,IN_ATTRIBUTE_VALUE_NQ=i++,BEFORE_DECLARATION=i++,IN_DECLARATION=i++,IN_PROCESSING_INSTRUCTION=i++,BEFORE_COMMENT=i++,IN_COMMENT=i++,AFTER_COMMENT_1=i++,AFTER_COMMENT_2=i++,BEFORE_CDATA_1=i++,BEFORE_CDATA_2=i++,BEFORE_CDATA_3=i++,BEFORE_CDATA_4=i++,BEFORE_CDATA_5=i++,BEFORE_CDATA_6=i++,IN_CDATA=i++,AFTER_CDATA_1=i++,AFTER_CDATA_2=i++,BEFORE_SPECIAL=i++,BEFORE_SPECIAL_END=i++,BEFORE_SCRIPT_1=i++,BEFORE_SCRIPT_2=i++,BEFORE_SCRIPT_3=i++,BEFORE_SCRIPT_4=i++,BEFORE_SCRIPT_5=i++,AFTER_SCRIPT_1=i++,AFTER_SCRIPT_2=i++,AFTER_SCRIPT_3=i++,AFTER_SCRIPT_4=i++,AFTER_SCRIPT_5=i++,BEFORE_STYLE_1=i++,BEFORE_STYLE_2=i++,BEFORE_STYLE_3=i++,BEFORE_STYLE_4=i++,AFTER_STYLE_1=i++,AFTER_STYLE_2=i++,AFTER_STYLE_3=i++,AFTER_STYLE_4=i++,BEFORE_ENTITY=i++,BEFORE_NUMERIC_ENTITY=i++,IN_NAMED_ENTITY=i++,IN_NUMERIC_ENTITY=i++,IN_HEX_ENTITY=i++,j=0,SPECIAL_NONE=j++,SPECIAL_SCRIPT=j++,SPECIAL_STYLE=j++;function whitespace(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function characterState(e,t){return function(r){r===e&&(this._state=t)}}function ifElseState(e,t,r){var n=e.toLowerCase();return e===n?function(e){e===n?this._state=t:(this._state=r,this._index--)}:function(s){s===n||s===e?this._state=t:(this._state=r,this._index--)}}function consumeSpecialNameChar(e,t){var r=e.toLowerCase();return function(n){n===r||n===e?this._state=t:(this._state=IN_TAG_NAME,this._index--)}}function Tokenizer$1(e,t){this._state=TEXT,this._buffer="",this._sectionStart=0,this._index=0,this._bufferOffset=0,this._baseState=TEXT,this._special=SPECIAL_NONE,this._cbs=t,this._running=!0,this._ended=!1,this._xmlMode=!(!e||!e.xmlMode),this._decodeEntities=!(!e||!e.decodeEntities)}Tokenizer$1.prototype._stateText=function(e){"<"===e?(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._state=BEFORE_TAG_NAME,this._sectionStart=this._index):this._decodeEntities&&this._special===SPECIAL_NONE&&"&"===e&&(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._baseState=TEXT,this._state=BEFORE_ENTITY,this._sectionStart=this._index)},Tokenizer$1.prototype._stateBeforeTagName=function(e){"/"===e?this._state=BEFORE_CLOSING_TAG_NAME:"<"===e?(this._cbs.ontext(this._getSection()),this._sectionStart=this._index):">"===e||this._special!==SPECIAL_NONE||whitespace(e)?this._state=TEXT:"!"===e?(this._state=BEFORE_DECLARATION,this._sectionStart=this._index+1):"?"===e?(this._state=IN_PROCESSING_INSTRUCTION,this._sectionStart=this._index+1):(this._state=this._xmlMode||"s"!==e&&"S"!==e?IN_TAG_NAME:BEFORE_SPECIAL,this._sectionStart=this._index)},Tokenizer$1.prototype._stateInTagName=function(e){("/"===e||">"===e||whitespace(e))&&(this._emitToken("onopentagname"),this._state=BEFORE_ATTRIBUTE_NAME,this._index--)},Tokenizer$1.prototype._stateBeforeCloseingTagName=function(e){whitespace(e)||(">"===e?this._state=TEXT:this._special!==SPECIAL_NONE?"s"===e||"S"===e?this._state=BEFORE_SPECIAL_END:(this._state=TEXT,this._index--):(this._state=IN_CLOSING_TAG_NAME,this._sectionStart=this._index))},Tokenizer$1.prototype._stateInCloseingTagName=function(e){(">"===e||whitespace(e))&&(this._emitToken("onclosetag"),this._state=AFTER_CLOSING_TAG_NAME,this._index--)},Tokenizer$1.prototype._stateAfterCloseingTagName=function(e){">"===e&&(this._state=TEXT,this._sectionStart=this._index+1)},Tokenizer$1.prototype._stateBeforeAttributeName=function(e){">"===e?(this._cbs.onopentagend(),this._state=TEXT,this._sectionStart=this._index+1):"/"===e?this._state=IN_SELF_CLOSING_TAG:whitespace(e)||(this._state=IN_ATTRIBUTE_NAME,this._sectionStart=this._index)},Tokenizer$1.prototype._stateInSelfClosingTag=function(e){">"===e?(this._cbs.onselfclosingtag(),this._state=TEXT,this._sectionStart=this._index+1):whitespace(e)||(this._state=BEFORE_ATTRIBUTE_NAME,this._index--)},Tokenizer$1.prototype._stateInAttributeName=function(e){("="===e||"/"===e||">"===e||whitespace(e))&&(this._cbs.onattribname(this._getSection()),this._sectionStart=-1,this._state=AFTER_ATTRIBUTE_NAME,this._index--)},Tokenizer$1.prototype._stateAfterAttributeName=function(e){"="===e?this._state=BEFORE_ATTRIBUTE_VALUE:"/"===e||">"===e?(this._cbs.onattribend(),this._state=BEFORE_ATTRIBUTE_NAME,this._index--):whitespace(e)||(this._cbs.onattribend(),this._state=IN_ATTRIBUTE_NAME,this._sectionStart=this._index)},Tokenizer$1.prototype._stateBeforeAttributeValue=function(e){'"'===e?(this._state=IN_ATTRIBUTE_VALUE_DQ,this._sectionStart=this._index+1):"'"===e?(this._state=IN_ATTRIBUTE_VALUE_SQ,this._sectionStart=this._index+1):whitespace(e)||(this._state=IN_ATTRIBUTE_VALUE_NQ,this._sectionStart=this._index,this._index--)},Tokenizer$1.prototype._stateInAttributeValueDoubleQuotes=function(e){'"'===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=BEFORE_ATTRIBUTE_NAME):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=BEFORE_ENTITY,this._sectionStart=this._index)},Tokenizer$1.prototype._stateInAttributeValueSingleQuotes=function(e){"'"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=BEFORE_ATTRIBUTE_NAME):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=BEFORE_ENTITY,this._sectionStart=this._index)},Tokenizer$1.prototype._stateInAttributeValueNoQuotes=function(e){whitespace(e)||">"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=BEFORE_ATTRIBUTE_NAME,this._index--):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=BEFORE_ENTITY,this._sectionStart=this._index)},Tokenizer$1.prototype._stateBeforeDeclaration=function(e){this._state="["===e?BEFORE_CDATA_1:"-"===e?BEFORE_COMMENT:IN_DECLARATION},Tokenizer$1.prototype._stateInDeclaration=function(e){">"===e&&(this._cbs.ondeclaration(this._getSection()),this._state=TEXT,this._sectionStart=this._index+1)},Tokenizer$1.prototype._stateInProcessingInstruction=function(e){">"===e&&(this._cbs.onprocessinginstruction(this._getSection()),this._state=TEXT,this._sectionStart=this._index+1)},Tokenizer$1.prototype._stateBeforeComment=function(e){"-"===e?(this._state=IN_COMMENT,this._sectionStart=this._index+1):this._state=IN_DECLARATION},Tokenizer$1.prototype._stateInComment=function(e){"-"===e&&(this._state=AFTER_COMMENT_1)},Tokenizer$1.prototype._stateAfterComment1=function(e){this._state="-"===e?AFTER_COMMENT_2:IN_COMMENT},Tokenizer$1.prototype._stateAfterComment2=function(e){">"===e?(this._cbs.oncomment(this._buffer.substring(this._sectionStart,this._index-2)),this._state=TEXT,this._sectionStart=this._index+1):"-"!==e&&(this._state=IN_COMMENT)},Tokenizer$1.prototype._stateBeforeCdata1=ifElseState("C",BEFORE_CDATA_2,IN_DECLARATION),Tokenizer$1.prototype._stateBeforeCdata2=ifElseState("D",BEFORE_CDATA_3,IN_DECLARATION),Tokenizer$1.prototype._stateBeforeCdata3=ifElseState("A",BEFORE_CDATA_4,IN_DECLARATION),Tokenizer$1.prototype._stateBeforeCdata4=ifElseState("T",BEFORE_CDATA_5,IN_DECLARATION),Tokenizer$1.prototype._stateBeforeCdata5=ifElseState("A",BEFORE_CDATA_6,IN_DECLARATION),Tokenizer$1.prototype._stateBeforeCdata6=function(e){"["===e?(this._state=IN_CDATA,this._sectionStart=this._index+1):(this._state=IN_DECLARATION,this._index--)},Tokenizer$1.prototype._stateInCdata=function(e){"]"===e&&(this._state=AFTER_CDATA_1)},Tokenizer$1.prototype._stateAfterCdata1=characterState("]",AFTER_CDATA_2),Tokenizer$1.prototype._stateAfterCdata2=function(e){">"===e?(this._cbs.oncdata(this._buffer.substring(this._sectionStart,this._index-2)),this._state=TEXT,this._sectionStart=this._index+1):"]"!==e&&(this._state=IN_CDATA)},Tokenizer$1.prototype._stateBeforeSpecial=function(e){"c"===e||"C"===e?this._state=BEFORE_SCRIPT_1:"t"===e||"T"===e?this._state=BEFORE_STYLE_1:(this._state=IN_TAG_NAME,this._index--)},Tokenizer$1.prototype._stateBeforeSpecialEnd=function(e){this._special!==SPECIAL_SCRIPT||"c"!==e&&"C"!==e?this._special!==SPECIAL_STYLE||"t"!==e&&"T"!==e?this._state=TEXT:this._state=AFTER_STYLE_1:this._state=AFTER_SCRIPT_1},Tokenizer$1.prototype._stateBeforeScript1=consumeSpecialNameChar("R",BEFORE_SCRIPT_2),Tokenizer$1.prototype._stateBeforeScript2=consumeSpecialNameChar("I",BEFORE_SCRIPT_3),Tokenizer$1.prototype._stateBeforeScript3=consumeSpecialNameChar("P",BEFORE_SCRIPT_4),Tokenizer$1.prototype._stateBeforeScript4=consumeSpecialNameChar("T",BEFORE_SCRIPT_5),Tokenizer$1.prototype._stateBeforeScript5=function(e){("/"===e||">"===e||whitespace(e))&&(this._special=SPECIAL_SCRIPT),this._state=IN_TAG_NAME,this._index--},Tokenizer$1.prototype._stateAfterScript1=ifElseState("R",AFTER_SCRIPT_2,TEXT),Tokenizer$1.prototype._stateAfterScript2=ifElseState("I",AFTER_SCRIPT_3,TEXT),Tokenizer$1.prototype._stateAfterScript3=ifElseState("P",AFTER_SCRIPT_4,TEXT),Tokenizer$1.prototype._stateAfterScript4=ifElseState("T",AFTER_SCRIPT_5,TEXT),Tokenizer$1.prototype._stateAfterScript5=function(e){">"===e||whitespace(e)?(this._special=SPECIAL_NONE,this._state=IN_CLOSING_TAG_NAME,this._sectionStart=this._index-6,this._index--):this._state=TEXT},Tokenizer$1.prototype._stateBeforeStyle1=consumeSpecialNameChar("Y",BEFORE_STYLE_2),Tokenizer$1.prototype._stateBeforeStyle2=consumeSpecialNameChar("L",BEFORE_STYLE_3),Tokenizer$1.prototype._stateBeforeStyle3=consumeSpecialNameChar("E",BEFORE_STYLE_4),Tokenizer$1.prototype._stateBeforeStyle4=function(e){("/"===e||">"===e||whitespace(e))&&(this._special=SPECIAL_STYLE),this._state=IN_TAG_NAME,this._index--},Tokenizer$1.prototype._stateAfterStyle1=ifElseState("Y",AFTER_STYLE_2,TEXT),Tokenizer$1.prototype._stateAfterStyle2=ifElseState("L",AFTER_STYLE_3,TEXT),Tokenizer$1.prototype._stateAfterStyle3=ifElseState("E",AFTER_STYLE_4,TEXT),Tokenizer$1.prototype._stateAfterStyle4=function(e){">"===e||whitespace(e)?(this._special=SPECIAL_NONE,this._state=IN_CLOSING_TAG_NAME,this._sectionStart=this._index-5,this._index--):this._state=TEXT},Tokenizer$1.prototype._stateBeforeEntity=ifElseState("#",BEFORE_NUMERIC_ENTITY,IN_NAMED_ENTITY),Tokenizer$1.prototype._stateBeforeNumericEntity=ifElseState("X",IN_HEX_ENTITY,IN_NUMERIC_ENTITY),Tokenizer$1.prototype._parseNamedEntityStrict=function(){if(this._sectionStart+1<this._index){var e=this._buffer.substring(this._sectionStart+1,this._index),t=this._xmlMode?xmlMap:entityMap;t.hasOwnProperty(e)&&(this._emitPartial(t[e]),this._sectionStart=this._index+1)}},Tokenizer$1.prototype._parseLegacyEntity=function(){var e=this._sectionStart+1,t=this._index-e;for(t>6&&(t=6);t>=2;){var r=this._buffer.substr(e,t);if(legacyMap.hasOwnProperty(r))return this._emitPartial(legacyMap[r]),void(this._sectionStart+=t+1);t--}},Tokenizer$1.prototype._stateInNamedEntity=function(e){";"===e?(this._parseNamedEntityStrict(),this._sectionStart+1<this._index&&!this._xmlMode&&this._parseLegacyEntity(),this._state=this._baseState):(e<"a"||e>"z")&&(e<"A"||e>"Z")&&(e<"0"||e>"9")&&(this._xmlMode||this._sectionStart+1===this._index||(this._baseState!==TEXT?"="!==e&&this._parseNamedEntityStrict():this._parseLegacyEntity()),this._state=this._baseState,this._index--)},Tokenizer$1.prototype._decodeNumericEntity=function(e,t){var r=this._sectionStart+e;if(r!==this._index){var n=this._buffer.substring(r,this._index),s=parseInt(n,t);this._emitPartial(decodeCodePoint$1(s)),this._sectionStart=this._index}else this._sectionStart--;this._state=this._baseState},Tokenizer$1.prototype._stateInNumericEntity=function(e){";"===e?(this._decodeNumericEntity(2,10),this._sectionStart++):(e<"0"||e>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(2,10),this._index--)},Tokenizer$1.prototype._stateInHexEntity=function(e){";"===e?(this._decodeNumericEntity(3,16),this._sectionStart++):(e<"a"||e>"f")&&(e<"A"||e>"F")&&(e<"0"||e>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(3,16),this._index--)},Tokenizer$1.prototype._cleanup=function(){this._sectionStart<0?(this._buffer="",this._bufferOffset+=this._index,this._index=0):this._running&&(this._state===TEXT?(this._sectionStart!==this._index&&this._cbs.ontext(this._buffer.substr(this._sectionStart)),this._buffer="",this._bufferOffset+=this._index,this._index=0):this._sectionStart===this._index?(this._buffer="",this._bufferOffset+=this._index,this._index=0):(this._buffer=this._buffer.substr(this._sectionStart),this._index-=this._sectionStart,this._bufferOffset+=this._sectionStart),this._sectionStart=0)},Tokenizer$1.prototype.write=function(e){this._ended&&this._cbs.onerror(Error(".write() after done!")),this._buffer+=e,this._parse()},Tokenizer$1.prototype._parse=function(){for(;this._index<this._buffer.length&&this._running;){var e=this._buffer.charAt(this._index);this._state===TEXT?this._stateText(e):this._state===BEFORE_TAG_NAME?this._stateBeforeTagName(e):this._state===IN_TAG_NAME?this._stateInTagName(e):this._state===BEFORE_CLOSING_TAG_NAME?this._stateBeforeCloseingTagName(e):this._state===IN_CLOSING_TAG_NAME?this._stateInCloseingTagName(e):this._state===AFTER_CLOSING_TAG_NAME?this._stateAfterCloseingTagName(e):this._state===IN_SELF_CLOSING_TAG?this._stateInSelfClosingTag(e):this._state===BEFORE_ATTRIBUTE_NAME?this._stateBeforeAttributeName(e):this._state===IN_ATTRIBUTE_NAME?this._stateInAttributeName(e):this._state===AFTER_ATTRIBUTE_NAME?this._stateAfterAttributeName(e):this._state===BEFORE_ATTRIBUTE_VALUE?this._stateBeforeAttributeValue(e):this._state===IN_ATTRIBUTE_VALUE_DQ?this._stateInAttributeValueDoubleQuotes(e):this._state===IN_ATTRIBUTE_VALUE_SQ?this._stateInAttributeValueSingleQuotes(e):this._state===IN_ATTRIBUTE_VALUE_NQ?this._stateInAttributeValueNoQuotes(e):this._state===BEFORE_DECLARATION?this._stateBeforeDeclaration(e):this._state===IN_DECLARATION?this._stateInDeclaration(e):this._state===IN_PROCESSING_INSTRUCTION?this._stateInProcessingInstruction(e):this._state===BEFORE_COMMENT?this._stateBeforeComment(e):this._state===IN_COMMENT?this._stateInComment(e):this._state===AFTER_COMMENT_1?this._stateAfterComment1(e):this._state===AFTER_COMMENT_2?this._stateAfterComment2(e):this._state===BEFORE_CDATA_1?this._stateBeforeCdata1(e):this._state===BEFORE_CDATA_2?this._stateBeforeCdata2(e):this._state===BEFORE_CDATA_3?this._stateBeforeCdata3(e):this._state===BEFORE_CDATA_4?this._stateBeforeCdata4(e):this._state===BEFORE_CDATA_5?this._stateBeforeCdata5(e):this._state===BEFORE_CDATA_6?this._stateBeforeCdata6(e):this._state===IN_CDATA?this._stateInCdata(e):this._state===AFTER_CDATA_1?this._stateAfterCdata1(e):this._state===AFTER_CDATA_2?this._stateAfterCdata2(e):this._state===BEFORE_SPECIAL?this._stateBeforeSpecial(e):this._state===BEFORE_SPECIAL_END?this._stateBeforeSpecialEnd(e):this._state===BEFORE_SCRIPT_1?this._stateBeforeScript1(e):this._state===BEFORE_SCRIPT_2?this._stateBeforeScript2(e):this._state===BEFORE_SCRIPT_3?this._stateBeforeScript3(e):this._state===BEFORE_SCRIPT_4?this._stateBeforeScript4(e):this._state===BEFORE_SCRIPT_5?this._stateBeforeScript5(e):this._state===AFTER_SCRIPT_1?this._stateAfterScript1(e):this._state===AFTER_SCRIPT_2?this._stateAfterScript2(e):this._state===AFTER_SCRIPT_3?this._stateAfterScript3(e):this._state===AFTER_SCRIPT_4?this._stateAfterScript4(e):this._state===AFTER_SCRIPT_5?this._stateAfterScript5(e):this._state===BEFORE_STYLE_1?this._stateBeforeStyle1(e):this._state===BEFORE_STYLE_2?this._stateBeforeStyle2(e):this._state===BEFORE_STYLE_3?this._stateBeforeStyle3(e):this._state===BEFORE_STYLE_4?this._stateBeforeStyle4(e):this._state===AFTER_STYLE_1?this._stateAfterStyle1(e):this._state===AFTER_STYLE_2?this._stateAfterStyle2(e):this._state===AFTER_STYLE_3?this._stateAfterStyle3(e):this._state===AFTER_STYLE_4?this._stateAfterStyle4(e):this._state===BEFORE_ENTITY?this._stateBeforeEntity(e):this._state===BEFORE_NUMERIC_ENTITY?this._stateBeforeNumericEntity(e):this._state===IN_NAMED_ENTITY?this._stateInNamedEntity(e):this._state===IN_NUMERIC_ENTITY?this._stateInNumericEntity(e):this._state===IN_HEX_ENTITY?this._stateInHexEntity(e):this._cbs.onerror(Error("unknown _state"),this._state),this._index++}this._cleanup()},Tokenizer$1.prototype.pause=function(){this._running=!1},Tokenizer$1.prototype.resume=function(){this._running=!0,this._index<this._buffer.length&&this._parse(),this._ended&&this._finish()},Tokenizer$1.prototype.end=function(e){this._ended&&this._cbs.onerror(Error(".end() after done!")),e&&this.write(e),this._ended=!0,this._running&&this._finish()},Tokenizer$1.prototype._finish=function(){this._sectionStart<this._index&&this._handleTrailingData(),this._cbs.onend()},Tokenizer$1.prototype._handleTrailingData=function(){var e=this._buffer.substr(this._sectionStart);this._state===IN_CDATA||this._state===AFTER_CDATA_1||this._state===AFTER_CDATA_2?this._cbs.oncdata(e):this._state===IN_COMMENT||this._state===AFTER_COMMENT_1||this._state===AFTER_COMMENT_2?this._cbs.oncomment(e):this._state!==IN_NAMED_ENTITY||this._xmlMode?this._state!==IN_NUMERIC_ENTITY||this._xmlMode?this._state!==IN_HEX_ENTITY||this._xmlMode?this._state!==IN_TAG_NAME&&this._state!==BEFORE_ATTRIBUTE_NAME&&this._state!==BEFORE_ATTRIBUTE_VALUE&&this._state!==AFTER_ATTRIBUTE_NAME&&this._state!==IN_ATTRIBUTE_NAME&&this._state!==IN_ATTRIBUTE_VALUE_SQ&&this._state!==IN_ATTRIBUTE_VALUE_DQ&&this._state!==IN_ATTRIBUTE_VALUE_NQ&&this._state!==IN_CLOSING_TAG_NAME&&this._cbs.ontext(e):(this._decodeNumericEntity(3,16),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._decodeNumericEntity(2,10),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._parseLegacyEntity(),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData()))},Tokenizer$1.prototype.reset=function(){Tokenizer$1.call(this,{xmlMode:this._xmlMode,decodeEntities:this._decodeEntities},this._cbs)},Tokenizer$1.prototype.getAbsoluteIndex=function(){return this._bufferOffset+this._index},Tokenizer$1.prototype._getSection=function(){return this._buffer.substring(this._sectionStart,this._index)},Tokenizer$1.prototype._emitToken=function(e){this._cbs[e](this._getSection()),this._sectionStart=-1},Tokenizer$1.prototype._emitPartial=function(e){this._baseState!==TEXT?this._cbs.onattribdata(e):this._cbs.ontext(e)};var _inherits=function(){},_inherits$1=Object.freeze({default:_inherits}),_resolve_empty={},_resolve_empty$1=Object.freeze({default:_resolve_empty}),require$$1$1=_inherits$1&&_inherits||_inherits$1,require$$2=_resolve_empty$1&&_resolve_empty||_resolve_empty$1,Tokenizer$2=Tokenizer_1,formTags={input:!0,option:!0,optgroup:!0,select:!0,button:!0,datalist:!0,textarea:!0},openImpliesClose={tr:{tr:!0,th:!0,td:!0},th:{th:!0},td:{thead:!0,th:!0,td:!0},body:{head:!0,link:!0,script:!0},li:{li:!0},p:{p:!0},h1:{p:!0},h2:{p:!0},h3:{p:!0},h4:{p:!0},h5:{p:!0},h6:{p:!0},select:formTags,input:formTags,output:formTags,button:formTags,datalist:formTags,textarea:formTags,option:{option:!0},optgroup:{optgroup:!0}},voidElements={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,path:!0,circle:!0,ellipse:!0,line:!0,rect:!0,use:!0,stop:!0,polyline:!0,polygon:!0},re_nameEnd=/\s|\//;function Parser$1(e,t){this._options=t||{},this._cbs=e||{},this._tagname="",this._attribname="",this._attribvalue="",this._attribs=null,this._stack=[],this.startIndex=0,this.endIndex=null,this._lowerCaseTagNames="lowerCaseTags"in this._options?!!this._options.lowerCaseTags:!this._options.xmlMode,this._lowerCaseAttributeNames="lowerCaseAttributeNames"in this._options?!!this._options.lowerCaseAttributeNames:!this._options.xmlMode,this._options.Tokenizer&&(Tokenizer$2=this._options.Tokenizer),this._tokenizer=new Tokenizer$2(this._options,this),this._cbs.onparserinit&&this._cbs.onparserinit(this)}require$$1$1(Parser$1,require$$2.EventEmitter),Parser$1.prototype._updatePosition=function(e){null===this.endIndex?this._tokenizer._sectionStart<=e?this.startIndex=0:this.startIndex=this._tokenizer._sectionStart-e:this.startIndex=this.endIndex+1,this.endIndex=this._tokenizer.getAbsoluteIndex()},Parser$1.prototype.ontext=function(e){this._updatePosition(1),this.endIndex--,this._cbs.ontext&&this._cbs.ontext(e)},Parser$1.prototype.onopentagname=function(e){if(this._lowerCaseTagNames&&(e=e.toLowerCase()),this._tagname=e,!this._options.xmlMode&&e in openImpliesClose)for(var t;(t=this._stack[this._stack.length-1])in openImpliesClose[e];this.onclosetag(t));!this._options.xmlMode&&e in voidElements||this._stack.push(e),this._cbs.onopentagname&&this._cbs.onopentagname(e),this._cbs.onopentag&&(this._attribs={})},Parser$1.prototype.onopentagend=function(){this._updatePosition(1),this._attribs&&(this._cbs.onopentag&&this._cbs.onopentag(this._tagname,this._attribs),this._attribs=null),!this._options.xmlMode&&this._cbs.onclosetag&&this._tagname in voidElements&&this._cbs.onclosetag(this._tagname),this._tagname=""},Parser$1.prototype.onclosetag=function(e){if(this._updatePosition(1),this._lowerCaseTagNames&&(e=e.toLowerCase()),this._options.xmlMode){const t=this._stack;let r=t.pop();for(;r!==e;)this._cbs.onerror&&this._cbs.onerror("Unclosed tag <"+r+">"),r=t.pop();this.onopentagend(),this._cbs.onclosetag&&this._cbs.onclosetag(r)}else if(!this._stack.length||e in voidElements)"br"!==e&&"p"!==e||(this.onopentagname(e),this._closeCurrentTag());else{let t=this._stack.lastIndexOf(e);if(-1!==t)if(this._cbs.onclosetag)for(t=this._stack.length-t;t--;)this._cbs.onclosetag(this._stack.pop());else this._stack.length=t;else"p"===e&&(this.onopentagname(e),this._closeCurrentTag())}},Parser$1.prototype.onselfclosingtag=function(){this._options.xmlMode||this._options.recognizeSelfClosing?this._closeCurrentTag():this.onopentagend()},Parser$1.prototype._closeCurrentTag=function(){var e=this._tagname;this.onopentagend(),this._stack[this._stack.length-1]===e&&(this._cbs.onclosetag&&this._cbs.onclosetag(e),this._stack.pop())},Parser$1.prototype.onattribname=function(e){this._lowerCaseAttributeNames&&(e=e.toLowerCase()),this._attribname=e},Parser$1.prototype.onattribdata=function(e){this._attribvalue+=e},Parser$1.prototype.onattribend=function(){this._cbs.onattribute&&this._cbs.onattribute(this._attribname,this._attribvalue),this._attribs&&!Object.prototype.hasOwnProperty.call(this._attribs,this._attribname)&&(this._attribs[this._attribname]=this._attribvalue),this._attribname="",this._attribvalue=""},Parser$1.prototype._getInstructionName=function(e){var t=e.search(re_nameEnd),r=t<0?e:e.substr(0,t);return this._lowerCaseTagNames&&(r=r.toLowerCase()),r},Parser$1.prototype.ondeclaration=function(e){if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("!"+t,"!"+e)}},Parser$1.prototype.onprocessinginstruction=function(e){if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("?"+t,"?"+e)}},Parser$1.prototype.oncomment=function(e){this._updatePosition(4),this._cbs.oncomment&&this._cbs.oncomment(e),this._cbs.oncommentend&&this._cbs.oncommentend()},Parser$1.prototype.oncdata=function(e){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(),this._cbs.ontext&&this._cbs.ontext(e),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+e+"]]")},Parser$1.prototype.onerror=function(e){this._cbs.onerror&&this._cbs.onerror(e)},Parser$1.prototype.onend=function(){if(this._cbs.onclosetag)for(var e=this._stack.length;e>0;this._cbs.onclosetag(this._stack[--e]));this._cbs.onend&&this._cbs.onend()},Parser$1.prototype.reset=function(){this._cbs.onreset&&this._cbs.onreset(),this._tokenizer.reset(),this._tagname="",this._attribname="",this._attribs=null,this._stack=[],this._cbs.onparserinit&&this._cbs.onparserinit(this)},Parser$1.prototype.parseComplete=function(e){this.reset(),this.end(e)},Parser$1.prototype.write=function(e){this._tokenizer.write(e)},Parser$1.prototype.end=function(e){this._tokenizer.end(e)},Parser$1.prototype.pause=function(){this._tokenizer.pause()},Parser$1.prototype.resume=function(){this._tokenizer.resume()},Parser$1.prototype.parseChunk=Parser$1.prototype.write,Parser$1.prototype.done=Parser$1.prototype.end;var Parser_1=Parser$1;function parseMarkup(e,t){let r=t.ownerDocument?t.ownerDocument.format:t.format;if(!r)throw new Error("Either 'ownerDocument' or 'format' must be set.");let n=Object.assign({},t,{xmlMode:"xml"===r}),s=new DomHandler({format:r,elementFactory:t.elementFactory});return new Parser_1(s,n).end(e),s.document}Parser_1.prototype.ondeclaration=function(e){if(this._cbs.ondeclaration)this._cbs.ondeclaration(e);else if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("!"+t,"!"+e)}},Parser_1.prototype.oncdata=function(e){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(e),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+e+"]]")};const RE_WHITESPACE=/\s+/g,RE_DOCTYPE=/^DOCTYPE\s+([^\s]+)(?:\s+PUBLIC\s+["]([^"]+)["](?:\s+["]([^"]+)["])?)\s*$/;class DomHandler{constructor(e={}){if(this.elementFactory=e.elementFactory,!this.elementFactory)throw new Error("'elementFactory' is required");this.options=e,this.document=null,this._tagStack=[]}onparserinit(){this.document=this.elementFactory("document",{format:this.options.format}),this._tagStack=[this.document]}onend(){if(this._tagStack.length>1)throw new Error("Unexpected EOF. Tag was opened but not closed.")}onerror(e){throw new Error(e)}onclosetag(){this._tagStack.pop()}_addDomElement(e){let t=this._tagStack[this._tagStack.length-1];t.childNodes||(t.childNodes=[]);let r=t.childNodes,n=r[r.length-1];e.next=null,n?(e.prev=n,n.next=e):e.prev=null,r.push(e),e.parent=t||null}onopentag(e,t){let r=this.document.createElement(e);forEach(t,(e,t)=>{r.setAttribute(t,e)}),this._addDomElement(r),this._tagStack.push(r)}ontext(e){let t;this.options.normalizeWhitespace&&(e=e.replace(RE_WHITESPACE," "));let r=this._tagStack[this._tagStack.length-1];if(r&&r.childNodes&&(t=r.childNodes[r.childNodes.length-1]),t&&t.type===domelementtype.Text)t.data+=e;else{let t=this.document.createTextNode(e);this._addDomElement(t)}}oncomment(e){var t=this._tagStack[this._tagStack.length-1];if(t&&t.type===domelementtype.Comment)t.data+=e;else{let t=this.document.createComment(e);this._addDomElement(t),this._tagStack.push(t)}}oncommentend(){this._tagStack.pop()}oncdatastart(e){let t=this.document.createCDATASection(e);this._addDomElement(t),this._tagStack.push(t)}oncdataend(){this._tagStack.pop()}onprocessinginstruction(e,t){t=t.slice(e.length,-1).trim(),e=e.slice(1);let r=this.document.createProcessingInstruction(e,t);"xml"===e?this.document._xmlInstruction=r:this._addDomElement(r)}ondeclaration(e){if(!e.startsWith("DOCTYPE"))throw new Error("Not implemented: parse declaration "+e);{let t=RE_DOCTYPE.exec(e);if(!t)throw new Error("Could not parse DOCTYPE element: "+e);this.document.setDoctype(t[1],t[2],t[3])}}}let _browserWindowStub;class MemoryDOMElement extends DOMElement{constructor(e,t={}){if(super(),this.type=e,!e)throw new Error("'type' is mandatory");if(this.ownerDocument=t.ownerDocument,"document"!==e&&!this.ownerDocument)throw new Error("'ownerDocument' is mandatory");switch(e){case domelementtype.Tag:if(!t.name)throw new Error("'name' is mandatory.");this.name=this._normalizeName(t.name),this.nameWithoutNS=nameWithoutNS(this.name),this.properties=new Map,this.attributes=new Map,this.classes=new Set,this.styles=new Map,this.eventListeners=[],this.childNodes=t.children||t.childNodes||[],this._assign(t);break;case domelementtype.Text:case domelementtype.Comment:case domelementtype.CDATA:this.data=t.data||"";break;case domelementtype.Directive:if(!t.name)throw new Error("'name' is mandatory.");this.name=this._normalizeName(t.name),this.nameWithoutNS=nameWithoutNS(this.name),this.data=t.data;break;case domelementtype.Doctype:this.data=t.data;break;case"document":{let e=t.format;if(this.format=e,!e)throw new Error("'format' is mandatory.");switch(this.childNodes=t.children||t.childNodes||[],e){case"xml":this.contentType="application/xml";break;case"html":this.contentType="text/html";break;default:throw new Error("Unsupported format "+e)}break}default:this.name=null,this.properties=new Map,this.attributes=new Map,this.classes=new Set,this.styles=new Map,this.eventListeners=[],this.childNodes=t.children||t.childNodes||[]}}getNativeElement(){return this}getNodeType(){switch(this.type){case domelementtype.Tag:case domelementtype.Script:case domelementtype.Style:return"element";default:return this.type}}isTextNode(){return"text"===this.type}isElementNode(){return"tag"===this.type||"script"===this.type}isCommentNode(){return"comment"===this.type}isDocumentNode(){return"document"===this.type}isComponentNode(){return"component"===this.type}clone(e){let t=new MemoryDOMElement(this.type,this);return this.childNodes&&(t.childNodes.length=0,e&&this.childNodes.forEach(r=>{t.appendChild(r.clone(e))})),t}get tagName(){return this.getTagName()}set tagName(e){this.setTagName(e)}getTagName(){return this.name}setTagName(e){return this._isXML()?this.name=String(e):this.name=String(e).toLowerCase(),this.nameWithoutNS=nameWithoutNS(this.name),this}hasAttribute(e){if(this.attributes)return this.attributes.has(e)}getAttribute(e){if(this.attributes)return this.attributes.get(e)}setAttribute(e,t){if(this.attributes){switch(t=String(t),e){case"class":this.classes=new Set,parseClasses(this.classes,t);break;case"style":this.styles=new Map,parseStyles(this.styles,t)}this.attributes.set(e,t),this._isHTML()&&deriveHTMLPropertyFromAttribute(this,e,t)}return this}removeAttribute(e){if(this.attributes){switch(e){case"class":this.classes=new Set;break;case"style":this.styles=new Map}this.attributes.delete(e)}return this}getAttributes(){return this.attributes}getProperty(e){if(this.properties)return this.properties.get(e)}setProperty(e,t){if(this.properties){if(this._isXML())throw new Error("setProperty() is only be used on HTML elements");_setHTMLPropertyValue(this,e,t)}return this}hasClass(e){if(this.classes)return this.classes.has(e)}addClass(e){return this.classes&&(this.classes.add(e),this.attributes.set("class",stringifyClasses(this.classes))),this}removeClass(e){return this.classes&&this.classes.has(e)&&(this.classes.delete(e),this.attributes.set("class",stringifyClasses(this.classes))),this}getContentType(){return this.getOwnerDocument().contentType}getDoctype(){return this.isDocumentNode()?_findDocTypeElement(this):this.getOwnerDocument().getDoctype()}setDoctype(e,t,r){let n=this.getOwnerDocument(),s=_findDocTypeElement(n),o=this.createDocumentType(e,t,r);s?n.replaceChild(o,s):n.insertBefore(o,n.getChildren()[0]),n.doctype=o}getInnerHTML(){let e=this._isXML();return domUtils.getInnerHTML(this,{xmlMode:e,decodeEntities:!e})}setInnerHTML(e){if(this.childNodes){let t=this._isXML(),r=parseMarkup(e,{ownerDocument:this.getOwnerDocument(),format:t?"xml":"html",decodeEntities:!t,elementFactory:MemoryDOMElementFactory});this.empty(),r.childNodes.slice(0).forEach(e=>{this.appendChild(e)})}return this}getOuterHTML(){let e=this._isXML();return domUtils.getOuterHTML(this,{xmlMode:e,decodeEntities:!e})}getTextContent(){return domUtils.getText(this)}setTextContent(e){switch(this.type){case domelementtype.Text:case domelementtype.Comment:case domelementtype.CDATA:this.data=e;break;default:if(this.childNodes){let t=this.createTextNode(e);this.empty(),this.appendChild(t)}}return this}getStyle(e){if(this.styles)return this.styles.get(e)}setStyle(e,t){return this.styles&&(DOMElement.pxStyles[e]&&isNumber(t)&&(t+="px"),this.styles.set(e,t),this.attributes.set("style",stringifyStyles(this.styles))),this}is(e){return cssSelect.is(this,e,{xmlMode:this._isXML()})}find(e){return cssSelect.selectOne(e,this,{xmlMode:this._isXML()})}findAll(e){return cssSelect.selectAll(e,this,{xmlMode:this._isXML()})}getChildCount(){return this.childNodes?this.childNodes.length:0}getChildNodes(){return this.childNodes.slice(0)}getChildren(){return this.childNodes.filter(function(e){return"tag"===e.type})}get children(){return this.getChildren()}getChildAt(e){if(this.childNodes)return this.childNodes[e]}getChildIndex(e){if(this.childNodes)return this.childNodes.indexOf(e)}getLastChild(){if(this.childNodes)return last$1(this.childNodes)}getFirstChild(){if(this.childNodes)return this.childNodes[0]}getNextSibling(){return this.next}getPreviousSibling(){return this.prev}getParent(){return this.parent}getOwnerDocument(){return"document"===this.type?this:this.ownerDocument}getFormat(){return this.getOwnerDocument().format}createDocument(e){return MemoryDOMElement.createDocument(e)}createElement(e){return new MemoryDOMElement(domelementtype.Tag,{name:e,ownerDocument:this.getOwnerDocument()})}createTextNode(e){return new MemoryDOMElement(domelementtype.Text,{data:e,ownerDocument:this.getOwnerDocument()})}createComment(e){return new MemoryDOMElement(domelementtype.Comment,{data:e,ownerDocument:this.getOwnerDocument()})}createProcessingInstruction(e,t){return new MemoryDOMElement(domelementtype.Directive,{name:e,data:t,ownerDocument:this.getOwnerDocument()})}createDocumentType(e,t,r){return new MemoryDOMDoctype(domelementtype.Doctype,{data:{name:e,publicId:t,systemId:r},ownerDocument:this.getOwnerDocument()})}createCDATASection(e){return new MemoryDOMElement(domelementtype.CDATA,{data:e,ownerDocument:this.getOwnerDocument()})}appendChild(e){if(this.childNodes&&!isNil(e)){if(!(e=this._normalizeChild(e)))return this;domUtils.appendChild(this,e),e.ownerDocument=this.getOwnerDocument()}return this}removeChild(e){e.parentNode===this&&e.remove()}insertAt(e,t){if(!(t=this._normalizeChild(t)))return this;let r=this.childNodes;return r&&(e>=r.length?domUtils.appendChild(this,t):domUtils.prepend(r[e],t),t.ownerDocument=this.getOwnerDocument()),this}insertBefore(e,t){if(isNil(t))return this.appendChild(e);if(this.childNodes){if(!(this.childNodes.indexOf(t)>-1))throw new Error("insertBefore(): reference node is not a child of this element.");domUtils.prepend(t,e),e.ownerDocument=this.getOwnerDocument()}return this}removeAt(e){let t=this.childNodes;if(t){t[e].remove()}return this}empty(){let e=this.childNodes;return e&&(e.forEach(e=>{e.next=e.prev=e.parent=null}),e.length=0),this}remove(){return domUtils.removeElement(this),this}replaceChild(e,t){return e.parent===this&&e.replaceWith(t),this}replaceWith(e){return e=this._normalizeChild(e),domUtils.replaceElement(this,e),e.ownerDocument=this.getOwnerDocument(),this}getEventListeners(){return this.eventListeners||[]}click(){return this.emit("click",{target:this,currentTarget:this}),!0}emit(e,t){this._propagateEvent(new MemoryDOMElementEvent(e,this,t))}getBoundingClientRect(){return{top:0,left:0,height:0,width:0}}getClientRects(){return[{top:0,left:0,height:0,width:0}]}_propagateEvent(e){let t=this.eventListeners;if(t){if(t.forEach(t=>{t.eventName===e.type&&t.handler(e)}),e.stopped)return;let r=this.parentNode;r&&r._propagateEvent(e)}}removeAllEventListeners(){return this.eventListeners=[],this}_assign(e){e.name&&(this.name=e.name),this.classes&&e.classes&&e.classes.forEach(e=>{this.classes.add(e)}),this.styles&&e.styles&&forEach(e.styles,(e,t)=>{this.styles.set(t,e)});let t=e.attributes||e.attribs;this.attributes&&t&&forEach(t,(e,t)=>{switch(t){case"class":parseClasses(this.classes,e);break;case"style":parseStyles(this.styles,e)}this.attributes.set(t,e)}),this.eventListeners&&e.eventListeners&&(this.eventListeners=this.eventListeners.concat(e.eventListeners))}_normalizeChild(e){if(!isNil(e)){if(isString(e)&&(e=this.createTextNode(e)),!e||!e._isMemoryDOMElement)throw new Error("Illegal argument: only String and MemoryDOMElement instances are valid.");return e}}_normalizeName(e){return this._isXML()?e:e.toLowerCase()}_isHTML(){return"html"===this.getFormat()}_isXML(){return"xml"===this.getFormat()}get _isMemoryDOMElement(){return!0}static createDocument(e,t={}){if("xml"===e){let r=new MemoryDOMElement("document",{format:e}),n=[];return t.version&&n.push(`version="${t.version}"`),t.encoding&&n.push(`encoding="${t.encoding}"`),n.length>0&&(r._xmlInstruction=r.createProcessingInstruction("xml",n.join(" "))),r}return MemoryDOMElement.parseMarkup(DOMElement.EMPTY_HTML,"html")}static parseMarkup(e,t,r={}){if(!e)return MemoryDOMElement.createDocument(t);let n,s="html"===t,o=Object.assign({format:t,decodeEntities:s,elementFactory:MemoryDOMElementFactory},r);if(r.raw)return parseMarkup(e,o);if(r.snippet&&(e=`<__snippet__>${e}</__snippet__>`),"html"===t?_sanitizeHTMLStructure(n=parseMarkup(e,o)):"xml"===t&&(n=parseMarkup(e,o)),r.snippet){let e=n.find("__snippet__").childNodes;return 1===e.length?e[0]:e}return n}static wrapNativeElement(e){if(inBrowser){if(e===window||e===window.document)return new DOMElementStub;e instanceof window.Node||e._isBrowserDOMElement}if(!e._isMemoryDOMElement)throw new Error("Illegal argument: expected MemoryDOMElement instance");return e}static wrap(e){return MemoryDOMElement.wrapNativeElement(e)}static unwrap(e){if(!e._isMemoryDOMElement)throw new Error("Illegal argument: expected MemoryDOMElement instance");return e}static isReverse(){return!1}static getBrowserWindow(){return _browserWindowStub||(_browserWindowStub=new MemoryWindowStub),_browserWindowStub}}function MemoryDOMElementFactory(e,t){return new MemoryDOMElement(e,t)}class MemoryDOMDoctype extends MemoryDOMElement{get name(){return this.data.name}get publicId(){return this.data.publicId}get systemId(){return this.data.systemId}}function parseClasses(e,t){t.split(/\s+/).forEach(t=>{e.add(t)})}function stringifyClasses(e){return Array.from(e).join(" ")}function parseStyles(e,t){(t=(t||"").trim())&&t.split(";").forEach(t=>{let r=t.indexOf(":");if(r<1||r===t.length-1)return;let n=t.slice(0,r).trim(),s=t.slice(r+1).trim();e.set(n,s)})}function stringifyStyles(e){if(!e)return"";let t=Object.keys(e).map(t=>t+":"+e[t]).join(";");return t.length>0&&(t+=";"),t}const BUILTIN_EVENTS=["keydown","keyup","keypress","mousedown","mouseup","mouseover","click","dblclick"].reduce((e,t)=>(e[t]=!0,e),{});class MemoryDOMElementEvent{constructor(e,t,r){this.type=e,this.timeStamp=Date.now(),this.target=t,BUILTIN_EVENTS[e]?r&&Object.assign(this,r):this.detail=r}stopPropagation(){this.stopped=!0}preventDefault(){this.defaultPrevented=!0}}class DOMElementStub{on(){}off(){}}class MemoryWindowStub extends MemoryDOMElement{constructor(){super("window",{ownerDocument:MemoryDOMElement.createDocument("html")});let e={href:"",hash:""};function t(t){let r=t.indexOf("#");e.href=t,r>=0&&(e.hash=t.slice(r))}let r={replaceState(e,r,n){t(n)},pushState(e,r,n){t(n)}};this.location=e,this.history=r}}function nameWithoutNS(e){const t=e.indexOf(":");return t>0?e.slice(t+1):e}const ATTR_TO_PROPS={input:{value:!0,checked:(e,t,r)=>{const n="off"!==r;e.setProperty("checked",n)}}};function deriveHTMLPropertyFromAttribute(e,t,r){const n=ATTR_TO_PROPS[e.tagName];if(n){let s=n[t];!0===s?e.setProperty(t,r):s&&s(e,t,r)}}const PROPERTY_TRANSFORMATIONS={input:{checked:(e,t,r)=>{!0===r?(e.properties.set(t,!0),e.properties.set("value","on")):(e.properties.set(t,!1),e.properties.set("value","off"))},value:(e,t,r)=>{switch(e.getAttribute("type")){case"checkbox":"on"===r?(e.properties.set(t,!0),e.properties.set("value","on")):(e.properties.set(t,!1),e.properties.set("value","off"));break;default:_setProperty(e,t,r)}}}};function _setProperty(e,t,r){void 0===r?e.properties.delete(t):e.properties.set(t,String(r))}function _setHTMLPropertyValue(e,t,r){const n=PROPERTY_TRANSFORMATIONS[e.tagName];if(n){let s=n[t];if(s)return void s(e,t,r)}_setProperty(e,t,r)}function _sanitizeHTMLStructure(e){let t=e.find("html");if(!t){let r=e.find("head"),n=e.find("title"),s=e.findAll("meta"),o=e.find("body");r&&r.remove(),n&&n.remove(),s.forEach(e=>e.remove()),o&&o.remove();let i=e.childNodes.slice();i.forEach(e=>{e.parent=null}),e.childNodes.length=0,t=e.createElement("html"),r||((r=e.createElement("head")).appendChild(n),r.append(s),t.appendChild(r)),o||(o=e.createElement("body")).append(i),t.appendChild(o),e.append(t)}}function _findDocTypeElement(e){if(e.doctype)return e.doctype;const t=e.childNodes;for(let r=0;r<t.length;r++){let n=t[r];if(n.type===domelementtype.Doctype)return e.doctype=n,n}}let DefaultDOMElement={};function _getDefaultImpl(){return DefaultDOMElement._forceMemoryDOM?MemoryDOMElement:platform.inBrowser||platform.inElectron?BrowserDOMElement:MemoryDOMElement}DefaultDOMElement.createDocument=function(e,t){return _getDefaultImpl().createDocument(e,t)},DefaultDOMElement.createElement=function(e){return console.error("DEPRECATED: every element should have an ownerDocument. Use DefaultDOMElement.createDocument() to create a document first"),DefaultDOMElement.createDocument("html").createElement(e)},DefaultDOMElement.createTextNode=function(e){return console.error("DEPRECATED: every element should have a ownerDocument. Use DefaultDOMElement.createDocument() to create a document first"),DefaultDOMElement.createDocument("html").createTextNode(e)},DefaultDOMElement.getBrowserWindow=function(){return _getDefaultImpl().getBrowserWindow()},DefaultDOMElement.parseHTML=function(e,t){return _getDefaultImpl().parseMarkup(e,"html",t)},DefaultDOMElement.parseXML=function(e,t){return _getDefaultImpl().parseMarkup(e,"xml",t)},DefaultDOMElement.parseSnippet=function(e,t){return _getDefaultImpl().parseMarkup(e,t,{snippet:!0})},DefaultDOMElement.wrap=DefaultDOMElement.wrapNativeElement=function(e){if(!e)throw new Error("Illegal argument");return _getDefaultImpl().wrap(e)},DefaultDOMElement.unwrap=function(e){if(!e)throw new Error("Illegal argument");return _getDefaultImpl().unwrap(e)},DefaultDOMElement.isReverse=function(e,t,r,n){return _getDefaultImpl().isReverse(e,t,r,n)},DefaultDOMElement._forceMemoryDOM=!1;const _global="undefined"!=typeof global?global:window,substanceGlobals=_global.hasOwnProperty("Substance")?_global.Substance:_global.Substance={DEBUG_RENDERING:!1};function deleteFromArray(e,t){if(e)for(var r=0;r<e.length;r++)e[r]===t&&(e.splice(r,1),r--)}function isBoolean(e){return!0===e||!1===e||e&&e.constructor===Boolean}class VirtualElement extends DOMElement{constructor(e){super(),this.parent=null,this._owner=e,this._ref=null}getParent(){return this.parent}get childNodes(){return this.getChildNodes()}getChildCount(){return this.children.length}getChildAt(e){return this.children[e]}getComponent(){return this._comp}ref(e){if(!e)throw new Error("Illegal argument");if(this._ref)throw new Error("A VirtualElement can only be referenced once.");if(this._ref=e,this._context){const t=this._context.refs;if(t.has(e))throw new Error('An item with reference "'+e+'" already exists.');t.set(e,this)}return this}isInDocument(){return!1}get _isVirtualElement(){return!0}}class VirtualHTMLElement extends VirtualElement{constructor(e){super(),this._tagName=e,this.classNames=null,this.attributes=null,this.htmlProps=null,this.style=null,this.eventListeners=null,this.children=[]}getTagName(){return this._tagName}setTagName(e){return this._tagName=e,this}hasClass(e){return!!this.classNames&&this.classNames.indexOf(e)>-1}addClass(e){return this.classNames||(this.classNames=[]),this.classNames.push(e),this}removeClass(e){return this.classNames&&(this.classNames=without(this.classNames,e)),this}removeAttribute(e){return this.attributes&&this.attributes.delete(e),this}getAttribute(e){if(this.attributes)return this.attributes.get(e)}setAttribute(e,t){return this.attributes||(this.attributes=new Map),this.attributes.set(e,t),this}getAttributes(){let e=[];return this.attributes&&(e=Array.from(this.attributes)),this.classNames&&e.push(["class",this.classNames.join(" ")]),this.style&&e.push(["style",map(this.style,function(e,t){return t+":"+e}).join(";")]),new Map(e)}getId(){return this.getAttribute("id")}setId(e){return this.setAttribute("id",e),this}setTextContent(e){return e=String(e||""),this.empty(),this.appendChild(e),this}setInnerHTML(e){return e=e||"",this.empty(),this._innerHTMLString=e,this}getInnerHTML(){if(this.hasOwnProperty("_innerHTMLString"))return this._innerHTMLString;throw new Error("Not supported.")}getValue(){return this.htmlProp("value")}setValue(e){return this.htmlProp("value",e),this}getChildNodes(){return this.children}getChildren(){return this.children.filter(function(e){return"text"!==e.getNodeType()})}isTextNode(){return!1}isElementNode(){return!0}isCommentNode(){return!1}isDocumentNode(){return!1}append(){if(this._innerHTMLString)throw Error("It is not possible to mix $$.html() with $$.append(). You can call $$.empty() to reset this virtual element.");return this._append(this.children,arguments),this}appendChild(e){if(this._innerHTMLString)throw Error("It is not possible to mix $$.html() with $$.append(). You can call $$.empty() to reset this virtual element.");return this._appendChild(this.children,e),this}insertAt(e,t){if(!(t=this._normalizeChild(t)))throw new Error("Illegal child: "+t);if(!t._isVirtualElement)throw new Error("Illegal argument for $$.insertAt():"+t);if(e<0||e>this.children.length)throw new Error("insertAt(): index out of bounds.");return this._insertAt(this.children,e,t),this}insertBefore(e,t){var r=this.children.indexOf(t);if(!(r>-1))throw new Error("insertBefore(): reference node is not a child of this element.");return this.insertAt(r,e),this}removeAt(e){if(e<0||e>=this.children.length)throw new Error("removeAt(): Index out of bounds.");return this._removeAt(e),this}removeChild(e){if(!e||!e._isVirtualElement)throw new Error("removeChild(): Illegal arguments. Expecting a CheerioDOMElement instance.");var t=this.children.indexOf(e);if(t<0)throw new Error("removeChild(): element is not a child.");return this.removeAt(t),this}replaceChild(e,t){if(!(t&&e&&t._isVirtualElement&&e._isVirtualElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");var r=this.children.indexOf(e);if(r<0)throw new Error("replaceChild(): element is not a child.");return this.removeAt(r),this.insertAt(r,t),this}empty(){for(var e=this.children;e.length;){e.pop().parent=null}return delete this._innerHTMLString,this}getProperty(e){if(this.htmlProps)return this.htmlProps.get(e)}setProperty(e,t){return this.htmlProps||(this.htmlProps=new Map),this.htmlProps.set(e,t),this}removeProperty(e){return this.htmlProps&&this.htmlProps.delete(e),this}getStyle(e){if(this.style)return this.style.get(e)}setStyle(e,t){return this.style||(this.style=new Map),DOMElement.pxStyles[e]&&isNumber(t)&&(t+="px"),this.style.set(e,t),this}_createEventListener(e,t,r){return r.context=r.context||this._owner._comp,super._createEventListener(e,t,r)}getNodeType(){return"element"}hasInnerHTML(){return Boolean(this._innerHTMLString)}_normalizeChild(e){if(!isNil(e)){if(e._isVirtualElement)return e;if(isString(e)||isBoolean(e)||isNumber(e))return new VirtualTextNode(String(e));throw new Error("Unsupported child type")}}_append(e,t){if(1!==t.length||isArray(t[0])){var r;if(isArray(t[0]))r=t[0];else{if(!(arguments.length>1))return;r=Array.prototype.slice.call(t,0)}r.forEach(this._appendChild.bind(this,e))}else this._appendChild(e,t[0])}_appendChild(e,t){if(t=this._normalizeChild(t))return e.push(t),this._attach(t),t}_insertAt(e,t,r){r&&(e.splice(t,0,r),this._attach(r))}_removeAt(e,t){var r=e[t];e.splice(t,1),this._detach(r)}_attach(e){e.parent=this,this._context&&(e._owner!==this._owner&&e._isVirtualComponent&&this._context.injectedComponents.push(e),e._owner!==this._owner&&e._ref&&(this._context.foreignRefs[e._ref]=e))}_detach(e){e.parent=null,this._context&&(e._isVirtualComponent&&deleteFromArray(this._context.injectedComponents,e),e._owner!==this._owner&&e._ref&&this._context.foreignRefs.delete(e._ref))}_copy(){if(this.classNames||this.attributes||this.eventListeners||this.htmlProps||this.style){let e={};return this.classNames&&(e.classNames=this.classNames.slice()),this.attributes&&(e.attributes=new Map(this.attributes)),this.eventListeners&&(e.eventListeners=this.eventListeners.slice()),this.htmlProps&&(e.htmlProps=new Map(this.htmlProps)),this.style&&(e.style=new Map(this.style)),e}}_clear(){this.classNames=null,this.attributes=null,this.htmlProps=null,this.style=null,this.eventListeners=null}_merge(e){if(!e)return;const t=["classNames","eventListeners"];for(let r of t){let t=e[r];if(t){let e=this[r];this[r]=e?e.concat(t):t.slice()}}const r=["attributes","htmlProps","style"];for(let t of r){let r=e[t];if(r){let e=this[t];this[t]=e?new Map([...e,...r]):new Map(r)}}}get _isVirtualHTMLElement(){return!0}}class VirtualComponent extends VirtualHTMLElement{constructor(e,t){super(),t=t||{},this.ComponentClass=e,this.props=t,t.children||(t.children=[]),this.children=t.children}getComponent(){return this._comp}getChildren(){return this.props.children}getNodeType(){return"component"}outlet(e){return new Outlet(this,e)}setInnerHTML(){throw new Error("Can not set innerHTML of a Component")}_attach(e){e._preliminaryParent=this}_detach(e){e._preliminaryParent=null}get _isVirtualHTMLElement(){return!1}get _isVirtualComponent(){return!0}}class Outlet{constructor(e,t){this.virtualEl=e,this.name=t,Object.freeze(this)}_getOutlet(){var e=this.virtualEl.props[this.name];return e||(e=[],this.virtualEl.props[this.name]=e),e}append(){var e=this._getOutlet();return this.virtualEl._append(e,arguments),this}empty(){var e=this.virtualEl.props[this.name];return e.forEach(function(e){this._detach(e)}.bind(this)),e.splice(0,e.length),this}}class VirtualTextNode extends VirtualElement{constructor(e){super(),this.text=e}get _isVirtualTextNode(){return!0}}VirtualElement.Component=VirtualComponent,VirtualElement.TextNode=VirtualTextNode,VirtualElement.createElement=function(){var e,t,r=arguments[0],n=arguments[1];if(isString(r))t="element";else{if(!isFunction$1(r)||!r.prototype._isComponent)throw isNil(r)?new Error("$$(null): provided argument was null or undefined."):new Error("Illegal usage of $$()");t="component"}var s,o,i={};for(var a in n)if(n.hasOwnProperty(a)){var l=n[a];switch(a){case"class":s=l;break;case"ref":o=l;break;default:i[a]=l}}return"element"===t?(e=new VirtualHTMLElement(r)).attr(i):e=new VirtualComponent(r,i),e._owner=this.owner,s&&e.addClass(s),o&&e.ref(o),[].forEach(function(t){if(isFunction$1(t.handler))e.on(t.name,t.handler);else{if(!isPlainObject(t.handler))throw new Error("Illegal arguments for $$(_,{ on"+t.name+"})");var r=t.handler;e.on(t.name,r.handler,r.context,r)}}),arguments.length>2&&e.append(flattenOften(Array.prototype.slice.call(arguments,2),3)),e},VirtualElement.Context=class{constructor(e){this.owner=e,this.refs=new Map,this.foreignRefs=new Map,this.elements=[],this.components=[],this.injectedComponents=[],this.$$=this._createComponent.bind(this),this.$$.capturing=!0}_createComponent(){let e=VirtualElement.createElement.apply(this,arguments);return e._context=this,e._owner=this.owner,e._isVirtualComponent&&this.components.push(e),this.elements.push(e),e}};const TOP_LEVEL_ELEMENT=Symbol("TOP_LEVEL_ELEMENT");class RenderingEngine{constructor(e={}){if(this.componentFactory=e.componentFactory,!this.componentFactory)throw new Error("'componentFactory' is mandatory");if(this.elementFactory=e.elementFactory||DefaultDOMElement.createDocument("html"),!this.elementFactory)throw new Error("'elementFactory' is mandatory")}_render(e,t,r){substanceGlobals.VERBOSE_RENDERING_ENGINE&&(console.group("RenderingEngine"),e.el?console.log("Rendering Engine: re-render of %s",e.constructor.name):console.log("Rendering Engine: initial render of %s",e.constructor.name),console.time("rendering (total)"));let n=_createWrappingVirtualComponent(e),s=this._createState();t&&s.set(OLDPROPS,n,t),r&&s.set(OLDSTATE,n,r);try{substanceGlobals.VERBOSE_RENDERING_ENGINE&&console.time("capturing"),_capture(s,n,TOP_LEVEL_ELEMENT),substanceGlobals.VERBOSE_RENDERING_ENGINE&&console.timeEnd("capturing"),substanceGlobals.VERBOSE_RENDERING_ENGINE&&console.time("updating"),_update(s,n),substanceGlobals.VERBOSE_RENDERING_ENGINE&&console.timeEnd("updating"),_triggerDidUpdate(s,n)}finally{substanceGlobals.VERBOSE_RENDERING_ENGINE&&(console.timeEnd("rendering (total)"),console.groupEnd("RenderingEngine")),s.dispose()}}_renderChild(e,t){let r=this._createState();t.parent={_comp:e,_isFake:!0};try{return _capture(r,t),_update(r,t),t._comp}finally{r.dispose()}}_createState(){return new RenderingState(this.componentFactory,this.elementFactory)}static createContext(e){let t=_createWrappingVirtualComponent(e);return new VirtualElement.Context(t)}}function _capture(e,t,r){if(e.is(CAPTURED,t))return t;let n=t._comp;if(n||(n=_create(e,t),e.set(NEW,t)),t._isVirtualComponent){let s;if(r===TOP_LEVEL_ELEMENT){s=!0,console.assert(t._comp===n,"top-level element and component should be linked already"),e.set(MAPPED,t),e.set(MAPPED,n),e.set(LINKED,t),e.set(LINKED,n);let r=_getInternalComponentData(n);t.elementProps=r.elementProps}else s=!n.el||n.shouldRerender(t.props,n.state),t.elementProps=t._copy(),t._clear(),e.set(OLDPROPS,t,n.props),e.set(OLDSTATE,t,n.state),n._setProps(t.props),e.is(NEW,t)||e.set(UPDATED,t);if(s){let r=new VirtualElement.Context(t),s=n.render(r.$$);if(!s)throw new Error("Component.render() returned nil.");if(s._isVirtualComponent)t._forwardedEl=s,t._isForwarding=!0,s._isForwarded=!0,s.parent=t,t.children=[s];else{if(!s._isVirtualHTMLElement)throw new Error("render() must return a plain element or a Component");t.tagName=s.tagName,t._merge(s),s.hasInnerHTML()?(t._innerHTMLString=s._innerHTMLString,t.children=[]):(t.children=s.children,t.children.forEach(e=>{e.parent=t}))}if(t._context=s._context,t.elementProps&&(t._merge(t.elementProps),t._isForwarding&&t._forwardedEl._merge(t)),!e.is(NEW,t)&&n.isMounted()&&e.set(UPDATED,t),_forEachComponent(e,n,t,_linkComponent),substanceGlobals.DEBUG_RENDERING){let s=t.children.slice(0);for(;s.length;){let t=s.shift();e.is(CAPTURED,t)||(t._isVirtualComponent||(t._comp||_create(e,t),t._isVirtualHTMLElement&&t.children.length>0&&(s=s.concat(t.children)),e.set(CAPTURED,t)))}let o=new DescendingContext(e,r);for(;o.hasPendingCaptures();)o.reset(),n.render(o.$$);for(let t of r.injectedComponents)_capture(e,t);t._forwardedEl&&_capture(e,t._forwardedEl)}else if(t._forwardedEl)_capture(e,t._forwardedEl);else for(let r of t.children)_capture(e,r);_forEachComponent(e,n,t,_propagateLinking)}else e.set(SKIPPED,t)}else if(t._isVirtualHTMLElement)for(let r of t.children)_capture(e,r);return e.set(CAPTURED,t),t}function _create(e,t){let r=t._comp;console.assert(!r,"Component instance should not exist when this method is used.");let n=t.parent._comp;if(n||(n=_create(e,t.parent)),t._isVirtualComponent){if(console.assert(n,"A Component should have a parent."),r=e.componentFactory.createComponent(t.ComponentClass,n,t.props),t.props=r.props,t._forwardedEl){let n=t._forwardedEl,s=e.componentFactory.createComponent(n.ComponentClass,r,n.props);n.props=s.props,r._forwardedComp=s}}else t._isVirtualHTMLElement?r=e.componentFactory.createElementComponent(n,t):t._isVirtualTextNode&&(r=e.componentFactory.createTextNodeComponent(n,t));return t._ref&&(r._ref=t._ref),t._owner&&(r._owner=t._owner._comp),t._comp=r,r}function _forEachComponent(e,t,r,n){if(console.assert(r._isVirtualComponent,"this method is intended for VirtualComponents only"),!r.__components__){let e=r._context;console.assert(e,"there should be a capturing context on the VirtualComponent");let n=e.refs,s=e.foreignRefs;e.internalRefs||(e.internalRefs=_extractInternalRefs(e,r));let o=e.internalRefs,i=[],a=_getInternalComponentData(t),l=a.refs,c=a.foreignRefs,d=a.internalRefs||new Map,h=(e,t)=>{for(let[r,n]of e){let e,s=t.get(r);s&&(e=s._comp),i.push({vc:n,comp:e})}};n.size>0&&h(n,l),s.size>0&&h(s,c),o.size>0&&h(o,d),r.__components__=i}if(r.__components__.length>0)for(let t of r.__components__)n(e,t.comp,t.vc)}function _linkComponent(e,t,r){t?_isMapped(e,t,r)||_isLinked(e,t,r)||(_isOfSameType(t,r)?_link(e,t,r):_reject(e,t,r)):_reject(e,t,r)}function _link(e,t,r){r._comp=t,e.set(MAPPED,r),e.set(MAPPED,t),e.set(LINKED,r),e.set(LINKED,t)}function _reject(e,t,r){r._comp=null,e.set(MAPPED,r),t&&e.set(MAPPED,t)}function _isMapped(e,t,r){const n=e.is(MAPPED,r),s=e.is(MAPPED,t);return!(!n&&!s)}function _isLinked(e,t,r){let n=e.is(LINKED,t),s=e.is(LINKED,r);return r._comp===t&&(s||(console.error("FIXME: comp is linked, but not virtual component"),e.set(LINKED,r)),n||(console.error("FIXME: virtual comp is linked, but not component"),e.set(LINKED,r)),!0)}function _propagateLinking(e,t,r,n){if(!r)return console.error("DOCUMENT WHY THIS IS NEEDED"),!1;if(!t)return!1;if(n&&_isMapped(e,t,r))return _isLinked(e,t,r);if(!r._isVirtualComponent){if(!_isOfSameType(t,r))return _reject(e,t,r),!1;_link(e,t,r)}let s=!1,o=t.getParent();if(r.parent)s=_propagateLinking(e,o,r.parent,!0);else if(r._preliminaryParent){for(;o&&o._isElementComponent;)o=o.getParent();s=_propagateLinking(e,o,r._preliminaryParent,!0)}return r._isVirtualComponent&&!s&&(substanceGlobals.VERBOSE_RENDERING_ENGINE&&console.info("Component has been relocated: "+t.constructor.name),e.set(RELOCATED,r),e.set(RELOCATED,t)),s}function _isOfSameType(e,t){return e._isElementComponent&&t._isVirtualHTMLElement||e._isComponent&&t._isVirtualComponent&&e.constructor===t.ComponentClass||e._isTextNodeComponent&&t._isVirtualTextNode}function _update(e,t){if(e.is(SKIPPED,t))return;let r=t._comp;if(r||t._ref&&t._preliminaryParent!==t._owner&&_capture(e,t),console.assert(r&&r._isComponent,"A captured VirtualElement must have a component instance attached."),t._isForwarding)_update(e,t._forwardedEl);else{if(r.el){let e=r.el;console.assert(e,"Component's element should exist at this point."),_updateDOMElement(e,t)}else r.el=_createDOMElement(e,t);if((t._isVirtualComponent||t._isVirtualHTMLElement)&&!t.hasInnerHTML()){let n=t.children,s=r.el.getChildNodes().map(t=>{let n=t._comp;return n._isForwarded()&&(n=_findForwardingChildOfComponent(r,n)),!n||e.is(RELOCATED,n)?(r.el.removeChild(t),null):n}).filter(Boolean),o=0,i=0;for(;o<s.length||i<n.length;){let t;do{t=s[o++]}while(t&&e.is(DETACHED,t));let a=n[i++];if(t&&!a){for(;t;)_removeChild(e,r,t),t=s[o++];break}if(t&&t.el.isTextNode()&&a&&a._isVirtualTextNode&&t.el.textContent===a.text)continue;if(t&&t._isElementComponent&&a._isVirtualHTMLElement&&!e.is(MAPPED,t)&&!e.is(MAPPED,a)&&t.tagName===a.tagName){a._comp=t,e.set(LINKED,a),e.set(LINKED,t),_update(e,a);continue}e.is(RENDERED,a)||_update(e,a);let l=a._comp;l!==t&&(e.is(RELOCATED,l)&&l._setParent(r),console.assert(l,"Component instance should now be available."),!a||t?e.is(LINKED,a)?e.is(LINKED,t)?(e.set(DETACHED,t),_removeChild(e,r,t),i--):(_removeChild(e,r,t),i--):e.is(LINKED,t)?(_insertChildBefore(e,r,l,t),o--):_replaceChild(e,r,t,l):_appendChild(e,r,l))}}}if(t._isVirtualComponent&&(_storeInternalData(r,t),t._forwardedEl)){let e=t._forwardedEl._comp;if(r.el){let t=r.el._comp;t!==e&&(t.triggerDispose(),r.el.parentNode.replaceChild(r.el,e.el),r.el=e.el,e.triggerDidMount())}else r.el=e.el}e.set(RENDERED,t),e.set(RENDERED,r)}function _getInternalComponentData(e){return e.__internal__||(e.__internal__=new InternalComponentData),e.__internal__}function _storeInternalData(e,t){let r=t._context,n=_getInternalComponentData(e);n.elementProps=t.elementProps,n.refs=r.refs,n.foreignRefs=r.foreignRefs,n.internalRefs=r.internalRefs,e.refs=Array.from(r.refs).reduce((e,[t,r])=>{return r._comp?e[t]=r._comp:console.warn(`Warning: component with reference '${t}' has not been used`),e},{})}function _extractInternalRefs(e,t){let r=new Map,n=new Map;for(let s of e.components){if(s._ref)continue;let e=_getVirtualComponentTrace(s,t);if(r.has(e)){let t=r.get(e)+1;r.set(e,t),e=e+"@"+t}else r.set(e,1);n.set(e,s)}return n}function _getVirtualComponentTrace(e,t){let r=[e.ComponentClass.name];if(!e._isForwarded){let n=e.getParent();for(;n&&n!==t&&!n._isFake;)console.assert(n._isVirtualHTMLElement),r.unshift(n.tagName),n=n.parent}return r.join("/")}function _triggerDidUpdate(e,t){t._isVirtualComponent?(e.is(SKIPPED,t)||t.children.forEach(_triggerDidUpdate.bind(null,e)),e.is(UPDATED,t)&&t._comp.didUpdate(e.get(OLDPROPS,t),e.get(OLDSTATE,t))):t._isVirtualHTMLElement&&t.children.forEach(_triggerDidUpdate.bind(null,e))}function _appendChild(e,t,r){t.el.appendChild(r.el),_triggerDidMount(e,t,r)}function _replaceChild(e,t,r,n){t.el.replaceChild(r.el,n.el),e.is(DETACHED,r)||r.triggerDispose(),_triggerDidMount(e,t,n)}function _insertChildBefore(e,t,r,n){t.el.insertBefore(r.el,n.el),_triggerDidMount(e,t,r)}function _removeChild(e,t,r){t.el.removeChild(r.el),e.is(DETACHED,r)||r.triggerDispose()}function _triggerDidMount(e,t,r){e.is(DETACHED,r)||!t.isMounted()||r.isMounted()||r.triggerDidMount(!0)}function _createDOMElement(e,t){let r;return r=t._isVirtualTextNode?e.elementFactory.createTextNode(t.text):e.elementFactory.createElement(t.tagName),t._comp&&(r._comp=t._comp),_updateDOMElement(r,t),r}function _updateDOMElement(e,t){if(t._isVirtualTextNode)return void e.setTextContent(t.text);let r=e.getTagName();if(t.tagName.toLowerCase()!==r&&e.setTagName(t.tagName),_updateHash({oldHash:e.getAttributes(),newHash:t.getAttributes(),update:function(t,r){e.setAttribute(t,r)},remove:function(t){e.removeAttribute(t)}}),_updateHash({oldHash:e.htmlProps,newHash:t.htmlProps,update:function(t,r){e.setProperty(t,r)},remove:function(t){e.removeProperty(t)}}),_updateListeners({el:e,oldListeners:e.getEventListeners(),newListeners:t.getEventListeners()}),t.hasInnerHTML()){if(e._hasInnerHTML){let r=e.getInnerHTML(),n=t.getInnerHTML();r!==n&&e.setInnerHTML(n)}else e.empty(),e.setInnerHTML(t.getInnerHTML());e._hasInnerHTML=!0}}function _hashGet(e,t){return e instanceof Map?e.get(t):e[t]}function _updateHash({newHash:e,oldHash:t,update:r,remove:n}){if(!e&&!t)return;e||(e=new Map),t||(t=new Map);let s={};for(let n of e.keys()){let o=_hashGet(t,n),i=_hashGet(e,n);s[n]=!0,o!==i&&r(n,i)}if(isFunction$1(t.keys)&&t.size>0){Array.from(t.keys()).forEach(e=>{s[e]||n(e)})}else for(let e in t)t.hasOwnProperty(e)&&!s[e]&&n(e)}function _updateListeners(e){let t=e.el,r=e.newListeners||[];t.removeAllEventListeners();for(let e=0;e<r.length;e++)t.addEventListener(r[e])}function _findForwardingChildOfComponent(e,t){let r=t.getParent();for(;r;){let t=r.getParent();if(t===e)return r;r=t}}class DescendingContext{constructor(e,t){this.state=e,this.owner=t.owner,this.refs=new Map,this.foreignRefs=new Map,this.internalRefs=null,this.elements=t.elements,this.pos=0,this.updates=t.components.length,this.remaining=this.updates,this.injectedComponents=t.injectedComponents,this.$$=this._$$.bind(this)}_$$(){let e=this.state,t=this.elements[this.pos++];if(!e.is(CAPTURED,t)&&t._isVirtualComponent){let r=t.parent;r&&(r===this.owner||e.is(CAPTURED,t.parent))&&(_capture(e,t),this.updates++,this.remaining--)}return(t=VirtualElement.createElement.apply(this,arguments))._context=this,t._owner=this.owner,t._attach=function(){},t._detach=function(){},t}hasPendingCaptures(){return this.updates>0&&this.remaining>0}reset(){this.pos=0,this.updates=0,this.refs.clear()}}function _createWrappingVirtualComponent(e){let t=new VirtualElement.Component(e.constructor);return t._comp=e,t}const CAPTURED=Symbol("CAPTURED"),DETACHED=Symbol("DETACHED"),LINKED=Symbol("LINKED"),MAPPED=Symbol("MAPPED"),NEW=Symbol("NEW"),OLDPROPS=Symbol("OLDPROPS"),OLDSTATE=Symbol("OLDSTATE"),RELOCATED=Symbol("RELOCATED"),RENDERED=Symbol("RENDERED"),SKIPPED=Symbol("SKIPPED"),UPDATED=Symbol("UPDATED");class RenderingState{constructor(e,t){this.componentFactory=e,this.elementFactory=t,this.polluted=[],this.id="__"+uuid()}dispose(){let e=this.id;this.polluted.forEach(function(t){delete t[e]})}set(e,t,r=!0){let n=t[this.id];n||(n={},t[this.id]=n,this.polluted.push(t)),n[e]=r}get(e,t){let r=t[this.id];if(r)return r[e]}is(e,t){return Boolean(this.get(e,t))}}class InternalComponentData{constructor(){this.refs=new Map,this.foreignRefs=new Map,this.internalRefs=new Map,this.elementProps=null}}RenderingEngine._INTERNAL_API={_capture:_capture,_wrap:_createWrappingVirtualComponent,_update:_update,CAPTURED:CAPTURED,DETACHED:DETACHED,LINKED:LINKED,MAPPED:MAPPED,NEW:NEW,RELOCATED:RELOCATED,RENDERED:RENDERED,SKIPPED:SKIPPED,TOP_LEVEL_ELEMENT:TOP_LEVEL_ELEMENT,UPDATED:UPDATED};const COMPONENT_FACTORY={createComponent:(e,t,r)=>new e(t,r),createElementComponent:(e,t)=>new ElementComponent(e,t),createTextNodeComponent:(e,t)=>new TextNodeComponent(e,t)};class Component extends EventEmitter{constructor(e,t={},r={}){let n;super(),this.parent=e&&e._isComponent?e:null,this.el=r.el,n=isFunction$1(this.defineContext)?this.defineContext(t,e):r.context||this._getContext(),this.context=n||{},this.renderingEngine=e&&e.renderingEngine||r.renderingEngine||new RenderingEngine({componentFactory:COMPONENT_FACTORY}),this._SKIP_COMPONENT_INIT||(this.__id__=uuid(),this.refs={},this.__foreignRefs__={},this._actionHandlers=this.getActionHandlers(),this.props=t,this.state=this.getInitialState()||{})}getId(){return this.__id__}setId(){throw new Error("'id' is readonly")}getActionHandlers(){return{}}getChildContext(){return{}}getInitialState(){return{}}getParent(){return this.parent}getRoot(){let e=this,t=e;for(;t;)t=(e=t).getParent();return e}getElement(){return this.el}getNativeElement(){return this.el.getNativeElement()}getLabel(e,...t){let r=this.getLabelProvider();if(!r)throw new Error("Missing labelProvider.");return r.getLabel(e,...t)}getLabelProvider(){return this.context.labelProvider}getComponent(e,t){let r=this.getComponentRegistry();if(!r)throw new Error("Missing componentRegistry.");const n=r.get(e);if(!t&&!n)throw new Error("No Component registered with name "+e);return n}getComponentRegistry(){return this.context.componentRegistry}render(e){return e("div")}mount(e){if(!e)throw new Error("Element is required.");return e=DefaultDOMElement.wrap(e),this.el=null,this.renderingEngine=Component.createRenderingEngine(e.getOwnerDocument()),this._render(),e.appendChild(this.el),e.isInDocument()&&this.triggerDidMount(!0),this}shouldRerender(e,t){return!0}rerender(){this._rerender(this.props,this.state)}_rerender(e,t){this._render(e,t),this.isMounted()||this.didUpdate(e,t)}_render(e,t){if(this.__isRendering__)throw new Error("Component is rendering already.");this.__isRendering__=!0;try{this.renderingEngine._render(this,e,t)}finally{delete this.__isRendering__}}triggerDidMount(){this._isForwarded()&&this.getParent().triggerDidMount(),this.__isMounted__||(this.__isMounted__=!0,this.didMount());const e=this.getChildren();for(let t of e)t.triggerDidMount(!0)}triggerDispose(){this._isForwarding()?this.el._comp.triggerDispose():this.getChildren().forEach(function(e){e.triggerDispose()}),this.dispose(),this.__isMounted__=!1}didMount(){}didUpdate(){}isMounted(){return this.__isMounted__}dispose(){}_isForwarding(){return!!this.el&&this.el._comp!==this}_isForwarded(){let e=this.getParent();return e&&e._isForwarding()}_getForwardedComponent(){if(this.el)return this.el._comp}_setParent(e){this.parent=e,this.context=this._getContext()||{},Object.freeze(this.context)}send(e){let t=this;for(;t;){if(t._actionHandlers&&t._actionHandlers[e])return t._actionHandlers[e].apply(t,Array.prototype.slice.call(arguments,1)),!0;t=t.getParent()}return console.warn("Action",e,"was not handled."),!1}handleActions(e){return forEach(e,function(e,t){this.handleAction(t,e)}.bind(this)),this}handleAction(e,t){if(!e||!t||!isFunction$1(t))throw new Error("Illegal arguments.");t=t.bind(this),this._actionHandlers[e]=t}getState(){return this.state}setState(e){let t=this.props,r=this.state,n=!this.__isSettingProps__&&this.shouldRerender(this.getProps(),e);this.willUpdateState(e),this.state=e||{},Object.freeze(this.state),n?this._rerender(t,r):this.__isSettingProps__||this.didUpdate(t,r)}extendState(e){e=extend({},this.state,e),this.setState(e)}willUpdateState(e){}getProps(){return this.props}setProps(e){let t=this.props,r=this.state,n=this.shouldRerender(e,this.state);this._setProps(e),n?this._rerender(t,r):this.didUpdate(t,r)}_setProps(e){e=e||{},this.__isSettingProps__=!0;try{this.willReceiveProps(e),this.props=e||{},Object.freeze(e)}finally{delete this.__isSettingProps__}}extendProps(e){let t=extend({},this.props,e);this.setProps(t)}willReceiveProps(e){}getTextContent(){if(this.el)return this.el.textContent}get textContent(){return this.getTextContent()}getInnerHTML(){if(this.el)return this.el.getInnerHTML()}get innerHTML(){return this.getInnerHTML()}getOuterHTML(){if(this.el)return this.el.getOuterHTML()}get outerHTML(){return this.getOuterHTML()}getAttribute(e){if(this.el)return this.el.getAttribute(e)}setAttribute(e,t){return this.el&&this.el.setAttribute(e,t),this}getProperty(e){if(this.el)return this.el.getProperty(e)}setProperty(e,t){return this.el&&this.el.setProperty(e,t),this}get tagName(){if(this.el)return this.el.tagName}hasClass(e){if(this.el)return this.el.hasClass(e)}addClass(e){return this.el&&this.el.addClass(e),this}removeClass(e){return this.el&&this.el.removeClass(e),this}getStyle(e){if(this.el)return this.el.getStyle(e)}setStyle(e,t){return this.el?this.el.setStyle(e,t):this}getValue(){if(this.el)return this.el.getValue()}setValue(e){return this.el&&this.el.setValue(e),this}getChildCount(){return this.el?this.el.getChildCount():0}get childNodes(){return this.getChildNodes()}getChildNodes(){if(!this.el)return[];let e=this.el.getChildNodes();return e=e.map(_unwrapComp).filter(Boolean)}getChildren(){if(!this.el)return[];let e=this.el.getChildren();return e=e.map(_unwrapComp).filter(Boolean)}getChildAt(e){let t=this.el.getChildAt(e);if(t)return _unwrapCompStrict(t)}find(e){return _unwrapComp(this.el.find(e))}findAll(e){return this.el.findAll(e).map(_unwrapComp).filter(Boolean)}appendChild(e){this.insertAt(this.getChildCount(),e)}insertAt(e,t){if(isString(t)&&(t=new VirtualElement.TextNode(t)),!t._isVirtualElement)throw new Error('Invalid argument: "child" must be a VirtualElement.');let r=this.renderingEngine._renderChild(this,t);this.el.insertAt(e,r.el),_mountChild(this,r)}removeAt(e){let t=this.el.getChildAt(e);if(t){_disposeChild(_unwrapCompStrict(t)),this.el.removeAt(e)}}removeChild(e){if(!e||!e._isComponent)throw new Error("removeChild(): Illegal arguments. Expecting a Component instance.");_disposeChild(e),this.el.removeChild(e.el)}replaceChild(e,t){if(!(t&&e&&t._isComponent&&e._isComponent))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");_disposeChild(e),this.el.replaceChild(t.el,e.el),this.isMounted()&&t.triggerDidMount(!0)}empty(){return this._clear(),this}_clear(){let e=this.el;e&&(this.getChildNodes().forEach(function(e){_disposeChild(e)}),e.empty()),this.refs={},this.__foreignRefs__={}}remove(){_disposeChild(this),this.el.remove()}addEventListener(){throw new Error("Not supported.")}removeEventListener(){throw new Error("Not supported.")}insertBefore(){throw new Error("Not supported.")}click(){return!!this.el&&this.el.click()}getComponentPath(){let e=[],t=this;for(;t;)e.unshift(t),t=t.getParent();return e}_getContext(){let e={},t=this.getParent();return t&&(e=extend(e,t.context),t.getChildContext)?extend(e,t.getChildContext()):e}get _isComponent(){return!0}attr(){return DOMElement.prototype.attr.apply(this,arguments)}htmlProp(){return DOMElement.prototype.htmlProp.apply(this,arguments)}val(){return DOMElement.prototype.val.apply(this,arguments)}css(){return DOMElement.prototype.css.apply(this,arguments)}text(){return DOMElement.prototype.text.apply(this,arguments)}append(){return DOMElement.prototype.append.apply(this,arguments)}static unwrap(){return _unwrapComp.apply(this,arguments)}static render(e){let t=new this(null,e=e||{});return t._render(),t}static mount(e,t){if(1===arguments.length&&(t=e,e={}),!t)throw new Error("'el' is required.");if(isString(t)){let e=t;if(!platform.inBrowser)throw new Error("This selector is not supported on server side.");t=window.document.querySelector(e)}t=DefaultDOMElement.wrap(t);let r=new this(null,e);return r.mount(t),r}static getComponentForDOMElement(e){return _unwrapComp(e)}static unwrapDOMElement(e){return console.warn("DEPRECATED: Use Component.getComponentForDOMElement"),Component.getComponentForDOMElement(e)}static getComponentFromNativeElement(e){return _unwrapComp(DefaultDOMElement.wrap(e))}static createRenderingEngine(e){return new RenderingEngine({componentFactory:COMPONENT_FACTORY,elementFactory:e})}static get Element(){return ElementComponent}static get TextNode(){return TextNodeComponent}}function _disposeChild(e){e.triggerDispose(),e._owner&&e._ref&&(console.assert(e._owner.refs[e._ref]===e,"Owner's ref should point to this child instance."),delete e._owner.refs[e._ref])}function _mountChild(e,t){e.isMounted()&&t.triggerDidMount(!0),t._owner&&t._ref&&(t._owner.refs[t._ref]=t)}function _unwrapComp(e){if(e&&(e._isDOMElement||(e=DefaultDOMElement.unwrap(e)),e))return e._comp}function _unwrapCompStrict(e){let t=_unwrapComp(e);if(!t)throw new Error("Expecting a back-link to the component instance.");return t}class ElementComponent extends Component{get _isElementComponent(){return!0}get _SKIP_COMPONENT_INIT(){return!0}}class TextNodeComponent extends Component{setTextContent(e){if(!this.el)throw new Error("Component must be rendered first.");this.el.textContent!==e&&(this.el.textContent=e)}getChildNodes(){return[]}getChildren(){return[]}get _isTextNodeComponent(){return!0}get _SKIP_COMPONENT_INIT(){return!0}}class Range{constructor(e,t,r,n,s){if("SKIP"!==arguments[0])if(1===arguments.length&&isPlainObject(arguments[0])){let e=arguments[0];this.start=e.start,this.end=e.end,this.reverse=Boolean(e.reverse),this.containerPath=e.containerPath,this.surfaceId=e.surfaceId}else this.start=e,this.end=t,this.reverse=Boolean(r),this.containerPath=n,this.surfaceId=s}isCollapsed(){return this.start.equals(this.end)}equals(e){return this===e||isArrayEqual(this.containerPath,e.containerPath)&&this.start.equals(e.start)&&this.end.equals(e.end)}isReverse(){return this.reverse}toString(){let e=[this.start.toString(),"->",this.end.toString()];return this.isReverse()&&e.push("[reverse]"),this.containerPath&&e.push("[container="+this.containerPath+"]"),this.surfaceId&&e.push("[surface="+this.surfaceId+"]"),e.join("")}get _isRange(){return!0}}const ENTER=1,EXIT=-1,ANCHOR=-2;class Fragmenter{constructor(e){Object.assign(this,e)}start(e,t,r){if(!isString(t))throw new Error("Illegal argument: 'text' must be a String, but was "+t);this._start(e,t,r)}onText(e,t,r){}onEnter(e,t){return null}onExit(e,t,r){}_enter(e,t){return e.counter++,this.onEnter(e,t)}_exit(e,t,r){this.onExit(e,t,r)}_createText(e,t,r){this.onText(e,t,r)}_start(e,t,r){for(var n=_extractEntries.call(this,r),s=[{context:e,entry:null}],o=0,i=0;i<n.length;i++){var a,l,c,d=n[i],h=t.substring(o,d.pos);if(h&&this._createText(s[s.length-1].context,h,d),o=d.pos,d.mode===ENTER||d.mode===ANCHOR){for(a=1;a<s.length&&!(d.level<s[a].entry.level);a++);for(l=s.length-1;l>=a;l--)(c=s[l].entry).length=o-c.pos,this._exit(c,s[l].context,s[l-1].context);for(s.splice(a,0,{entry:d}),l=a;l<s.length;l++)(c=s[l].entry).pos=o,s[l].context=this._enter(c,s[l-1].context)}if(d.mode===EXIT||d.mode===ANCHOR){for(a=1;a<s.length&&s[a].entry.node!==d.node;a++);for(l=s.length-1;l>=a;l--)(c=s[l].entry).length=o-c.pos,this._exit(c,s[l].context,s[l-1].context);for(s.splice(a,1),l=a;l<s.length;l++)(c=s[l].entry).pos=o,s[l].context=this._enter(c,s[l-1].context)}}var u=t.substring(o);u&&this._createText(e,u)}}function _extractEntries(e){let t=[],r=[];forEach(e,function(e){if(e.isAnchor())t.push({mode:ANCHOR,pos:e.offset,id:e.id,level:Fragmenter.ALWAYS_ON_TOP,type:"anchor",node:e,counter:-1,length:0});else{var n=Fragmenter.NORMAL;e.isInlineNode()?n=Number.MAX_VALUE:e.constructor.hasOwnProperty("fragmentation")?n=e.constructor.fragmentation:e.hasOwnProperty("fragmentationHint")&&(n=e.fragmentationHint);var s=Math.min(e.start.offset,e.end.offset),o=Math.max(e.start.offset,e.end.offset),i={pos:s,mode:ENTER,level:n,id:e.id,type:e.type,node:e,length:0,counter:-1};t.push(i),r.push({pos:o,mode:EXIT,level:n,id:e.id,type:e.type,node:e,opener:i})}}),t.sort(_compareOpeners);for(var n=t.length-1;n>=0;n--)t[n].idx=n;r.sort(_compareClosers);for(var s=new Array(t.length+r.length),o=0,i=0,a=0,l=t[i],c=r[a];l||c;)l&&c?c.pos<=l.pos&&c.opener!==l?(s[o]=c,a++):(s[o]=l,i++):l?(s[o]=l,i++):c&&(s[o]=c,a++),l=t[i],c=r[a],o++;return s}function _compareOpeners(e,t){if(e.pos<t.pos)return-1;if(e.pos>t.pos)return 1;if(e.mode<t.mode)return-1;if(e.mode>t.mode)return 1;if(e.mode===t.mode){if(e.level<t.level)return-1;if(e.level>t.level)return 1}return 0}function _compareClosers(e,t){return e.pos<t.pos?-1:e.pos>t.pos?1:e.pos===e.opener.pos&&t.pos===t.opener.pos?e.opener.idx<t.opener.idx?-1:1:e.opener.idx>t.opener.idx?-1:e.opener.idx<t.opener.idx?1:0}Fragmenter.SHOULD_NOT_SPLIT=0,Fragmenter.NORMAL=10,Fragmenter.ANY=100,Fragmenter.ALWAYS_ON_TOP=Number.MAX_VALUE;class AnnotatedTextComponent extends Component{render(e){return this._renderContent(e).addClass("sc-annotated-text").css({whiteSpace:"pre-wrap"})}getPath(){return this.props.path}getText(){return this.getDocument().get(this.props.path)||""}isEmpty(){return!this.getText()}getAnnotations(){return this.getDocument().getIndex("annotations").get(this.props.path)}getDocument(){return this.props.doc||this.context.doc}_getTagName(){return this.props.tagName}_onDocumentChange(e){e.change&&e.change.hasUpdated(this.getPath())&&this.rerender()}_renderContent(e){let t=this.getText(),r=this.getAnnotations(),n=e(this._getTagName()||"span");if(r&&r.length>0){new Fragmenter({onText:this._renderTextNode.bind(this),onEnter:this._renderFragment.bind(this,e),onExit:this._finishFragment.bind(this)}).start(n,t,r)}else n.append(t);return n}_renderTextNode(e,t){t&&t.length>0&&e.append(t)}_renderFragment(e,t){let r=t.node;return e(this._getFragmentComponentClass(r),this._getFragmentProps(r))}_getFragmentComponentClass(e,t){let r=this.getComponent(e.type,"not-strict");return!e.isInlineNode()||r.prototype._isInlineNodeComponent||r.isCustom||(r=this.getComponent("inline-node")),r||t||(r=this._getUnsupportedInlineNodeComponentClass()),r}_getUnsupportedInlineNodeComponentClass(){return this.getComponent("annotation")}_getFragmentProps(e){return{node:e}}_finishFragment(e,t,r){r.append(t)}}class SelectionFragmentComponent extends Component{render(e){let t=e("span").addClass("se-selection-fragment");if(this.props.collaborator){let e=this.props.collaborator.colorIndex;t.addClass("sm-collaborator-"+e)}else t.addClass("sm-local-user");return t.append(this.props.children),t}}class TextPropertyComponent extends AnnotatedTextComponent{getInitialState(){const e=this.context.markersManager;let t,r=this.getPath();if(e)t=e.getMarkers(r,{surfaceId:this.getSurfaceId(),containerPath:this.getContainerPath()});else{t=this.getDocument().getAnnotations(r)}return{markers:t}}didMount(){const e=this.context.markersManager;e&&e.register(this)}dispose(){const e=this.context.markersManager;e&&e.deregister(this)}render(e){let t=this.getPath(),r=this._renderContent(e).addClass("sc-text-property").attr({"data-path":t.join(".")}).css({"white-space":"pre-wrap"});return this.isEmpty()&&(r.addClass("sm-empty"),this.props.placeholder&&r.append(e("span").addClass("se-placeholder").append(this.props.placeholder))),this.props.withoutBreak||r.append(e("br")),r}getAnnotations(){return this.props.markers?this.state.markers.concat(this.props.markers):this.state.markers}_renderFragment(e,t){let r,n=t.node,s=n.id;return"selection-fragment"===n.type?r=e(SelectionFragmentComponent,{collaborator:n.collaborator}):(r=super._renderFragment.apply(this,arguments),s&&r.ref(s+"@"+t.counter)),r.attr("data-offset",t.pos),r}getSurface(){return this.props.surface||this.context.surface}getSurfaceId(){let e=this.getSurface();return e?e.id:null}getContainerPath(){let e=this.getSurface();return e?e.getContainerPath():null}isEditable(){const e=this.getSurface();return!!e&&e.isEditable()}isReadonly(){const e=this.getSurface();return!e||e.isReadonly()}getDOMCoordinate(e){return this._getDOMCoordinate(this.el,e)}_finishFragment(e,t,r){t.attr("data-length",e.length),r.append(t)}_getDOMCoordinate(e,t){let r,n=0;if(0===t)return{container:e.getNativeElement(),offset:0};for(let s=e.getFirstChild();s;s=s.getNextSibling(),n++)if(s.isTextNode()){if((r=s.textContent.length)>=t)return{container:s.getNativeElement(),offset:t};t-=r}else if(s.isElementNode()){let o=s.getAttribute("data-length");if(!o)return console.error("FIXME: Can not map to DOM coordinates."),null;if((r=parseInt(o,10))>=t){if(s.attr("data-inline")){let t=s.getNextSibling();return t&&t.isTextNode()?{container:t.getNativeElement(),offset:0}:{container:e.getNativeElement(),offset:e.getChildIndex(s)+1}}return this._getDOMCoordinate(s,t,n)}t-=r}}get _isTextPropertyComponent(){return!0}static getCoordinate(e,t,r){let n,s=_getPropertyContext(e,t,r);if(!s)return null;if(isNumber(n=t.parentNode&&t.parentNode.is(".se-placeholder")?0:_getCharPos(s.node,s.offset))){let e=new Coordinate(s.path,n);return e._comp=s.comp,e}return null}}function _getPropertyContext(e,t,r){let n={comp:null,el:null,path:null,node:t,offset:r};for(;t&&t!==e;){if(t.isElementNode()){let e=Component.unwrap(t);if(e&&e._isTextPropertyComponent)return n.comp=e,n.el=t,n.path=e.getPath(),n;t.getAttribute("data-inline")&&(n.node=t,r>0&&(n.offset=1))}t=t.getParent()}return null}function _getCharPos(e,t){let r,n,s=t;if(r=e.getParent(),e.isTextNode())if(e===r.firstChild){let e=r.getAttribute("data-path"),n=r.getAttribute("data-offset");s=e?t:n?parseInt(n,10)+t:_getCharPos(r,0)+t}else s=_getCharPos(r,n=r.getChildIndex(e))+t;else{if(!e.isElementNode())return null;{let o=e.getAttribute("data-path"),i=e.getAttribute("data-offset");o?s=_countCharacters(e,t):i?(n=r.getChildIndex(e),s=parseInt(i,10)+_countCharacters(e,t)):s=_getCharPos(r,n=r.getChildIndex(e))+_countCharacters(e,t)}}return s}function _countCharacters(e,t){let r=0;if(e.getAttribute("data-inline"))return 0===t?0:1;let n=e.getChildCount();1===arguments.length&&(t=n),t=Math.min(n,t);for(let n=0,s=e.getFirstChild();n<t;s=s.getNextSibling(),n++)if(s.isTextNode())r+=s.getTextContent().length;else if(s.isElementNode()){let e=s.getAttribute("data-length");s.getAttribute("data-inline")?r+=1:r+=e?parseInt(e,10):_countCharacters(s)}return r}let keys$1={UNDEFINED:0,BACKSPACE:8,DELETE:46,INSERT:45,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,RETURN:13,END:35,HOME:36,TAB:9,PAGEUP:33,PAGEDOWN:34,ESCAPE:27,ESC:27,SHIFT:16,SPACE:32,PLUS:171,VOLUMEUP:183,VOLUMEDOWN:182,VOLUMEMUTE:181,PRINTSCREEN:44};for(let e=1;e<=24;e++)keys$1["F"+e]=111+e;class AbstractIsolatedNodeComponent extends Component{constructor(...e){super(...e),this.name=this.props.node.id,this._state={selectionFragment:null},this.handleAction("escape",this.escape),this.ContentClass=this._getContentClass();let t=platform.isFF||!this.ContentClass.noBlocker;this.blockingMode=t?"closed":"open"}getInitialState(){let e=this.getEditorSession().getSelection(),t=this.getEditorSession().getSelectionState();return this._deriveStateFromSelectionState(e,t)}getChildContext(){return{parentSurfaceId:this.getId(),isolatedNodeComponent:this,surface:void 0}}didMount(){super.didMount(),this.getEditorSession().onRender("selection",this._onSelectionChanged,this)}dispose(){super.dispose.call(this),this.getEditorSession().off(this)}renderContent(e,t,r={}){let n=this.ContentClass;if(n){return e(n,Object.assign(this._getContentProps(),r))}return console.error("Could not resolve a component for type: "+t.type),e(this.__elementTag)}getId(){return this._id||(this._id=this.context.parentSurfaceId+"/"+this.name),this._id}get id(){return this.getId()}getMode(){return this.state.mode}escape(){this.selectNode()}isOpen(){return"open"===this.blockingMode}isClosed(){return"closed"===this.blockingMode}isNotSelected(){return!this.state.mode}isSelected(){return"selected"===this.state.mode}isCoSelected(){return"co-selected"===this.state.mode}isFocused(){return"focused"===this.state.mode}isCoFocused(){return"co-focused"===this.state.mode}getParentSurface(){return this.context.surface}getEditorSession(){return this.context.editorSession}getSurfaceManager(){return this.context.surfaceManager}_onSelectionChanged(){const e=this.getEditorSession(),t=e.getSelection(),r=e.getSelectionState(),n=this._deriveStateFromSelectionState(t,r);!n&&this.state.mode?this.extendState({mode:null}):n&&n.mode!==this.state.mode&&this.extendState(n)}onKeydown(e){e.keyCode===keys$1.ESCAPE&&"focused"===this.state.mode&&(e.stopPropagation(),e.preventDefault(),this.escape())}_getContentClass(){const e=this.props.node;let t;return(t=this.getComponent(e.type,!0))||(t=Component),t}_getContentProps(){return{disabled:this.props.disabled,node:this.props.node,isolatedNodeState:this.state.mode,focused:"focused"===this.state.mode}}_getSurfaceForSelection(e,t){let r=t.surface;if(!r){if(e&&e.surfaceId){r=this.getSurfaceManager().getSurface(e.surfaceId)}else r=null;t.surface=r}return r}_getIsolatedNodes(e,t){let r=t.isolatedNodes;if(!r){if(r=[],e&&e.surfaceId){let t=this.getSurfaceManager().getSurface(e.surfaceId);t&&(r=t.getComponentPath().filter(e=>e._isAbstractIsolatedNodeComponent))}t.isolatedNodes=r}return r}_shouldConsumeEvent(e){let t=Component.unwrap(e.currentTarget);return this._getIsolatedNode(t)===this}_getIsolatedNode(e){return e._isAbstractIsolatedNodeComponent?this:e.context.isolatedNodeComponent?e.context.isolatedNodeComponent:e.context.surface?e.context.surface.context.isolatedNodeComponent:void 0}get _isAbstractIsolatedNodeComponent(){return!0}}const BRACKET="X",SLASH="/".charCodeAt(0);class IsolatedNodeComponent extends AbstractIsolatedNodeComponent{render(e){const t=this.props.node,r=this.ContentClass,n=this.props.disabled;let s=e("div");s.addClass(this.getClassNames()).addClass("sc-isolated-node").addClass("sm-"+this.props.node.type).attr("data-id",t.id),n&&s.addClass("sm-disabled"),this.state.mode&&s.addClass("sm-"+this.state.mode),r.noStyle||s.addClass("sm-default-style"),s.on("keydown",this.onKeydown);const o="closed"===this.blockingMode&&!this.state.unblocked;s.append(e("div").addClass("se-bracket sm-left").ref("left").append(BRACKET));let i=this.renderContent(e,t,{disabled:this.props.disabled||o}).ref("content");return i.attr("contenteditable",!1),s.append(i),s.append(e(Blocker).ref("blocker")),s.append(e("div").addClass("se-bracket sm-right").ref("right").append(BRACKET)),o||(s.addClass("sm-no-blocker"),s.on("click",this.onClick).on("dblclick",this.onDblClick)),s.on("mousedown",this._reserveMousedown,this),s}getClassNames(){return""}getContent(){return this.refs.content}selectNode(){const e=this.getEditorSession();let t={type:"node",nodeId:this.props.node.id};const r=this.getParentSurface();r&&Object.assign(t,{containerPath:r.getContainerPath(),surfaceId:r.id}),e.setSelection(t)}onClick(e){e.stopPropagation()}onDblClick(e){e.stopPropagation()}grabFocus(e){let t=this.refs.content;if(t.grabFocus)return t.grabFocus(e),!0}_reserveMousedown(e){e.__reserved__||(e.__reserved__=this)}_deriveStateFromSelectionState(e,t){const r=this._getSurfaceForSelection(e,t),n=this.getParentSurface();let s={mode:null,unblocked:null};if(!r)return s;if(r===n){let t=this.props.node.id;e.isNodeSelection()&&e.getNodeId()===t&&(e.isFull()?(s.mode="selected",s.unblocked=!0):e.isBefore()?(s.mode="cursor",s.position="before"):e.isAfter()&&(s.mode="cursor",s.position="after")),e.isContainerSelection()&&e.containsNode(t)&&(s.mode="co-selected")}else{let t=e.surfaceId,r=this.getId();if(r.length<t.length&&t.startsWith(r)&&t.charCodeAt(r.length)===SLASH){t.slice(r.length+1).indexOf("/")>0?(s.mode="co-focused",s.unblocked=!0):(s.mode="focused",s.unblocked=!0)}}return s}get _isIsolatedNodeComponent(){return!0}static getDOMCoordinate(e,t){let{start:r,end:n}=IsolatedNodeComponent.getDOMCoordinates(e);return 0===t.offset?r:n}static getDOMCoordinates(e){const t=e.refs.left,r=e.refs.right;return{start:{container:t.getNativeElement(),offset:0},end:{container:r.getNativeElement(),offset:r.getChildCount()}}}static getCoordinate(e,t){let r,n=Component.unwrap(e,"strict").context.isolatedNodeComponent,s=null;return"left"===t.direction||e===n.refs.left.el?s=0:"right"!==t.direction&&e!==n.refs.right.el||(s=1),null!==s&&((r=new Coordinate([n.props.node.id],s))._comp=n),r}}class Blocker extends Component{render(e){return e("div").addClass("sc-isolated-node-blocker").attr("draggable",!0).attr("contenteditable",!1).on("click",this.onClick).on("dblclick",this.onDblClick)}onClick(e){if(e.target!==this.getNativeElement())return;e.stopPropagation();const t=this._getIsolatedNodeComponent();t.extendState({mode:"selected",unblocked:!0}),t.selectNode()}onDblClick(e){e.stopPropagation()}_getIsolatedNodeComponent(){return this.context.isolatedNodeComponent}}const DEBUG$1=!1;class DOMSelection{constructor(e){this.editor=e,platform.inBrowser&&(this.wRange=window.document.createRange()),this.state={dom:null,model:null}}getSelection(e){if(!platform.inBrowser)return;let t=this.mapDOMSelection(e);return this.editor.getDocument()._createSelectionFromRange(t)}getSelectionForDOMRange(e){let t=this.mapDOMRange(e);return this.editor.getDocument()._createSelectionFromRange(t)}mapDOMSelection(e){let t,r=window.getSelection(),n=this.state;if(DEBUG$1&&console.info("DOM->Model: ",r.anchorNode,r.anchorOffset,r.focusNode,r.focusOffset),0===r.rangeCount)return o();let s=DefaultDOMElement.wrapNativeElement(r.anchorNode);if(r.isCollapsed){let n=this._getCoordinate(s,r.anchorOffset,e);if(!n)return o();t=_createRange({start:n,end:n})}else{let n=DefaultDOMElement.wrapNativeElement(r.focusNode);t=this._getRange(s,r.anchorOffset,n,r.focusOffset,e)}return DEBUG$1&&console.info("DOM->Model: range ",t?t.toString():null),n.model=t,t;function o(){return n.dom=null,n.model=null,null}}setSelection(e){if(!platform.inBrowser)return;let t=this.state,r=window.getSelection(),n=this.wRange;if(!e||e.isNull())return this.clear();let{start:s,end:o}=this.mapModelToDOMCoordinates(e);if(!s)return this.clear();e.isReverse()&&([s,o]=[o,s]),t.dom={anchorNode:s.container,anchorOffset:s.offset,focusNode:o.container,focusOffset:o.offset},function({anchorNode:e,anchorOffset:t,focusNode:s,focusOffset:o}){r.removeAllRanges(),n.setStart(e,t),n.setEnd(e,t),r.addRange(n),(s!==t||o!==t)&&r.extend(s,o)}(t.dom)}mapModelToDOMCoordinates(e){let t;DEBUG$1&&console.info("Model->DOM: sel =",e.toString());let r,n,s=this.editor.getSurfaceManager().getSurface(e.surfaceId);if(s?t=s.el:(console.warn("No surface:",e.surfaceId),t=this.editor.getElement()),e.isNull()||e.isCustomSelection())return{};if(e.isPropertySelection()||e.isContainerSelection()){if(!(r=this._getDOMCoordinate(t,e.start)))return console.warn("FIXME: selection seems to be invalid."),{};if(e.isCollapsed())n=r;else if(!(n=this._getDOMCoordinate(t,e.end)))return console.warn("FIXME: selection seems to be invalid."),{}}else if(e.isNodeSelection()){let s=Component.unwrap(t.find('*[data-id="'+e.getNodeId()+'"]'));if(!s)return console.error("Could not find component with id",e.getNodeId()),{};if(s._isIsolatedNodeComponent){let t=IsolatedNodeComponent.getDOMCoordinates(s,e);r=t.start,n=t.end}else{let e=s.el;r={container:e.getNativeElement(),offset:0},n={container:e.getNativeElement(),offset:e.getChildCount()}}}return DEBUG$1&&console.info("Model->DOM:",r.container,r.offset,n.container,n.offset,"isReverse?",e.isReverse()),{start:r,end:n}}_getDOMCoordinate(e,t){let r,n=null;if(t.isNodeCoordinate()){if(r=Component.unwrap(e.find('*[data-id="'+t.getNodeId()+'"]')))if(r._isIsolatedNodeComponent)n=IsolatedNodeComponent.getDOMCoordinate(r,t);else{let e=0;t.offset>0&&(e=r.getChildCount()),n={container:r.getNativeElement(),offset:e}}}else(r=Component.unwrap(e.find('.sc-text-property[data-path="'+t.path.join(".")+'"]')))&&(n=r.getDOMCoordinate(t.offset));return n}mapDOMRange(e,t){return this._getRange(DefaultDOMElement.wrapNativeElement(e.startContainer),e.startOffset,DefaultDOMElement.wrapNativeElement(e.endContainer),e.endOffset,t)}clear(){window.getSelection().removeAllRanges(),this.state.dom=null,this.state.model=null}collapse(e){let t,r=window.getSelection();r.rangeCount>0&&((t=r.getRangeAt(0)).collapse("left"===e),r.removeAllRanges(),r.addRange(t))}select(e){let t=window.getSelection(),r=window.document.createRange();r.selectNode(e.getNativeElement()),t.removeAllRanges(),t.addRange(r)}extend(e,t){window.getSelection().extend(e.getNativeElement(),t)}setCursor(e,t){let r=window.getSelection(),n=window.document.createRange();n.setStart(e.getNativeElement(),t),r.removeAllRanges(),r.addRange(n)}_getRange(e,t,r,n,s={}){let o,i,a=DefaultDOMElement.isReverse(e,t,r,n);return e===r&&t===n?o=i=this._getCoordinate(e,t,s):(o=this._getCoordinate(e,t,{direction:a?"right":"left"}),i=this._getCoordinate(r,n,s)),o&&i?_createRange({start:o,end:i,isReverse:a}):null}_getCoordinate(e,t,r={}){let n=null;n||(n=TextPropertyComponent.getCoordinate(this.editor.getElement(),e,t));let s=Component.unwrap(e);if(!n&&s&&s.context.isolatedNodeComponent&&(n=IsolatedNodeComponent.getCoordinate(e,r)),!n)if(s&&s._isContainerEditor){let e=0===t?0:t-1,r=0===t,o=s.getDocument(),i=s.getContainerPath(),a=o.get(i),l=o.get(a[e]),c=s.getChildAt(e);(n=new Coordinate([l.id],r?0:1))._comp=c}else if(e.isElementNode()&&e.getChildCount()>0){let r,s=t>0?e.getChildAt(t-1):e.firstChild,o=Component.unwrap(s);o&&o._isTextPropertyComponent&&(r=s),r&&(n=TextPropertyComponent.getCoordinate(e,r,t>0?r.getChildCount():0))}return n}}function _createRange({start:e,end:t,isReverse:r}){if(r&&([e,t]=[t,e]),!e._comp||!t._comp)return console.error("FIXME: getCoordinate() should provide a component instance"),null;let n=e._comp.context.surface;return n?n!==t._comp.context.surface?(console.error("Coordinates are within two different surfaces. Can not create a selection."),null):new Range(e,t,r,n.getContainerPath(),n.id):(console.error("FIXME: Editable components should have their surface in the context"),null)}class DeprecatedResourceManager{constructor(e,t){this.editorSession=e,this.context=t,this.editorSession.onRender("document",this._onDocumentChange,this)}dispose(){this.editorSession.off(this)}triggerFetch(e){e.fetchPayload(this.context,(t,r)=>{t?this._updateNode(e.id,{errorMessage:t.toString()}):this._updateNode(e.id,r)})}_onDocumentChange(e){let t=this.editorSession.getDocument();forEach(e.created,(e,r)=>{let n=t.get(r);n.constructor.isResource&&setTimeout(()=>{this.triggerFetch(n)})})}_updateNode(e,t){this.editorSession.transaction(r=>{forEach(t,(t,n)=>{r.set([e,n],t)})})}}class DeprecatedAbstractEditor extends Component{constructor(...e){super(...e),this._initialize(this.props)}didMount(){this.getEditorSession().attachEditor(this)}dispose(){this._dispose()}_initialize(e){const t=e.editorSession;if(!t)throw new Error("EditorSession instance required");this.editorSession=t,this.doc=t.getDocument();let r=t.getConfigurator();this.componentRegistry=r.getComponentRegistry(),this.commandGroups=r.getCommandGroups(),this.keyboardShortcuts=r.getKeyboardShortcutsByCommand(),this.tools=r.getTools(),this.labelProvider=r.getLabelProvider(),this.iconProvider=r.getIconProvider(),this.surfaceManager=t.surfaceManager,this.commandManager=t.commandManager,this.dragManager=t.dragManager,this.macroManager=t.macroManager,this.converterRegistry=t.converterRegistry,this.globalEventHandler=t.globalEventHandler,this.editingBehavior=t.editingBehavior,this.markersManager=t.markersManager,this.resourceManager=new DeprecatedResourceManager(t,this.getChildContext()),this.domSelection=new DOMSelection(this),this.labelProvider.setLanguage(t.getLanguage()),t.onUpdate("lang",e=>{this.labelProvider.setLanguage(e)},this),t.onRender("lang",this.rerender,this)}willReceiveProps(e){let t=e.editorSession;t&&t!==this.editorSession&&(this._dispose(),this._initialize(e))}_dispose(){const e=this.getEditorSession();e.off(this),e.detachEditor(this),this.empty(),this.resourceManager.dispose()}getChildContext(){return{editor:this,editorSession:this.editorSession,configurator:this.editorSession.getConfigurator(),doc:this.doc,document:this.doc,componentRegistry:this.componentRegistry,surfaceManager:this.surfaceManager,domSelection:this.domSelection,commandManager:this.commandManager,markersManager:this.markersManager,converterRegistry:this.converterRegistry,dragManager:this.dragManager,editingBehavior:this.editingBehavior,globalEventHandler:this.globalEventHandler,iconProvider:this.iconProvider,labelProvider:this.labelProvider,resourceManager:this.resourceManager,commandGroups:this.commandGroups,tools:this.tools,keyboardShortcuts:this.keyboardShortcuts}}onKeyDown(e){if("Dead"===e.key)return;return this.editorSession.keyboardManager.onKeydown(e)}getDocument(){return this.editorSession.getDocument()}getConfigurator(){return this.editorSession.getConfigurator()}getEditorSession(){return this.editorSession}getComponentRegistry(){return this.componentRegistry}getSurfaceManager(){return this.surfaceManager}getLabelProvider(){return this.labelProvider}}const PLAINOBJ={};class DeprecatedRegistry{constructor(e,t){this.entries={},this.names=[],this.validator=t,e&&forEach(e,function(e,t){this.add(t,e)}.bind(this))}contains(e){return this.entries.hasOwnProperty(e)}add(e,t){if(this.validator&&this.validator(t),PLAINOBJ[e])throw new Error('Illegal key: "'+e+'" is a property of Object which is thus not allowed as a key.');this.contains(e)&&this.remove(e),this.entries[e]=t,this.names.push(e)}remove(e){let t=this.names.indexOf(e);t>=0&&this.names.splice(t,1),delete this.entries[e]}clear(){this.names=[],this.entries={}}get(e,t){let r=this.entries[e];if(t&&!r)throw new Error("No entry registered for name "+e);return r}forEach(e){for(let t=0;t<this.names.length;t++){let r=this.names[t];if(!1===e(this.entries[r],r))break}}map(e){let t=[];return this.forEach((r,n)=>{t.push(e(r,n))}),t}filter(e){let t=[];return this.forEach(function(r,n){e(r,n)&&t.push(r)}),t}values(){return this.filter(()=>!0)}get _isRegistry(){return!0}}class DeprecatedCommandManager{constructor(e,t){if(!e.editorSession)throw new Error("EditorSession required.");this.editorSession=e.editorSession,this.commands=t,this.context=Object.assign({},e,{doc:this.editorSession.getDocument()}),this._initialize(),this.editorSession.on("pre-render",this._onSessionUpdate,this),this._updateCommandStates(this.editorSession)}dispose(){this.editorSession.off(this)}executeCommand(e,t,r){let n=this._getCommand(e);if(!n)return void console.warn("command",e,"not registered");let s=this.editorSession.getCommandStates()[e],o=Object.assign(this._getCommandParams(),t,{commandState:s});if(!n.isAsync){return n.execute(o,this._getCommandContext())}this.editorSession.lock(),n.execute(o,this._getCommandContext(),(e,t)=>{e?r?r(e):console.error(e):r&&r(null,t),this.editorSession.unlock()})}_initialize(){this.commandRegistry=new DeprecatedRegistry,forEach(this.commands,e=>{this.commandRegistry.add(e.name,e)})}_getCommand(e){return this.commandRegistry.get(e)}_updateCommandStates(e){const t=this._getCommandContext(),r=this._getCommandParams(),n=r.surface,s=this.commandRegistry;let o={},i=s.names.slice();if(i.forEach(e=>{o[e]={disabled:!0}}),n){let e=n.props.commands,t=n.props.excludedCommands;e?i=e.filter(e=>s.contains(e)):t&&(i=without(i,...t))}i.map(e=>s.get(e)).forEach(e=>{e&&(o[e.getName()]=e.getCommandState(r,t))}),this.commandStates=o,e.setCommandStates(o)}_onSessionUpdate(){const e=this.editorSession;(e.hasChanged("change")||e.hasChanged("selection")||e.hasChanged("commandStates"))&&this._updateCommandStates(e)}_getCommandContext(){return this.context}_getCommandParams(){let e=this.context.editorSession;return{editorSession:e,selectionState:e.getSelectionState(),selection:e.getSelection(),surface:e.getFocusedSurface()}}}class NodeRegistry extends DeprecatedRegistry{register(e){var t=e.prototype.type;if(!isString(t)||!t)throw new Error("Node type must be string and not empty");if(!e.prototype._isNode)throw new Error("Nodes must be subclasses of Substance.Data.Node");this.contains(t)&&(console.info("Overriding node type",t),this.remove(t)),this.add(t,e)}}class NodeProperty{constructor(e,t){this.name=e,this.definition=t,Object.freeze(this),Object.freeze(t)}isArray(){return isArray(this.definition.type)}isReference(){return this.isArray()?"id"===last$1(this.definition.type):"id"===this.definition.type}isText(){return Boolean(this.definition._isText)}isContainer(){return Boolean(this.definition._isContainer)}isOwned(){return Boolean(this.definition.owned)}isOptional(){return this.definition.optional||this.hasDefault()}isNotNull(){return Boolean(this.definition.notNull)}hasDefault(){return this.definition.hasOwnProperty("default")}getDefault(){return this.definition.default}createDefaultValue(){if(isArray(this.definition.type))return[];switch(this.definition.type){case"boolean":return!1;case"string":return"";case"number":return-1;case"object":return{};case"coordinate":return new Coordinate([],0);default:return null}}get type(){return this.definition.type}get targetTypes(){return this.definition.targetTypes}get defaultTextType(){return this.definition.defaultTextType}get values(){return this.definition.values}}class NodeSchema{constructor(e,t){this._properties=e,this._superTypes=t,this._ownedPropNames=new Set,this._ownedProps=[];for(let t of e.values())(t.isReference()&&t.isOwned()||"file"===t.type)&&(this._ownedPropNames.add(t.name),this._ownedProps.push(t))}getProperty(e){return this._properties.get(e)}hasOwnedProperties(){return this._ownedPropNames.size>0}getOwnedProperties(){return this._ownedProps.slice()}isOwned(e){return this._ownedPropNames.has(e)}getSuperType(){return this._superTypes[0]}getSuperTypes(){return this._superTypes.slice()}[Symbol.iterator](){return this._properties.values()}}const VALUE_TYPES=new Set(["id","string","number","boolean","enum","object","array","coordinate"]);class Node extends EventEmitter{constructor(...e){super(),this._properties={},this._initialize(...e)}_initialize(e){let t=this.constructor.schema;for(let r of t){let t=r.name;const n=void 0!==e[t],s=r.isOptional(),o=r.hasDefault();if(!s&&!n)throw new Error("Property "+t+" is mandatory for node type "+this.type);n?this._properties[t]=_checked(r,e[t]):o&&(this._properties[t]=cloneDeep(_checked(r,r.getDefault())))}}dispose(){this._disposed=!0}isDisposed(){return Boolean(this._disposed)}isInstanceOf(e){return Node.isInstanceOf(this.constructor,e)}getSchema(){return this.constructor.schema}getTypeNames(){let e=this.constructor,t=this.schema.getSuperTypes();return e.hasOwnProperty("type")&&t.unshift(e.type),t}getPropertyType(e){return this.constructor.schema.getProperty(e).type}toJSON(){var e={type:this.type};const t=this.getSchema();for(let r of t){let t=this[r.name];r.isOptional()&&void 0===t||((isArray(t)||isObject(t))&&(t=cloneDeep(t)),e[r.name]=t)}return e}get type(){return this.constructor.type}_set(e,t){this._properties[e]=t}static isInstanceOf(e,t){let r=e.schema;if(!r)return!1;if(e.type===t)return!0;for(let e of r._superTypes)if(e===t)return!0;return!1}get _isNode(){return!0}static _defineSchema(e){Node.schema=e}}function _assign(e){let t=new Map;for(let r of e)for(let[e,n]of r)t.has(e)&&t.delete(e),t.set(e,n);return t}function compileSchema(e,t){let r=[_compileSchema(t)],n=_getParentClass(e);for(;n;)n&&n._schema&&r.unshift(n._schema._properties),n=_getParentClass(n);let s=_getSuperTypes(e),o=new NodeSchema(_assign(r),s);for(let t of o){let r=t.name;Object.defineProperty(e.prototype,r,{get(){return this._properties[r]},set(e){this.set(r,e)},enumerable:!0,configurable:!0})}return o}function _compileSchema(e){let t=new Map;return forEach(e,function(e,r){"type"!==r&&((e=_compileDefintion(e=isString(e)||isArray(e)?{type:e}:cloneDeep(e))).name=r,t.set(r,new NodeProperty(r,e)))}),t}function _isValueType(e){return VALUE_TYPES.has(e)}function _compileDefintion(e){let t=Object.assign({},e),r=e.type;if(isArray(r)){let e=r,n=e.length-1,s=e[0],o=e[n];"array"===s?(t.type=e.slice(),"id"===o||_isValueType(o)||(t.targetTypes=[o],t.type[n]="id")):e.length>1?(e.forEach(e=>{if(_isValueType(e))throw new Error("Multi-types must consist of node types.")}),t.type=["array","id"],t.targetTypes=e):_isValueType(s)?t.type=["array",s]:(t.type=["array","id"],t.targetTypes=e)}else"text"===r?t={type:"string",default:"",_isText:!0,targetTypes:e.targetTypes}:"id"===r||_isValueType(r)||(t.type="id",t.targetTypes=[r]);return t}function _checked(e,t){let r,n=e.name;if(r=e.isArray()?"array":e.type,null===t){if(e.isNotNull())throw new Error("Value for property "+n+" is null.");return t}if(void 0===t)throw new Error("Value for property "+n+" is undefined.");if("string"===r&&!isString(t)||"enum"===r&&!isString(t)||"boolean"===r&&!isBoolean(t)||"number"===r&&!isNumber(t)||"array"===r&&!isArray(t)||"id"===r&&!isString(t)||"object"===r&&!isObject(t))throw new Error("Illegal value type for property "+n+": expected "+r+", was "+typeof t);return t}function _getSuperTypes(e){var t=[];let r=_getParentClass(e);for(;r&&"@node"!==r.type;)r.hasOwnProperty("type")&&t.push(r.type),r=_getParentClass(r);return t}function _getParentClass(e){var t=Object.getPrototypeOf(e.prototype);if(t)return t.constructor}Object.defineProperty(Node,"schema",{get(){let e=this;if(!e.hasOwnProperty("_schema")){let t=_getParentClass(e).schema;e._schema=new NodeSchema(t._properties,_getSuperTypes(e))}return e._schema},set(e){let t=this;e.type&&(t.type=e.type),t._schema=compileSchema(t,e)}}),Node.schema={type:"@node",id:"string"};class Schema{constructor(e){arguments.length>1&&(console.warn('DEPRECATED: use "new Schema(options)" instead'),e={name:arguments[0],version:arguments[1]}),this.name=e.name,this.version=e.version,this.nodeRegistry=new NodeRegistry,this.addNodes(this.getBuiltIns()),e.nodes&&this.addNodes(e.nodes)}addNodes(e){e&&forEach(e,e=>{e.prototype._isNode?this.addNode(e):console.error("Illegal node class: ",e)})}addNode(e){this.nodeRegistry.register(e)}getNodeClass(e,t){return this.nodeRegistry.get(e,t)}getBuiltIns(){return[]}isInstanceOf(e,t){var r=this.getNodeClass(e);return!!r&&Node.isInstanceOf(r,t)}each(...e){return this.nodeRegistry.each(...e)}getDefaultTextType(){throw new Error("Schmema.prototype.getDefaultTextType() must be overridden.")}getNodeSchema(e){var t=this.getNodeClass(e);return t?t.schema:(console.error("Unknown node type ",e),null)}}class XPathNode{constructor(e,t){this.id=e,this.type=t,this.prev=null,this.property=null,this.pos=null}toJSON(){let e={id:this.id,type:this.type};return this.property&&(e.property=this.property),isNumber(this.pos)&&(e.pos=this.pos),e}toArray(){let e=[this.toJSON()],t=this;for(;t.prev;)t=t.prev,e.unshift(t.toJSON());return e}}class DocumentNodeSelectAdapter extends domUtils.DomUtils{isTag(){return!0}getChildren(e){return getChildren(e)}getParent(e){return getParent(e)}getAttributeValue(e,t){return e[t]}getAttributes(e){return["id",e.id]}hasAttrib(e,t){return"id"===t||e.hasOwnProperty(t)}getName(e){return e.type}getNameWithoutNS(e){return this.getName(e)}getText(e){return e.isText()?e.getText():""}}const cssSelectAdapter=new DocumentNodeSelectAdapter;class DocumentNode extends Node{_initialize(e,t){this.document=e,super._initialize(t),this._xpath=new XPathNode(this.id,this.type)}getDocument(){return this.document}resolve(e){let t=this[e];if(t){let e=this.getDocument();return isArray(t)?t.map(t=>e.get(t)):e.get(t)}}set(e,t){this.getDocument().set([this.id,e],t)}assign(e){e&&Object.keys(e).forEach(t=>{this.set(t,e[t])})}hasParent(){return Boolean(this.parent)}getParent(){return isString(this.parent)?this.document.get(this.parent):this.parent}setParent(e){isString(e)&&(e=this.document.get(e)),this.parent=e}getRoot(){let e=this;for(;e.parent;)e=e.parent;return e}find(e){return cssSelect.selectOne(e,this,{xmlMode:!0,adapter:cssSelectAdapter})}findAll(e){return cssSelect.selectAll(e,this,{xmlMode:!0,adapter:cssSelectAdapter})}getXpath(){return this._xpath}getPosition(){return this._xpath.pos}isAnchor(){return this.constructor.isAnchor()}isAnnotation(){return this.constructor.isAnnotation()}isBlock(){return this.constructor.isBlock()}isContainer(){return this.constructor.isContainer()}isContainerAnnotation(){return this.constructor.isContainerAnnotation()}isInlineNode(){return this.constructor.isInlineNode()}isList(){return this.constructor.isList()}isListItem(){return this.constructor.isListItem()}isPropertyAnnotation(){return this.constructor.isPropertyAnnotation()}isText(){return this.constructor.isText()}static isAnchor(){return!1}static isAnnotation(){return!1}static isBlock(){return!1}static isContainer(){return!1}static isContainerAnnotation(){return!1}static isInlineNode(){return!1}static isList(){return!1}static isListItem(){return!1}static isPropertyAnnotation(){return!1}static isText(){return!1}get _isDocumentNode(){return!0}}function ContainerMixin(e){return class extends e{getContentPath(){throw new Error("This method is abstract")}getContent(){return this.getDocument().get(this.getContentPath())}contains(e){return this.getChildIndex(e)>=0}getNodeAt(e){const t=this._getNodeIdAt(e);if(t)return this.getDocument().get(t)}getNodes(){const e=this.getDocument();return this.getContent().map(t=>e.get(t)).filter(Boolean)}getNodeIndex(e){return this.getContent().indexOf(e)}getPath(){return this.getContentPath()}append(e){const t=arguments[0];return isString(t)||t._isNode&&(e=t.id),this.insertAt(this.length,e)}insertAt(e,t){const r=this.getDocument(),n=this.length;if(!isNumber(e)||e<0||e>n)throw new Error("Index out of bounds");if(!isString(t)){if(!t._isNode)throw new Error("Invalid argument.");t=t.id}r.update(this.getContentPath(),{type:"insert",pos:e,value:t})}remove(e){const t=getContainerPosition(this.getDocument(),this.getContentPath(),e);this.removeAt(t)}removeAt(e){const t=this.length;if(!(e>=0&&e<t))throw new Error("Index out of bounds.");this.getDocument().update(this.getContentPath(),{type:"delete",pos:e})}get length(){return this.getLength()}getLength(){return this.getContent().length}_getNodeIdAt(e){let t=this.getContent();return e<0||e>=t.length?void 0:t[e]}static isContainer(){return!0}}}class Container extends(ContainerMixin(DocumentNode)){getContentPath(){return[this.id,"nodes"]}getContent(){return this.nodes}}function AnnotationMixin(e){class t extends e{constructor(e,t){super(e,_normalizedProps(t)),this._properties.start=new Coordinate(this.start),this._properties.end=new Coordinate(this.end)}get path(){return console.warn("DEPRECATED: use annotation.start.path instead"),this.start.path}getPath(){return this.start.path}get startPath(){return console.warn("DEPRECATED: use annotation.start.path instead."),this.start.path}set startPath(e){console.warn("DEPRECATED: use annotation.start.path instead."),this.start.path=e}get startOffset(){return console.warn("DEPRECATED: use annotation.start.offset instead."),this.start.offset}set startOffset(e){console.warn("DEPRECATED: use annotation.start.offset instead."),this.start.offset=e}get endPath(){return console.warn("DEPRECATED: use annotation.end.path instead."),this.end.path}set endPath(e){console.warn("DEPRECATED: use annotation.end.path instead."),this.end.path=e}get endOffset(){return console.warn("DEPRECATED: use annotation.end.offset instead."),this.end.offset}set endOffset(e){console.warn("DEPRECATED: use annotation.end.offset instead."),this.end.offset=e}getText(){var e=this.getDocument();return e?getTextForSelection(e,this.getSelection()):(console.warn("Trying to use a Annotation which is not attached to the document."),"")}isAnnotation(){return!0}canSplit(){return!0}getSelection(){const e=this.getDocument();return e?this.isContainerAnnotation()?e.createSelection({type:"container",containerPath:this.containerPath,startPath:this.start.path,startOffset:this.start.offset,endPath:this.end.path,endOffset:this.end.offset}):this.getDocument().createSelection({type:"property",path:this.start.path,startOffset:this.start.offset,endOffset:this.end.offset}):(console.warn("Trying to use a ContainerAnnotation which is not attached to the document."),Selection.nullSelection())}_updateRange(e,t){if(t.isContainerSelection())isEqual(this.start.path,t.start.path)||e.set([this.id,"start","path"],t.start.path),this.start.offset!==t.start.offset&&e.set([this.id,"start","offset"],t.start.offset),isEqual(this.end.path,t.end.path)||e.set([this.id,"end","path"],t.end.path),this.end.offset!==t.end.offset&&e.set([this.id,"end","offset"],t.end.offset);else{if(!t.isPropertySelection())throw new Error("Invalid selection.");isArrayEqual(this.start.path,t.start.path)||e.set([this.id,"path"],t.start.path),this.start.offset!==t.start.offset&&e.set([this.id,"start","offset"],t.start.offset),this.end.offset!==t.end.offset&&e.set([this.id,"end","offset"],t.end.offset)}}static isAnnotation(){return!0}}return t.schema={start:{type:"coordinate",default:{path:[],offset:0}},end:{type:"coordinate",default:{path:[],offset:0}}},t}function _normalizedProps(e){if(e.hasOwnProperty("start"))e.hasOwnProperty("end")&&!e.end.path&&(e.end.path=e.start.path);else{let t,r;(e.hasOwnProperty("startPath")||e.hasOwnProperty("path"))&&(t={path:e.startPath||e.path,offset:e.startOffset}),(e.hasOwnProperty("endPath")||e.hasOwnProperty("endOffset"))&&(r={path:e.endPath||e.path,offset:e.endOffset}),t&&!r&&(r=cloneDeep(t)),t&&(delete(e=Object.assign({},e)).path,delete e.startPath,delete e.endPath,delete e.startOffset,delete e.endOffset,e.start=t,e.end=r)}return e}Container.schema={type:"@container",nodes:{type:["array","id"],default:[],owned:!0}};class PropertyAnnotation extends(AnnotationMixin(DocumentNode)){get _isAnnotation(){return!0}get _isPropertyAnnotation(){return!0}static isPropertyAnnotation(){return!0}static get autoExpandRight(){return!0}}PropertyAnnotation.schema={type:"@annotation",_content:{type:"string",optional:!0}};class ContainerAnnotation extends(AnnotationMixin(DocumentNode)){setHighlighted(e,t){this.highlighted!==e&&(this.highlighted=e,this.highlightedScope=t,this.emit("highlighted",e,t),forEach(this.fragments,function(r){r.emit("highlighted",e,t)}))}static isAnnotation(){return!0}static isContainerAnnotation(){return!0}}ContainerAnnotation.schema={type:"@container-annotation",containerPath:{type:["array","id"]},start:"coordinate",end:"coordinate"};class DocumentSchema extends Schema{constructor(e){if(super(e),!e.DocumentClass)throw new Error("DocumentClass is mandatory");Object.assign(this,e)}getDocumentClass(){return this.DocumentClass}getDefaultTextType(){return this.defaultTextType}getBuiltIns(){return[DocumentNode,PropertyAnnotation,Container,ContainerAnnotation]}}class ComponentRegistry extends DeprecatedRegistry{constructor(e){super(e,function(e){if(!e.prototype._isComponent)throw new Error("Component registry: wrong type. Expected a ComponentClass. Was: "+String(e))})}}class FontAwesomeIcon extends Component{render(e){return this.props.stack?e("span").addClass("fa-stack").append(this.props.stack.map(t=>e("i").addClass("fa "+t+" fa-stack"))):e("i").addClass("fa "+this.props.icon)}}class FontAwesomeIconProvider{constructor(e){this.faMap={},this.textMap={},forEach(e,(e,t)=>{let r=e.fontawesome;r&&(isString(r)&&(r={icon:r}),this.addFAIcon(t,r));let n=e.text;n&&this.addTextIcon(t,n)})}renderIcon(e,t){let r=this.faMap[t],n=this.textMap[t];return r?e(FontAwesomeIcon,r):n||void 0}addFAIcon(e,t){this.faMap[e]=t}addTextIcon(e,t){this.textMap[e]=t}}class DefaultLabelProvider{constructor(e,t){this.lang=t||"en",this.labels=e}getLabel(e,t){let r=this.labels[this.lang];if(!r)return e;let n=r[e]||e;return t?this._evalTemplate(n,t):n}setLanguage(e){this.lang=e||"en"}_evalTemplate(e,t){return this._extractVariables(e).forEach(r=>{let n=new RegExp(`\\\${${r}}`,"g"),s=t[r];e=e.replace(n,s)}),e}_extractVariables(e){let t,r=/\${(\w+)}/g,n=[];for(;t=r.exec(e);)n.push(t[1]);return n}}function getDOMRangeFromEvent(e){let t,r=e.clientX,n=e.clientY;if(document.body.createTextRange)(t=document.body.createTextRange()).moveToPoint(r,n);else if(!isNil(document.createRange))if(isNil(e.rangeParent))if(document.caretPositionFromPoint){let e=document.caretPositionFromPoint(r,n);(t=document.createRange()).setStart(e.offsetNode,e.offset),t.collapse(!0)}else document.caretRangeFromPoint&&(t=document.caretRangeFromPoint(r,n));else(t=document.createRange()).setStart(e.rangeParent,e.rangeOffset),t.collapse(!0);return t}function getRelativeRect(e,t){var r=t.left-e.left,n=t.top-e.top;return{left:r,top:n,right:e.width-r-t.width,bottom:e.height-n-t.height,width:t.width,height:t.height}}function getSelectionRect(e){if(platform.inBrowser){const t=window.getSelection();if(0===t.rangeCount)return;const r=t.getRangeAt(0);let n=e,s=r.getBoundingClientRect();if(0===s.top&&0===s.bottom){let e=_fixCorruptDOMSelection(t,r);e&&(s=e)}return getRelativeRect(n,s)}}function _fixCorruptDOMSelection(e,t){let r=e.anchorNode;if(!r||!r.getBoundingClientRect)return;let n=r.getBoundingClientRect();return{left:n.left,top:n.top,width:0,height:n.height,right:n.width,bottom:n.bottom}}function isMouseInsideDOMSelection(e){let t=window.getSelection();if(0===t.rangeCount)return!1;let r=t.getRangeAt(0).getBoundingClientRect();return e.clientX>=r.left&&e.clientX<=r.right&&e.clientY>=r.top&&e.clientY<=r.bottom}function getQueryStringParam(e,t){if("undefined"==typeof window)return null;let r=t||window.location.href,n=new RegExp("[?&]"+e+"=([^&#]*)","i").exec(r);return n?decodeURIComponent(n[1]):null}function setDOMSelection(e,t,r,n){let s=window.getSelection(),o=window.document.createRange();e._isDOMElement&&(e=e.getNativeElement()),r||(r=e,n=t),r._isDOMElement&&(r=r.getNativeElement()),o.setStart(e,t),o.setEnd(r,n),s.removeAllRanges(),s.addRange(o)}class DragAndDropHandler{match(e,t){return!1}drop(e,t){}get _isDragAndDropHandler(){return!0}}class DeprecatedDragManager extends EventEmitter{constructor(e,t){super(),this.context=t;let r=[],n=[];e.forEach(e=>{switch(e.type||"drop-asset"){case"drop-asset":r.push(e);break;case"move-inline":n.push(e);break;default:console.warn("Unknown type of drop handler.",e)}}),this.dropHandlers=[new MoveInline(n),new MoveBlockNode,new InsertNodes(r,this.context),new CustomHandler],platform.inBrowser&&(this.el=DefaultDOMElement.wrapNativeElement(document),this.el.on("dragstart",this.onDragStart,this),this.el.on("drop",this.onDragEnd,this),this.el.on("dragenter",this.onDragEnter,this),this.el.on("dragexit",this.onDragExit,this),this.el.on("mousedown",this.onMousedown,this))}dispose(){this.el&&this.el.off(this)}onDragStart(e){this._initDrag(e,{external:!1});var t=document.createElement("img");t.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",e.dataTransfer.setDragImage(t,0,0),"inline"===this.dragState.mode?e.dataTransfer.setData("text/html",t.outerHTML):e.dataTransfer.setData("text/html","<div></div>")}onDragEnter(e){this.dragState||this._initDrag(e,{external:!0})}onDragEnd(e){e.__reserved__||this.dragState&&(e.stopPropagation(),e.preventDefault(),this._onDragEnd(e))}onDragExit(e){platform.isFF||this._onDragEnd(e)}extendDragState(e){Object.assign(this.dragState,e)}onMousedown(e){this.dragState&&(this.dragState=null,this._onDragEnd(e))}_onDragEnd(e){this.dragState?this._handleDrop(e):console.warn("Not in a valid drag state."),this.emit("drag:finished"),this.dragState=null}_handleDrop(e){let t,r,n=this.dragState,s=!1;for(n.event=e,n.data=this._getData(e),t=0;t<this.dropHandlers.length&&!s;t++)s=(r=this.dropHandlers[t]).match(n);if(s){this.context.editorSession.transaction(e=>{r.drop(e,n)})}else console.error("No drop handler could be found.")}_initDrag(e,t){let r=this._getSelection(),n=Object.assign({startEvent:e},t);if(this.dragState=n,n.external)return n.selectionDrag=!1,n.sourceSelection=null,n.scrollPanes=this._getSurfacesGroupedByScrollPane(),void this.emit("drag:started",n);if((r.isPropertySelection()||r.isContainerSelection())&&isMouseInsideDOMSelection(e))return r.isContainerSelection()?(console.warn("Dragging of ContainerSelection is not supported yet."),a()):(n.inline=!0,n.selectionDrag=!0,void(n.sourceSelection=r));let s,o=Component.unwrap(e.target);if(!o)return a();if(o._isInlineNodeComponent?(s=o,n.inline=!0,n.sourceNode=o.props.node):s=o.context.isolatedNodeComponent,!s)return a();let i=s.context.surface;if(s._isInlineNodeComponent){let e=s.props.node;return n.inline=!0,n.selectionDrag=!0,void(n.sourceSelection={type:"property",path:e.start.path,startOffset:e.start.offset,endOffset:e.end.offset,containerPath:i.getContainerPath(),surfaceId:i.id})}function a(){e.preventDefault(),e.stopPropagation()}n.selectionDrag=!1,n.nodeDrag=!0,n.sourceSelection={type:"node",nodeId:s.props.node.id,containerPath:i.getContainerPath(),surfaceId:i.id},n.scrollPanes=this._getSurfacesGroupedByScrollPane(),this.emit("drag:started",n)}_getSurfacesGroupedByScrollPane(){let e={};return this.context.surfaceManager.getSurfaces().forEach(t=>{if(!t.isContainerEditor())return;let r=t.context.scrollPane,n=r.getName(),s=t.getName();if(e[n])e[n].surfaces[s]=t;else{let o={};o[s]=t,e[n]={scrollPane:r,surfaces:o}}}),e}_getSelection(){return this.context.editorSession.getSelection()}_getComponents(e){let t=[],r=e;for(;r;){let e=Component.getComponentForDOMElement(r);if(e&&(t.unshift(e),e._isSurface))return t;r=r.parentNode}return null}_getIsolatedNodeOrContainerChild(e){let t,r;for(t=(r=e).parentNode;t;){if(t._comp&&t._comp._isContainerEditor)return r._comp;if(r._comp&&r._comp._isIsolatedNode)return r._comp;t=(r=t).parentNode}}_extractUris(e){let t=[],r=e.getData("text/uri-list");return r&&(t=r.split("\n").filter(function(e){return!e.startsWith("#")})),t}_getData(e){let t=e.dataTransfer;if(t)return{files:Array.prototype.slice.call(t.files),uris:this._extractUris(t),text:t.getData("text/plain"),html:t.getData("text/html")}}}class MoveBlockNode extends DragAndDropHandler{match(e){let{insertPos:t}=e.dropParams;return!e.external&&e.nodeDrag&&"place"===e.dropType&&t>=0}drop(e,t){let{insertPos:r}=t.dropParams;e.setSelection(t.sourceSelection);let n=e.copySelection();e.deleteSelection({clear:!0});let s=t.targetSurface.getContainerPath(),o=t.targetSurface.getName(),i=e.get(s),a=i[r],l="before";a||(a=i[r-1],l="after"),e.setSelection({type:"node",nodeId:a,mode:l,containerPath:s,surfaceId:o}),e.paste(n)}}class MoveInline extends DragAndDropHandler{match(e){return!e.external&&e.inline}drop(e,t){let r=t.event,n=t.sourceSelection,s=getDOMRangeFromEvent(r);if(!s)return;let o=Component.unwrap(r.target);if(!o)return;let i=o.context.domSelection;if(!i)return;let a=i.mapDOMRange(s);if(!a)return;let l=e.getDocument()._createSelectionFromRange(a);e.selection=n;let c=e.copySelection();e.deleteSelection(),e.selection=transformSelection(l,e),e.paste(c)}}class InsertNodes extends DragAndDropHandler{constructor(e,t){super(),this.assetHandlers=e,this.context=t}match(e){return"place"===e.dropType&&e.external}drop(e,t){let{insertPos:r}=t.dropParams,n=t.data.files,s=t.data.uris,o=t.targetSurface.getContainerPath(),i=t.targetSurface.id,a=e.get(o),l=a[r],c="before";l||(l=a[r-1],c="after"),e.setSelection({type:"node",nodeId:l,mode:c,containerPath:o,surfaceId:i}),n.length>0?n.forEach(t=>{this._callHandlers(e,{file:t,type:"file"})}):s.length>0?s.forEach(t=>{this._callHandlers(e,{uri:t,type:"uri"})}):console.info("TODO: implement html/text drop here")}_callHandlers(e,t){let r,n;for(r=0;r<this.assetHandlers.length;r++){if((n=this.assetHandlers[r]).match(t,this.context)){n.drop(e,t,this.context);break}}}}class CustomHandler extends DragAndDropHandler{match(e){return"custom"===e.dropType}drop(e,t){t.component.handleDrop(e,t)}}class DeprecatedFileManager{constructor(e,t){this.extensions=e,this.proxies={},this.context=t;const r=t.editorSession;if(!r)throw new Error("'context.editorSession' is required.");forEach(r.getDocument().getNodes(),e=>{e._isFileNode&&this.storeFile(e)}),r.onUpdate("document",this._onDocumentChange,this)}dispose(){this.context.editorSession.off(this)}storeFile(e){let t=this.proxies[e.id];return t||(t=this.createFileProxy(e))&&(this.proxies[e.id]=t),e.proxy=t,t}createFileProxy(e){let t=this.context;for(var r=0;r<this.extensions.length;r++){let n=this.extensions[r];if(n.match(e,t))return new n(e,t)}console.error("No file adapter found for ",e)}getProxy(e){return this.proxies[e.id]}sync(){let e=map(this.proxies,e=>e.sync());return Promise.all(e)}_onDocumentChange(e){let t=this.context.editorSession.getDocument();forEach(e.created,(e,r)=>{let n=t.get(r);n._isFileNode&&this.storeFile(n)})}}const events=["keydown","keyup","keypress","mousedown","mouseup","copy"];class AbstractGlobalEventHandler{constructor(){this.listeners=[],this.initialize()}initialize(){if(platform.inBrowser){let e=DefaultDOMElement.wrapNativeElement(window.document);events.forEach(function(t){e.on(t,this._dispatch.bind(this,t),this)}.bind(this))}}dispose(){if(platform.inBrowser){DefaultDOMElement.wrapNativeElement(window.document).off(this)}}addEventListener(e,t,r){if(!r.id)throw new Error("GlobalEventHandler can only be used with option 'id'");let n=new DOMEventListener(e,t,r);this.listeners.push(n)}removeEventListener(e){let t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}getEventListeners(){return this.listeners}_getActiveListener(e){const t=this.getSelection();if(t){let r=t.surfaceId;for(let t=0;t<this.listeners.length;t++){let n=this.listeners[t];if(n.eventName===e&&n.options.id===r)return n}}}_dispatch(e,t){const r=this._getActiveListener(e);r&&r.handler(t)}on(...e){return DOMElement.prototype.on.apply(this,e)}off(...e){return DOMElement.prototype.off.apply(this,e)}}class DeprecatedGlobalEventHandler extends AbstractGlobalEventHandler{constructor(e){super(),this.editorSession=e}getSelection(){return this.editorSession.getSelection()}}function parseKeyEvent(e,t){let r=[];return e.altKey&&("AltRight"===e.code?r.push("ALTGR"):r.push("ALT")),e.ctrlKey&&r.push("CTRL"),e.metaKey&&r.push("META"),e.shiftKey&&r.push("SHIFT"),t||r.push(e.keyCode),r.join("+")}class HandlerParams{constructor(e){const t=e.editorSession;t&&(this.editorSession=t,this.selection=t.getSelection(),this.selectionState=t.getSelectionState(),this.surface=t.getFocusedSurface())}}class AbstractKeyboardManager{onKeydown(e,t){let r=parseKeyEvent(e),n=this._getBindings("keydown",r);if(n){t=t||this._getContext();let r=this._getParams(t),s=!1;for(let e=0;e<n.length&&!s;e++){s=(0,n[e])(r,t)}return s&&(e.preventDefault(),e.stopPropagation()),s}}onTextInput(e,t){let r=this._getBindings("textinput",e);if(r){t=t||this._getContext();let e=this._getParams(t),n=!1;for(let s=0;s<r.length&&!n;s++){n=(0,r[s])(e,t)}return n}}_getParams(e){return new HandlerParams(e)}_getBindings(e,t){throw new Error("This method is abstract")}_getContext(){throw new Error("This method is abstract")}}function parseKeyCombo(e){let t=e.split("+"),r={keyCode:-1};for(var n=0;n<t.length;n++){let s=t[n].toUpperCase();switch(s){case"ALT":r.altKey=!0;break;case"ALTGR":r.altKey=!0,r.code="AltRight";break;case"CMD":r.metaKey=!0;break;case"CTRL":r.ctrlKey=!0;break;case"COMMANDORCONTROL":platform.isMac?r.metaKey=!0:r.ctrlKey=!0;break;case"MEDIANEXTTRACK":r.code="MediaTrackNext";break;case"MEDIAPLAYPAUSE":r.code="MediaPlayPause";break;case"MEDIAPREVIOUSTRACK":r.code="MediaPreviousTrack";break;case"MEDIASTOP":r.code="MediaStop";break;case"SHIFT":r.shiftKey=!0;break;case"SUPER":r.metaKey=!0;break;default:if(1===s.length)r.keyCode=s.charCodeAt(0);else{if(!keys$1.hasOwnProperty(s))throw new Error("Unsupported keyboard command: "+e);r.keyCode=keys$1[s]}}}return r}class DeprecatedKeyboardManager extends AbstractKeyboardManager{constructor(e,t,r){super(),this.editorSession=e,this.context=r.context||{},this.keydownBindings={},this.textInputBindings={},t.forEach(({key:t,spec:r})=>{let n=r.type||"keydown";if(!r.command)throw new Error("Keyboard binding not supported",r);{let s=new ExecuteCommandHandler(e,r.command),o=s.execute.bind(s);"keydown"===n?(t=parseKeyEvent(parseKeyCombo(t)),this.keydownBindings[t]||(this.keydownBindings[t]=[]),this.keydownBindings[t].push(o)):"textinput"===n&&(this.textInputBindings[t]=o)}})}_getBindings(e,t){switch(e){case"keydown":return this.keydownBindings[t];case"textinput":return this.textInputBindings[t];default:throw new Error("Unsupported keyboard event type")}}_getContext(){return this.context}static parseCombo(...e){return parseKeyEvent(parseKeyCombo(...e))}}class ExecuteCommandHandler{constructor(e,t){this.editorSession=e,this.commandName=t}execute(e){let t=e.editorSession.getCommandStates()[this.commandName];return!(!t||t.disabled)&&(this.editorSession.executeCommand(this.commandName,e),!0)}}class DeprecatedMacroManager{constructor(e,t){this.context=e,this.macros=t,this.context.editorSession.onFinalize("document",this.onDocumentChanged,this)}dispose(){this.context.editorSession.off(this)}onDocumentChanged(e,t){this.executeMacros(e,t)}executeMacros(e,t){let r,n,s,o,i,a,l=this.context.editorSession.getDocument();switch(t.action){case"type":{let t=e.ops[0];"update"===t.type&&t.diff._isTextOperation&&(r=(a=t.path)[0],n=l.get(r),s=l.get(a),i=(o=t.diff.pos)+t.diff.getLength());break}case"break":{let t=e.before.selection;if(!t.isPropertySelection())return;if(r=(a=t.path)[0],!(n=l.get(r))||!n.isText())return;s=n.getText(),i=o=t.start.offset;break}case"paste":if(1===e.ops.length){let t=e.ops[0];if("update"===t.type&&"string"===t.propertyType){if(r=(a=t.path)[0],!(n=l.get(r)).isText())return;s=n.getText(),i=(o=t.diff.pos)+t.diff.getLength()}}break;default:return}let c={action:t.action,node:n,path:a,text:s,start:o,end:i,editorSession:this.context.editorSession,selection:this.context.editorSession.getSelection()};setTimeout(()=>{for(let e=0;e<this.macros.length;e++){if(this.macros[e].execute(c,this.context))break}})}}class ArrayTree{add(e,t){let r=this._getKey(e);this[r]||(this[r]=[]),this[r].push(t)}remove(e,t){let r=this._getKey(e);this[r]&&deleteFromArray(this[r],t)}get(e){return this[this._getKey(e)]||[]}_getKey(e){return isString?e:getKeyForPath(e)}}class Marker extends PropertyAnnotation{_initialize(e,t){if(this.document=e,this.type=t.type,!t.type)throw new Error("'type' is mandatory");if(!t.start)throw new Error("'start' is mandatory");if(!t.end)throw new Error("'end' is mandatory");Object.assign(this._properties,t)}containsSelection(e){return!e.isNull()&&(e.isPropertySelection()?isArrayEqual(this.start.path,e.start.path)&&this.start.offset<=e.start.offset&&this.end.offset>=e.end.offset:void console.warn("Marker.contains() does not support other selection types."))}get type(){return this._type}set type(e){this._type=e}get _isPropertyAnnotation(){return!1}get _isMarker(){return!0}}class DeprecatedMarkersManager{constructor(e){this.editorSession=e,this._textProperties={},this._dirtyProps={},this._markers=new MarkersIndex(this),e.onUpdate("document",this._onChange,this),e.onRender(this._updateProperties,this)}dispose(){this.editorSession.off(this),this._markers.dispose()}setMarkers(e,t){this.clearMarkers(e),t.forEach(t=>this.addMarker(e,t))}addMarker(e,t){t._key=e,t._isMarker||(t=new Marker(this.editorSession.getDocument(),t)),this._markers.add(t)}clearMarkers(e){this._markers.clear(e)}register(e){let t=String(e.getPath()),r=this._textProperties[t];r||(r=this._textProperties[t]=[]),r.push(e)}deregister(e){let t=String(e.getPath()),r=this._textProperties[t];r&&(deleteFromArray(this._textProperties[t],e),0===r.length&&delete this._textProperties[t])}getMarkers(e,t){t=t||{};let r=this.editorSession.getDocument().getAnnotations(e)||[],n=this._markers.get(e,t.surfaceId,t.containerPath);return r.concat(n)}_onChange(e){this._markers._onDocumentChange(e),this._recordDirtyTextProperties(e)}_recordDirtyTextProperties(e){forEach(e.updated,(e,t)=>{this._dirtyProps[t]=!0})}_updateProperties(){Object.keys(this._dirtyProps).forEach(e=>{let t=this._textProperties[e];t&&t.forEach(this._updateTextProperty.bind(this))}),this._dirtyProps={}}_updateTextProperty(e){let t=e.getPath(),r=this.getMarkers(t,{surfaceId:e.getSurfaceId(),containerPath:e.getContainerPath()});e.setState({markers:r})}}class MarkersIndex{constructor(e){this._manager=e,this._byKey=new ArrayTree,this._documentMarkers=new ArrayTree,this._surfaceMarkers={},this._containerMarkers={}}get(e,t){let r=this._documentMarkers[e]||[];if(t&&this._surfaceMarkers[t]){let n=this._surfaceMarkers[t][e];n&&(r=r.concat(n))}return r}add(e){const t=e._key;this._byKey.add(t,e),this._add(e)}remove(e){const t=e._key;this._byKey.remove(t,e),this._remove(e)}clear(e){this._byKey.get(e).forEach(e=>{this._remove(e)})}_add(e){const t=this._manager._dirtyProps;switch(e.scope||"document"){case"document":{const r=e.start.path;t[r]=!0,this._documentMarkers.add(r,e);break}case"surface":{this._surfaceMarkers[e.surfaceId]||(this._surfaceMarkers[e.surfaceId]=new ArrayTree);const r=e.start.path;t[r]=!0,this._surfaceMarkers[e.surfaceId].add(r,e);break}case"container":console.warn("Container scoped markers are not supported yet");break;default:console.error("Invalid marker scope.")}}_remove(e){const t=this._manager._dirtyProps;switch(e.scope||"document"){case"document":{const r=e.start.path;t[r]=!0,this._documentMarkers.remove(r,e);break}case"surface":{this._surfaceMarkers[e.surfaceId]||(this._surfaceMarkers[e.surfaceId]=new ArrayTree);const r=e.start.path;t[r]=!0,this._surfaceMarkers[e.surfaceId].remove(r,e);break}case"container":console.warn("Container scoped markers are not supported yet");break;default:console.error("Invalid marker scope.")}}_getAllCustomMarkers(e){let t=this._documentMarkers[e]||[];for(let r in this._surfaceMarkers){if(!this._surfaceMarkers.hasOwnProperty(r))continue;let n=this._surfaceMarkers[r][e];n&&(t=t.concat(n))}return t}_onDocumentChange(e){e.ops.forEach(e=>{if("update"===e.type&&e.diff._isTextOperation){let t=this._getAllCustomMarkers(e.path),r=e.diff;switch(r.type){case"insert":this._transformInsert(t,r);break;case"delete":this._transformDelete(t,r)}}})}_transformInsert(e,t){const r=t.pos,n=t.str.length;0!==n&&e.forEach(e=>{var t=e.start.offset,s=e.end.offset,o=t,i=s;if(!(r>=s))return r<=t?(o+=n,i+=n,e.start.offset=o,void(e.end.offset=i)):void(r<s&&(i+=n,e.end.offset=i,this._remove(e)))})}_transformDelete(e,t){const r=t.pos,n=t.str.length,s=r+n;r!==s&&e.forEach(e=>{var t=e.start.offset,o=e.end.offset,i=t,a=o;if(s<=t)i-=n,a-=n,e.start.offset=i,e.end.offset=a;else if(r>=o);else{if(r<=t&&(i=t-Math.min(s-r,t-r)),r<=o&&(a=o-Math.min(s-r,o-r)),t!==o&&i===a)return void this._remove(e);t!==i&&(e.start.offset=i),o!==a&&(e.end.offset=a),this._remove(e)}})}}class DeprecatedSurfaceManager{constructor(e){this.editorSession=e,this.surfaces={},this._state={selection:null},e.onUpdate("selection",this._onSelectionChanged,this),e.onPostRender(this._recoverDOMSelection,this)}dispose(){this.editorSession.off(this)}getSurface(e){if(e)return this.surfaces[e]}getFocusedSurface(){const e=this._state.selection;if(e&&e.surfaceId)return this.getSurface(e.surfaceId)}getSurfaces(){return Object.keys(this.surfaces).map(e=>this.surfaces[e])}registerSurface(e){const t=e.getId();this.surfaces[t]&&console.error(`A surface with id ${t} has already been registered.`),this.surfaces[t]=e}unregisterSurface(e){e.off(this);let t=e.getId();this.surfaces[t]===e&&delete this.surfaces[t]}_onSelectionChanged(e){this._state.selection=e,e&&e.isCustomSelection()&&platform.inBrowser&&(window.getSelection().removeAllRanges(),window.document.activeElement.blur())}_recoverDOMSelection(){if(this.editorSession._blurred)return;let e=this.getFocusedSurface();e&&!e.isDisabled()&&(e._focus(),e.rerenderDOMSelection())}}class SaveHandlerStub{saveDocument({fileManager:e}){return console.info("Simulating save ..."),e.sync().then(()=>{console.info("Creating document snapshot...")})}}class DeprecatedConfigurator{constructor(){this.config={schema:{},nodes:{},tools:{},components:{},converters:{},importers:{},exporters:{},fileProxies:[],commands:{},commandGroups:{},toolPanels:{},editingBehaviors:[],macros:[],managers:{},dropHandlers:[],keyboardShortcuts:[],icons:{},labels:{},lang:"en",editorOptions:[],CommandManagerClass:DeprecatedCommandManager,DragManagerClass:DeprecatedDragManager,SaveHandlerClass:null}}defineSchema(e){if(e.ArticleClass&&(console.warn("DEPRECATED: schema.ArticleClass is now called schema.DocumentClass"),e.DocumentClass=e.ArticleClass),!e.DocumentClass)throw new Error("schema.DocumentClass is mandatory");this.config.schema=e}addEditorOption(e){if(!e.key)throw new Error("An option key must be defined");if(!e.value)throw new Error("An option value must be defined");this.config.editorOptions[e.key]=e.value}getEditorOptions(){return this.config.editorOptions}addNode(e,t){let r=e.type;if(!r)throw new Error("A NodeClass must have a type.");if(this.config.nodes[r]&&!t)throw new Error("NodeClass with this type name is already registered: "+r);this.config.nodes[r]=e}addConverter(e,t){let r=this.config.converters[e];if(r||(r={},this.config.converters[e]=r),isFunction$1(t)){t=new t}if(!t.type)throw new Error("A converter needs an associated type.");r[t.type]=t}addImporter(e,t){this.config.importers[e]=t}addExporter(e,t){this.config.exporters[e]=t}addComponent(e,t,r){if(!r&&this.config.components[e])throw new Error(e+" already registered");if(!t)throw new Error("Provided nil for component "+e);if(!t.prototype._isComponent)throw new Error("ComponentClass must be a subclass of ui/Component.");this.config.components[e]=t}addCommand(e,t,r){if(!isString(e))throw new Error("Expecting 'name' to be a String");if(!t)throw new Error("Provided nil for command "+e);if(!t.prototype._isCommand)throw new Error("Expecting 'CommandClass' to be of type ui/Command.");if(r=r||{},this.config.commands[e]&&!r.force)throw new Error(`Another command with name ${e} has already been registered. Use 'options.force' if this is intentional.`);this.config.commands[e]={name:e,CommandClass:t,options:r};let n=r.commandGroup;n&&(this.config.commandGroups[n]||(this.config.commandGroups[n]=[]),this.config.commandGroups[n].push(e))}addTool(e,t){if(!isString(e))throw new Error("Expecting 'name' to be a String");if(!t)throw new Error("Provided nil for tool "+e);if(!t||!t.prototype._isTool)throw new Error("Expecting 'ToolClass' to be of type ui/Tool. name:",e);this.config.tools[e]=t}getTools(){return this.config.tools}addToolPanel(e,t){this.config.toolPanels[e]=t}getToolPanel(e){return this.config.toolPanels[e]}addManager(e,t){this.config.managers[e]=t}getManagers(){return this.config.managers}addIcon(e,t){var r=this.config.icons[e];r||(r={},this.config.icons[e]=r),Object.assign(r,t)}addLabel(e,t){isString(t)?(this.config.labels.en||(this.config.labels.en={}),this.config.labels.en[e]=t):forEach(t,function(t,r){this.config.labels[r]||(this.config.labels[r]={}),this.config.labels[r][e]=t}.bind(this))}addSeed(e){this.config.seed=e}addEditingBehavior(e){console.error("Support for custom EditingBehaviors has been removed. Instead you can override Document.getEditingInterface()")}addMacro(e){this.config.macros.push(e)}addDragAndDrop(e){if(console.warn("DEPRECATED: Use addDropHandler() instead"),!e.prototype._isDragAndDropHandler)throw new Error("Only instances of DragAndDropHandler are allowed.");this.addDropHandler(new e)}addDropHandler(e){e._isDragAndDropHandler&&(e.type=e.type||"drop-asset"),this.config.dropHandlers.push(e)}addKeyboardShortcut(e,t){let r={key:e,spec:t};this.config.keyboardShortcuts.push(r)}addFileProxy(e){this.config.fileProxies.push(e)}getFileAdapters(){return this.config.fileProxies.slice(0)}import(e,t){return e.configure(this,t||{}),this}getConfig(){return this.config}getStyles(){return this.config.styles}getSchema(){return this.schema||(this.schema=new DocumentSchema(this.config.schema),this.schema.addNodes(this.config.nodes)),this.schema}getDocumentClass(){return this.config.schema.DocumentClass}createArticle(e){return console.warn("DEPRECATED: createArticle is now called createDocument"),this.createDocument(e)}createDocument(e){const t=this.getSchema();let r=new(t.getDocumentClass())(t);return e&&e(r),r}createImporter(e,t,r={}){return new(0,this.config.importers[e])(Object.assign({schema:this.getSchema(),converters:this.getConverterRegistry().get(e).values()},r),t)}createExporter(e,t,r={}){return new(0,this.config.exporters[e])(Object.assign({schema:this.getSchema(),converters:this.getConverterRegistry().get(e).values()},r),t)}getComponentRegistry(){var e=new ComponentRegistry;return forEach(this.config.components,function(t,r){e.add(r,t)}),e}getCommands(){return map(this.config.commands,function(e,t){return new e.CommandClass(Object.assign({name:t},e.options))})}getCommandGroups(){return this.config.commandGroups}getConverterRegistry(){if(!this.converterRegistry){var e=new DeprecatedRegistry;forEach(this.config.converters,function(t,r){e.add(r,new DeprecatedRegistry(t))}),this.converterRegistry=e}return this.converterRegistry}getDropHandlers(){return this.config.dropHandlers.slice(0)}getSeed(){return this.config.seed}getIconProvider(){return new FontAwesomeIconProvider(this.config.icons)}getEditingBehavior(){console.error("Support for custom EditingBehaviors has been removed. Instead you can override Document.getEditingInterface()")}getMacros(){return this.config.macros}getKeyboardShortcuts(){return this.config.keyboardShortcuts}getFindAndReplaceConfig(){return this.config.findAndReplace}setFindAndReplaceConfig(e){this.config.findAndReplace=e}getKeyboardShortcutsByCommand(){let e={};return this.config.keyboardShortcuts.forEach(t=>{if(t.spec.command){let r=t.key.toUpperCase();r=platform.isMac?(r=(r=(r=(r=(r=r.replace(/CommandOrControl/i,"⌘")).replace(/Ctrl/i,"^")).replace(/Shift/i,"⇧")).replace(/Enter/i,"↵")).replace(/Alt/i,"⌥")).replace(/\+/g,""):r.replace(/CommandOrControl/i,"Ctrl"),e[t.spec.command]=r}}),e}setDefaultLanguage(e){this.config.lang=e}getDefaultLanguage(){return this.config.lang||"en"}setCommandManagerClass(e){this.config.CommandManagerClass=e}getCommandManagerClass(){return this.config.CommandManagerClass||DeprecatedCommandManager}setDragManagerClass(e){this.config.DragManagerClass=e}getDragManagerClass(){return this.config.DragManagerClass||DeprecatedDragManager}setFileManagerClass(e){this.config.FileManagerClass=e}getFileManagerClass(){return this.config.FileManagerClass||DeprecatedFileManager}setGlobalEventHandlerClass(e){this.config.GlobalEventHandlerClass=e}getGlobalEventHandlerClass(){return this.config.GlobalEventHandlerClass||DeprecatedGlobalEventHandler}setKeyboardManagerClass(e){this.config.KeyboardManagerClass=e}getKeyboardManagerClass(){return this.config.KeyboardManagerClass||DeprecatedKeyboardManager}setMacroManagerClass(e){this.config.MacroManagerClass=e}getMacroManagerClass(){return this.config.MacroManagerClass||DeprecatedMacroManager}setMarkersManagerClass(e){this.config.MarkersManagerClass=e}getMarkersManagerClass(){return this.config.MarkersManagerClass||DeprecatedMarkersManager}setSurfaceManagerClass(e){this.config.SurfaceManagerClass=e}getSurfaceManagerClass(){return this.config.SurfaceManagerClass||DeprecatedSurfaceManager}setSaveHandlerClass(e){this.config.SaveHandlerClass=e}getSaveHandler(){return new(this.config.SaveHandlerClass||SaveHandlerStub)}getLabelProviderClass(){return this.config.LabelProviderClass||DefaultLabelProvider}setLabelProviderClass(e){this.config.LabelProviderClass=e}getLabelProvider(){return new(this.getLabelProviderClass())(this.config.labels)}}class DeprecatedToolPanel extends Component{didMount(){this.context.editorSession.onRender("commandStates",this._onCommandStatesChanged,this)}dispose(){this.context.editorSession.off(this)}render(e){throw new Error("This method is abstract")}getEntryTypeComponents(){return{"tool-group":this.getComponent("tool-group"),"tool-dropdown":this.getComponent("tool-dropdown"),"tool-prompt":this.getComponent("tool-prompt"),"tool-separator":this.getComponent("tool-separator")}}renderEntries(e){return this.props.toolPanel.map(t=>{let r=this.getEntryTypeComponents()[t.type];if(!r)throw new Error("Toolpanel entry type not found");let n=Object.assign({},t,{theme:this.getTheme()}),s=e(r,n);return t.name&&s.ref(t.name),s})}hasEnabledTools(){let e=!1;return this.refs.entriesContainer.childNodes.forEach(t=>{t.hasEnabledTools()&&(e=!0)}),e}getActiveToolGroupNames(){throw new Error("Abstract method")}showDisabled(){return!1}getToolStyle(){throw new Error("Abstract method")}getTheme(){return this.props.theme||"dark"}_onCommandStatesChanged(){this.rerender()}}class DeprecatedContextMenu extends DeprecatedToolPanel{didMount(){if(super.didMount(),!this.context.scrollPane)throw new Error("Requires a scrollPane context");this.context.scrollPane.on("context-menu:opened",this._onContextMenuOpened,this)}dispose(){super.dispose(),this.context.scrollPane.off(this)}render(e){let t=e("div").addClass("sc-context-menu sm-hidden");return t.addClass("sm-theme-"+this.getTheme()),t.append(e("div").addClass("se-active-tools").append(this.renderEntries(e)).ref("entriesContainer")),t}show(e){this.el.removeClass("sm-hidden"),this._position(e)}hide(){this.el.addClass("sm-hidden")}_onContextMenuOpened(e){let t=e.mouseBounds;this.el.removeClass("sm-hidden");let r=this.el.htmlProp("offsetWidth");this.el.css("top",t.top);let n=t.left;n=Math.max(n,0);let s=t.left+t.right-r;n=Math.min(n,s),this.el.css("left",n)}getTheme(){return this.props.theme||"dark"}}function getRelativeBoundingRect(e,t){let r;r=t._isDOMElement?t.getNativeElement():t,isArray(e)||(e=[e]);let n=_getBoundingRect(e.map(e=>{let t;return _getBoundingOffsetsRect(t=e._isDOMElement?e.getNativeElement():e,r)})),s=r.getBoundingClientRect();return{left:n.left,top:n.top,right:s.width-n.left-n.width,bottom:s.height-n.top-n.height,width:n.width,height:n.height}}function _getBoundingRect(e){var t={left:Number.POSITIVE_INFINITY,top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY,width:Number.NaN,height:Number.NaN};return forEach(e,function(e){e.left<t.left&&(t.left=e.left),e.top<t.top&&(t.top=e.top),e.left+e.width>t.right&&(t.right=e.left+e.width),e.top+e.height>t.bottom&&(t.bottom=e.top+e.height)}),t.width=t.right-t.left,t.height=t.bottom-t.top,t}function _getBoundingOffsetsRect(e,t){var r=t.getBoundingClientRect(),n=_getBoundingRect(e.getClientRects()),s=n.left-r.left,o=n.top-r.top;return{left:s,top:o,right:r.width-s-n.width,bottom:r.height-o-n.height,width:n.width,height:n.height}}class DeprecatedDropzones extends Component{didMount(){const e=this._getDragManager();e&&(e.on("drag:started",this.onDragStarted,this),e.on("drag:finished",this.onDragFinished,this))}dispose(){const e=this._getDragManager();e&&e.off(this)}render(e){let t=e("div").addClass("sc-dropzones");return this.state.dropzones?(t.on("dragenter",this.onDrag).on("dragover",this.onDrag),forEach(this.state.dropzones,(r,n)=>{r.forEach((r,s)=>{let o,i=r.type;if("place"===i?o=e("div").addClass("se-dropzone").attr({"data-dropzone-index":s,"data-dropzone-surface":n}).append(e("div").addClass("se-drop-teaser").css({top:r.teaserPos})):"custom"===i&&(o=e("div").addClass("se-custom-dropzone").attr({"data-dropzone-index":s,"data-dropzone-surface":n}).append(e("div").addClass("se-message").append(r.message))),o){let n=e("div").addClass("se-drop-shield").on("dragenter",this.onDragEnter).on("dragleave",this.onDragLeave).on("drop",this.onDrop).on("mouseenter",this.onDragEnter).on("mouseleave",this.onDragLeave).on("mouseup",this.onDrop);o.append(n),o.css({position:"absolute",top:r.top,left:r.left,width:r.width,height:r.height}),t.append(o)}})})):t.addClass("sm-hidden"),t}onDragStarted(e){let t=this._computeDropzones(e);setTimeout(()=>{this.setState({dropzones:t})},250)}onDragFinished(){this.setState({})}onDragEnter(e){e.target.parentNode.classList.add("sm-over")}onDragLeave(e){e.target.parentNode.classList.remove("sm-over")}onDrag(e){e.preventDefault()}onDrop(e){e.__reserved__=!0,e.preventDefault(),e.stopPropagation();let t=e.target.parentNode.dataset.dropzoneIndex,r=e.target.parentNode.dataset.dropzoneSurface,n=this.state.dropzones[r][t],s=n.dropParams,o=n.type,i=this.context.surfaceManager.getSurface(r),a=n.component,l=n.dropzoneComponent,c=this.context.dragManager;c.extendDragState({targetSurface:i,dropType:o,dropParams:s,component:a,dropzoneComponent:l}),c._onDragEnd(e)}_getDragManager(){return this.context.dragManager}_getBoundingRect(e){let t=e.context.scrollPane.getContentElement();return getRelativeBoundingRect(e.el,t)}_computeDropzones(e){let t=this.context.scrollPane.getName(),r={};return forEach(e.scrollPanes[t].surfaces,e=>{let t=e.childNodes,n=t.length+1,s=[];for(let e=0;e<n;e++){if(0===e){let r=this._getBoundingRect(t[0]);s.push({type:"place",left:r.left,top:r.top,width:r.width,height:r.height/2,teaserPos:0,dropParams:{insertPos:e}})}else if(e===n-1){let r=this._getBoundingRect(t[e-1]);s.push({type:"place",left:r.left,top:r.top+r.height/2,width:r.width,height:r.height/2,teaserPos:r.height/2,dropParams:{insertPos:e}})}else{let r=this._getBoundingRect(t[e-1]),n=this._getBoundingRect(t[e]),o=r.top+r.height/2,i=n.top+n.height/2;s.push({type:"place",left:r.left,top:o,width:r.width,height:i-o,teaserPos:(r.top+r.height+n.top)/2-o,dropParams:{insertPos:e}})}if(e<n-1){let r=t[e];if(r._isIsolatedNodeComponent&&(r=r.getContent()),r.getDropzoneSpecs){r.getDropzoneSpecs().forEach(e=>{let t=e.component,n=this._getBoundingRect(t);s.push({type:"custom",component:r,dropzoneComponent:t,left:n.left,top:n.top,width:n.width,height:n.height,message:e.message,dropParams:e.dropParams})})}}}r[e.getName()]=s}),r}_renderDropTeaser(e){e.visible?(this.el.removeClass("sm-hidden"),this.el.css("top",e.rect.top),this.el.css("left",e.rect.left),this.el.css("right",e.rect.right)):this.el.addClass("sm-hidden")}}class DeprecatedChangeHistory{constructor(){this.reset()}reset(){this.doneChanges=[],this.undoneChanges=[],this.lastChange=null}canUndo(){return this.doneChanges.length>0}canRedo(){return this.undoneChanges.length>0}push(e){this.doneChanges.push(e),this.undoneChanges=[]}}class Transaction{constructor(e){this.master=e,this.stage=e.newInstance().createFromDocument(e),this.stage._isTransactionDocument=!0,this.tx=this.stage.createEditingInterface(),this._isTransacting=!1,e._ops.length=0}dispose(){this.stage.dispose()}get ops(){return this.stage._ops}set ops(e){this.stage._ops=e}_reset(){this._before={},this._after={},this.stage._ops.length=0,this._info={}}_recordChange(e,t){if(this._isTransacting)throw new Error("Nested transactions are not supported.");if(!isFunction$1(e))throw new Error("Document.transaction() requires a transformation function.");let r,n=!1;this._isTransacting=!0,this._reset();try{e(this.tx);let s=this.ops;if(s.length>0&&((r=new DocumentChange(s,{},{})).info=t,this.master._isXMLDocument))if(t&&"type"===t.action);else{let e=this.stage._validateChange(r);if(!e.ok)throw new Error("Transaction is violating the schema: \n"+e.errors.map(e=>e.msg).join("\n"))}n=!0}finally{n||this._rollback(),this._isTransacting=!1}return r}_sync(){const e=this.master,t=this.stage;let r=e._ops;for(let e=0;e<r.length;e++)t._applyOp(r[e]);r.length=0}__applyChange__(e){const t=this.stage,r=e.ops;for(let e=0;e<r.length;e++)t._applyOp(r[e])}_rollback(){const e=this.stage;let t=e._ops;for(let r=t.length-1;r>=0;r--)e._applyOp(t[r].invert());t.length=0}}class DeprecatedSelectionState{constructor(e){this.document=e,this.selection=Selection.nullSelection,this._reset()}getSelection(){return this.selection}setSelection(e){return e?e.attach(this.document):e=Selection.nullSelection,this.selection=e,this._deriveState(e),!0}_deriveState(e){this._reset(),this._deriveContainerSelectionState(e),this._deriveAnnoState(e),this.document.getIndex("markers")&&this._deriveMarkerState(e)}_deriveContainerSelectionState(e){let t=this.document,r=e.containerPath;if(r){let n,s,o=e.start.getNodeId(),i=e.end.getNodeId(),a=getContainerRoot(t,r,o),l=a.getPosition();l>0&&(this.previousNode=getPreviousNode(t,r,l)),this.isFirst=isFirst(t,r,e.start),i===o?(n=a,s=l):s=(n=getContainerRoot(t,r,i)).getPosition(),this.nextNode=getNextNode(t,r,s),this.isLast=isLast(t,r,e.end)}}_deriveAnnoState(e){const t=this.document;let r={};function n(e){r[e.type]||(r[e.type]=[]),r[e.type].push(e)}const s=getPropertyAnnotationsForSelection(t,e);s.forEach(n),1===s.length&&s[0].isInlineNode()&&(this.isInlineNodeSelection=s[0].getSelection().equals(e));const o=e.containerPath;if(o){getContainerAnnotationsForSelection(t,e,o).forEach(n)}this.annosByType=r}_deriveMarkerState(e){let t=getMarkersForSelection(this.document,e);this.markers=t}_reset(){this.annosByType={},this.markers=null,this.isInlineNodeSelection=!1,this.previousNode=null,this.nextNode=null,this.isFirst=!1,this.isLast=!1,this.surface=null,this.isolatedNodes=null}}class DeprecatedEditorSession extends EventEmitter{constructor(e,t){super(),t=t||{},this.__id__=uuid(),this.document=e;const r=t.configurator;if(!r)throw new Error("No configurator provided.");this.configurator=r,this._transaction=new Transaction(e),_patchTxSetSelection(this._transaction,this),this._history=new DeprecatedChangeHistory,this._currentChange=null,this._selectionState=new DeprecatedSelectionState(e),this._commandStates=[],this._resources=["document","selection","commandStates"],this._dirtyFlags={},this._change=null,this._info=null,this._flowStages=["update","pre-render","render","post-render","position","finalize"],this._postponed=[],this._observers={},this._lang=t.lang||this.configurator.getDefaultLanguage(),this._dir=t.dir||"ltr";const n=r.getCommandManagerClass(),s=r.getDragManagerClass(),o=r.getFileManagerClass(),i=r.getGlobalEventHandlerClass(),a=r.getKeyboardManagerClass(),l=r.getMacroManagerClass(),c=r.getMarkersManagerClass(),d=r.getSurfaceManagerClass();this.surfaceManager=new d(this),this._context={editorSession:this,surfaceManager:this.surfaceManager},t.context&&Object.assign(this._context,t.context);let h=r.getCommands(),u=r.getDropHandlers(),p=r.getMacros(),g=r.getConverterRegistry();this.fileManager=t.fileManager||new o(r.getFileAdapters(),this._context),this._hasUnsavedChanges=!1,this._isSaving=!1,t.saveHandler?this.saveHandler=t.saveHandler:this.saveHandler=r.getSaveHandler(),this._managers={},forEach(r.getManagers(),(e,t)=>{this._managers[t]=new e(this._context)}),this.commandManager=t.commandManager||new n(this._context,h),this.dragManager=new s(u,Object.assign({},this._context,{commandManager:this.commandManager})),this.macroManager=new l(this._context,p),this.globalEventHandler=new i(this,this.surfaceManager),this.markersManager=new c(this),this.keyboardManager=new a(this,r.getKeyboardShortcuts(),{context:this._context}),this.converterRegistry=g}dispose(){this._transaction.dispose(),this.surfaceManager.dispose(),this.fileManager.dispose(),this.commandManager.dispose(),this.dragManager.dispose(),this.macroManager.dispose(),this.globalEventHandler.dispose(),this.markersManager.dispose(),forEach(this._managers,e=>{e.dispose&&e.dispose()})}hasChanged(e){return this._dirtyFlags[e]}hasDocumentChanged(){return this.hasChanged("document")}hasSelectionChanged(){return this.hasChanged("selection")}hasCommandStatesChanged(){return this.hasChanged("commandStates")}hasLanguageChanged(){return this.hasChanged("lang")}hasTextDirectionChanged(){return this.hasChanged("dir")}get(e){switch(e){case"document":return this.getDocument();case"selection":return this.getSelection();case"commandStates":return this.getCommandStates();case"change":return this.getChange();case"lang":return this.getLanguage();case"dir":return this.getTextDirection();default:throw new Error("Unknown resource: "+e)}}getConfigurator(){return this.configurator}getContext(){return this._context}getDocument(){return this.document}getManager(e){return this._managers[e]}getSelection(){return this.getSelectionState().getSelection()}getSelectionState(){return this._selectionState}getCommandStates(){return this._commandStates}getChange(){return this._change}getChangeInfo(){return this._info}getFocusedSurface(){return this.surfaceManager.getFocusedSurface()}getSurface(e){return this.surfaceManager.getSurface(e)}getLanguage(){return this._lang}getTextDirection(){return this._dir}canUndo(){return this._history.canUndo()}canRedo(){return this._history.canRedo()}resetHistory(){this._history.reset(),this._setDirty("commandStates"),this._flowing||this.startFlow()}executeCommand(...e){this.commandManager.executeCommand(...e)}attachEditor(e){this.editor=e}detachEditor(){this.editor=void 0}getEditor(){return this.editor}setSelection(e,t){if(e&&isPlainObject(e)&&(e=this.getDocument().createSelection(e)),e&&!e.isNull()&&!e.surfaceId){let t=this.getFocusedSurface();t&&(e.surfaceId=t.id)}return _addSurfaceId(e,this),_addContainerPath(e,this),this._setSelection(e)&&!t&&this.startFlow(),e}selectNode(e){let t=this.getFocusedSurface();this.setSelection({type:"node",nodeId:e,containerPath:t.getContainerPath(),surfaceId:t.id})}setCommandStates(e){this._commandStates=e,this._setDirty("commandStates")}setLanguage(e){this._lang!==e&&(this._lang=e,this._setDirty("lang"),this.startFlow())}setTextDirection(e){this._dir!==e&&(this._dir=e,this._setDirty("dir"),this.startFlow())}createSelection(){const e=this.getDocument();return e.createSelection.apply(e,arguments)}getCollaborators(){return null}setSaveHandler(e){this.saveHandler=e}transaction(e,t){const r=this._transaction,n=r.tx;t=t||{},r._sync();let s=this.getSelection();n.selection=s;let o=r._recordChange(e,t),i=n.selection;return o?(o.before={selection:s},o.after={selection:i},this._commit(o,t)):(this._setSelection(n.selection),this.startFlow()),o}undo(){this._undoRedo("undo")}redo(){this._undoRedo("redo")}on(...e){let t=e[0];if(this._flowStages.indexOf(t)>=0){e.shift();let r=e[2]||{},n=r.resource;n&&(delete r.resource,e.unshift(n)),this._registerObserver(t,e)}else EventEmitter.prototype.on.apply(this,e)}off(...e){if(1===e.length){let t=e[0];if(super.off(...e),t[this.__id__]){const e=t[this.__id__];delete t[this.__id__],e.forEach(e=>{this.__deregisterObserver(e)})}}else{const t=e[0],r=e[1],n=e[2];this._deregisterObserver(t,r,n)}}onUpdate(...e){return this._registerObserver("update",e)}onPreRender(...e){return this._registerObserver("pre-render",e)}onRender(...e){return this._registerObserver("render",e)}onPostRender(...e){return this._registerObserver("post-render",e)}onPosition(...e){return this._registerObserver("position",e)}onFinalize(...e){return this._registerObserver("finalize",e)}_setSelection(e){let t=this.getSelectionState().setSelection(e);return t&&this._setDirty("selection"),t}_undoRedo(e){const t=this.getDocument();var r,n;"redo"===e?(r=this._history.undoneChanges,n=this._history.doneChanges):(r=this._history.doneChanges,n=this._history.undoneChanges);var s=r.pop();if(s){this._applyChange(s,{}),this._transaction.__applyChange__(s),n.push(t.invert(s));let e=s.after.selection;e&&e.attach(t),this._setSelection(e),this.startFlow()}else console.warn("No change can be %s.","undo"===e?"undone":"redone")}_transformLocalChangeHistory(e){var t={ops:e.ops.map(function(e){return e.clone()})};transformDocumentChange(t,this._history.doneChanges),transformDocumentChange(t,this._history.undoneChanges)}_transformSelection(e){return transformSelection(this.getSelection(),e)}_commit(e,t){this._commitChange(e,t),this._hasUnsavedChanges=!0,this.startFlow()}_commitChange(e,t){if(e.timestamp=Date.now(),this._applyChange(e,t),!1!==t.history&&!t.hidden){let t=this.getDocument().invert(e);this._history.push(t)}var r=e.after.selection||Selection.nullSelection;r.isNull()||r.surfaceId||(r.surfaceId=e.after.surfaceId),this._setSelection(r),this.emit("commit",e)}_applyChange(e,t){if(!e)return void console.error("FIXME: change is null.");const r=this.getDocument();r._apply(e),r._notifyChangeListeners(e,t),this._setDirty("document"),this._change=e,this._info=t}_applyRemoteChange(e){e.ops.length>0&&(this._applyChange(e,{remote:!0}),this._transaction.__applyChange__(e),this._transformLocalChangeHistory(e),this._setSelection(this._transformSelection(e)),this.startFlow())}hasUnsavedChanges(){return this._hasUnsavedChanges}save(){var e=this.saveHandler;if(this._hasUnsavedChanges&&!this._isSaving){if(this._isSaving=!0,e){let t={editorSession:this,fileManager:this.fileManager};return e.saveDocument(t).then(()=>{this._hasUnsavedChanges=!1,this.setSelection(this.getSelection())}).catch(e=>{console.error("Error during save",e)}).then(()=>{this._isSaving=!1})}{let e="Document saving is not handled at the moment. Make sure saveHandler instance provided to editorSession";return console.error(e),Promise.reject(new Error(e))}}}startFlow(){if(this._flowing)throw new Error("Already in a flow. You need to postpone the update.");this._flowing=!0;try{this.performFlow()}finally{this._resetFlow(),this._flowing=!1}const e=this._postponed,t=this;this._postponed=[],setTimeout(function(){e.forEach(function(e){e(t)})},0)}performFlow(){this._flowStages.forEach(e=>{this._notifyObservers(e)})}postpone(e){this._postponed.push(e)}_parseObserverArgs(e){let t={stage:null,resource:null,handler:null,context:null,options:{}},r=0,n=e[r];if(isString(n)&&(t.resource=n,n=e[++r]),!n)throw new Error("Provided handler function was nil.");if(!isFunction$1(n))throw new Error("Expecting a handler Function.");return t.handler=n,(n=e[++r])&&(t.context=n,n=e[++r]),n&&(t.options=n),t}_registerObserver(e,t){let r=this._parseObserverArgs(t);r.stage=e,this.__registerObserver(e,r)}__registerObserver(e,t){if(t.context){const e=t.context;e[this.__id__]||(e[this.__id__]=[]),e[this.__id__].push(t)}let r=this._observers[e];r||(r=this._observers[e]=[]),r.push(t)}_deregisterObserver(e,t,r){let n=this;if(1===arguments.length)forEach(n._observers,e=>{for(let t=e.length-1;t>=0;t--){const n=e[t];n.context===r&&(e.splice(t,1),n._deregistered=!0)}});else{let s=n._observers[e];if(s)for(let e=s.length-1;e>=0;e--){let n=s[e];n.handler===t&&n.context===r&&(s.splice(e,1),n._deregistered=!0)}else EventEmitter.prototype.off.apply(n,arguments)}}__deregisterObserver(e){const t=e.stage,r=this._observers[t],n=e.context,s=e.handler;for(let e=r.length-1;e>=0;e--){let t=r[e];t.handler===s&&t.context===n&&(r.splice(e,1),t._deregistered=!0)}}_notifyObservers(e){let t=this._observers[e];if(!t)return;let r=t.slice();for(let e=0;e<r.length;e++){let t=r[e];if(!t._deregistered)if(t.resource)if("document"===t.resource){if(!this.hasDocumentChanged())continue;const e=this.getChange(),r=this.getChangeInfo(),n=t.options.path;n?e.hasUpdated(n)&&t.handler.call(t.context,e,r,this):t.handler.call(t.context,e,r,this)}else{if(!this.hasChanged(t.resource))continue;const e=this.get(t.resource);t.handler.call(t.context,e,this)}else t.handler.call(t.context,this)}}_setDirty(e){this._dirtyFlags[e]=!0}_resetFlow(){Object.keys(this._dirtyFlags).forEach(e=>{this._dirtyFlags[e]=!1}),this._change=null,this._info=null}setBlurred(e){this._blurred=e,this.commandManager._updateCommandStates(this),this._setDirty("commandStates")}isBlurred(){return Boolean(this._blurred)}}function _patchTxSetSelection(e,t){e.setSelection=function(r){return _addSurfaceId(r=Transaction.prototype.setSelection.call(e,r),t),_addContainerPath(r,t),r}}function _addSurfaceId(e,t){if(e&&!e.isNull()&&!e.surfaceId){let r=t.getFocusedSurface();r&&(e.surfaceId=r.id)}}function _addContainerPath(e,t){if(e&&!e.isNull()&&e.surfaceId&&!e.containerPath){let r=t.getSurface(e.surfaceId);if(r){let t=r.getContainerPath();t&&(e.containerPath=t)}}}class DeprecatedMenuItem extends Component{render(e){let t=this.props.commandState,r=e("button").addClass("sc-menu-item").append(this._renderIcon(e),this._renderLabel(e),this._renderKeyboardShortcut(e)).on("click",this._onClick);return this.props.label&&r.append(this.renderLabel(e)),t.active&&r.addClass("sm-active"),t.disabled?r.attr("tabindex",-1).attr("disabled",!0):r.attr("tabindex",1),r}_renderLabel(e){return e("div").addClass("se-label").append(this._getLabel())}_renderIcon(e){return e("div").addClass("se-icon").append(this.context.iconProvider.renderIcon(e,this.props.name))}_renderKeyboardShortcut(e){return e("div").addClass("se-keyboard-shortcut").append(this._getKeyboardShortcut())}_getLabel(){return this.context.labelProvider.getLabel(this.props.name,this.props.commandState)}_getKeyboardShortcut(){let e=this.props.name,t=this.context.keyboardShortcuts;return t[e]?t[e]:""}_onClick(e){e.preventDefault(),e.stopPropagation(),this.props.commandState.disabled||this.executeCommand()}executeCommand(e){this.context.commandManager.executeCommand(this.props.name,e)}}class DeprecatedMenu extends Component{render(e){let t=this.props.commandStates,r=e("div").addClass("sc-menu");return this.props.items.forEach(n=>{n.command?r.append(e(DeprecatedMenuItem,{name:n.command,commandState:t[n.command]})):"separator"===n.type&&r.append(e("div").addClass("separator"))}),r}}class Tooltip extends Component{render(e){let t=e("div").addClass("sc-tooltip");return t.append(this.props.text),t}}class DeprecatedToggleTool extends Component{render(e){let t=e("div").addClass("sc-toggle-tool"),r=this.getClassNames();return r&&t.addClass(r),t.append(this.renderButton(e)),t.append(e(Tooltip,{text:this._getTooltipText()})),t}renderButton(e){let t=this.props.commandState;return e(this.getComponent("button"),{icon:this.getIconName(),active:t.active,disabled:t.disabled,theme:this.props.theme}).on("click",this.onClick)}getClassNames(){return""}getCommandName(){return this.getName()}getName(){return this.props.name}getIconName(){return this.props.name}onClick(e){e.preventDefault(),e.stopPropagation(),this.props.disabled||this.executeCommand()}_getTooltipText(){let e=this.props.name,t=this.context.labelProvider.getLabel(e),r=this.context.keyboardShortcuts;return r[e]?[t," (",r[e],")"].join(""):t}executeCommand(e){e=Object.assign({mode:this.props.mode},e),this.context.commandManager.executeCommand(this.getCommandName(),e)}get _isTool(){return!0}}class DeprecatedToolGroup extends Component{isToolEnabled(e,t){let r=!0;return this.props.contextual&&!t.showInContext&&(r=!1),t.disabled&&(r=!1),r}hasEnabledTools(e){let t;return e||(e=this._getCommandStates()),forEach(e,(e,r)=>{this.isToolEnabled(r,e)&&(t=!0)}),t}render(e){let t=this._getCommandStates(),r=e("div").addClass(this._getClassNames());return r.addClass("sm-"+this.props.name),forEach(t,(t,n)=>{if(this.isToolEnabled(n,t)||this.props.showDisabled){let s=this._getToolClass(n);r.append(e(s,{name:n,commandState:t,style:this.props.style,theme:this.props.theme}).ref(n))}}),r}_getCommandStates(){let e=this.context.editorSession.getCommandStates(),t=this.context.commandGroups,r={};return this.props.commandGroups.forEach(n=>{t[n]&&t[n].forEach(t=>{e[t]&&(r[t]=e[t])})}),r}_getClassNames(){return"sc-tool-group"}_getToolClass(e){let t,r=this.context.tools;return t="descriptive"===this.props.style?DeprecatedMenuItem:DeprecatedToggleTool,r[e]||t}}class DeprecatedMenuGroup extends DeprecatedToolGroup{_getToolClass(e){return this.context.tools[e]||DeprecatedMenuItem}_getClassNames(){return"sc-menu-group"}}class DeprecatedOverlay extends DeprecatedToolPanel{didMount(){if(super.didMount(),!this.context.scrollPane)throw new Error("Requires scrollPane context");this.context.scrollPane.on("selection:positioned",this._onSelectionPositioned,this)}dispose(){super.dispose(),this.context.scrollPane.off(this)}render(e){let t=e("div").addClass("sc-overlay");return t.addClass("sm-hidden"),t.addClass("sm-theme-"+this.getTheme()),t.append(e("div").addClass("se-active-tools").append(this.renderEntries(e)).ref("entriesContainer")),t}show(e){this.el.removeClass("sm-hidden"),this._position(e)}hide(){this.el.addClass("sm-hidden")}_onSelectionPositioned(e){if(this.hasEnabledTools()){this.el.removeClass("sm-hidden");let t=this.el.htmlProp("offsetWidth"),r=e.selectionRect,n=r.width;this.el.css("top",r.top+r.height);let s=r.left+n/2-t/2;s=Math.max(s,0);let o=r.left+n+r.right-t;s=Math.min(s,o),this.el.css("left",s)}else this.el.addClass("sm-hidden")}getTheme(){return this.props.theme||"dark"}}class DeprecatedResponsiveApplication extends Component{constructor(...e){super(...e),this.pages={},this.handleActions({navigate:this.navigate})}getInitialState(){return{route:void 0,mobile:this._isMobile()}}didMount(){if(platform.inBrowser){DefaultDOMElement.getBrowserWindow().on("resize",this._onResize,this)}this.router=this.getRouter(),this.router.on("route:changed",this._onRouteChanged,this);let e=this.router.readRoute();this.navigate(e,{replace:!0})}dispose(){this.router.off(this),this.router.dispose()}navigate(e,t){this.extendState({route:e}),this.router.writeRoute(e,t)}_onRouteChanged(e){this.navigate(e,{replace:!0})}_isMobile(){if(platform.inBrowser)return window.innerWidth<700}_onResize(){this._isMobile()?this.state.mobile||this.extendState({mobile:!0}):this.state.mobile&&this.extendState({mobile:!1})}_getPage(){return this.state.route.page||this.getDefaultPage()}_getPageClass(){let e=this._getPage();return this.pages[e]}_getPageProps(){let e=cloneDeep(this.state.route);return delete e.page,e.mobile=this.state.mobile,e}addPage(e,t){this.pages[e]=t}renderPage(e){let t=this._getPageClass(),r=this._getPage();return e(t,this._getPageProps()).ref(r)}render(e){let t=e("div").addClass("sc-responsive-application");return void 0===this.state.route?t:(t.append(this.renderPage(e)),t)}}class DeprecatedScrollbar extends Component{didMount(){DefaultDOMElement.getBrowserWindow().on("resize",this.onResize,this),this.props.scrollPane.on("scroll",this.onScroll,this),setTimeout(()=>{this.updatePositions()})}dispose(){DefaultDOMElement.getBrowserWindow().off(this),this.props.scrollPane.off(this)}didUpdate(){this.updatePositions()}render(e){let t=e("div").addClass("sc-scrollbar").on("mousedown",this.onMouseDown);if(this.props.highlights){let r=[];forEach(this.props.highlights,function(t,n){forEach(t,function(t){r.push(e("div").ref(t).addClass("se-highlight sm-"+n))})}),t.append(e("div").ref("highlights").addClass("se-highlights").append(r))}return t.append(e("div").ref("thumb").addClass("se-thumb")),t}updatePositions(){let e=this.props.scrollPane,t=e.getScrollableElement(),r=e.getContentHeight(),n=e.getHeight(),s=e.getScrollPosition(),o=e.getContentElement();this.factor=r/n,this.factor<=1?this.el.addClass("sm-hide-thumb"):this.el.removeClass("sm-hide-thumb"),this.refs.thumb.css({top:s/this.factor,height:n/this.factor}),this.props.highlights&&forEach(this.props.highlights,function(e){forEach(e,function(e){let r=t.find('*[data-id="'+e+'"]');if(!r)return;let n=getRelativeBoundingRect(r,o),s=n.top/this.factor,i=n.height/this.factor;i<DeprecatedScrollbar.overlayMinHeight&&(i=DeprecatedScrollbar.overlayMinHeight),this.refs[e]?this.refs[e].css({top:s,height:i}):console.warn("no ref found for highlight",e)}.bind(this))}.bind(this))}getScrollableElement(){return this.props.scrollPane.getScrollableElement()}onResize(){this.rerender()}onScroll(){this.updatePositions()}onMouseDown(e){e.stopPropagation(),e.preventDefault(),this._mouseDown=!0;let t=DefaultDOMElement.getBrowserWindow();t.on("mousemove",this.onMouseMove,this),t.on("mouseup",this.onMouseUp,this);let r=this.el.getOffset().top,n=e.pageY-r,s=this.refs.thumb.el;e.target!==s.getNativeElement()?(this.offset=s.height/2,this.onMouseMove(e)):this.offset=n-s.getPosition().top}onMouseUp(){this._mouseDown=!1;let e=DefaultDOMElement.getBrowserWindow();e.off("mousemove",this.onMouseMove,this),e.off("mouseup",this.onMouseUp,this)}onMouseMove(e){if(this._mouseDown){let t=this.props.scrollPane.getScrollableElement(),r=this.el.getOffset().top,n=(e.pageY-r-this.offset)*this.factor;t.setProperty("scrollTop",n)}}}function getRelativeMouseBounds(e,t){let r=t.getBoundingClientRect(),n=e.clientX-r.left,s=e.clientY-r.top;return{left:n,right:r.width-n,top:s,bottom:r.height-s}}DeprecatedScrollbar.overlayMinHeight=2;class AbstractScrollPane extends Component{getChildContext(){return{scrollPane:this}}didMount(){platform.inBrowser&&(this.windowEl=DefaultDOMElement.wrapNativeElement(window),this.windowEl.on("resize",this.onSelectionPositioned,this))}dispose(){this.windowEl&&this.windowEl.off(this)}getName(){return this.props.name}onSelectionPositioned(){let e=this._getContentRect(),t=this._getSelectionRect();if(!t)return;let r={contentRect:e,selectionRect:t};this._emitSelectionPositioned(r),this._scrollSelectionIntoView(t)}_emitSelectionPositioned(e){this.emit("selection:positioned",e),this.emit("dom-selection:rendered",e)}_onContextMenu(e){e.preventDefault();let t=this._getMouseBounds(e);this.emit("context-menu:opened",{mouseBounds:t})}_scrollSelectionIntoView(e){let t=this.getScrollPosition(),r=t+this.getHeight(),n=e.top,s=e.top+e.height;(n<t&&s<t||n>r&&s>r)&&this.setScrollPosition(n)}getHeight(){throw new Error("Abstract method")}getContentHeight(){throw new Error("Abstract method")}getContentElement(){throw new Error("Abstract method")}getScrollableElement(){throw new Error("Abstract method")}getScrollPosition(){throw new Error("Abstract method")}setScrollPosition(){throw new Error("Abstract method")}getPanelOffsetForElement(e){throw new Error("Abstract method")}scrollTo(e,t){throw new Error("Abstract method")}_getContentRect(){return this.getContentElement().getNativeElement().getBoundingClientRect()}_getSelectionRect(){return getSelectionRect(this._getContentRect())}_getMouseBounds(e){return getRelativeMouseBounds(e,this.getContentElement().getNativeElement())}}class DeprecatedScrollPane extends AbstractScrollPane{didMount(){super.didMount(),this.refs.scrollbar&&this.props.highlights&&this.props.highlights.on("highlights:updated",this.onHighlightsUpdated,this),this.refs.scrollbar&&(platform.inBrowser&&(this.domObserver=new window.MutationObserver(this._onContentChanged.bind(this)),this.domObserver.observe(this.el.getNativeElement(),{subtree:!0,attributes:!0,characterData:!0,childList:!0})),this.context.editorSession.onPosition(this._onPosition,this))}dispose(){super.dispose(),this.props.highlights&&this.props.highlights.off(this),this.context.editorSession.off(this),this.context.dragManager.off(this),this.domObserver&&this.domObserver.disconnect()}render(e){let t=e("div").addClass("sc-scroll-pane");return platform.isFF&&t.addClass("sm-firefox"),this.props.noStyle||t.addClass("sm-default-style"),"substance"===this.props.scrollbarType&&(t.addClass("sm-substance-scrollbar"),t.addClass("sm-scrollbar-position-"+this.props.scrollbarPosition),t.append(e(DeprecatedScrollbar,{scrollPane:this}).ref("scrollbar").attr("id","content-scrollbar")),t.append(e("div").ref("scanline").addClass("se-scanline"))),t.append(e("div").ref("scrollable").addClass("se-scrollable").append(this.renderContent(e)).on("scroll",this.onScroll)),t}renderContent(e){let t=e("div").ref("content").addClass("se-content");return t.append(this.props.children),"custom"===this.props.contextMenu&&t.on("contextmenu",this._onContextMenu),t}_onContentChanged(){this._contentChanged=!0}_onPosition(){this.refs.scrollbar&&this._contentChanged&&(this._contentChanged=!1,this._updateScrollbar())}_updateScrollbar(){this.refs.scrollbar&&this.refs.scrollbar.updatePositions()}onHighlightsUpdated(e){this.refs.scrollbar.extendProps({highlights:e})}onScroll(){let e=this.getScrollPosition(),t=this.refs.scrollable;this.props.onScroll&&this.props.onScroll(e,t),this.props.tocProvider&&this.props.tocProvider.markActiveEntry(this),this.emit("scroll",e,t)}getHeight(){return this.getScrollableElement().height}getContentHeight(){return this.refs.content.el.getNativeElement().scrollHeight}getContentElement(){return this.refs.content.el}getScrollableElement(){return this.refs.scrollable.el}getScrollPosition(){return this.getScrollableElement().getProperty("scrollTop")}setScrollPosition(e){this.getScrollableElement().setProperty("scrollTop",e)}getPanelOffsetForElement(e){return getRelativeBoundingRect(e,this.refs.content.el).top}scrollTo(e,t){let r=this.getScrollableElement(),n=r.find(e);if(n){const e=this.getPanelOffsetForElement(n);let s=!0;if(t){const t=r.height,n=r.getProperty("scrollTop");s=e<n||n+t<e}s&&this.setScrollPosition(e)}else console.warn(`No match found for selector '${e}' in scrollable container`)}onSelectionPositioned(...e){super.onSelectionPositioned(...e),this._updateScrollbar()}_onContextMenu(e){super._onContextMenu(e),this._updateScrollbar()}}class DeprecatedToolbar extends DeprecatedToolPanel{render(e){let t=e("div").addClass("sc-toolbar");return t.append(e("div").addClass("se-active-tools").append(this.renderEntries(e)).ref("entriesContainer")),t}getTheme(){return this.props.theme||"light"}}class DeprecatedToolDropdown extends DeprecatedToolGroup{willReceiveProps(){this.setState({showChoices:!1})}render(e){let t=this.getComponent("button"),r=this._getCommandStates(),n=e("div").addClass("sc-tool-dropdown");n.addClass("sm-"+this.props.name);const s=this._getToggleName(r)||this.props.name;if(this.props.showDisabled||this.hasEnabledTools(r)){let o;if("minimal"===this.props.style)o=e(t,{icon:s,dropdown:!0,active:this.state.showChoices,theme:this.props.theme}).on("click",this._toggleChoices);else{if("descriptive"!==this.props.style)throw new Error("Style "+this.props.style+" not supported");o=e(t,{label:s,commandState:r[s],dropdown:!0,active:this.state.showChoices,theme:this.props.theme}).on("click",this._toggleChoices)}n.append(o),this.state.showChoices?n.append(e("div").addClass("se-choices").append(e(DeprecatedMenu,{commandStates:r,items:this._getMenuItems(r)}))):"minimal"!==this.props.style&&s===this.props.name||n.append(this._renderToolTip(e))}return n}_renderToolTip(e){let t=this.context.labelProvider;return e(Tooltip,{text:t.getLabel(this.props.name)})}_getToggleName(e){return this._getActiveCommandName(e)}_getMenuItems(e){const t=this.props.showDisabled;let r=[];return forEach(e,(e,n)=>{(t||this.isToolEnabled(n,e))&&r.push({command:n})}),r}_getActiveCommandName(e){let t;return forEach(e,(e,r)=>{e.active&&!t&&(t=r)}),t}_toggleChoices(){this.setState({showChoices:!this.state.showChoices})}}class DeprecatedToolPrompt extends DeprecatedToolGroup{_getClassNames(){return"sc-tool-prompt"}}class DeprecatedToolSeparator extends Component{render(e){return e("div").addClass("sc-tool-separator")}hasEnabledTools(){return!1}}class DeprecatedWorkflowPane extends DeprecatedToolPanel{render(e){let t=e("div").addClass("sc-workflow-pane");return t.append(e("div").addClass("se-active-tools").append(this.renderEntries(e)).ref("entriesContainer")),t}getTheme(){return this.props.theme||"light"}}class CollabSession extends DeprecatedEditorSession{constructor(e,t){if(super(e,t),t=t||{},this.config=t,this.collabClient=t.collabClient,t.docVersion&&console.warn("config.docVersion is deprecated: Use config.version instead"),t.docVersion&&console.warn("config.docId is deprecated: Use config.documentId instead"),this.version=t.version,this.documentId=t.documentId||t.docId,void 0!==t.autoSync?this.autoSync=t.autoSync:this.autoSync=!0,!this.documentId)throw new SubstanceError("InvalidArgumentsError",{message:"documentId is mandatory"});if(void 0===this.version)throw new SubstanceError("InvalidArgumentsError",{message:"version is mandatory"});this._connected=!1,this._nextChange=null,this._pendingChange=null,this._pendingSync=!1,this._error=null,this.onUpdate("document",this.afterDocumentChange,this),this.collabClient.on("connected",this.onCollabClientConnected,this),this.collabClient.on("disconnected",this.onCollabClientDisconnected,this),this.collabClient.on("message",this._onMessage.bind(this)),this.collabClient.isConnected()&&this.autoSync&&this.sync()}dispose(){this.disconnect(),this.collabClient.off(this)}disconnect(){let e={type:"disconnect",documentId:this.documentId};this._abortSync(),this._send(e)}sync(){if(this.__canSync()){let e=this._nextChange,t={type:"sync",documentId:this.documentId,version:this.version,change:e?this.serializeChange(e):void 0};this._send(t),this._pendingSync=!0,this._pendingChange=e,this.emit("sync"),this._nextChange=null,this._error=null}else console.error("Can not sync. Either collabClient is not connected or already syncing")}getCollaborators(){return this.collaborators}isConnected(){return this._connected}serializeChange(e){return e.toJSON()}deserializeChange(e){return DocumentChange.fromJSON(e)}_onMessage(e){if(e.documentId!==this.documentId)return!1;switch((e=cloneDeep(e)).type){case"syncDone":this.syncDone(e);break;case"syncError":this.syncError(e);break;case"update":this.update(e);break;case"disconnectDone":this.disconnectDone(e);break;case"error":this.error(e);break;default:return console.error("CollabSession: unsupported message",e.type,e),!1}return!0}_send(e){return this.collabClient.isConnected()?(this.collabClient.send(e),!0):(console.warn("Try not to call _send when disconnected. Skipping message",e),!1)}update(e){let t=e.change,r=e.version;this._nextChange||this._pendingSync?console.info("skipped remote update. Pending sync or local changes."):(t&&(t=this.deserializeChange(t),this._applyRemoteChange(t)),r&&(this.version=r),this.startFlow())}syncDone(e){let t=e.serverChange,r=e.version;t&&(t=this.deserializeChange(t),this._applyRemoteChange(t)),this.version=r,this._pendingChange=null,this._pendingSync=!1,this._error=null,this._connected=!0,this.startFlow(),this.emit("connected"),this._requestSync()}syncError(e){console.info("SyncError occured. Aborting sync",e),this._abortSync()}disconnectDone(){this._afterDisconnected()}error(e){let t=e.error,r=this[t.name],n=SubstanceError.fromJSON(t);if(!r)return t("CollabSession: unsupported error",t.name),!1;this.emit("error",n),(r=r.bind(this))(n)}afterDocumentChange(e,t){t.remote||this._recordChange(e)}onCollabClientConnected(){this.autoSync&&this.sync()}onCollabClientDisconnected(){this._abortSync(),this._connected&&this._afterDisconnected()}_commit(e,t){this._commitChange(e,t),this.startFlow()}_applyRemoteChange(e){e.ops.length>0&&(this._transaction.__applyChange__(e),this.getDocument()._apply(e),this._setDirty("document"),this._transformLocalChangeHistory(e),this._setSelection(this._transformSelection(e)),this._change=e,this._info={remote:!0},this.startFlow())}_recordChange(e){this._nextChange?(this._nextChange.ops=this._nextChange.ops.concat(e.ops),this._nextChange.after=e.after):this._nextChange=e,this._requestSync()}__canSync(){return this.collabClient.isConnected()&&!this._pendingSync}_requestSync(){this._nextChange&&this.__canSync()&&this.sync()}_abortSync(){let e=this._nextChange;this._pendingChange&&(e=this._pendingChange,this._nextChange&&(e.ops=e.ops.concat(this._nextChange.ops),e.after=this._nextChange.after),this._pendingChange=null),this._pendingSync=!1,this._error=null,this._nextChange=e}_afterDisconnected(){this._connected=!1,this.emit("disconnected")}_hasLocalChanges(){return this._nextChange&&this._nextChange.ops.length>0}}function findParentDOMElement(e){for(;e;){let t=DefaultDOMElement.unwrap(e);if(t)return t;e=e.parentNode}}function findParent(e,t){for(;e;){if(e.is(t))return e;e=e.getParent()}}function stop(e){e.stopPropagation()}function stopAndPrevent(e){e.stopPropagation(),e.preventDefault()}function walk(e,t){_walk(e,t,0)}function _walk(e,t,r){if(t(e,r),e.getChildCount()>0){let n=e.getChildNodeIterator();for(;n.hasNext();)_walk(n.next(),t,r+1)}}function isRightButton(e){let t=!1;return"which"in e?t=3===e.which:"button"in e&&(t=2===e.button),t}function getBoundingRect(e){let t=e.getNativeElement().getBoundingClientRect();return{top:t.top,left:t.left,height:t.height,width:t.width}}function getBoundingRectForRects(...e){let t,r,n,s;if(e.length>0){let o=e[0];t=o.top,r=o.left,n=t+o.height,s=r+o.width;for(let o=1;o<e.length;o++){let i=e[o];t=Math.min(t,i.top),r=Math.min(r,i.left),n=Math.max(n,i.top+i.height),s=Math.max(s,i.left+i.width)}}return{top:t,left:r,right:s,bottom:n,height:n-t,width:s-r}}function isXInside(e,t){return e>=t.left&&e<=t.left+t.width}function isYInside(e,t){return e>=t.top&&e<=t.top+t.height}var domHelpers=Object.freeze({findParentDOMElement:findParentDOMElement,findParent:findParent,stop:stop,stopAndPrevent:stopAndPrevent,walk:walk,isRightButton:isRightButton,getBoundingRect:getBoundingRect,getBoundingRectForRects:getBoundingRectForRects,isXInside:isXInside,isYInside:isYInside});class ChangeHistoryView{constructor(e){this.documentSession=e,this._undo=[],this._redo=[]}canUndo(){return this._undo.length>0}canRedo(){return this._redo.length>0}commit(e,t){let r=this.documentSession._history.length;this.documentSession._commitChange(e,t),this._undo.push(r),this._redo.length=0}undo(){if(0===this._undo.length)return;let e,t=this.documentSession._history.length,r=this._undo.pop();try{e=this.documentSession.revert(r),this._redo.push(t)}catch(e){console.error(e),this._undo.push(r)}return e}redo(){if(0===this._redo.length)return;let e,t=this.documentSession._history.length,r=this._redo.pop();try{e=this.documentSession.revert(r),this._undo.push(t)}catch(e){console.error(e),this._redo.push(r)}return e}reset(){this._undo.length=0,this._redo.length=0}}class DocumentStage{constructor(e){this.masterSession=e;let t=e.getDocument();this.masterDocument=t,this.stageDocument=t.newInstance().createFromDocument(t),this.stageDocument._isTransactionDocument=!0,this.stageVersion=this._getMasterVersion(),this.tx=this.stageDocument.createEditingInterface(),this._isTransacting=!1}dispose(){this.stageDocument.dispose()}_reset(){this.stageDocument._ops.length=0}_transaction(e,t,r={}){if(this._isTransacting)throw new Error("Nested transactions are not supported.");if(!isFunction$1(e))throw new Error("Document.transaction() requires a transformation function.");let n,s=!1;this._isTransacting=!0,this._reset(),this._sync();try{const o=this.tx;r.selection&&(o.selection=r.selection),e(o);let i=this.stageDocument._ops;i.length>0&&((n=new DocumentChange(i,{},{})).info=t,n.before=r,n.after={selection:o.selection},this.stageVersion++),s=!0}finally{s||this._rollback(),this._reset(),this._isTransacting=!1}return n}_sync(){const e=this._getMasterVersion(),t=this.stageVersion;if(t<e){let r=this.stageDocument,n=this.masterSession._history.slice(t);for(let e of n)r._apply(e);this.stageVersion=e}else if(t>e)throw new Error("stage document is in an unexpected state.")}_rollback(){const e=this.stageDocument;let t=e._ops;for(let r=t.length-1;r>=0;r--)e._applyOp(t[r].invert());this._reset()}_getMasterVersion(){return this.masterSession._history.length}}class AbstractEditorSession extends EventEmitter{constructor(e,t,r){super();const n=t.getDocument();this._id=e,this._document=n,this._documentSession=t,this._history=r||new ChangeHistoryView(t),this._stage=new DocumentStage(t),this._initialize()}_initialize(){}dispose(){}canUndo(){return this._history.canUndo()}canRedo(){return this._history.canRedo()}getDocument(){return this._document}getFocusedSurface(){}getSurface(e){}getSelection(){return this._getSelection()}setSelection(e){if(e||(e=Selection.nullSelection),e&&isPlainObject(e)&&(e=this.getDocument().createSelection(e)),e&&!e.isNull()&&!e.surfaceId){let t=this.getFocusedSurface();t&&(e.surfaceId=t.id)}return e.isCustomSelection()||(e.surfaceId||_addSurfaceId$1(e,this),e.containerPath||_addContainerPath$1(e,this)),this._setSelection(this._normalizeSelection(e)),e}transaction(e,t={}){const r=this._stage;let n={selection:this._getSelection()},s=r._transaction(e,t,n);if(s){let e=s.after.selection;this._setSelection(this._normalizeSelection(e)),this._commit(s,t)}return s}undo(){let e=this._history.undo();e&&this._setSelection(this._normalizeSelection(e.after.selection))}updateNodeStates(e,t={}){this._documentSession.updateNodeStates(e,t)}redo(){let e=this._history.redo();e&&this._setSelection(this._normalizeSelection(e.after.selection))}resetHistory(){this._history.reset()}_commit(e,t){this._history.commit(e,t)}_normalizeSelection(e){const t=this.getDocument();return e?e.attach(t):e=Selection.nullSelection,e}_getSelection(){}_setSelection(e){}_transformSelection(e){return transformSelection(this.getSelection(),e)}}function _addSurfaceId$1(e,t){if(e&&!e.isNull()&&!e.surfaceId){let r=t.getFocusedSurface();r&&(e.surfaceId=r.id)}}function _addContainerPath$1(e,t){if(e&&!e.isNull()&&e.surfaceId&&!e.containerPath){let r=t.getSurface(e.surfaceId);if(r){let t=r.getContainerPath();t&&(e.containerPath=t)}}}class TreeNode{}class TreeIndex{get(e){return arguments.length>1&&(e=Array.prototype.slice(arguments,0)),get(this,e=_pathify(e))}getAll(e){if(arguments.length>1&&(e=Array.prototype.slice(arguments,0)),!isArray(e=_pathify(e)))throw new Error("Illegal argument for TreeIndex.get()");let t=get(this,e);return this._collectValues(t)}set(e,t){setWith(this,e=_pathify(e),t,function(e){if(!e)return new TreeNode})}delete(e){if(1===(e=_pathify(e)).length)delete this[e[0]];else{let t=e[e.length-1],r=get(this,e=e.slice(0,-1));r&&delete r[t]}}clear(){let e=this;for(let t in e)e.hasOwnProperty(t)&&delete e[t]}traverse(e){this._traverse(this,[],e)}forEach(...e){this.traverse(...e)}_traverse(e,t,r){let n;for(n in e){if(!e.hasOwnProperty(n))continue;let s=e[n],o=t.concat([n]);s instanceof TreeNode?this._traverse(s,o,r):r(s,o)}}_collectValues(e){let t={};return this._traverse(e,[],function(e,r){let n=r[r.length-1];t[n]=e}),t}}function _pathify(e){return isString(e)?[e]:e}class TreeIndexArrays extends TreeIndex{contains(e){let t=super.get(e);return Boolean(t)}get(e){let t=super.get(e);return t instanceof TreeNode&&(t=t.__values__||[]),t}set(e,t){super.get(e).__values__=t}add(e,t){if(!isArray(e=_pathify(e)))throw new Error("Illegal arguments.");let r;setWith(this,e.concat(["__values__","__dummy__"]),void 0,function(e,t){return"__values__"===t?(e||(e=[]),r=e):e||(e=new TreeNode),e}),delete r.__dummy__,r.push(t)}remove(e,t){let r=get(this,e);r instanceof TreeNode&&(1===arguments.length?delete r.__values__:deleteFromArray(r.__values__,t))}_collectValues(e){let t=[];return this._traverse(e,[],function(e){t.push(e)}),t=Array.prototype.concat.apply([],t)}}TreeIndex.Arrays=TreeIndexArrays;class AnnotationIndex extends DocumentIndex{constructor(){super(),this.byPath=new TreeIndex,this.byType=new TreeIndex}select(e){return e.isPropertyAnnotation()||e.isInlineNode()}clear(){this.byPath.clear(),this.byType.clear()}get(e,t,r,n){var s;return s=map(s=isString(e)||1===e.length?this.byPath.getAll(e)||{}:this.byPath.get(e)),isNumber(t)&&(s=filter(s,AnnotationIndex.filterByRange(t,r))),n&&(s=filter(s,DocumentIndex.filterByType(n))),s}create(e){const t=e.start.path;this.byType.set([e.type,e.id],e),t&&t.length>0&&this.byPath.set(e.start.path.concat([e.id]),e)}delete(e){this._delete(e.type,e.id,e.start.path)}_delete(e,t,r){this.byType.delete([e,t]),r&&r.length>0&&this.byPath.delete(r.concat([t]))}update(e,t,r,n){this.select(e)&&"start"===t[1]&&"path"===t[2]&&(this._delete(e.type,e.id,n),this.create(e))}}AnnotationIndex.filterByRange=function(e,t){return function(r){var n=r.start.offset,s=r.end.offset>=e;return isNumber(t)&&(s=s&&n<=t),s}};class BlockNode extends DocumentNode{static isBlock(){return!0}}function copySelection(e,t){if(!t)throw new Error("'selection' is mandatory.");let r=null;return t.isNull()||t.isCollapsed()||(t.isPropertySelection()?r=_copyPropertySelection(e,t):t.isContainerSelection()?r=_copyContainerSelection(e,t):t.isNodeSelection()?r=_copyNodeSelection(e,t):console.error("Copy is not yet supported for selection type.")),r}function _copyPropertySelection(e,t){let r=t.start.path,n=t.start.offset,s=t.end.offset,o=e.get(r),i=e.createSnippet(),a=i.getContainer();return i.create({type:e.schema.getDefaultTextType(),id:TEXT_SNIPPET_ID,content:o.substring(n,s)}),a.append(TEXT_SNIPPET_ID),forEach(e.getIndex("annotations").get(r,n,s),function(e){let t=cloneDeep(e.toJSON()),r=[TEXT_SNIPPET_ID,"content"];t.start={path:r,offset:Math.max(n,e.start.offset)-n},t.end={path:r,offset:Math.min(s,e.end.offset)-n},i.create(t)}),i}function _copyContainerSelection(e,t){let r=t.containerPath,n=e.createSnippet(),s=n.getContainer().getContentPath(),o=getNodeIdsCoveredByContainerSelection(e,t),i=o.length;if(0===i)return n;let a=t.start,l=t.end,c=!1,d=!1,h={};for(let t=0;t<i;t++){let u=o[t],p=e.get(u);0===t&&isLast(e,r,a)?c=!0:t===i-1&&isFirst(e,r,l)?d=!0:h[u]||(copyNode(p).forEach(e=>{let t=n.create(e);h[t.id]=!0}),append(n,s,u))}if(!c){let e=getContainerRoot(n,s,a.getNodeId());e.isText()?deleteTextRange(n,null,a):e.isList()&&deleteListRange(n,e,null,a,{deleteEmptyFirstItem:!0})}if(!d){let e=getContainerRoot(n,s,l.getNodeId());e.isText()?deleteTextRange(n,l,null):e.isList()&&deleteListRange(n,e,l,null)}return n}function _copyNodeSelection(e,t){let r=e.createSnippet(),n=r.getContainer().getContentPath(),s=t.getNodeId(),o=e.get(s);return copyNode(o).forEach(e=>{r.create(e)}),append(r,n,o.id),r}function _transferWithDisambiguatedIds(e,t,r,n){if(n[r])throw new Error("FIXME: dont call me twice");n[r]=r;const s=e.get(r,"strict"),o=s.toJSON();let i,a=r;t.contains(r)&&(i=uuid(s.type),o.id=i);const l=e.getIndex("annotations"),c=s.getSchema();let d=[];for(let r of c){const s=r.name;if("id"!==s&&"type"!==s)if(r.isReference()&&r.isOwned()||"file"===r.type)if(r.isArray()){let r=o[s];o[s]=_transferArrayOfReferences(e,t,r,n)}else{let r=o[s];n[r]||(o[s]=_transferWithDisambiguatedIds(e,t,r,n))}else if(r.isText()){let e=l.get([a,r.name]);for(let t=0;t<e.length;t++){let r=e[t];r.start.path[0]===a&&i&&(r.start.path[0]=i),r.end.path[0]===a&&i&&(r.end.path[0]=i),d.push(r)}}}t.create(o);for(let r=0;r<d.length;r++)_transferWithDisambiguatedIds(e,t,d[r].id,n);return o.id}function _transferArrayOfReferences(e,t,r,n){let s=r.slice(0);for(let o=0;o<r.length;o++){let i=r[o];if(isArray(i))s[o]=_transferArrayOfReferences(e,t,i,n);else{let r=i;r&&!n[r]&&(s[o]=_transferWithDisambiguatedIds(e,t,r,n))}}return s}function paste(e,t){let r=e.selection;if(!r||r.isNull())throw new Error("Can not paste without selection.");if(r.isCustomSelection())throw new Error("Paste not implemented for custom selection.");(t=t||{}).text=t.text||"";let n=t.doc,s=Boolean(r.containerPath);if(r.isCollapsed()||e.deleteSelection(),!n){if(!s)return void e.insertText(t.text);n=_convertPlainTextToDocument(e,t)}let o=n.get(SNIPPET_ID),i=o.getLength();if(0===i)return;let a=o.getNodeAt(0);return s?(a.isText()&&(_pasteAnnotatedText(e,n),o.removeAt(0),i--),i>0&&_pasteDocument(e,n)):1===i?a.isText()&&_pasteAnnotatedText(e,n):_pasteAnnotatedText(e,n=_convertIntoAnnotatedText(e,n)),t}function _convertPlainTextToDocument(e,t){let r,n=t.text.split(/\s*\n\s*\n/),s=e.getDocument().newInstance(),o=s.getSchema().getDefaultTextType(),i=s.create({type:"@container",id:SNIPPET_ID,nodes:[]});if(1===n.length)r=s.create({id:TEXT_SNIPPET_ID,type:o,content:n[0]}),i.append(r.id);else for(let e=0;e<n.length;e++)r=s.create({id:uuid(o),type:o,content:n[e]}),i.append(r.id);return s}function _convertIntoAnnotatedText(e,t){let r=e.selection.start.path,n=e.createSnippet(),s=n.getSchema().getDefaultTextType(),o=t.get("snippet").getContent(),i=[],a=0,l=[];for(let e of o){let n=t.get(e);if(n.isText()){let e=n.getText();i.length>0&&(i.push(" "),a+=1);let t=map(n.getAnnotations(),e=>{let t=e.toJSON();return t.start.path=r.slice(0),t.start.offset+=a,t.end.offset+=a,t});i.push(e),l=l.concat(t),a+=e.length}}return n.create({id:TEXT_SNIPPET_ID,type:s,content:i.join("")}),l.forEach(e=>n.create(e)),n.getContainer().append(TEXT_SNIPPET_ID),n}function _pasteAnnotatedText(e,t){let r=e.selection;const n=t.get(SNIPPET_ID).nodes[0],s=t.get(n).getPath(),o=t.get(s),i=t.getIndex("annotations").get(s);let a=r.start.path,l=r.start.offset;e.insertText(o);let c=e.getProperty(a);if(c.isText()){let t=map(i),r=c.targetTypes;r&&(t=t.filter(e=>r.indexOf(e.type)>=0));for(let r of t){let t=r.toJSON();t.start.path=a.slice(0),t.start.offset+=l,t.end.offset+=l,e.get(t.id)&&(t.id=uuid(t.type)),e.create(t)}}}function _pasteDocument(e,t){let r=t.get(SNIPPET_ID);if(0===r.getLength())return;let n,s=e.selection,o=s.containerPath;if(s.isPropertySelection()){let t=s.start.path,i=getContainerRoot(e,o,s.start.getNodeId());if(i.isText()){let r=i.getPosition(),a=e.get(t);0===a.length?(removeAt(e,o,n=r),deepDeleteNode(e,e.get(i.id))):a.length===s.start.offset?n=r+1:(e.break(),n=r+1)}else if(i.isList()){let t=i,a=e.get(s.start.getNodeId()),l=r.getNodeAt(0);if(l.isList()){if(l.getLength()>0){let n=a.getPosition();0===a.getLength()?(removeAt(e,t.getItemsPath(),n),deepDeleteNode(e,a),_pasteListItems(e,t,l,n)):0===s.start.offset?_pasteListItems(e,t,l,n):s.start.offset>=a.getLength()?_pasteListItems(e,t,l,n+1):(e.break(),_pasteListItems(e,t,l,n+1)),r.getLength()>1&&_breakListApart(e,o,t)}r.removeAt(0),n=t.getPosition()+1}else 1===t.getLength()&&0===a.getLength()?(removeAt(e,o,n=t.getPosition()),deepDeleteNode(e,t)):0===a.getPosition()&&0===s.start.offset?n=t.getPosition():a.getPosition()===t.getLength()-1&&s.end.offset>=a.getLength()?n=t.getPosition()+1:(n=t.getPosition()+1,_breakListApart(e,o,t))}}else if(s.isNodeSelection()){let t=getContainerPosition(e,o,s.getNodeId());if(s.isBefore())n=t;else{if(!s.isAfter())throw new Error("Illegal state: the selection should be collapsed.");n=t+1}}_pasteContainerNodes(e,t,o,n)}function _pasteContainerNodes(e,t,r,n){let s=[],o={},i=t.get(SNIPPET_ID).nodes.map(e=>t.get(e)),a=e.getProperty(r).targetTypes;a&&a.length>0&&(i=i.filter(e=>a.indexOf(e.type)>=0));for(let t of i){let i=_transferWithDisambiguatedIds(t.getDocument(),e,t.id,o);t=e.get(i),insertAt(e,r,n++,i),s.push(t)}if(s.length>0){setCursor(e,last$1(s),r,"after")}}function _pasteListItems(e,t,r,n){let s,o=e.getSelection(),i=r.resolve("items"),a={};for(let r of i){let o=_transferWithDisambiguatedIds(r.getDocument(),e,r.id,a);insertAt(e,t.getItemsPath(),n++,o),s=e.get(o)}e.setSelection({type:"property",path:s.getPath(),startOffset:s.getLength(),surfaceId:o.surfaceId,containerPath:o.containerPath})}function _breakListApart(e,t,r){let n=r.getPosition(),s=e.selection;e.break(),e.get(e.selection.start.getNodeId()).getLength()>0&&(e.setSelection(s),e.break()),console.assert(0===e.get(e.selection.start.getNodeId()).getLength(),"at this point the current list-item should be empty"),e.break(),deepDeleteNode(e,removeAt(e,t,n+1))}class Editing{annotate(e,t){let r=e.selection,n=e.getSchema().getNodeClass(t.type);if(!n)throw new Error("Unknown annotation type",t);let s={start:r.start,end:r.end,containerPath:r.containerPath};if(r.isPropertySelection()){if(!n.isAnnotation())throw new Error("Annotation can not be created for a selection.")}else r.isContainerSelection()&&n.isPropertyAnnotation()&&console.warn("NOT SUPPORTED YET: creating property annotations for a non collapsed container selection.");return Object.assign(s,t),e.create(s)}break(e){let t=e.selection;if(t.isNodeSelection()){let r=t.containerPath,n=getContainerPosition(e,r,t.getNodeId()),s=this.createTextNode(e,r);t.isBefore()?insertAt(e,r,n,s.id):(insertAt(e,r,n+1,s.id),setCursor(e,s,r,"before"))}else if(t.isCustomSelection());else if(t.isCollapsed()||t.isPropertySelection()){let r=t.containerPath;if(t.isCollapsed()||(this._deletePropertySelection(e,t),e.setSelection(t.collapse("left"))),r){let n=t.start.path[0],s=e.get(n);this._breakNode(e,s,t.start,r)}}else if(t.isContainerSelection()){let r=t.start,n=t.containerPath,s=getContainerPosition(e,n,r.path[0]);this._deleteContainerSelection(e,t,{noMerge:!0}),setCursor(e,getNextNode(e,n,s),n,"before")}}createTextNode(e,t,r){let n=e.getProperty(t);if(!n.defaultTextType)throw new Error('Container properties must have a "defaultTextType" defined in the schema');return e.create({type:n.defaultTextType,content:r})}createListNode(e,t,r={}){return e.create({type:"list",items:[],listType:r.listType||"bullet"})}delete(e,t){let r=e.selection;if(r.isNodeSelection())this._deleteNodeSelection(e,r,t);else if(r.isCustomSelection());else if(r.isCollapsed()){let n=r.start.path,s=n[0],o=r.containerPath,i=e.get(n),a=r.start.offset;if(o&&(0===a&&"left"===t||a===i.length&&"right"===t)){let n=getContainerRoot(e,o,s);if(n.isList()&&0===a&&"left"===t)return this.toggleList(e);this._merge(e,n,r.start,t,o)}else{if(0===a&&"left"===t||a===i.length&&"right"===t)return;let s="left"===t?a-1:a;deleteTextRange(e,{path:n,offset:s},{path:n,offset:s+1}),e.setSelection({type:"property",path:n,startOffset:s,containerPath:r.containerPath})}}else r.isPropertySelection()?(deleteTextRange(e,r.start,r.end),e.setSelection(r.collapse("left"))):r.isContainerSelection()?this._deleteContainerSelection(e,r):console.warn("Unsupported case: tx.delete(%)",t,r)}_deleteNodeSelection(e,t,r){let n=t.getNodeId(),s=t.containerPath,o=getContainerPosition(e,s,n);if(t.isFull()||t.isBefore()&&"right"===r||t.isAfter()&&"left"===r){removeAt(e,s,o),deepDeleteNode(e,e.get(n));let r=this.createTextNode(e,t.containerPath);insertAt(e,s,o,r.id),e.setSelection({type:"property",path:r.getPath(),startOffset:0,containerPath:s})}else if(t.isBefore()&&"left"===r){if(o>0){let t=getPreviousNode(e,s,o);t.isText()?(e.setSelection({type:"property",path:t.getPath(),startOffset:t.getLength()}),this.delete(e,r)):e.setSelection({type:"node",nodeId:t.id,containerPath:s})}}else if(t.isAfter()&&"right"===r){if(o<e.get(s).length-1){let t=getNextNode(e,s,o);t.isText()?(e.setSelection({type:"property",path:t.getPath(),startOffset:0}),this.delete(e,r)):e.setSelection({type:"node",nodeId:t.id,containerPath:s})}}else console.warn("Unsupported case: delete(%s)",r,t)}_deletePropertySelection(e,t){let r=t.start.path,n=t.start.offset,s=t.end.offset;e.update(r,{type:"delete",start:n,end:s}),annotationHelpers.deletedText(e,r,n,s)}_deleteContainerSelection(e,t,r={}){let n=t.containerPath,s=t.start,o=t.end,i=s.getNodeId(),a=o.getNodeId(),l=getContainerPosition(e,n,i),c=getContainerPosition(e,n,a);if(l===c){let r=getContainerRoot(e,n,i);if(r.isText())deleteTextRange(e,s,o);else{if(!r.isList())throw new Error("Not supported yet.");deleteListRange(e,r,s,o)}return void e.setSelection(t.collapse("left"))}let d=s.getNodeId(),h=o.getNodeId(),u=e.get(s.getNodeId()),p=e.get(o.getNodeId()),g=isEntirelySelected(e,u,s,null),f=isEntirelySelected(e,p,null,o);if(f)removeAt(e,n,c),deepDeleteNode(e,p);else{let t=getContainerRoot(e,n,h);t.isText()?deleteTextRange(e,null,o):t.isList()&&deleteListRange(e,t,null,o)}for(let t=c-1;t>l;t--){let r=removeAt(e,n,t);deepDeleteNode(e,e.get(r))}if(g)removeAt(e,n,l),deepDeleteNode(e,u);else{let t=getContainerRoot(e,n,d);t.isText()?deleteTextRange(e,s,null):t.isList()&&deleteListRange(e,t,s,null)}if(g&&f){let t=this.createTextNode(e,n);insertAt(e,n,l,t.id),e.setSelection({type:"property",path:t.getPath(),startOffset:0,containerPath:n})}else if(g||f)g?setCursor(e,p,n,"before"):setCursor(e,u,n,"after");else{if(!r.noMerge){let r=getContainerRoot(e,n,u.id);this._merge(e,r,t.start,"right",n)}e.setSelection(t.collapse("left"))}}insertInlineNode(e,t){let r=e.selection;this.insertText(e,"\ufeff"),r=e.selection;let n=e.selection.end.offset,s=n-"\ufeff".length;return t=Object.assign({},t,{start:{path:r.path,offset:s},end:{path:r.path,offset:n}}),e.create(t)}insertBlockNode(e,t){let r,n=e.selection,s=n.containerPath;if(r=t._isNode&&e.get(t.id)?e.get(t.id):e.create(t),n.isNodeSelection()){let t=n.getNodeId(),o=getContainerPosition(e,s,t);n.isBefore()?insertAt(e,s,o,r.id):n.isAfter()?(insertAt(e,s,o+1,r.id),e.setSelection({type:"node",containerPath:s,nodeId:r.id,mode:"after"})):(removeAt(e,s,o),deepDeleteNode(e,e.get(t)),insertAt(e,s,o,r.id),e.setSelection({type:"node",containerPath:s,nodeId:r.id,mode:"after"}))}else if(n.isPropertySelection()){if(!s)throw new Error("insertBlockNode can only be used within a container.");n.isCollapsed()||(this._deletePropertySelection(e,n),e.setSelection(n.collapse("left")));let t=e.get(n.path[0]);if(!t)throw new Error("Invalid selection.");let o=getContainerPosition(e,s,t.id);if(t.isText()){let i=t.getText();0===i.length?(removeAt(e,s,o),deepDeleteNode(e,t),insertAt(e,s,o,r.id),setCursor(e,r,s,"after")):0===n.start.offset?insertAt(e,s,o,r.id):n.start.offset===i.length?(insertAt(e,s,o+1,r.id),setCursor(e,r,s,"before")):(this.break(e),insertAt(e,s,o+1,r.id),setCursor(e,r,s,"after"))}else console.error("Not supported: insertBlockNode() on a custom node")}else if(n.isContainerSelection()){if(n.isCollapsed()){let t=n.start;if(t.isPropertyCoordinate())e.setSelection({type:"property",path:t.path,startOffset:t.offset,containerPath:s});else{if(!t.isNodeCoordinate())throw new Error("Unsupported selection for insertBlockNode");e.setSelection({type:"node",containerPath:s,nodeId:t.path[0],mode:0===t.offset?"before":"after"})}return this.insertBlockNode(e,r)}return this.break(e),this.insertBlockNode(e,r)}return r}insertText(e,t){let r=e.selection;if(r.isNodeSelection()){let n=r.containerPath,s=r.getNodeId(),o=getContainerPosition(e,n,s),i=this.createTextNode(e,n,t);r.isBefore()?insertAt(e,n,o,i.id):r.isAfter()?insertAt(e,n,o+1,i.id):(removeAt(e,n,o),deepDeleteNode(e,e.get(s)),insertAt(e,n,o,i.id)),setCursor(e,i,n,"after")}else r.isCustomSelection()||(r.isCollapsed()||r.isPropertySelection()?this._insertText(e,r,t):r.isContainerSelection()&&(this._deleteContainerSelection(e,r),this.insertText(e,t)))}paste(e,t){if(t)if(isString(t))paste(e,{text:t});else{if(!t._isDocument)throw new Error("Illegal content for paste.");paste(e,{doc:t})}}switchTextType(e,t){let r=e.selection;if(!r.isPropertySelection())throw new Error("Selection must be a PropertySelection.");let n=r.containerPath;if(!n)throw new Error("Selection must be within a container.");let s=r.path,o=s[0],i=e.get(o);if(!i.isText())throw new Error("Trying to use switchTextType on a non text node.");const a=uuid(t.type),l=i.getPath();console.assert(2===l.length,"Currently we assume that TextNodes store the plain-text on the first level");const c=l[1];let d=[a,c],h=Object.assign({id:a,type:t.type,direction:i.direction},t);h[c]=i.getText();let u=e.create(h);annotationHelpers.transferAnnotations(e,s,0,d,0);let p=getContainerPosition(e,n,o);return removeAt(e,n,p),deepDeleteNode(e,i),insertAt(e,n,p,u.id),e.setSelection({type:"property",path:d,startOffset:r.start.offset,endOffset:r.end.offset,containerPath:n}),u}toggleList(e,t){let r=e.selection,n=r.containerPath;if(!n)throw new Error("Selection must be within a container.");if(r.isPropertySelection()){let s=getContainerRoot(e,n,r.start.path[0]),o=s.getPosition();if(s.isText()){removeAt(e,n,o);let i=this.createListNode(e,n,t),a=i.createListItem(s.getText());annotationHelpers.transferAnnotations(e,s.getPath(),0,a.getPath(),0),i.appendItem(a),deepDeleteNode(e,s),insertAt(e,n,o,i.id),e.setSelection({type:"property",path:a.getPath(),startOffset:r.start.offset,containerPath:n})}else if(s.isList()){let t=r.start.path[0],i=e.get(t),a=s.getItemPosition(i),l=this.createTextNode(e,n,i.getText());if(annotationHelpers.transferAnnotations(e,i.getPath(),0,l.getPath(),0),s.removeItemAt(a),s.isEmpty())removeAt(e,n,o),deepDeleteNode(e,s),insertAt(e,n,o,l.id);else if(0===a)insertAt(e,n,o,l.id);else if(s.getLength()<=a)insertAt(e,n,o+1,l.id);else{let t=[];const r=s.getItems();for(let e=r.length-1;e>=a;e--)t.unshift(r[e]),s.removeItemAt(e);let i=this.createListNode(e,n,s);for(let e=0;e<t.length;e++)i.appendItem(t[e]);insertAt(e,n,o+1,l.id),insertAt(e,n,o+2,i.id)}e.setSelection({type:"property",path:l.getPath(),startOffset:r.start.offset,containerPath:n})}}else r.isContainerSelection()&&console.error("TODO: support toggleList with ContainerSelection")}indent(e){let t=e.selection,r=t.containerPath;if(t.isPropertySelection()){let n=getContainerRoot(e,r,t.start.getNodeId());if(n.isList()){let r=t.start.path[0],s=e.get(r),o=s.getLevel();s&&o<3&&(s.setLevel(s.level+1),e.set([n.id,"_itemsChanged"],!0))}}else t.isContainerSelection()&&console.error("TODO: support toggleList with ContainerSelection")}dedent(e){let t=e.selection,r=t.containerPath;if(t.isPropertySelection()){let n=getContainerRoot(e,r,t.start.getNodeId());if(n.isList()){let r=t.start.path[0],s=e.get(r),o=s.getLevel();s&&o>1&&(s.setLevel(s.level-1),e.set([n.id,"_itemsChanged"],!0))}}else t.isContainerSelection()&&console.error("TODO: support toggleList with ContainerSelection")}_insertText(e,t,r){let n=t.start,s=t.end;if(!isArrayEqual(n.path,s.path))throw new Error("Unsupported state: range should be on one property");let o=n.path,i=n.offset,a=s.offset,l=!t.isCollapsed(),c=r.length;l&&e.update(o,{type:"delete",start:i,end:a}),e.update(o,{type:"insert",start:i,text:r}),e.getAnnotations(o).forEach(function(t){let r=t.start.offset,n=t.end.offset;n<i||(r>=a?(e.update([t.id,"start"],{type:"shift",value:i-a+c}),e.update([t.id,"end"],{type:"shift",value:i-a+c})):r>=i&&n<a||t.isInlineNode()&&r>=i&&n<=a?e.delete(t.id):r>=i&&n>=a?((r>i||!l)&&e.update([t.id,"start"],{type:"shift",value:i-r+c}),e.update([t.id,"end"],{type:"shift",value:i-a+c})):r<i&&n<a?e.update([t.id,"end"],{type:"shift",value:i-n+c}):(n!==i||t.constructor.autoExpandRight)&&(r<i&&n>=a?t.isInlineNode()||e.update([t.id,"end"],{type:"shift",value:i-a+c}):console.warn("TODO: handle annotation update case.")))});let d=i+r.length;e.setSelection({type:"property",path:n.path,startOffset:d,containerPath:t.containerPath,surfaceId:t.surfaceId})}_breakNode(e,t,r,n){(t=getContainerRoot(e,n,t.id)).isText()?this._breakTextNode(e,t,r,n):t.isList()?this._breakListNode(e,t,r,n):console.error("FIXME: _breakNode() not supported for type",t.type)}_breakTextNode(e,t,r,n){let s=r.path,o=r.offset,i=t.getPosition(),a=t.getText();if(0===o){insertAt(e,n,i,e.create({type:t.type,content:""}).id),e.setSelection({type:"property",path:s,startOffset:0,containerPath:n})}else{const r=t.getPath()[1],l=uuid(t.type);let c=t.toJSON();c.id=l,c[r]=a.substring(o),o===a.length&&(c.type=e.getSchema().getDefaultTextType());let d=e.create(c);o<a.length&&(annotationHelpers.transferAnnotations(e,s,o,d.getPath(),0),e.update(s,{type:"delete",start:o,end:a.length})),insertAt(e,n,i+1,d.id),e.setSelection({type:"property",path:d.getPath(),startOffset:0,containerPath:n})}}_breakListNode(e,t,r,n){let s=r.path,o=r.offset,i=e.get(s[0]),a=t.length,l=t.getItemPosition(i),c=i.getText(),d=i.getPath()[1],h=i.toJSON();if(delete h.id,0===o)if(c){h[d]="";let r=e.create(h);t.insertItemAt(l,r),e.setSelection({type:"property",path:i.getPath(),startOffset:0})}else{let r=t.getPosition(),s=this.createTextNode(e,n);if(a<2)removeAt(e,n,r),deepDeleteNode(e,t),insertAt(e,n,r,s.id);else if(0===l)t.removeItem(i),deepDeleteNode(e,i),insertAt(e,n,r,s.id);else if(l>=a-1)t.removeItem(i),deepDeleteNode(e,i),insertAt(e,n,r+1,s.id);else{let o=[];const i=t.getItems().slice();for(let e=a-1;e>l;e--)o.unshift(i[e]),t.removeItem(i[e]);t.removeItem(i[l]);let c=this.createListNode(e,n,t);for(let e=0;e<o.length;e++)c.appendItem(o[e]);insertAt(e,n,r+1,s.id),insertAt(e,n,r+2,c.id)}e.setSelection({type:"property",path:s.getPath(),startOffset:0})}else{h[d]=c.substring(o);let r=e.create(h);o<c.length&&(annotationHelpers.transferAnnotations(e,s,o,r.getPath(),0),e.update(s,{type:"delete",start:o,end:c.length})),t.insertItemAt(l+1,r),e.setSelection({type:"property",path:r.getPath(),startOffset:0})}}_merge(e,t,r,n,s){if(t.isList()){let o=t,i=r.path[0],a=e.get(i),l=o.getItemPosition(a);if("left"===n&&l>0||"right"===n&&l<o.items.length-1){l="left"===n?l-1:l;let t=o.getItemAt(l),r=t.getLength();return mergeListItems(e,o.id,l),void e.setSelection({type:"property",path:t.getPath(),startOffset:r,containerPath:s})}}let o=e.get(s),i=t.getPosition();"left"===n&&i>0?this._mergeNodes(e,s,i-1,n):"right"===n&&i<o.length-1&&this._mergeNodes(e,s,i,n)}_mergeNodes(e,t,r,n){let s=e.get(t),o=e.get(s[r]),i=r+1,a=e.get(s[i]);if(o.isText()){if(o.isEmpty())return removeAt(e,t,r),i--,deepDeleteNode(e,o),void setCursor(e,a,t,"before");let s=o,l=s.getPath(),c=s.getLength();if(a.isText()){let r=a,n=r.getPath();removeAt(e,t,i),e.update(l,{type:"insert",start:c,text:r.getText()}),annotationHelpers.transferAnnotations(e,n,0,l,c),deepDeleteNode(e,r),e.setSelection({type:"property",path:l,startOffset:c,containerPath:t})}else if(a.isList()){let r=a;if(!a.isEmpty()){let t=r.getFirstItem(),n=t.getPath();r.removeItemAt(0),e.update(l,{type:"insert",start:c,text:t.getText()}),annotationHelpers.transferAnnotations(e,n,0,l,c),deepDeleteNode(e,t)}r.isEmpty()&&(removeAt(e,t,i),deepDeleteNode(e,r)),e.setSelection({type:"property",path:l,startOffset:c,containerPath:t})}else selectNode(e,"left"===n?o.id:a.id,t)}else if(o.isList())if(a.isText()){let n=o.getLastItem(),l=n.getPath(),c=n.getLength(),d=s.length>r+2?e.get(s[r+2]):null;if(0===a.getLength())removeAt(e,t,i),deepDeleteNode(e,a);else{let r=a,n=r.getPath();removeAt(e,t,i),e.update(l,{type:"insert",start:c,text:r.getText()}),annotationHelpers.transferAnnotations(e,n,0,l,c),deepDeleteNode(e,r)}d&&d.type===o.type&&this._mergeTwoLists(e,t,o,d),e.setSelection({type:"property",path:n.getPath(),startOffset:c,containerPath:t})}else if(a.isList()){if("right"!==n)throw new Error("Illegal state");let r=o.getLastItem();this._mergeTwoLists(e,t,o,a),e.setSelection({type:"property",path:r.getPath(),startOffset:r.getLength(),containerPath:t})}else selectNode(e,"left"===n?o.id:a.id,t);else a.isText()&&a.isEmpty()?(removeAt(e,t,i),deepDeleteNode(e,a),setCursor(e,o,t,"after")):selectNode(e,"left"===n?o.id:a.id,t)}_mergeTwoLists(e,t,r,n){removeAt(e,t,n.getPosition());let s=n.getItems().slice();for(let e=0;e<s.length;e++)n.removeItemAt(0),r.appendItem(s[e]);deepDeleteNode(e,n)}}class EditingInterface{constructor(e,t={}){this._document=e,this._selection=null,this._impl=t.editing||new Editing,this._direction=null}dispose(){}getDocument(){return this._document}get(...e){return this._document.get(...e)}getProperty(...e){return this._document.getProperty(...e)}contains(e){return this._document.contains(e)}find(e){return this._document.find(e)}findAll(e){return this._document.findAll(e)}create(e){return this._document.create(e)}delete(e){return this._document.delete(e)}deepDeleteNode(e){return deepDeleteNode(this._document.get(e))}set(e,t){return this._document.set(e,t)}update(e,t){return this._document.update(e,t)}updateNode(e,t){return this._document.updateNode(e,t)}createSelection(e){return e=augmentSelection(e,this._selection),this._document.createSelection(e)}setSelection(e){return e?isPlainObject(e)?e=this.createSelection(e):e.isNull()||(e=augmentSelection(e,this._selection)):e=Selection.nullSelection,this._selection=e,e}getSelection(){return this._selection}get selection(){return this._selection}set selection(e){this.setSelection(e)}get textDirection(){return this._direction}set textDirection(e){this._direction=e}annotate(e){const t=this._selection;if(t&&(t.isPropertySelection()||t.isContainerSelection()))return this._impl.annotate(this,e)}break(){this._selection&&!this._selection.isNull()&&this._impl.break(this)}copySelection(){const e=this.getDocument(),t=this._selection;if(t&&!t.isNull()&&!t.isCollapsed())return copySelection(e,this._selection)}deleteSelection(e){const t=this._selection;!t||t.isNull()||t.isCollapsed()||this._impl.delete(this,"right",e)}deleteCharacter(e){const t=this._selection;!t||t.isNull()||(t.isCollapsed()?this._impl.delete(this,e):this.deleteSelection())}insertText(e){const t=this._selection;t&&!t.isNull()&&this._impl.insertText(this,e)}insertInlineNode(e){const t=this._selection;if(t&&!t.isNull()&&t.isPropertySelection())return this._impl.insertInlineNode(this,e)}insertBlockNode(e){const t=this._selection;if(t&&!t.isNull())return this._impl.insertBlockNode(this,e)}paste(e){const t=this._selection;if(t&&!t.isNull()&&!t.isCustomSelection())return this._impl.paste(this,e)}switchTextType(e){const t=this._selection;if(t&&!t.isNull())return this._impl.switchTextType(this,e)}toggleList(e){const t=this._selection;if(t&&!t.isNull())return this._impl.toggleList(this,e)}indent(){const e=this._selection;if(e&&!e.isNull())return this._impl.indent(this)}dedent(){const e=this._selection;if(e&&!e.isNull())return this._impl.dedent(this)}getIndex(...e){return this._document.getIndex(...e)}getAnnotations(...e){return this._document.getAnnotations(...e)}getSchema(){return this._document.getSchema()}createSnippet(){return this._document.createSnippet()}}class ChangeRecorder extends EditingInterface{constructor(e){super(e.clone())}generateChange(){const e=this.getDocument(),t=e._ops.slice();e._ops.length=0;let r=new DocumentChange(t,{},{});return r._extractInformation(e),r}}function encodeXMLEntities(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}class DOMExporter{constructor(e,t){if(this.context=t||{},!e.converters)throw new Error("config.converters is mandatory");if(e.converters._isRegistry?this.converters=e.converters:(this.converters=new DeprecatedRegistry,e.converters.forEach(function(e){let t=isFunction$1(e)?new e:e;t.type?this.converters.add(t.type,t):console.error("Converter must provide the type of the associated node.",t)}.bind(this))),this.state={doc:null},this.config=e,this._elementFactory=e.elementFactory,!this._elementFactory)throw new Error("'elementFactory' is mandatory");this.$$=this.createElement.bind(this)}exportDocument(e){return this.convertDocument(e)}convertDocument(e){throw new Error("This method is abstract")}convertContainer(e,t){if(!t)throw new Error("Illegal arguments: containerPath is mandatory.");return this.state.doc=e,e.get(t).map(t=>{let r=e.get(t);return this.convertNode(r)})}convertNode(e){isString(e)?e=this.state.doc.get(e):this.state.doc=e.getDocument();var t,r=this.getNodeConverter(e);return!e.isPropertyAnnotation()||r&&r.export?(r||(r=this.getDefaultBlockConverter()),(t=r.tagName?this.$$(r.tagName):this.$$("div")).attr(this.config.idAttribute,e.id),t=r.export?r.export(e,t,this)||t:this.getDefaultBlockConverter().export(e,t,this)||t):this._convertPropertyAnnotation(e)}convertProperty(e,t,r){return this.initialize(e,r),this.$$("div").append(this.annotatedText(t)).innerHTML}annotatedText(e){var t=this.state.doc,r=t.get(e),n=t.getIndex("annotations").get(e);return this._annotatedText(r,n)}getNodeConverter(e){return this.converters.get(e.type)}getDefaultBlockConverter(){throw new Error("This method is abstract.")}getDefaultPropertyAnnotationConverter(){throw new Error("This method is abstract.")}getDocument(){return this.state.doc}createElement(e){return this._elementFactory.createElement(e)}_annotatedText(e,t){var r=this,n=new Fragmenter;n.onText=function(e,t){t&&(r.config.ENCODE_ENTITIES_IN_TEXT&&(t=encodeXMLEntities(t)),e.children.push(t))},n.onEnter=function(e){return{annotation:e.node,children:[]}},n.onExit=function(e,t,n){var s,o=t.annotation,i=r.getNodeConverter(o);if(i||(i=r.getDefaultPropertyAnnotationConverter()),(s=i.tagName?this.$$(i.tagName):this.$$("span")).attr(this.config.idAttribute,o.id),o.isInlineNode())s=i.export?i.export(o,s,r)||s:this.convertNode(o)||s;else{if(!o.isAnnotation())throw new Error("Illegal element type: only inline nodes and annotations are allowed within a TextNode");if(i.export&&(s=i.export(o,s,r)||s).children.length)throw new Error("A converter for an annotation type must not convert children. The content of an annotation is owned by their TextNode.");s.append(t.children)}n.children.push(s)}.bind(this);var s={children:[]};return n.start(s,e,t),s.children}_convertPropertyAnnotation(e){return this.$$("div").append(this.annotatedText(e.path)).find("["+this.config.idAttribute+'="'+e.id+'"]')}}class HTMLExporter extends DOMExporter{constructor(e,t){super(_defaultConfig(e),t)}exportDocument(e){let t=DefaultDOMElement.parseHTML("<html><head></head><body></body></html>");return this.convertDocument(e,t)}getDefaultBlockConverter(){return defaultBlockConverter}getDefaultPropertyAnnotationConverter(){return defaultAnnotationConverter}}function _defaultConfig(e){return(e=Object.assign({idAttribute:"data-id"},e)).elementFactory||(e.elementFactory=DefaultDOMElement.createDocument("html")),e}const defaultAnnotationConverter={tagName:"span",export:function(e,t){t.tagName="span",t.attr("data-type",e.type),forEach(e.toJSON(),function(e,r){"id"!==r&&"type"!==r&&(isString(e)||isNumber(e)||isBoolean(e))&&t.attr("data-"+r,e)})}},defaultBlockConverter={export:function(e,t,r){t.attr("data-type",e.type),forEach(e.toJSON(),function(n,s){if("id"!==s&&"type"!==s){var o=r.$$("div").attr("property",s);"string"===e.getPropertyType(s)&&n?o.append(r.annotatedText([e.id,s])):o.text(n),t.append(o)}})}};class JSONConverter{importDocument(e,t){if(!t.nodes)throw new Error("Invalid JSON format.");var r=e.getSchema();if(t.schema&&r.name!==t.schema.name)throw new Error("Incompatible schema.");var n=t.nodes;return e.import(function(e){forEach(n,function(t){e.get(t.id)&&e.delete(t.id),e.create(t)})}),e}exportDocument(e){var t={schema:{name:e.getSchema().name},nodes:{}};return forEach(e.getNodes(),function(e){e._isDocumentNode&&(t.nodes[e.id]=e.toJSON())}),t}}class ClipboardExporter extends HTMLExporter{exportDocument(e){let t;this.state.doc=e;let r=this.convertDocument(e);t=1===r.length&&r[0].attr("data-id")===TEXT_SNIPPET_ID?r[0].innerHTML:r.map(function(e){return e.outerHTML}).join("");let n=new JSONConverter;return"<html><head>"+`<script id="substance-clipboard" type="application/json">${JSON.stringify(n.exportDocument(e))}<\/script>`+"</head><body>"+t+"</body></html>"}convertDocument(e){let t=e.get(SNIPPET_ID);if(!t)throw new Error('Illegal clipboard document: could not find container "'+SNIPPET_ID+'"');return this.convertContainer(e,t.getContentPath())}}function createCountingIdGenerator(){var e={};return function(t){return e.hasOwnProperty(t)||(e[t]=1),[t,"-",e[t]++].join("")}}const WS_LEFT=/^\s+/g,WS_RIGHT=/\s+$/g,WS_ALL=/\s+/g,SPACE=" ",TABS_OR_NL=/[\t\n\r]+/g,INVISIBLE_CHARACTER="​";class DOMImporter{constructor(e,t){if(this.context=t||{},!e.schema)throw new Error('"config.schema" is mandatory');if(!e.converters)throw new Error('"config.converters" is mandatory');this.config=Object.assign({idAttribute:"id"},e),this.schema=e.schema,this.converters=e.converters,this.state=null,this._defaultBlockConverter=null,this._allConverters=[],this._blockConverters=[],this._propertyAnnotationConverters=[],this.state=new DOMImporter.State,this._initialize()}_initialize(){const e=this.schema,t=e.getDefaultTextType(),r=this.converters;for(let n=0;n<r.length;n++){let s;if("function"==typeof r[n]){s=new(0,r[n])}else s=r[n];if(!s.type)throw new Error("Converter must provide the type of the associated node.");if(!s.matchElement&&!s.tagName)throw new Error("Converter must provide a matchElement function or a tagName property.");s.matchElement||(s.matchElement=this._defaultElementMatcher.bind(s));const o=e.getNodeClass(s.type);if(!o)throw new Error("No node type defined for converter");this._defaultBlockConverter||t!==s.type||(this._defaultBlockConverter=s),this._allConverters.push(s),o.isPropertyAnnotation()||o.isInlineNode()?this._propertyAnnotationConverters.push(s):this._blockConverters.push(s)}}dispose(){this.state.doc&&this.state.doc.dispose()}reset(){this.state.doc&&this.state.doc.dispose(),this.state.reset(),this.state.doc=this._createDocument()}getDocument(){return this.state.doc}convertContainer(e,t){this.state.doc||this.reset();const r=this.state,n=new ArrayIterator(e),s=[];for(;n.hasNext();){const e=n.next();let t;const o=this._getConverterForElement(e,"block");if(o){r.pushContext(e.tagName,o);let n=this._createNodeData(e,o.type);n=o.import(e,n,this)||n,t=this._createNode(n),r.popContext().annos.forEach(e=>{this._createNode(e)})}else{if(e.isCommentNode())continue;if(e.isTextNode()&&/^\s*$/.exec(e.textContent))continue;n.back(),t=this._wrapInlineElementsIntoBlockElement(n)}t&&s.push(t.id)}return this._createNode({type:"@container",id:t,nodes:s})}convertElement(e){this.state.doc||this.reset();let t,r,n=!this.state.isConverting;n&&(this.state.isConverting=!0);const s=this._getConverterForElement(e);if(!s)throw new Error("No converter found for "+e.tagName);{const n=this.schema.getNodeClass(s.type);t=this._createNodeData(e,s.type),this.state.pushContext(e.tagName,s),t=n.isInlineNode()?this._convertInlineNode(e,t,s):n.isPropertyAnnotation()?this._convertPropertyAnnotation(e,t):s.import(e,t,this)||t,r=this.state.popContext().annos}const o=this._createNode(t);return r.forEach(e=>{this._createNode(e)}),this.config["stand-alone"]&&n&&(this.state.isConverting=!1,this.reset()),o}annotatedText(e,t,r={}){if(!t)throw new Error("path is mandatory");const n=this.state,s=last$1(n.contexts);if(!s)throw new Error("This should be called from within an element converter.");const o=n.preserveWhitespace;r.preserveWhitespace&&(n.preserveWhitespace=!0),n.stack.push({path:t,offset:0,text:"",annos:[]}),this.state.lastChar="";const i=this.getChildNodeIterator(e),a=this._annotatedText(i),l=n.stack.pop();return s.annos=s.annos.concat(l.annos),n.preserveWhitespace=o,a}plainText(e){var t=this.state,r=e.textContent;if(t.stack.length>0){var n=last$1(t.stack);n.offset+=r.length,n.text+=n.text.concat(r)}return r}_customText(e){var t=this.state;if(t.stack.length>0){var r=last$1(t.stack);r.offset+=e.length,r.text+=r.text.concat(e)}return e}nextId(e){return this.state.uuid(e)}_getNextId(e,t){let r=this.nextId(t);for(;this.state.ids[r]||e.find("#"+r);)r=this.nextId(t);return r}_getIdForElement(e,t){let r=e.getAttribute(this.config.idAttribute);return r&&!this.state.ids[r]?r:this._getNextId(e.getOwnerDocument(),t)}_createDocument(){const e=this.config.schema;return new(e.getDocumentClass())(e)}_convertPropertyAnnotation(e,t){const r=[t.id,"_content"];return t._content=this.annotatedText(e,r),t.start={path:r,offset:0},t.end={offset:t._content.length},t}_convertInlineNode(e,t,r){const n=[t.id,"_content"];return r.import&&(t=r.import(e,t,this)||t),t._content="$",t.start={path:n,offset:0},t.end={offset:1},t}_createNodeData(e,t){if(!t)throw new Error("type is mandatory.");let r={type:t,id:this._getIdForElement(e,t)};return this.state.ids[r.id]=!0,r}_createNode(e){let t=this.state.doc,r=t.get(e.id);return r&&t.delete(r.id),t.create(e)}getChildNodeIterator(e){return e.getChildNodeIterator()}_defaultElementMatcher(e){return e.is(this.tagName)}_annotatedText(e){const t=this.state,r=last$1(t.stack);if(!r)throw new Error("Illegal state: context is null.");for(;e.hasNext();){var n=e.next(),s="";if(n.isTextNode())(s=this._prepareText(n.textContent)).length&&(r.text=r.text.concat(s),r.offset+=s.length);else{if(n.isCommentNode())continue;if(n.isElementNode()){const e=this._getConverterForElement(n,"inline");if(!e){this.IGNORE_DEFAULT_WARNINGS||console.warn("Unsupported inline element. We will not create an annotation for it, but process its children to extract annotated text.",n.outerHTML);const e=this.getChildNodeIterator(n);this._annotatedText(e);continue}var o=r.offset;const s=e.type,i=this.schema.getNodeClass(s);if(!i)throw new Error(`No Node class registered for type ${s}.`);let a=this._createNodeData(n,s),l={path:r.path,offset:o,text:"",annos:[]};if(t.stack.push(l),e.import&&(t.pushContext(n.tagName,e),a=e.import(n,a,this)||a,t.popContext()),i.isInlineNode())this._customText(INVISIBLE_CHARACTER),t.lastChar="";else{const e=this.getChildNodeIterator(n);this._annotatedText(e)}t.stack.pop(),r.offset=l.offset,r.text=r.text.concat(l.text);const c=r.offset;a.start={path:r.path.slice(0),offset:o},a.end={offset:c};let d=last$1(t.stack);d.annos=d.annos.concat(l.annos,a)}else console.warn("Unknown element type. Taking plain text.",n.outerHTML),s=this._prepareText(n.textContent),r.text=r.text.concat(s),r.offset+=s.length}}return r.text}_getConverterForElement(e,t){var r;if("block"===t){if(!e.tagName)return null;r=this._blockConverters}else r="inline"===t?this._propertyAnnotationConverters:this._allConverters;for(var n=null,s=0;s<r.length;s++)if(this._converterCanBeApplied(r[s],e)){n=r[s];break}return n}_converterCanBeApplied(e,t){return e.matchElement(t,this)}_wrapInlineElementsIntoBlockElement(e){if(!e.hasNext())return;const t=this._defaultBlockConverter;if(!t)throw new Error("Wrapping inline elements automatically is not supported in this schema.");let r=e.peek().getOwnerDocument(),n=r.createElement("wrapper");for(;e.hasNext();){const t=e.next();if(this._getConverterForElement(t,"block")){e.back();break}n.append(t.clone())}const s=this.schema.getDefaultTextType();let o={type:s,id:this._getNextId(r,s)};this.state.pushContext("wrapper",t),o=t.import(n,o,this)||o;let i=this.state.popContext().annos;const a=this._createNode(o);return i.forEach(e=>{this._createNode(e)}),a}_prepareText(e){const t=this.state;if(t.preserveWhitespace)return e;var r=SPACE;return e=e.replace(TABS_OR_NL,""),e=(e=t.lastChar===SPACE?e.replace(WS_LEFT,""):e.replace(WS_LEFT,r)).replace(WS_RIGHT,r),(this.config.REMOVE_INNER_WS||t.removeInnerWhitespace)&&(e=e.replace(WS_ALL,SPACE)),t.lastChar=e[e.length-1]||t.lastChar,e}_trimTextContent(e){var t,r,n=e.getChildNodes(),s=n[0],o=last$1(n);return s&&s.isTextNode()&&(t=s.textContent,r=this._trimLeft(t),s.textContent=r),o&&o.isTextNode()&&(t=o.textContent,r=this._trimRight(t),o.textContent=r),e}_trimLeft(e){return e.replace(WS_LEFT,"")}_trimRight(e){return e.replace(WS_RIGHT,"")}}class DOMImporterState{constructor(){this.reset()}reset(){this.preserveWhitespace=!1,this.nodes=[],this.annotations=[],this.containerPath=null,this.container=[],this.ids={},this.contexts=[],this.stack=[],this.lastChar="",this.skipTypes={},this.ignoreAnnotations=!1,this.isConverting=!1,this.uuid=createCountingIdGenerator()}pushContext(e,t){this.contexts.push({tagName:e,converter:t,annos:[]})}popContext(){return this.contexts.pop()}getCurrentContext(){return last$1(this.contexts)}}DOMImporter.State=DOMImporterState,DOMImporter.INVISIBLE_CHARACTER=INVISIBLE_CHARACTER;class HTMLImporter extends DOMImporter{constructor(e){super(Object.assign({idAttribute:"data-id"},e)),this._el=DefaultDOMElement.parseHTML("<html></html>")}importDocument(e){this.reset();var t=DefaultDOMElement.parseHTML(e);return this.convertDocument(t),this.state.doc}convertDocument(e){throw new Error("This method is abstract")}}const INLINENODES=["a","b","big","i","small","tt","abbr","acronym","cite","code","dfn","em","kbd","strong","samp","time","var","bdo","br","img","map","object","q","script","span","sub","sup","button","input","label","select","textarea"].reduce((e,t)=>(e[t]=!0,e),{});class ClipboardImporter extends HTMLImporter{constructor(e){super(_withCatchAllConverter(e)),this.IGNORE_DEFAULT_WARNINGS=!0,Object.assign(e,{trimWhitespaces:!0,REMOVE_INNER_WS:!0}),this.editorOptions=e.editorOptions}importDocument(e){if(platform.isWindows){let t=/<!--StartFragment-->(.*)<!--EndFragment-->/.exec(e);t&&(e=t[1])}if(e.search(/script id=.substance-clipboard./)>=0){let t=DefaultDOMElement.parseHTML(e).find("#substance-clipboard");if(t){let e=t.textContent;try{return this.importFromJSON(e)}finally{}}}if(this.editorOptions&&this.editorOptions.forcePlainTextPaste)return null;let t=DefaultDOMElement.parseHTML(e),r=t.find('meta[name="generator"]'),n=t.find("html").getAttribute("xmlns:w");if(r){r.getAttribute("content").indexOf("LibreOffice")>-1&&(this._isLibreOffice=!0)}else if(n){if(n.indexOf("office:word")>-1){this._isMicrosoftWord=!0;let r=/<!--StartFragment-->([\s\S]*)<!--EndFragment-->/.exec(e);r&&(t=DefaultDOMElement.parseHTML(r[1]))}}else e.indexOf("docs-internal-guid")>-1&&(this._isGoogleDoc=!0);let s=t.find("body");if(!(s=this._sanitizeBody(s)))return console.warn("Invalid HTML."),null;return this._wrapIntoParagraph(s),this.reset(),this.convertBody(s),this.state.doc}_sanitizeBody(e){if(e.findAll("meta").forEach(e=>e.remove()),this._isLibreOffice||this._isMicrosoftWord){let t=e.getInnerHTML();e.setInnerHTML(t.replace(/\r\n|\r|\n/g," "))}else this._isGoogleDoc&&(e=this._fixupGoogleDocsBody(e));return e}_fixupGoogleDocsBody(e){if(!e)return;let t=e.find("b");t&&/^docs-internal/.exec(t.id)&&(e=t),e.findAll("span").forEach(e=>{let t=[];"700"===e.getStyle("font-weight")&&t.push("b"),"italic"===e.getStyle("font-style")&&t.push("i"),"super"===e.getStyle("vertical-align")&&t.push("sup"),"sub"===e.getStyle("vertical-align")&&t.push("sub"),e.removeAttribute("style"),function r(n,s){if(t.length>0){let o=n.createElement(t[0]);1===t.length&&o.append(e.textContent),s?n.replaceChild(e,o):n.appendChild(o),t.shift(),r(o)}}(e.getParent(),!0)});return["b","i","sup","sub"].forEach(t=>{e.findAll(t).forEach(e=>{let r=e.getPreviousSibling();if(r&&e.tagName===r.tagName){let n=e.getParent(),s=n.createElement(t);s.setInnerHTML(r.getInnerHTML()+e.getInnerHTML()),n.replaceChild(e,s),n.removeChild(r)}if(r&&r.tagName&&e.getChildCount()>0&&e.getChildAt(0).tagName===r.tagName){let n=e.getParent(),s=e.getChildAt(0),o=n.createElement(r.tagName),i=o.createElement(t);i.setTextContent(s.textContent),o.appendChild(i),n.replaceChild(e,o)}})}),e}_wrapIntoParagraph(e){let t=e.getChildNodes(),r=!1;for(let e=0;e<t.length;e++){const n=t[e];if(n.isTextNode()){if(!/^\s+$/.exec(n.textContent)){r=!0;break}}else if(INLINENODES[n.tagName]){r=!0;break}}if(r){let r=e.createElement("p");r.append(t),e.append(r)}}importFromJSON(e){this.reset();let t=this.getDocument(),r=JSON.parse(e);return(new JSONConverter).importDocument(t,r),t}convertBody(e){this.convertContainer(e.childNodes,SNIPPET_ID)}_createDocument(){return super._createDocument().createSnippet()}}function _withCatchAllConverter(e){let t=(e=Object.assign({},e)).schema.getDefaultTextType();return t&&(e.converters=e.converters.concat([{type:t,matchElement:function(e){return e.is("div")},import:function(e,t,r){t.content=r.annotatedText(e,[t.id,"content"])}}])),e}class ContainerAdapter extends Container{constructor(e,t){super(e,{id:getKeyForPath(t)}),this.document=e,this.path=t,e.data.nodes[this.id]=this}getContentPath(){return this.path}get nodes(){return this.document.get(this.path)}get _isDocumentNode(){return!1}get _isContainer(){return!1}}class ContainerAnnotationIndex extends DocumentIndex{constructor(){super(),this.byId=new TreeIndex}select(e){return e.isContainerAnnotation()}clear(){this.byId.clear()}get(e,t){var r=map(this.byId.get(String(e)));return isString(t)&&(r=filter(r,DocumentIndex.filterByType)),r}create(e){this.byId.set([String(e.containerPath),e.id],e)}delete(e){this.byId.delete([String(e.containerPath),e.id])}update(e,t,r,n){}}class CoordinateAdapter extends Coordinate{constructor(e,t,r){super("SKIP"),this._owner=e,this._pathProp=t,this._offsetProp=r,Object.freeze(this)}equals(e){return e===this||isArrayEqual(e.path,this.path)&&e.offset===this.offset}get path(){return this._owner[this._pathProp]}set path(e){this._owner[this._pathProp]=e}get offset(){return this._owner[this._offsetProp]}set offset(e){this._owner[this._offsetProp]=e}toJSON(){return{path:this.path,offset:this.offset}}toString(){return"("+this.path.join(".")+", "+this.offset+")"}}function createDocumentFactory(e,t){return{ArticleClass:e,createEmptyArticle:function(){return new e},createArticle:function(){const r=new e;return t(r),r},createChangeset:function(){const r=new e,n=new ChangeRecorder(r);return t(n),[n.generateChange().toJSON()]}}}class Data extends EventEmitter{constructor(e,t){if(super(),!e)throw new Error("schema is mandatory");if(!t)throw new Error("nodeFactory is mandatory");this.schema=e,this.nodeFactory=t,this.nodes={},this.indexes={},this.__QUEUE_INDEXING__=!1,this.queue=[]}contains(e){return Boolean(this.nodes[e])}get(e,t){let r=this._get(e);if(t&&void 0===r)throw isString(e)?new Error("Could not find node with id '"+e+"'."):this.contains(e[0])?new Error("Property for path '"+e+"' us undefined."):new Error("Could not find node with id '"+e[0]+"'.");return r}_get(e){if(!e)return;let t;if(isString(e)){let r=e;t=this.nodes[r]}else if(1===e.length){let r=e[0];t=this.nodes[r]}else if(e.length>1){let r=e[0],n=this.nodes[r];for(let t=1;t<e.length-1;t++){if(!n)return;n=n[e[t]]}if(!n)return;t=n[e[e.length-1]]}return t}getNodes(){return this.nodes}create(e){var t=this.nodeFactory.create(e.type,e);if(!t)throw new Error("Illegal argument: could not create node for data:",e);if(this.contains(t.id))throw new Error("Node already exists: "+t.id);if(!t.id||!t.type)throw new Error("Node id and type are mandatory.");this.nodes[t.id]=t;var r={type:"create",node:t};return this.__QUEUE_INDEXING__?this.queue.push(r):this._updateIndexes(r),t}delete(e){var t=this.nodes[e];if(t){t.dispose(),delete this.nodes[e];var r={type:"delete",node:t};return this.__QUEUE_INDEXING__?this.queue.push(r):this._updateIndexes(r),t}}set(e,t){let r=this.get(e[0]),n=this._set(e,t);var s={type:"set",node:r,path:e,newValue:t,oldValue:n};return this.__QUEUE_INDEXING__?this.queue.push(s):this._updateIndexes(s),n}_set(e,t){return _setValue(this.nodes,e,t)}update(e,t){let r,n=this.get(e[0]),s=this._get(e);if(t._isOperation)if(t._isArrayOperation){let e=s;s=Array.from(s),r=t.apply(e)}else if(t._isCoordinateOperation){let e=s;s=s.clone(),r=t.apply(e)}else r=t.apply(s);else if(t=this._normalizeDiff(s,t),isString(s))switch(t.type){case"delete":r=s.split("").splice(t.start,t.end-t.start).join("");break;case"insert":r=[s.substring(0,t.start),t.text,s.substring(t.start)].join("");break;default:throw new Error("Unknown diff type")}else if(isArray(s))switch(r=s.slice(0),t.type){case"delete":r.splice(t.pos,1);break;case"insert":r.splice(t.pos,0,t.value);break;default:throw new Error("Unknown diff type")}else{if(!s._isCoordinate)throw new Error("Diff is not supported:",JSON.stringify(t));switch(t.type){case"shift":(r=s={path:s.path,offset:s.offset}).offset+=t.value;break;default:throw new Error("Unknown diff type")}}this._set(e,r);var o={type:"update",node:n,path:e,newValue:r,oldValue:s};return this.__QUEUE_INDEXING__?this.queue.push(o):this._updateIndexes(o),s}_normalizeDiff(e,t){return isString(e)?t.delete?(console.warn('DEPRECATED: use doc.update(path, {type:"delete", start:s, end: e}) instead'),t={type:"delete",start:t.delete.start,end:t.delete.end}):t.insert&&(console.warn('DEPRECATED: use doc.update(path, {type:"insert", start:s, text: t}) instead'),t={type:"insert",start:t.insert.offset,text:t.insert.value}):isArray(e)?t.delete?(console.warn('DEPRECATED: use doc.update(path, {type:"delete", pos:1}) instead'),t={type:"delete",pos:t.delete.offset}):t.insert&&(console.warn('DEPRECATED: use doc.update(path, {type:"insert", pos:1, value: "foo"}) instead'),t={type:"insert",pos:t.insert.offset,value:t.insert.value}):e._isCoordinate&&t.hasOwnProperty("shift")&&(console.warn('DEPRECATED: use doc.update(path, {type:"shift", value:2}) instead'),t={type:"shift",value:t.shift}),t}toJSON(){let e={};return forEach(this.nodes,t=>{e[t.id]=t.toJSON()}),{schema:[this.schema.id,this.schema.version],nodes:e}}reset(){this.clear()}clear(){this.nodes={},forEach(this.indexes,e=>e.clear())}addIndex(e,t){return this.indexes[e]&&console.error("Index with name %s already exists.",e),t.reset(this),this.indexes[e]=t,t}getIndex(e){return this.indexes[e]}_updateIndexes(e){e&&!this.__QUEUE_INDEXING__&&forEach(this.indexes,function(t){if(t.select(e.node))switch(t[e.type]||console.error("Contract: every NodeIndex must implement "+e.type),e.type){case"create":t.create(e.node);break;case"delete":t.delete(e.node);break;case"set":t.set(e.node,e.path,e.newValue,e.oldValue);break;case"update":t.update(e.node,e.path,e.newValue,e.oldValue);break;default:throw new Error("Illegal state.")}})}_stopIndexing(){this.__QUEUE_INDEXING__=!0}_startIndexing(){for(this.__QUEUE_INDEXING__=!1;this.queue.length>0;){var e=this.queue.shift();this._updateIndexes(e)}}}function _setValue(e,t,r){isArray(r)?r=r.slice():isPlainObject(r)&&(r=cloneDeep(r));let n=e,s=t.length;for(let e=0;e<s-1;e++)if(!(n=n[t[e]]))throw new Error("Can not set value.");let o=t[s-1],i=n[o];return n._isNode?n._set(o,r):n[o]=r,i}class DefaultChangeCompressor{shouldMerge(e,t){return!1}merge(e,t){var r=e.ops[0],n=t.ops[0],s=r.diff,o=n.diff,i=!1;return s.isInsert()?s.pos+s.getLength()===o.pos&&((i=r.toJSON()).diff.str+=o.str):s.isDelete()&&(s.pos===o.pos?(i=r.toJSON()).diff.str+=o.str:o.pos+o.getLength()===s.pos&&((i=r.toJSON()).diff=o,i.diff.str+=s.str)),!!i&&(e.ops[0]=ObjectOperation.fromJSON(i),e.ops.length>1&&(e.ops=e.ops.concat(t.ops.slice(1)),e.after=t.after),!0)}}class FileProxy{constructor(e,t){this.fileNode=e,this.context=t,e.setProxy(this)}get id(){return this.fileNode.id}triggerUpdate(){let e=this.fileNode.id;this.context.editorSession.transaction(t=>{t.set([e,"__changed__"],"")},{history:!1})}getUrl(){return""}sync(){return Promise.reject(new Error("sync method not implemented"))}}FileProxy.match=function(e,t){return!1};class DefaultFileProxy extends FileProxy{constructor(e,t){super(e,t),this.file=e.sourceFile,this.file&&(this._fileUrl=URL.createObjectURL(this.file)),this.url=e.url}getUrl(){return this.url?this.url:this._fileUrl?this._fileUrl:""}sync(){return this.url||(console.info("Simulating file upload. Creating blob url instead.",this._fileUrl),this.url=this._fileUrl),Promise.resolve()}}class PropertyIndex extends NodeIndex{constructor(e){super(),this._property=e||"id",this.index=new TreeIndex}get(e){return this.index.get(e)||{}}getAll(e){return this.index.getAll(e)}clear(){this.index.clear()}select(e){return!0}create(e){var t=e[this._property];isArray(t)||(t=[t]),forEach(t,function(t){this.index.set([t,e.id],e)}.bind(this))}delete(e){var t=e[this._property];isArray(t)||(t=[t]),forEach(t,function(t){this.index.delete([t,e.id])}.bind(this))}update(e,t,r,n){if(this.select(e)&&t[1]===this._property){var s=n;isArray(s)||(s=[s]),forEach(s,function(t){this.index.delete([t,e.id])}.bind(this)),isArray(s=r)||(s=[s]),forEach(s,function(t){this.index.set([t,e.id],e)}.bind(this))}}set(e,t,r,n){this.update(e,t,r,n)}_initialize(e){forEach(e.getNodes(),function(e){this.select(e)&&this.create(e)}.bind(this))}}class IncrementalData extends Data{create(e){e._isNode&&(e=e.toJSON());let t=ObjectOperation.Create([e.id],e);return this.apply(t),t}delete(e){var t=null,r=this.get(e);if(r){var n=r.toJSON();t=ObjectOperation.Delete([e],n),this.apply(t)}return t}update(e,t){var r=this._getDiffOp(e,t),n=ObjectOperation.Update(e,r);return this.apply(n),n}set(e,t){var r=this.get(e),n=ObjectOperation.Set(e,r,t);return this.apply(n),n}apply(e){if(e.type!==ObjectOperation.NOP){if(e.type===ObjectOperation.CREATE)super.create(cloneDeep(e.val));else if(e.type===ObjectOperation.DELETE)super.delete(e.val.id);else if(e.type===ObjectOperation.UPDATE){let t=e.diff;super.update(e.path,t)}else{if(e.type!==ObjectOperation.SET)throw new Error("Illegal state.");super.set(e.path,e.val)}this.emit("operation:applied",e,this)}}_getDiffOp(e,t){var r=null;if(t.isOperation)r=t;else{var n=this.get(e);if(t=this._normalizeDiff(n,t),null===n||void 0===n)throw new Error("Property has not been initialized: "+JSON.stringify(e));if(isString(n))switch(t.type){case"delete":r=TextOperation.Delete(t.start,n.substring(t.start,t.end));break;case"insert":r=TextOperation.Insert(t.start,t.text);break;default:throw new Error("Unknown diff type")}else if(isArray(n))switch(t.type){case"delete":r=ArrayOperation.Delete(t.pos,n[t.pos]);break;case"insert":r=ArrayOperation.Insert(t.pos,t.value);break;default:throw new Error("Unknown diff type")}else if(n._isCoordinate)switch(t.type){case"shift":r=CoordinateOperation.Shift(t.value);break;default:throw new Error("Unknown diff type")}}if(!r)throw new Error("Unsupported diff: "+JSON.stringify(t));return r}}class DocumentNodeFactory{constructor(e){this.doc=e}create(e,t){var r=this.doc.schema.getNodeClass(e);if(!r)throw new Error("No node registered by that name: "+e);return new r(this.doc,t)}}class ParentNodeHook{constructor(e){this.doc=e,this.parents={},e.data.on("operation:applied",this._onOperationApplied,this)}_onOperationApplied(e){let t,r=this.doc.get(e.path[0]),n=!1,s=!1;switch(r&&(n=(t=r.getSchema()).hasOwnedProperties(),s=r.isAnnotation()),e.type){case"create":if(n)for(let e of t.getOwnedProperties()){let t=e.isArray(),n=r[e.name];n&&this._setParent(r,n,e.name,t),t&&this._updateContainerPositions([r.id,e.name])}s&&this._setAnnotationParent(r),this._setRegisteredParent(r);break;case"update":if(n){let n=e.path[1];if(t.isOwned(n)){let t=e.diff,s=t._isArrayOperation;t.isDelete()?this._setParent(null,t.getValue(),n,s):this._setParent(r,t.getValue(),n,s),s&&this._updateContainerPositions(e.path)}}break;case"set":if(n){let n=e.path[1];if(t.isOwned(n)){let s=t.getProperty(n).isArray(),o=e.getOldValue(),i=e.getValue();this._setParent(null,o,n,s),this._setParent(r,i,n,s),s&&this._updateContainerPositions(e.path)}}s&&"start"===e.path[1]&&"path"===e.path[2]&&this._setAnnotationParent(r)}}_setParent(e,t,r,n){t&&(isArray(t)?t.forEach(t=>this.__setParent(e,t,r,n)):this.__setParent(e,t,r,n))}__setParent(e,t,r,n){let s=this.doc.get(t);s?this._setParentAndXpath(e,s,r):this.parents[t]={parent:e,property:r,isChildren:n}}_setRegisteredParent(e){let t=this.parents[e.id];if(t){let{parent:r,property:n,isChildren:s}=t;this._setParentAndXpath(r,e,n),s&&(e._xpath.pos=r[n].indexOf(e.id)),delete this.parents[e.id]}}_setParentAndXpath(e,t,r){t.setParent(e);let n=t._xpath;e?(n.prev=e._xpath,n.property=r):(n.prev=null,n.property=null,n.pos=null)}_updateContainerPositions(e){let t=this.doc,r=t.get(e);if(r)for(let e=0;e<r.length;e++){let n=r[e],s=t.get(n);s&&(s._xpath.pos=e)}}_setAnnotationParent(e){let t=e.getDocument(),r=e.start.path,n=t.get(r[0]);this._setParent(n,e.id,r[1])}}ParentNodeHook.register=function(e){return new ParentNodeHook(e)};const converter=new JSONConverter;class Document extends EventEmitter{constructor(e,...t){if(super(),this.schema=e,!e)throw new Error("A document needs a schema for reflection.");this._ops=[],this._initialize(...t)}_initialize(){this.__id__=uuid(),this.nodeFactory=new DocumentNodeFactory(this),this.data=new IncrementalData(this.schema,this.nodeFactory),this.addIndex("type",new PropertyIndex("type")),this.addIndex("annotations",new AnnotationIndex),this.addIndex("container-annotations",new ContainerAnnotationIndex),ParentNodeHook.register(this)}dispose(){this.off(),this.data.off()}get id(){return this.__id__}getSchema(){return this.schema}contains(e){return this.data.contains(e)}get(e,t){return this.data.get(e,t)}resolve(e,t){let r=this.getProperty(e);if(!r){if(t)throw new Error("Invalid path");return}let n=this.get(e,t);return r.isReference()?r.isArray()?n.map(e=>this.get(e)):this.get(n):n}getNodes(){return this.data.getNodes()}getAnnotations(e){return this.getIndex("annotations").get(e)}getProperty(e){if(2!==e.length)throw new Error("path must have length=2");let[t,r]=e,n=this.get(t);if(n)return n.getSchema().getProperty(r);throw new Error("Invalid path.")}import(e){try{this.data._stopIndexing(),e(this),this.data._startIndexing()}finally{this.data.queue=[],this.data._startIndexing()}}create(e){if(e.id||(e.id=uuid(e.type)),!e.type)throw new Error("No node type provided");const t=this._create(e);if(t)return this._ops.push(t),this._isTransactionDocument||this._emitChange(t),this.get(e.id)}createDefaultTextNode(e,t){return this.create({type:this.getSchema().getDefaultTextType(),content:e||"",direction:t})}delete(e){const t=this.get(e),r=this._delete(e);return r&&(this._ops.push(r),this._isTransactionDocument||this._emitChange(r)),t}set(e,t){const r=this.get(e),n=this._set(e,t);return n&&(this._ops.push(n),this._isTransactionDocument||this._emitChange(n)),r}update(e,t){const r=this._update(e,t);return r&&(this._ops.push(r),this._isTransactionDocument||this._emitChange(r)),r}updateNode(e,t){let r=this.get(e);forEach(t,(n,s)=>{isEqual(r[s],t[s])||this.set([e,s],n)})}addIndex(e,t){return this.data.addIndex(e,t)}getIndex(e){return this.data.getIndex(e)}createSelection(e){let t;if(isNil(e))return Selection.nullSelection;if(1!==arguments.length||!isPlainObject(e))throw new Error("Illegal argument: call createSelection({ type: ... }");switch(e.type){case"property":{isNil(e.endOffset)&&(e.endOffset=e.startOffset),e.hasOwnProperty("reverse")||e.startOffset>e.endOffset&&([e.startOffset,e.endOffset]=[e.endOffset,e.startOffset],e.reverse=!e.reverse);let r=this.get(e.path,"strict");if(e.startOffset<0||e.startOffset>r.length)throw new Error("Invalid startOffset: target property has length "+r.length+", given startOffset is "+e.startOffset);if(e.endOffset<0||e.endOffset>r.length)throw new Error("Invalid startOffset: target property has length "+r.length+", given endOffset is "+e.endOffset);t=new PropertySelection(e);break}case"container":{let r=e.containerPath;if(!this.get(r))throw new Error('Can not create ContainerSelection: container "'+r+'" does not exist.');let n=this._normalizeCoor({path:e.startPath,offset:e.startOffset,containerPath:r}),s=this._normalizeCoor({path:e.endPath,offset:e.endOffset,containerPath:r});e.hasOwnProperty("reverse")||compareCoordinates(this,r,n,s)>0&&([n,s]=[s,n],e.reverse=!0),t=new ContainerSelection(r,n.path,n.offset,s.path,s.offset,e.reverse,e.surfaceId);break}case"node":t=createNodeSelection({doc:this,nodeId:e.nodeId,mode:e.mode,containerPath:e.containerPath,reverse:e.reverse,surfaceId:e.surfaceId});break;case"custom":t=CustomSelection.fromJSON(e);break;default:throw new Error("Illegal selection type",e)}return t.isNull()||t.attach(this),t}newInstance(){return new(0,this.constructor)(this.schema)}createSnippet(){var e=this.newInstance(),t=e.create({type:"@container",id:SNIPPET_ID});return e.getContainer=function(){return t},e}rebase(e,t){return t.length>0&&transformDocumentChange(t,e,{rebase:!0,immutableLeft:!0}),e}createFromDocument(e){this.clear();let t=Object.values(e.getNodes()),r={},n=new Set;return t.forEach(e=>{n.has(e)||this._computeDependencyLevel(e,r,n)}),t.sort((e,t)=>r[t.id]-r[e.id]),t.forEach(e=>this.create(e)),this}_computeDependencyLevel(e,t,r){if(!e)throw new Error("node was nil");if(r.has(e))throw new Error("Cyclic node dependency");r.add(e);let n=0;if(e.isAnnotation()||e.isInlineNode())n=-1;else{let s=e.getParent();if(s){let e;n=(e=t.hasOwnProperty(s.id)?t[s.id]:this._computeDependencyLevel(s,t,r))+1}}return t[e.id]=n,n}toJSON(){return converter.exportDocument(this)}clone(){let e=this.newInstance();return e.createFromDocument(this),e}clear(){this.data.clear(),this._ops.length=0}createEditingInterface(){return new EditingInterface(this)}invert(e){return e.invert()}_apply(e){let t=e.ops;for(let e of t)this._applyOp(e);e._extractInformation(this)}_applyOp(e){this.data.apply(e),this.emit("operation:applied",e)}_create(e){return this.data.create(e)}_delete(e){return this.data.delete(e)}_set(e,t){return this.data.set(e,t)}_update(e,t){return this.data.update(e,t)}_emitChange(e){const t=new DocumentChange([e],{},{});t._extractInformation(this),this._notifyChangeListeners(t,{hidden:!0})}_notifyChangeListeners(e,t){t=t||{},this.emit("document:changed",e,t,this)}_createSelectionFromRange(e){if(!e)return Selection.nullSelection;return isEqual(e.start.path,e.end.path)?e.start.isNodeCoordinate()?new NodeSelection(e.containerPath,e.start.getNodeId(),"full",e.reverse,e.surfaceId):this.createSelection({type:"property",path:e.start.path,startOffset:e.start.offset,endOffset:e.end.offset,reverse:e.reverse,containerPath:e.containerPath,surfaceId:e.surfaceId}):this.createSelection({type:"container",startPath:e.start.path,startOffset:e.start.offset,endPath:e.end.path,endOffset:e.end.offset,reverse:e.reverse,containerPath:e.containerPath,surfaceId:e.surfaceId})}_normalizeCoor({path:e,offset:t,containerPath:r}){if(1===e.length){let n=getContainerRoot(this,r,e[0]);if(n.isText())return new Coordinate(n.getPath(),0===t?0:n.getLength());if(n.isList()){if(0===t){let e=n.getItemAt(0);return new Coordinate(e.getPath(),0)}{let e=this.get(last$1(n.items));return new Coordinate(e.getPath(),e.getLength())}}}return new Coordinate(e,t)}get _isDocument(){return!0}}class DocumentSession extends EventEmitter{constructor(e){super(),this._document=e,this._history=[],e.on("document:changed",this._onDocumentChange,this)}dispose(){this._document.off(this)}getDocument(){return this._document}updateNodeStates(e,t={}){const r=this._document;let n=new DocumentChange([],{},{}),s={action:"node-state-update"};n._extractInformation(),n.info=s;for(let[t,s]of e){let e=r.get(t);e&&(e.state||(e.state={}),Object.assign(e.state,s),n.updated[t]=!0)}t.silent||(r._notifyChangeListeners(n,s),this.emit("change",n,s))}revert(e){let t=this._history[e];if(!t)throw new Error("Illegal change index");const r=this.getDocument();let n=r.invert(t),s=this._history.slice(e+1),o=r.rebase(n,s);return this._applyChange(o,{replay:"true"}),o}_commitChange(e,t){e.timestamp=Date.now(),this._applyChange(e,t)}_applyChange(e,t){if(!e)throw new Error("Invalid change");const r=this.getDocument();r._apply(e),r._notifyChangeListeners(e,t),this.emit("change",e,t)}_onDocumentChange(e){e&&e.ops.length>0&&this._history.push(e)}}class FileNode extends DocumentNode{getUrl(){return this.proxy?this.proxy.getUrl():(console.warn("No file proxy attached to ",this.id),"")}setProxy(e){this.proxy=e}get _isFileNode(){return!0}static get _isFileNode(){return!0}}function getChangeFromDocument(e){return new ChangeRecorder(e).generateChange()}function importNodeIntoDocument(e,t){let r=_transferWithDisambiguatedIds(t.getDocument(),e,t.id,{});return e.get(r)}FileNode.schema={type:"file",url:{type:"string",optional:!0},fileType:{type:"string",optional:!0},mimeType:{type:"string",optional:!0},sourceFile:{type:"object",optional:!0}};class InlineNode extends(AnnotationMixin(DocumentNode)){static isInlineNode(){return!0}}const ERR_ABSTRACT="This method is abstract!";function ListMixin(e){return class extends e{createListItem(e){throw new Error(ERR_ABSTRACT)}getItems(){throw new Error(ERR_ABSTRACT)}getItemsPath(){throw new Error(ERR_ABSTRACT)}insertItemAt(e,t){throw new Error(ERR_ABSTRACT)}removeItemAt(e){throw new Error(ERR_ABSTRACT)}getItemAt(e){return this.getItems()[e]}getItemPosition(e){return this.getItems().indexOf(e)}getLength(){return this.getItems().length}getFirstItem(){return this.getItemAt(0)}getLastItem(){return this.getItemAt(this.getLength()-1)}appendItem(e){this.insertItemAt(this.items.length,e)}removeItem(e){const t=this.getItemPosition(e);t>=0&&this.removeItemAt(t)}isEmpty(){return 0===this.getLength()}get length(){return this.getLength()}getListType(e){let t=e-1;return this._getListTypes()[t]||"bullet"}setListType(e,t){let r=e-1,n=this._getListTypes();if(n.length<e)for(let e=0;e<r;e++)n[e]||(n[e]="bullet");n[r]=t,this._setListTypes(n)}_getListTypes(){let e=this.getListTypeString();return e?e.split(",").map(e=>e.trim()):[]}_setListTypes(e){isArray(e)&&(e=e.join(",")),this.getListTypeString()!==e&&this.setListTypeString(e)}static isList(){return!0}}}const STRING={type:"string",default:""};function TEXT$1(...e){return{type:"text",targetTypes:e=flatten$1(e)}}const PLAIN_TEXT=Object.freeze(TEXT$1()),STRING_ARRAY={type:["array","string"],default:[]},BOOLEAN={type:"boolean",default:!1};function ENUM(e,t={}){let r={type:"enum",values:e};return Object.assign(r,t),r}function MANY(...e){return{type:["array","id"],targetTypes:e=flatten$1(e),default:[]}}function ONE(...e){return{type:"id",targetTypes:e=flatten$1(e),default:null}}function CHILDREN(...e){return{type:["array","id"],targetTypes:e=flatten$1(e),default:[],owned:!0}}function CHILD(...e){return{type:"id",targetTypes:e=flatten$1(e),owned:!0}}function CONTAINER(e){let t,r;if(isString(e)?(t=[e],r=e):({nodeTypes:t,defaultTextType:r}=e),!t)throw new Error("CONTAINER({ nodeTypes: [...] }) is mandatory.");if(!r)throw new Error("CONTAINER({ defaultTextType: [...] }) is mandatory.");let n=CHILDREN(...t);return n.defaultTextType=r,n._isContainer=!0,n}function OPTIONAL(e){return e.optional=!0,e}function TextNodeMixin(e){return class extends e{getTextPath(){return console.warn("DEPRECATED: use node.getPath()"),this.getPath()}getText(){return this.content}setText(e){return setText(this.getDocument(),this.getPath(),e),this}isEmpty(){return!this.getText()}getLength(){return this.getText().length}getAnnotations(){return this.getDocument().getIndex("annotations").get(this.getPath())}}}class TextNode extends(TextNodeMixin(DocumentNode)){getPath(){return[this.id,"content"]}getText(){return this.content}static isText(){return!0}}TextNode.schema={type:"text-node",content:"text",direction:{type:"enum",optional:!0,values:["left","right"]},textAlign:{type:"enum",default:"left",values:["left","right"]}};class TextBlock extends TextNode{static isBlock(){return!0}}class XMLExporter extends DOMExporter{constructor(e,t){super(_defaultConfig$1(e),t)}getDefaultBlockConverter(){return defaultBlockConverter$1}getDefaultPropertyAnnotationConverter(){return defaultAnnotationConverter$1}}function _defaultConfig$1(e){if(!(e=Object.assign({idAttribute:"id"},e)).elementFactory){let t={version:e.xmlVersion||"1.0",encoding:e.xmlEncoding||"UTF-8"};e.elementFactory=DefaultDOMElement.createDocument("xml",t)}return e}const defaultAnnotationConverter$1={tagName:"annotation",export:function(e,t){t.attr("type",e.type),forEach(e.toJSON(),function(e,r){"id"!==r&&"type"!==r&&(isString(e)||isNumber(e)||isBoolean(e))&&t.attr(r,e)})}},defaultBlockConverter$1={tagName:"block",export:function(e,t,r){t.attr("type",e.type),forEach(e.toJSON(),function(n,s){if("id"===s||"type"===s)return;const o=r.$$(s);"string"===e.getPropertyType(s)?o.append(r.annotatedText([e.id,s])):o.text(n),t.append(o)})}};class XMLImporter extends DOMImporter{constructor(e,t){super(Object.assign({idAttribute:"id"},e),t)}importDocument(e){this.reset();let t=DefaultDOMElement.parseXML(e);return this.convertDocument(t),this.state.doc}convertDocument(e){let t=e.children[0];if(!t)throw new Error("XML Root node could not be found.");this.convertElement(t)}}class AbstractClipboard{constructor(e){let t=e.getSchema(),r=e.getConverterRegistry(),n=[];r&&r.contains("html")&&(n=r.get("html").values()||[]),this._config={schema:t,DocumentClass:t.getDocumentClass(),converters:n,editorOptions:e.getEditorOptions()}}onCopy(e){let t=this._copy();substanceGlobals._clipboardData=e.clipboardData,e.clipboardData&&t.doc&&(e.preventDefault(),e.clipboardData.setData("text/plain",t.text),e.clipboardData.setData("text/html",t.html))}onCut(e){e.preventDefault(),this.onCopy(e),this._cut()}onPaste(e){let t,r,n=e.clipboardData,s={};for(let e=0;e<n.types.length;e++)s[n.types[e]]=!0;e.preventDefault(),e.stopPropagation(),s["text/plain"]&&(t=n.getData("text/plain")),s["text/html"]&&(r=n.getData("text/html")),substanceGlobals.clipboardData={text:t,html:r},r&&this._pasteHtml(r,t)||this._pastePlainText(t)}_getImporter(){return new ClipboardImporter(this._config)}_getExporter(){return new ClipboardExporter(this._config)}_copy(){throw new Error("This method is abstract.")}_cut(){throw new Error("This method is abstract.")}_pastePlainText(e){throw new Error("This method is abstract.")}_pasteHtml(e,t){throw new Error("This method is abstract.")}}class Command{constructor(e){if(this.config=e||{},this.name=this.config.name,!this.name)throw new Error("'name' is required")}get isAsync(){return!1}getName(){return this.name}getCommandState(e,t){throw new Error("Command.getCommandState() is abstract.")}execute(e,t){throw new Error("Command.execute() is abstract.")}isAnnotationCommand(){return!1}isInsertCommand(){return!1}isSwitchTypeCommand(){return!1}getParams(e){return new HandlerParams(e)}get _isCommand(){return!0}}Command.DISABLED=Object.freeze({disabled:!0,active:!1});class AnnotationCommand extends Command{constructor(e){if(super(e),!this.config.nodeType)throw new Error("'nodeType' is required")}getAnnotationType(){return this.config.nodeType}getType(){return this.getAnnotationType()}getAnnotationData(){return{}}isDisabled(e,t){let r=t.selectionState;return!!(t.editorSession.isBlurred()||!e||e.isNull()||!e.isAttached()||e.isCustomSelection()||e.isNodeSelection()||e.isContainerSelection()||r.isInlineNodeSelection)}showInContext(e){return!e.isCollapsed()}canCreate(e,t){if(t.isCollapsed())return!1;if(0===e.length)return!0;for(let r of e)if(t.overlaps(r.getSelection(),"strict"))return!1;return!0}canFuse(e,t){return e.length>=2&&!t.isCollapsed()}canDelete(e,t){if(1!==e.length)return!1;let r=e[0].getSelection();return t.isInsideOf(r)}canExpand(e,t){if(1!==e.length)return!1;let r=e[0].getSelection();return t.overlaps(r,"strict")&&!t.isInsideOf(r)}canTruncate(e,t){if(1!==e.length)return!1;let r=e[0].getSelection();return(t.isLeftAlignedWith(r)||t.isRightAlignedWith(r))&&!t.contains(r)&&!t.isCollapsed()}getCommandState(e,t){const r=e.selection;if(this.isDisabled(r,e,t))return{disabled:!0};let n=this._getAnnotationsForSelection(e),s={disabled:!1,active:!1,mode:null};return this.canCreate(n,r)?s.mode="create":this.canFuse(n,r)?s.mode="fuse":this.canTruncate(n,r)?(s.active=!0,s.mode="truncate"):this.canExpand(n,r)?s.mode="expand":this.canDelete(n,r)?(s.active=!0,s.mode="delete"):s.disabled=!0,s.showInContext=this.showInContext(r,e,t),s}execute(e,t){let r=e.commandState;if(r.disabled)return!1;switch(r.mode){case"create":return this.executeCreate(e,t);case"fuse":return this.executeFuse(e,t);case"truncate":return this.executeTruncate(e,t);case"expand":return this.executeExpand(e,t);case"delete":return this.executeDelete(e,t);default:return console.warn("Command.execute(): unknown mode",r.mode),!1}}executeCreate(e,t){const r=e.editorSession,n=this._getAnnotationsForSelection(e,t);this._checkPrecondition(e,n,this.canCreate);let s,o=this.getAnnotationData();return o.type=this.getAnnotationType(),r.transaction(e=>{s=e.annotate(o)}),{mode:"create",anno:s}}executeFuse(e){let t=this._getAnnotationsForSelection(e);return this._checkPrecondition(e,t,this.canFuse),this._applyTransform(e,e=>{annotationHelpers.fuseAnnotation(e,t)}),{mode:"fuse",anno:t[0]}}executeTruncate(e){let t=this._getAnnotationsForSelection(e),r=t[0];return this._checkPrecondition(e,t,this.canTruncate),this._applyTransform(e,t=>{annotationHelpers.truncateAnnotation(t,r,e.selection)}),{mode:"truncate",anno:r}}executeExpand(e){let t=this._getAnnotationsForSelection(e),r=t[0];return this._checkPrecondition(e,t,this.canExpand),this._applyTransform(e,t=>{annotationHelpers.expandAnnotation(t,r,e.selection)}),{mode:"expand",anno:r}}executeDelete(e){let t=this._getAnnotationsForSelection(e),r=t[0];return this._checkPrecondition(e,t,this.canDelete),this._applyTransform(e,e=>e.delete(r.id)),{mode:"delete",annoId:r.id}}isAnnotationCommand(){return!0}_checkPrecondition(e,t,r){let n=e.selection;if(!r.call(this,t,n))throw new Error("AnnotationCommand: can't execute command for selection "+n.toString())}_getAnnotationsForSelection(e){return e.selectionState.annosByType[this.getAnnotationType()]||[]}_applyTransform(e,t){const r=e.editorSession,n=e.selection;if(n.isNull())return;let s;return r.setSelection(n),r.transaction(function(r){let n=t(r,e);n&&(s=n.result)}),s}}class AnnotationComponent extends Component{didMount(){this.props.node.on("highlighted",this.onHighlightedChanged,this)}dispose(){this.props.node.off(this)}render(e){let t=e(this.getTagName()).attr("data-id",this.props.node.id).addClass(this.getClassNames());return this.props.node.highlighted&&t.addClass("sm-highlighted"),t.append(this.props.children),t}getClassNames(){return"sc-"+this.props.node.type}onHighlightedChanged(){this.props.node.highlighted?this.el.addClass("sm-highlighted"):this.el.removeClass("sm-highlighted")}getTagName(){return"span"}}class NodeComponent extends Component{didMount(){this.context.editorSession.onRender("document",this.rerender,this,{path:[this.props.node.id]})}dispose(){this.context.editorSession.off(this)}render(e){return e(this.getTagName()).attr("data-id",this.props.node.id).addClass(this.getClassNames())}getTagName(){return"div"}getClassNames(){return""}rerender(...e){this.props.node.isDisposed()||super.rerender(...e)}}class BlockNodeComponent extends NodeComponent{}class Button extends Component{render(e){let t=e("button").addClass("sc-button");return this.props.icon&&t.append(this.renderIcon(e)),this.props.label&&t.append(this.renderLabel(e)),this.props.dropdown&&t.append(this.renderDropdownIcon(e)),this.props.active&&t.addClass("sm-active"),this.props.theme&&t.addClass("sm-theme-"+this.props.theme),this.props.disabled?t.attr("tabindex",-1).attr("disabled",!0):t.attr("tabindex",1),t.append(this.props.children),t}renderIcon(e){return this.context.iconProvider.renderIcon(e,this.props.icon)}renderDropdownIcon(e){let t=this.context.iconProvider.renderIcon(e,"dropdown");return t.addClass("se-dropdown"),t}renderLabel(e){return e("span").addClass("se-label").append(this.getLabel(this.props.label))}getLabel(e){return this.context.labelProvider.getLabel(e,this.props.commandState)}}class Clipboard extends AbstractClipboard{constructor(e,t){super(e),this.editorSession=t}_copy(){let e=this.getEditorSession(),t=e.getSelection(),r=e.getDocument(),n=null,s="",o="",i=this._getExporter();return t.isCollapsed()||(s=getTextForSelection(r,t)||"",n=copySelection(r,t),o=i.exportDocument(n)),{doc:n,html:o,text:s}}_cut(){this.getEditorSession().transaction(e=>{e.deleteSelection()})}_pastePlainText(e){this.getEditorSession().transaction(t=>{t.paste(e)},{action:"paste"})}_pasteHtml(e,t){let r=this._getImporter().importDocument(e)||t;if(r){this.getEditorSession().transaction(e=>{e.paste(r)},{action:"paste"})}return!0}getEditorSession(){return this.editorSession}}function findParentComponent(e){for(;e;){const t=Component.unwrap(e);if(t)return t;e=e.parentNode}}function startsWith(e,t){return!!isString(e)&&(e.startsWith?e.startsWith(t):(isString(t)||(t=String(t)),e.slice(0,t.length)===t))}class UnsupportedNodeComponent extends Component{render(e){return e("pre").addClass("content-node unsupported").attr({"data-id":this.props.node.id,contentEditable:!1}).append(JSON.stringify(this.props.node.toJSON(),null,2))}}const BROWSER_DELAY=platform.isFF?1:0;class Surface extends Component{constructor(...e){super(...e),this._initialize()}_initialize(){if(!this.getEditorSession())throw new Error("editorSession is mandatory");if(this.name=this.props.name,!this.name)throw new Error("Surface must have a name.");if(this.name.indexOf("/")>-1)throw new Error("Surface.name must not contain '/'");this._surfaceId=Surface.createSurfaceId(this),this.clipboard=this.context.clipboard||this._initializeClipboard(),this.domSelection=this.context.domSelection||this._initializeDOMSelection(),this._state={skipNextFocusEvent:!1}}_initializeClipboard(){return new Clipboard(this.getConfigurator(),this.getEditorSession())}_initializeDOMSelection(){return new DOMSelection(this)}getChildContext(){return{surface:this,parentSurfaceId:this.getId(),doc:this.getDocument(),isolatedNodeComponent:null}}didMount(){this.getEditorSession().onRender("selection",this._onSelectionChanged,this);const e=this.getSurfaceManager();e&&e.registerSurface(this);const t=this.getGlobalEventHandler();t&&t.addEventListener("keydown",this._muteNativeHandlers,this)}dispose(){this.getEditorSession().off(this);const e=this.getSurfaceManager();e&&e.unregisterSurface(this);const t=this.getGlobalEventHandler();t&&t.removeEventListener("keydown",this._muteNativeHandlers)}didUpdate(){this._updateContentEditableState()}render(e){let t=e(this.props.tagName||"div").addClass(this._getClassNames()).attr("tabindex",2).attr("data-surface-id",this.id);return this.isDisabled()||(this.isEditable()&&(t.on("keydown",this.onKeyDown),platform.isIE||(t.on("compositionstart",this.onCompositionStart),t.on("compositionend",this.onCompositionEnd)),platform.inBrowser&&window.TextEvent&&!platform.isIE?t.on("textInput",this.onTextInput):t.on("keypress",this.onTextInputShim),t.on("paste",this._onPaste),t.on("cut",this._onCut)),this.isReadonly()||(t.on("mousedown",this.onMouseDown),t.on("contextmenu",this.onContextMenu),t.on("focus",this.onNativeFocus),t.on("blur",this.onNativeBlur)),t.on("copy",this._onCopy)),t}_getClassNames(){return`sc-surface sm-${this.name}`}getName(){return this.name}getId(){return this._surfaceId}getSurfaceId(){return this._surfaceId}isDisabled(){return this.props.disabled}isEditable(){return"full"===this.props.editing||void 0===this.props.editing}isSelectable(){return"selection"===this.props.editing||"full"===this.props.editing}isReadonly(){return"readonly"===this.props.editing}getElement(){return this.el}getDocument(){return this.getEditorSession().getDocument()}getComponentRegistry(){return this.context.componentRegistry}getConfigurator(){return this.context.configurator}getEditorSession(){return this.context.editorSession}getSurfaceManager(){return this.context.surfaceManager}getGlobalEventHandler(){return this.context.globalEventHandler}getKeyboardManager(){return this.context.keyboardManager}isEnabled(){return!this.state.disabled}isContainerEditor(){return!1}isCustomEditor(){return!1}hasNativeSpellcheck(){return"native"===this.props.spellcheck}getContainerPath(){return null}focus(){this.getEditorSession().getSelection().surfaceId!==this.getId()&&this.selectFirst()}blur(){const e=this.getEditorSession();e.getSelection().surfaceId===this.getId()&&e.setSelection(null)}selectFirst(){throw new Error("This method is abstract.")}rerenderDOMSelection(){if(!this.isDisabled()&&platform.inBrowser){let e=this.getEditorSession().getSelection();if(e.surfaceId===this.getId()){this.domSelection.setSelection(e);const t=this.context.scrollPane;t&&t.onSelectionPositioned&&(console.error("DEPRECATED: you should manage the scrollPane yourself"),t.onSelectionPositioned())}}}getDomNodeForId(e){return this.el.getNativeElement().querySelector('*[data-id="'+e+'"]')}onKeyDown(e){if(!this._shouldConsumeEvent(e))return;if("Dead"===e.key)return;if(!this.getKeyboardManager().onKeydown(e))switch(e.keyCode){case keys$1.LEFT:case keys$1.RIGHT:return this._handleLeftOrRightArrowKey(e);case keys$1.UP:case keys$1.DOWN:return this._handleUpOrDownArrowKey(e);case keys$1.HOME:case keys$1.END:return this._handleHomeOrEndKey(e);case keys$1.PAGEUP:case keys$1.PAGEDOWN:return this._handlePageUpOrDownKey(e);case keys$1.ENTER:return this._handleEnterKey(e);case keys$1.TAB:return this._handleTabKey(e);case keys$1.BACKSPACE:case keys$1.DELETE:return this._handleDeleteKey(e);case keys$1.ESCAPE:return this._handleEscapeKey(e);case keys$1.SPACE:return this._handleSpaceKey(e)}}onTextInput(e){if(!this._shouldConsumeEvent(e))return;if(e.preventDefault(),e.stopPropagation(),!e.data)return;let t=e.data;const r=this.getKeyboardManager();if(!r||!r.onTextInput(t)){this.getEditorSession().transaction(e=>{e.insertText(t)},{action:"type"})}}onCompositionStart(e){if(this._shouldConsumeEvent(e)&&e.data){const t=this.getEditorSession();let r=e.data.length,n=t.getSelection();if(n.isPropertySelection()&&n.isCollapsed()){let e=n.start.offset;t.setSelection(n.createWithNewRange(e-r,e))}}}onCompositionEnd(e){if(this._shouldConsumeEvent(e)&&platform.isFF){if(e.preventDefault(),e.stopPropagation(),!e.data)return;this._delayed(()=>{let t=e.data;const r=this.getKeyboardManager();if(!r||!r.onTextInput(t)){this.getEditorSession().transaction(e=>{e.insertText(t)},{action:"type"})}})}}onTextInputShim(e){if(!this._shouldConsumeEvent(e))return;if(0===e.which||0===e.charCode||e.keyCode===keys$1.TAB||e.keyCode===keys$1.ESCAPE||Boolean(e.metaKey)||Boolean(e.ctrlKey)^Boolean(e.altKey))return;let t=String.fromCharCode(e.which);e.shiftKey||(t=t.toLowerCase()),e.preventDefault(),e.stopPropagation();const r=this.getKeyboardManager();r&&r.onTextInput(t)||t.length>0&&this.getEditorSession().transaction(e=>{e.insertText(t)},{action:"type"})}onMouseDown(e){if(!this._shouldConsumeEvent(e))return!1;if(!e.__reserved__&&(e.__reserved__=this,this.isEditable()&&this.el.setAttribute("contenteditable",!0),0===e.button)){if(!(platform.isIE&&platform.version<12)&&e.detail>=3){let t=this.getEditorSession().getSelection();if(t.isPropertySelection())return this._selectProperty(t.path),e.preventDefault(),void e.stopPropagation();if(t.isContainerSelection())return this._selectProperty(t.startPath),e.preventDefault(),void e.stopPropagation()}if(this._state.skipNextFocusEvent=!0,platform.inBrowser){DefaultDOMElement.wrapNativeElement(window.document).on("mouseup",this.onMouseUp,this,{once:!0})}}}onMouseUp(e){e.stopPropagation(),this._delayed(()=>{let e=this.domSelection.getSelection();this._setSelection(e)})}onContextMenu(e){if(!this._shouldConsumeEvent(e))return;let t=this.domSelection.getSelection();this._setSelection(t)}onNativeBlur(){this._state.hasNativeFocus=!1}onNativeFocus(){this._state.hasNativeFocus=!0}_onCopy(e){this.clipboard.onCopy(e)}_onCut(e){this.clipboard.onCut(e)}_onPaste(e){this.clipboard.onPaste(e)}_onSelectionChanged(e){let t=this._deriveModeFromSelection(e);this.state.mode!==t&&this.extendState({mode:t})}_deriveModeFromSelection(e){if(!e)return null;let t,r=e.surfaceId,n=this.getId();return startsWith(r,n)&&(t=r.length===n.length?"focused":"co-focused"),t}_updateContentEditableState(){let e=this.isEditable()&&!this.props.disabled;e&&"co-focused"===this.state.mode&&(e=function(e,t){if(t){let r=e.getSelection(),n=t.getSurface(r.surfaceId);if(n){let e=n.context.isolatedNodeComponent;if(e)return e.isOpen()}}}(this.getEditorSession(),this.getSurfaceManager())),e?this.el.setAttribute("contenteditable",!0):this.el.removeAttribute("contenteditable")}_blur(){this.el&&this.el.blur()}_focus(){this.isDisabled()||(platform.isFF&&(this.domSelection.clear(),this.el.getNativeElement().blur()),this._focusElement())}_focusElement(){this._state.hasNativeFocus=!0,this.el&&!platform.isWebkit&&(this._state.skipNextFocusEvent=!0,this.el.focus({preventScroll:!0}),this._state.skipNextFocusEvent=!1)}_handleLeftOrRightArrowKey(e){e.stopPropagation();let t=e.keyCode===keys$1.LEFT?"left":"right";this._delayed(()=>{this._updateModelSelection({direction:t})})}_handleUpOrDownArrowKey(e){e.stopPropagation(),this._delayed(()=>{let t={direction:e.keyCode===keys$1.UP?"left":"right"};this._updateModelSelection(t)})}_handleHomeOrEndKey(e){e.stopPropagation(),this._delayed(()=>{let t={direction:e.keyCode===keys$1.HOME?"left":"right"};this._updateModelSelection(t)})}_handlePageUpOrDownKey(e){e.stopPropagation(),this._delayed(()=>{let t={direction:e.keyCode===keys$1.PAGEUP?"left":"right"};this._updateModelSelection(t)})}_handleSpaceKey(e){e.stopPropagation(),e.preventDefault();const t=this.getKeyboardManager();if(!t||!t.onTextInput(" ")){this.getEditorSession().transaction(e=>{e.insertText(" ")},{action:"type"})}}_handleTabKey(e){e.stopPropagation(),this.el.emit("tab",{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,code:e.code}),!1===this.props.handleTab?e.preventDefault():this.__handleTab(e)}__handleTab(){this._delayed(()=>{this._updateModelSelection()})}_handleEnterKey(e){e.preventDefault(),e.stopPropagation(),this.getEditorSession().transaction(e=>{e.break()},{action:"break"})}_handleEscapeKey(){}_handleDeleteKey(e){e.preventDefault(),e.stopPropagation();let t=e.keyCode===keys$1.BACKSPACE?"left":"right";this.getEditorSession().transaction(e=>{e.deleteCharacter(t)},{action:"delete"})}_hasNativeFocus(){return Boolean(this._state.hasNativeFocus)}_setSelection(e){!e.isNull()&&e.surfaceId===this.id&&platform.isFF&&this._focusElement(),this.getEditorSession().setSelection(e)}_updateModelSelection(e){let t=this.domSelection.getSelection(e);this._setSelection(t)}_selectProperty(e){let t=this.getDocument(),r=t.get(e);this._setSelection(t.createSelection({type:"property",path:e,startOffset:0,endOffset:r.length}))}_renderNode(e,t){let r=this.getDocument().get(t),n=this.getComponent(r.type,!0);return n||(console.error("Could not resolve a component for type: "+r.type),n=UnsupportedNodeComponent),e(n,this._getNodeProps(r))}_getNodeProps(e){return{node:e,placeholder:this.props.placeholder,disabled:this.props.disabled}}_shouldConsumeEvent(e){let t=Component.unwrap(e.target);return t&&(t===this||t.context.surface===this)}getSelectionFromEvent(e){let t=getDOMRangeFromEvent(e),r=this.domSelection.getSelectionForDOMRange(t);return r.surfaceId=this.getId(),r}setSelectionFromEvent(e){let t=this.getSelectionFromEvent(e);t?(this._state.skipNextFocusEvent=!0,this._setSelection(t)):console.error("Could not create a selection from event.")}get id(){return this._surfaceId}_delayed(e){platform.inBrowser&&window.setTimeout(e,BROWSER_DELAY)}_muteNativeHandlers(e){let t;t=platform.isMac?["META+66","META+73","META+85"]:["CTRL+66","CTRL+73","CTRL+85"];const r=parseKeyEvent(e);t.indexOf(r)>-1&&e.preventDefault()}}Surface.prototype._isSurface=!0,Surface.createSurfaceId=function(e){let t=e.context.parentSurfaceId;return t?t+"/"+e.name:e.name};class ContainerEditor extends Surface{constructor(e,t,r){t.containerPath=t.containerPath||t.node.getContentPath(),t.name=t.name||t.containerPath.join(".")||t.node.id,super(e,t,r)}_initialize(){if(super._initialize(),this.containerPath=this.props.containerPath,!isArray(this.containerPath))throw new Error("Property 'containerPath' is mandatory.");this._deriveInternalState(this.props)}shouldRerender(e){return e.disabled!==this.props.disabled}willReceiveProps(e){super.willReceiveProps.apply(this,arguments),this._deriveInternalState(e)}didMount(){super.didMount.apply(this,arguments),this.getEditorSession().onUpdate("document",this._onContainerChanged,this,{path:this.getContainerPath()})}dispose(){super.dispose.apply(this,arguments),this.getEditorSession().off(this)}render(e){let t=super.render(e),r=this.getDocument(),n=this.getContainerPath();t.attr("data-id",n.join(".")),t.attr("spellcheck","native"===this.props.spellcheck);let s=r.get(n);return t.append(s.map((t,n)=>this._renderNode(e,r.get(t),n))),this.props.disabled||this.isEmpty()||(t.addClass("sm-enabled"),t.setAttribute("contenteditable",!0)),t}_getClassNames(){return"sc-container-editor sc-surface"}selectFirst(){let e=this.getDocument(),t=this.getContainerPath(),r=e.get();if(r.length>0){setCursor(this.getEditorSession(),e.get(r[0]),t,"before")}}_renderNode(e,t,r){if(!t)throw new Error("Illegal argument");return e(this._getNodeComponentClass(t),this._getNodeProps(t)).ref(t.id)}_getNodeComponentClass(e){let t=this.getComponent(e.type);return e.isText()||t.prototype._isCustomNodeComponent||t.prototype._isIsolatedNodeComponent?t:this.getComponent("isolated-node")}_deriveInternalState(e){let t=this._state;!e.hasOwnProperty("enabled")||e.enabled?t.enabled=!0:t.enabled=!1}_selectNextIsolatedNode(e){let t=this.getEditorSession().getSelectionState(),r="left"===e?t.previousNode:t.nextNode,n=!r.isText()&&!r.isList();return!(!r||!n)&&(!!("left"===e&&t.isFirst||"right"===e&&t.isLast)&&(this.getEditorSession().setSelection({type:"node",nodeId:r.id,containerPath:this.getContainerPath(),surfaceId:this.id}),!0))}_handleLeftOrRightArrowKey(e){e.stopPropagation();const t=this.getDocument(),r=this.getEditorSession().getSelection(),n=e.keyCode===keys$1.LEFT,s=!n,o=n?"left":"right";if(r&&!r.isNull()){let i=r.containerPath;if(r.isNodeSelection()){let o=t.get(i),a=getContainerPosition(t,i,r.getNodeId());if(n&&0===a||s&&a===o.length-1)return void e.preventDefault()}r.isNodeSelection()&&!e.shiftKey&&this.domSelection.collapse(o)}this._delayed(()=>{this._updateModelSelection({direction:o})})}_handleUpOrDownArrowKey(e){e.stopPropagation();const t=this.getDocument(),r=this.getEditorSession().getSelection(),n=e.keyCode===keys$1.UP,s=!n,o=n?"left":"right";if(r&&!r.isNull()){let o=r.containerPath;if(r.isNodeSelection()){let i=t.get(o),a=getContainerPosition(t,o,r.getNodeId());if(n&&0===a||s&&a===i.length-1)return void e.preventDefault();let l=this.getEditorSession();if(!e.shiftKey){if(e.preventDefault(),n){return void setCursor(l,t.get(i[a-1]),o,"after")}return void setCursor(l,t.get(i[a+1]),o,"before")}}}this._delayed(()=>{this._updateModelSelection({direction:o})})}_handleTabKey(e){const t=this.getEditorSession(),r=t.getSelection();if(r.isNodeSelection()&&r.isFull()){const n=this.refs[r.getNodeId()];if(n&&stepIntoIsolatedNode(t,n))return e.preventDefault(),void e.stopPropagation()}super._handleTabKey(e)}__handleTab(e){e.preventDefault(),e.shiftKey?this.getEditorSession().transaction(e=>{e.dedent()},{action:"dedent"}):this.getEditorSession().transaction(e=>{e.indent()},{action:"indent"})}isContainerEditor(){return!0}getContainerPath(){return this.containerPath}isEmpty(){let e=this.getDocument().get(this.containerPath);return!e||0===e.length}isEditable(){return super.isEditable.call(this)&&!this.isEmpty()}_onContainerChanged(e){let t=this.getDocument(),r=RenderingEngine.createContext(this).$$,n=this.getContainerPath();for(let s=0;s<e.ops.length;s++){let o=e.ops[s];if(isArrayEqual(o.path,n))if("update"===o.type){let e=o.diff;if("insert"===e.type){let n,s=e.getValue(),o=t.get(s);n=o?this._renderNode(r,o):r("div"),this.insertAt(e.getOffset(),n)}else"delete"===e.type&&this.removeAt(e.getOffset())}else this.empty(),this.rerender()}}get _isContainerEditor(){return!0}}class CustomSurface extends Component{constructor(...e){super(...e),this._name=this._getCustomResourceId(),this._surfaceId=this._createSurfaceId()}getChildContext(){return{surface:this,parentSurfaceId:this.getId()}}didMount(){this._getSurfaceManager().registerSurface(this)}dispose(){this._getSurfaceManager().unregisterSurface(this)}rerenderDOMSelection(){}get name(){return this._name}getId(){return this._surfaceId}getSurfaceId(){return this.getId()}getContainer(){}getContainerId(){}isContainerEditor(){return!1}isCustomEditor(){return!0}isDisabled(){return Boolean(this.props.disabled)}_focus(){}_createSurfaceId(){let e=this.context.isolatedNodeComponent;if(e){return e.context.surface.id+"/"+e.props.node.id+"/"+this._name}return this._name}_getCustomResourceId(){throw new Error("This method needs to be implemented by a CustomSurface")}_getSurfaceManager(){return this.context.surfaceManager}}class EditInlineNodeCommand extends Command{constructor(...e){if(super(...e),!this.config.nodeType)throw new Error("Every AnnotationCommand must have a nodeType")}getCommandState(e,t){let r=e.selection,n={disabled:!0,active:!1},s=this._getAnnotationsForSelection(e);if(s.length>0)for(let e of s)if(e.getSelection().equals(r)){n.disabled=!1,n.nodeId=e.id;break}return n}execute(e,t){}_getAnnotationsForSelection(e){return e.selectionState.annosByType[this.config.nodeType]||[]}}class EditAnnotationCommand extends EditInlineNodeCommand{getCommandState(e,t){let r=e.selection,n=this._getAnnotationsForSelection(e),s={disabled:!0};return 1===n.length&&r.isPropertySelection()&&r.isCollapsed()&&(s.disabled=!1,s.showInContext=!0,s.nodeId=n[0].id),s}}class Highlights extends EventEmitter{constructor(e){super(),this.doc=e,this._highlights={}}get(){return this._highlights}set(e){let t=this._highlights,r=this.doc;forEach(e,function(e,n){let s=t[n]||[],o=without(s,e),i=without(e,s);forEach(o,function(e){let t=r.get(e);t&&(t.setHighlighted?t.setHighlighted(!1,n):console.warn("setHighlighted is not defined on target node"))}),forEach(i,function(e){let t=r.get(e);t&&(t.setHighlighted?t.setHighlighted(!0,n):console.warn("setHighlighted is not defined on target node"))})}),this._highlights=e,this.emit("highlights:updated",e)}}class InsertInlineNodeCommand extends Command{getCommandState(e,t){let r=e.selection;return{disabled:this.isDisabled(e,t),active:!1,showInContext:this.showInContext(r,e,t)}}showInContext(e,t){return!e.isCollapsed()}isDisabled(e,t){const r=this.getEditorSession(e,t);let n=r.getSelection(),s=r.getSelectionState();return!n.isPropertySelection()||!!s.isInlineNodeSelection}isAnnotationCommand(){return!0}execute(e,t){let r=e.commandState,n=e.editorSession;r.disabled||n.transaction(r=>{let n=this.createNodeData(r,e,t);r.insertInlineNode(n)})}createNodeData(e,t,r){throw new Error("This method is abstract")}}class InsertNodeCommand extends Command{constructor(e){super(e),this.config.nodeType||console.error("'config.nodeType' should be provided for InsertNodeCommand")}getType(){return this.config.nodeType}getCommandState(e,t){let r=e.selection,n={disabled:!0,active:!1};return r&&!r.isNull()&&!r.isCustomSelection()&&r.containerPath&&(n.disabled=!1),n.showInContext=this.showInContext(r,e,t),n}showInContext(e,t,r){let n=t.editorSession.getSelectionState();return e.isCollapsed()&&n.isFirst&&n.isLast}isInsertCommand(){return!0}execute(e,t){if(e.commandState.disabled)return;e.editorSession.transaction(r=>{let n=this.createNodeData(r,e,t),s=r.insertBlockNode(n);this.setSelection(r,s)})}createNodeData(e,t,r){const n=t.type;if(!n)throw new Error("'type' is mandatory");const s=t.editorSession.getDocument().getSchema().getNodeSchema(n);let o={type:n};for(let e of s)o[e.name]=t[e.name];return o}setSelection(e,t){t.isText()&&(e.selection={type:"property",path:t.getPath(),startOffset:0})}}class IsolatedInlineNodeComponent extends AbstractIsolatedNodeComponent{render(e){const t=this.props.node,r=this.ContentClass,n=this.state;let s=e("span");s.addClass(this.getClassNames()).addClass("sc-inline-node").addClass("sm-"+t.type).attr("data-id",t.id).attr("data-inline","1");let o=this.isDisabled();return n.mode?s.addClass("sm-"+n.mode):s.addClass("sm-not-selected"),r.noStyle||s.addClass("sm-default-style"),s.on("keydown",this.onKeydown),s.append(this.renderContent(e,t).ref("content").addClass("se-content")),o&&s.addClass("sm-disabled").attr("contenteditable",!1).on("click",this.onClick),t.shouldBeDraggable&&s.attr("draggable",!0),s}isDisabled(){return!this.state.mode||["co-selected","cursor"].indexOf(this.state.mode)>-1}getClassNames(){return""}onClick(e){this._shouldConsumeEvent(e)&&(e.stopPropagation(),e.preventDefault(),this.selectNode())}selectNode(){const e=this.getEditorSession(),t=this.props.node;let r={type:"property",path:t.start.path,startOffset:t.start.offset,endOffset:t.end.offset};const n=this.getParentSurface();n&&Object.assign(r,{containerPath:n.getContainerPath(),surfaceId:n.id}),e.setSelection(r)}_getContentClass(){const e=this.props.node;let t;return(t=this.getComponent(e.type,!0))||(t=this.getComponent("unsupported-inline-node",!0)),t||(console.error(`No component registered for inline node '${e.type}'.`),t=StubInlineNodeComponent),t}_deriveStateFromSelectionState(e,t){const r=this._getSurfaceForSelection(e,t),n=this.getParentSurface();if(!r)return null;if(r===n){const t=this.props.node;if(e.isPropertySelection()&&!e.isCollapsed()&&isEqual(e.start.path,t.start.path)){const r=t.getSelection();if(r.equals(e))return{mode:"selected"};if(e.contains(r))return{mode:"co-selected"}}}let s=r.context.isolatedNodeComponent;return s?s===this?{mode:"focused"}:this._getIsolatedNodes(e,t).indexOf(this)>-1?{mode:"co-focused"}:null:null}get _isInlineNodeComponent(){return!0}}class StubInlineNodeComponent extends Component{render(e){const t=this.props.node;return e("span").text("???").attr("data-id",t.id).attr("data-type",t.type)}}class Router extends EventEmitter{constructor(...e){super(...e),this.__isStarted__=!1}start(){DefaultDOMElement.getBrowserWindow().on("hashchange",this._onHashChange,this),this.__isStarted__=!0}readRoute(){return this.__isStarted__||this.start(),this.parseRoute(this.getRouteString())}writeRoute(e,t){t=t||{};let r=this.stringifyRoute(e);r?this._writeRoute(r,t):this.clearRoute(t)}dispose(){DefaultDOMElement.getBrowserWindow().off(this)}parseRoute(e){return Router.routeStringToObject(e)}stringifyRoute(e){return Router.objectToRouteString(e)}getRouteString(){return DefaultDOMElement.getBrowserWindow().getNativeElement().location.hash.slice(1)}_writeRoute(e,t){let r=DefaultDOMElement.getBrowserWindow().getNativeElement();this.__isSaving__=!0;try{t.replace?r.history.replaceState({},"",`#${e}`):r.history.pushState({},"",`#${e}`)}finally{this.__isSaving__=!1}}clearRoute(e){this._writeRoute("",e)}_onHashChange(){if(!this.__isSaving__)if(this.__isLoading__)console.error("FIXME: router is currently applying a route.");else{this.__isLoading__=!0;try{let e=this.getRouteString(),t=this.parseRoute(e);this.emit("route:changed",t)}finally{this.__isLoading__=!1}}}static objectToRouteString(e){return map(e,(e,t)=>`${t}=${e}`).join(",")}static routeStringToObject(e){let t={};if(!e)return t;let r=e.split(",");for(let e of r)if(e.indexOf("=")>=0){let r=e.split("=");if(2!==r.length)throw new Error("Illegal route.");t[r[0].trim()]=r[1].trim()}else t[e]=!0;return t}}class SwitchTextTypeCommand extends Command{constructor(e){if(super(e),!e.spec)throw new Error("'config.spec' is mandatory");if(!e.spec.type)throw new Error("'config.spec.type' is mandatory")}getType(){return this.config.spec.type}getCommandState(e){const t=e.editorSession,r=t.getDocument(),n=e.selection,s=t.isBlurred();let o={disabled:!1};if(n.isPropertySelection()&&!s){let e=n.getPath(),t=r.get(e[0]);t&&t.isText()&&t.isBlock()?(o.active=isMatch(t,this.config.spec),o.showInContext=0===n.start.offset&&0===n.end.offset):o.disabled=!0}else o.disabled=!0;return o}execute(e){e.editorSession.transaction(e=>e.switchTextType(this.config.spec))}isSwitchTypeCommand(){return!0}}class TextBlockComponent extends NodeComponent{render(e){let t=super.render(e);t.addClass("sc-text-block");let r=this.props.node;return r.direction&&t.attr("dir",r.direction),r.textAlign&&t.addClass("sm-align-"+r.textAlign),t.append(e(TextPropertyComponent,{placeholder:this.props.placeholder,path:r.getPath(),direction:r.direction})),t}}class TextPropertyEditor extends Surface{constructor(e,t){if(t.name=t.name||t.path.join("."),super(e,t),!t.path)throw new Error("Property 'path' is mandatory.")}render(e){const t=this.getComponent("text-property");let r=super.render.apply(this,arguments);return this.props.disabled||(r.addClass("sm-enabled"),r.attr("contenteditable",!0),r.attr("spellcheck","native"===this.props.spellcheck)),r.append(e(t,{doc:this.getDocument(),placeholder:this.props.placeholder,tagName:this.props.tagName||"div",path:this.props.path,markers:this.props.markers,withoutBreak:this.props.withoutBreak}).ref("property")),r}_getClassNames(){return"sc-text-property-editor sc-surface"}selectFirst(){this.editorSession.setSelection({type:"property",path:this.getPath(),startOffset:0,surfaceId:this.id})}getPath(){return this.props.path}_handleEnterKey(e){e.stopPropagation(),!1!==this.props.handleEnter&&this.props.multiLine||e.preventDefault(),this.el.emit("enter",{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,code:e.code})}_handleEscapeKey(e){this.el.emit("escape",{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,code:e.code})}get _isTextPropertyEditor(){return!0}}class SplitPane extends Component{render(e){if(2!==this.props.children.length)throw new Error("SplitPane only works with exactly two child elements");let t=e("div").addClass("sc-split-pane");"horizontal"===this.props.splitType?t.addClass("sm-horizontal"):t.addClass("sm-vertical");let r=this.props.children[0],n=this.props.children[1];return this.props.sizeB?(n.addClass("se-pane sm-sized"),n.css(this.getSizedStyle(this.props.sizeB)),r.addClass("se-pane sm-auto-fill")):(r.addClass("se-pane sm-sized"),r.css(this.getSizedStyle(this.props.sizeA)),n.addClass("se-pane sm-auto-fill")),t.append(r,n),t}getSizedStyle(e){return e&&"inherit"!==e?"horizontal"===this.props.splitType?{height:e}:{width:e}:{}}}class Undo extends Command{getCommandState(e){return{disabled:!e.editorSession.canUndo(),active:!1}}execute(e){let t=e.editorSession;return t.canUndo()&&t.undo(),!0}}class Redo extends Command{getCommandState(e){return{disabled:!e.editorSession.canRedo(),active:!1}}execute(e){let t=e.editorSession;return!!t.canRedo()&&(t.redo(),!0)}}class SelectAll extends Command{getCommandState(e){let t=e.editorSession,r=t.isBlurred(),n=e.surface||t.getFocusedSurface(),s=t.getSelection();return{disabled:r||!s||s.isNull()||!n||!(n._isContainerEditor||n._isTextPropertyEditor)}}execute(e){let t=e.editorSession,r=t.getDocument(),n=e.surface||t.getFocusedSurface();if(n){let e;if(n._isContainerEditor){let s=n.getContainerPath(),o=r.get(s);if(0===o.length)return!1;let i=o[0],a=last$1(o);e=t.createSelection({type:"container",startPath:[i],startOffset:0,endPath:[a],endOffset:1,containerPath:s,surfaceId:n.id})}else if(n._isTextPropertyEditor){let s=n.getPath(),o=r.get(s);e=t.createSelection({type:"property",path:s,startOffset:0,endOffset:o.length,surfaceId:n.id})}return t.setSelection(e),!0}return!1}}function series(e,t,r){e[r=r||0](function(n,...s){if(n)return t(n);r===e.length-1?t(n,...s):series(e,t,r+1)})}var async=Object.freeze({series:series});const ALPHABET="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function getColumnLabel(e){if(!isNumber(e))throw new Error("Illegal argument.");let t="";for(;;){let r=e%ALPHABET.length;if(e=Math.floor(e/ALPHABET.length),t=ALPHABET[r]+t,e>0)e--;else if(0===e)break}return t}function getRowCol(e){var t=/^([A-Z]+)([1-9][0-9]*)$/.exec(e);return[parseInt(t[2],10)-1,getColumnIndex(t[1])]}const A="A".charCodeAt(0),ALPHABET_LENGTH=ALPHABET.length;function getColumnIndex(e){let t=0,r=0;for(let n=e.length-1;n>=0;n--){let s=e.charCodeAt(n)-A;if(s<0||s>=ALPHABET_LENGTH)throw new Error("Illegal column label: "+e);t+=Math.pow(ALPHABET_LENGTH,r)*(s+1),r++}return t-1}function getCellLabel(e,t){return getColumnLabel(t)+(e+1)}function getIndexesFromRange(e,t){let r,n,[s,o]=getRowCol(e);return t?([r,n]=getRowCol(t),s>r&&([s,r]=[r,s]),o>n&&([o,n]=[n,o])):[r,n]=[s,o],{startRow:s,startCol:o,endRow:r,endCol:n}}function getRangeFromMatrix(e,t,r,n,s,o){if(!o){if(t===n&&r===s){let n=e[t];return n?n[r]:void 0}if(t===n){let n=e[t];return n?n.slice(r,s+1):[]}if(r===s){let s=[];for(let o=t;o<=n;o++){let t=e[o];t&&s.push(t[r])}return s}}let i=[];for(var a=t;a<n+1;a++){let t=e[a];t&&i.push(t.slice(r,s+1))}return i}var tableHelpers=Object.freeze({ALPHABET:ALPHABET,getColumnLabel:getColumnLabel,getRowCol:getRowCol,getColumnIndex:getColumnIndex,getCellLabel:getCellLabel,getIndexesFromRange:getIndexesFromRange,getRangeFromMatrix:getRangeFromMatrix});function array2table(e){return e.reduce((e,t)=>(e[t]=!0,e),{})}function levenshtein(e,t){let r=[];for(let n=0;n<=t.length;n++){if(r[n]=[n],0===n)continue;let s=n-1;for(let o=0;o<=e.length;o++){if(r[0][o]=o,0===o)continue;let i=o-1;r[n][o]=t.charAt(s)===e.charAt(i)?r[s][i]:Math.min(r[s][i]+1,r[n][i]+1,r[s][o]+1)}}return r}function diff(e,t,r){if(!isString(e)||!isString(t))throw new Error("Illegal arguments.");r=r||0;let n=[];if(e||t)if(!e&&t)n.push({type:"insert",start:r,text:t});else if(e&&!t)n.push({type:"delete",start:r,end:r+e.length});else{n=_diff(e,t,levenshtein(e,t),r)}return n}function _diff(e,t,r,n){let s,o=t.length,i=e.length,a=[];for(;o>0&&i>0;)l();return c(),a;function l(){let e=r[o][i],n=o-1,a=i-1;r[n][a]<e?(s&&"replace"===s.type?(s.start--,s.text.unshift(t.charAt(n))):(c(),s={type:"replace",start:a,end:i,text:[t.charAt(n)]}),o--,i--):r[n][i]<e?(s&&"insert"===s.type?(s.start--,s.text.unshift(t.charAt(n))):(c(),s={type:"insert",start:a,text:[t.charAt(n)]}),o--):r[o][a]<e?(s&&"delete"===s.type?s.start--:(c(),s={type:"delete",start:a,end:i}),i--):(c(),o--,i--)}function c(){if(s){switch(s.type){case"insert":s.start+=n,s.text=s.text.join("");break;case"delete":s.start+=n,s.end+=n;break;case"replace":s.start+=n,s.end+=n,s.text=s.text.join("");break;default:throw new Error("Invalid state")}a.push(s),s=null}}}class Factory extends DeprecatedRegistry{create(e){var t=this.get(e);if(!t)throw new Error("No class registered by that name: "+e);var r=Array.prototype.slice.call(arguments,1),n=Object.create(t.prototype);return t.apply(n,r),n}}function getRangeFromMatrix$1(e,t,r,n,s,o){if(!o){if(t===n&&r===s){let t=e[r];return t?t[s]:void 0}if(t===n){let n=e[t];return n?n.slice(r,s+1):[]}if(r===s){let s=[];for(let o=t;o<=n;o++){let t=e[o];t&&s.push(t[r])}return s}}let i=[];for(var a=t;a<n+1;a++){let t=e[a];t&&i.push(t.slice(r,s+1))}return i}function includes(e,t){return!!e&&e.indexOf(t)>=0}function merge$1(e,t,r){var n=null;return"replace"===(r=r||{}).array?n=_replaceArrays:"concat"===r.array&&(n=_concatArrays),n?mergeWith(e,t,n):merge(e,t)}function _concatArrays(e,t){return isArray(e)?e.concat(t):null}function _replaceArrays(e,t){return isArray(e)?t:null}function percentage(e){return String(Math.floor(100*e*100)/100)+" %"}function pluck(e,t){return map(e,function(e){return e[t]})}function printStacktrace(){try{throw new Error}catch(e){console.error(e.stack)}}function renderListNode(e,t){let r=e.getItems(),n=[t(s(1))];for(let e=0;e<r.length;e++){const o=r[e],i=o.getLevel();if(i<n.length)for(let e=n.length;e>i;e--)n.pop();else if(i>n.length)for(let e=n.length;e<i;e++){let r,o=n[e-1],i=o.getChildCount();0===i?(r=t("li"),o.append(r)):r=o.getChildAt(i-1);let a=t(s(e+1));r.append(a),n.push(a)}console.assert(i===n.length,"item.level should now be the same as stack.length"),last$1(n).append(t(o))}for(let e=n.length;e>1;e--)n.pop();return n[0];function s(t){return"order"===e.getListType(t)?"ol":"ul"}}function sendRequest(e,t){return new Promise(function(r,n){var s=(e.method||"GET").toUpperCase(),o=e.url;if(["GET","POST","PUT","DELETE"].indexOf(s)<0)throw new Error("Parameter 'method' must be 'GET', 'POST', 'PUT', or 'DELETE'.");if(!o)throw new Error("Parameter 'url' is required.");var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===i.readyState)return function(){if(200===i.status){var e=i.responseText;t&&t(null,e),r(e)}else{console.error(i.statusText);let e=new Error(i.statusText);t&&t(e),n(e)}}()},i.open(s,o,!0),e.header&&forEach(e.header,function(e,t){i.setRequestHeader(t,e)}),e.data instanceof FormData?i.send(e.data):e.data?i.send(JSON.stringify(e.data)):i.send()})}function times$2(e,t,r){for(let n=0;n<e;n++)t.call(r)}function toUnixLineEndings(e){return e.replace(/\r?\n/g,"\n")}const START="START",END="END",EPSILON="EPSILON",TEXT$2="TEXT";class DFA{constructor(e){e&&0!==Object.keys(e).length||(e={START:{EPSILON:END}}),this.transitions=e}consume(e,t){const r=this.transitions;if(!r[e])return-1;let n=r[e][t];if(void 0!==n)return n;for(;void 0!==r[e][EPSILON];){if((e=r[e][EPSILON])===END)return-1;if(void 0!==(n=r[e][t]))return n}return-1}canConsume(e,t){return-1!==this.consume(e,t)}isFinished(e){const t=this.transitions;if("END"===e)return!0;if(!t[e])return!1;for(;void 0!==t[e][EPSILON];)if("END"===(e=t[e][EPSILON]))return!0;return!1}_tokensByPath(){const e=[],t=this.transitions;if(!t)return[];let r={};forEach(t[START],(e,t)=>{r[e]||(r[e]=[]),r[e].push(t)});let n={START:!0,END:!0};return forEach(r,(r,s)=>{let o={};r.forEach(e=>{e!==EPSILON&&(o[e]=!0)});let i=[s];for(;i.length>0;){let e=i.pop();if(s===END)continue;n[e]=!0;let r=t[e];if(!r)throw new Error(`Internal Error: no transition from state ${e}`);let a=Object.keys(r);for(let e=0;e<a.length;e++){const t=a[e],s=r[t];n[s]||i.push(s),t!==EPSILON&&(o[t]=!0)}}let a=Object.keys(o);a.length>0&&e.push(a)}),e}}DFA.START=START,DFA.END=END,DFA.EPSILON=EPSILON,DFA.TEXT="TEXT";const START$1=DFA.START,END$1=DFA.END,EPSILON$1=DFA.EPSILON;class DFABuilder{constructor(e){this.transitions=e}addTransition(e,t,r){return this.transitions||(this.transitions={}),isArray(r)||(r=[r]),r.forEach(r=>_addTransition(this.transitions,e,t,r)),this}append(e){if(this.transitions&&e.transitions){let t=cloneDeep(this.transitions),r=cloneDeep(e.transitions),n=Boolean(t[START$1][EPSILON$1]),s=Boolean(r[START$1][EPSILON$1]);n&&delete t[START$1][EPSILON$1];let o=uuid();forEach(t,e=>{forEach(e,(t,r)=>{t===END$1&&(e[r]=o)})}),n&&forEach(r[START$1],(e,r)=>{_addTransition(t,START$1,e,r)}),r[o]=r[START$1],forEach(r,e=>{forEach(e,(t,r)=>{t===START$1&&(e[r]=o)})}),delete r[START$1],forEach(r,(e,r)=>{forEach(e,(e,n)=>{_addTransition(t,r,e,n)})}),n&&s&&_addTransition(t,START$1,END$1,EPSILON$1),this.transitions=t}else e.transitions&&(this.transitions=cloneDeep(e.transitions));return this}merge(e){if(this.transitions&&e.transitions){let t=this.transitions;forEach(e.transitions,(e,r)=>{forEach(e,(e,n)=>{_addTransition(t,r,e,n)})})}else e.transitions&&(this.transitions=cloneDeep(e.transitions));return this}optional(){let e=new DFABuilder(cloneDeep(this.transitions));return this.transitions&&e.addTransition(START$1,END$1,EPSILON$1),e}kleene(){return this.plus().optional()}plus(){let e;if(this.transitions){let t=cloneDeep(this.transitions);const r=Boolean(t[START$1][EPSILON$1]);delete t[START$1][EPSILON$1];let n=uuid();forEach(t,e=>{forEach(e,(t,r)=>{t===END$1&&(e[r]=n)})}),_addTransition(t,n,END$1,EPSILON$1),forEach(t[START$1],(e,r)=>{_addTransition(t,n,e,r)}),r&&_addTransition(t,START$1,END$1,EPSILON$1),e=new DFABuilder(t)}else e=new DFABuilder(cloneDeep(this.transitions));return e}toJSON(){return cloneDeep(this.transitions)}copy(){let e=cloneDeep(this.transitions);if(this.transitions){let t=Object.keys(e),r={START:START$1,END:END$1};t.forEach(e=>{e!==START$1&&e!==END$1&&(r[e]=uuid())}),forEach(e,(t,n)=>{n!==START$1&&n!==END$1&&(e[r[n]]=t,delete e[n]),forEach(t,(e,n)=>{e!==START$1&&e!==END$1&&(t[n]=r[e])})})}return new DFABuilder(e)}}function _addTransition(e,t,r,n){let s=e[t];if(s||(e[t]=s={}),n===EPSILON$1&&t===START$1&&r!==END$1)throw new Error("The only EPSILON transition from START must be START->END");s[n]&&s[n]!==r?console.error("Token %s already used. Ignoring this transition.",n):s[n]=r}function _isTextNodeEmpty(e){return Boolean(/^\s*$/.exec(e.textContent))}DFABuilder.singleToken=function(e){let t=new DFABuilder;return t.addTransition(START$1,END$1,e),t};const{START:START$2,END:END$2,TEXT:TEXT$3,EPSILON:EPSILON$2}=DFA;class Expression{constructor(e,t){this.name=e,this.root=t,this._initialize()}_initialize(){this._compile()}toString(){return this.root.toString()}copy(){return this.root.copy()}toJSON(){return{name:this.name,content:this.root.toJSON()}}isAllowed(e){return Boolean(this._allowedChildren[e])}_normalize(){this.root._normalize()}_compile(){this.root._compile()}_describeError(e,t){let r=[];return t!==TEXT$3?this.isAllowed(t)?r.push(`<${t}> is not allowed at the current position in <${this.name}>.\n${this.toString()}`):r.push(`<${t}> is not valid in <${this.name}>\nSchema: ${this.toString()}`):r.push(`TEXT is not allowed at the current position: ${e.trace.join(",")}\n${this.toString()}`),r.join("")}}function createExpression(e,t){return t instanceof Interleave?new InterleaveExpr(e,t):new DFAExpr(e,t)}Expression.fromJSON=function(e){return createExpression(e.name,_fromJSON(e.content))};class DFAExpr extends Expression{getInitialState(){return{dfaState:START$2,errors:[],trace:[]}}canConsume(e,t){return this.dfa.canConsume(e.dfaState,t)}consume(e,t){const r=this.dfa;let n=e.dfaState,s=r.consume(n,t);return e.dfaState=s,-1===s?(e.errors.push({msg:this._describeError(e,t),el:e.el}),!1):(e.trace.push(t),!0)}isFinished(e){return this.dfa.isFinished(e.dfaState)}_initialize(){super._initialize(),this._computeAllowedChildren()}_compile(){super._compile(),this.dfa=new DFA(this.root.dfa.transitions)}_computeAllowedChildren(){this._allowedChildren=_collectAllTokensFromDFA(this.dfa)}_findInsertPos(e,t,r){const n=this.root;return n instanceof Sequence?this._findInsertPosInSequence(e,t,r):n instanceof Plus||n instanceof Kleene?"first"===r?0:e.childNodes.length:void 0}_isValid(e){let t=this.getInitialState();for(let r=0;r<e.length;r++){const n=e[r];if(n&&!this.consume(t,n))return!1}return this.isFinished(t)}_findInsertPosInSequence(e,t,r){const n=[];e.getChildNodes().forEach(e=>{const t=e.tagName;t?n.push(t):e._isDOMElement&&e.isTextNode()&&!_isTextNodeEmpty(e)?n.push(TEXT$3):n.push(null)});const s=n.length,o=this;function i(e){let r=n.slice(0);return r.splice(e,0,t),o._isValid(r)}if("first"===r){for(let e=0;e<=s;e++)if(i(e))return e}else for(let e=s;e>=0;e--)if(i(e))return e;return-1}}function _collectAllTokensFromDFA(e){const t={};return e.transitions&&forEach(e.transitions,e=>{Object.keys(e).forEach(e=>{e!==EPSILON$2&&(t[e]=!0)})}),t}class InterleaveExpr extends Expression{getInitialState(){const e=this.dfas,t=new Array(e.length);return t.fill(START$2),{dfaStates:t,errors:[],trace:[],lastDFA:0}}canConsume(e,t){return this._findNextDFA(e,t)>=0}consume(e,t){const r=this._findNextDFA(e,t);if(r<0)return e.errors.push({msg:this._describeError(e,t)}),!1;{const n=this.dfas[r],s=e.dfaStates[r],o=n.consume(s,t);return e.dfaStates[r]=o,e.trace.push(t),!0}}isFinished(e){const t=this.dfas;for(let r=0;r<t.length;r++){const n=t[r],s=e.dfaStates[r];if(!n.isFinished(s))return!1}return!0}_initialize(){super._initialize(),this._computeAllowedChildren()}_compile(){super._compile(),this.blocks=this.root.blocks,this.dfas=this.blocks.map(e=>new DFA(e.dfa.transitions))}_computeAllowedChildren(){this._allowedChildren=Object.assign(...this.blocks.map(e=>_collectAllTokensFromDFA(e.dfa)))}_findNextDFA(e,t){console.assert(e.dfaStates.length===this.dfas.length);const r=this.dfas;for(let n=0;n<e.dfaStates.length;n++){const s=r[n],o=e.dfaStates[n];if(s.canConsume(o,t))return n}return-1}_findInsertPos(e,t,r){return e.childNodes.length}}class Token{constructor(e){this.name=e}toString(){return this.name}toJSON(){return this.name}copy(){return new Token(this.name)}_normalize(){}_compile(){this.dfa=DFABuilder.singleToken(this.name)}}Token.fromJSON=function(e){return new Token(e)};class Choice{constructor(e){this.blocks=e}copy(){return new Choice(this.blocks.map(e=>e.copy()))}toJSON(){return{type:"|",blocks:this.blocks.map(e=>e.toJSON())}}_normalize(){const e=this.blocks;for(let t=e.length-1;t>=0;t--){let r=e[t];r._normalize(),r instanceof Choice&&e.splice(t,1,...r.blocks)}}_compile(){let e=new DFABuilder;return this.blocks.forEach(t=>{if(t instanceof Token)e.addTransition(START$2,END$2,t.name);else{if(t instanceof Interleave)throw new Error("Nested interleave blocks are not supported.");t.dfa||t._compile(),e.merge(t.dfa)}}),this.dfa=e,e}toString(){return"("+this.blocks.map(e=>e.toString()).join("|")+")"}}Choice.fromJSON=function(e){return new Choice(e.blocks.map(e=>_fromJSON(e)))};class Sequence{constructor(e){this.blocks=e}copy(){return new Sequence(this.blocks.map(e=>e.copy()))}toJSON(){return{type:",",blocks:this.blocks.map(e=>e.toJSON())}}_compile(){let e=new DFABuilder;return this.blocks.forEach(t=>{if(t instanceof Token)e.append(DFABuilder.singleToken(t.name));else{if(t instanceof Interleave)throw new Error("Nested interleave blocks are not supported.");t.dfa||t._compile(),e.append(t.dfa)}}),this.dfa=e,e}_normalize(){const e=this.blocks;for(let t=e.length-1;t>=0;t--){let r=e[t];r._normalize(),r instanceof Sequence&&e.splice(t,1,...r.blocks)}}toString(){return"("+this.blocks.map(e=>e.toString()).join(",")+")"}}Sequence.fromJSON=function(e){return new Sequence(e.blocks.map(e=>_fromJSON(e)))};class Interleave{constructor(e){this.blocks=e}copy(){return new Interleave(this.blocks.map(e=>e.copy()))}toString(){return"("+this.blocks.map(e=>e.toString()).join(", ")+")[unordered]"}toJSON(){return{type:"~",blocks:this.blocks.map(e=>e.toJSON())}}_normalize(){}_compile(){this.blocks.forEach(e=>e._compile())}}Interleave.fromJSON=function(e){return new Interleave(e.blocks.map(e=>_fromJSON(e)))};class Optional{constructor(e){this.block=e}copy(){return new Optional(this.block.copy())}toJSON(){return{type:"?",block:this.block.toJSON()}}_compile(){const e=this.block;if(e instanceof Interleave)throw new Error("Nested interleave blocks are not supported.");return e.dfa||e._compile(),this.dfa=e.dfa.optional(),this.dfa}_normalize(){const e=this.block;e._normalize(),e instanceof Optional?this.block=e.block:e instanceof Kleene&&console.error("FIXME -  <optional> is useless here",this.toString())}toString(){return this.block.toString()+"?"}}Optional.fromJSON=function(e){return new Optional(_fromJSON(e.block))};class Kleene{constructor(e){this.block=e}copy(){return new Kleene(this.block.copy())}toJSON(){return{type:"*",block:this.block.toJSON()}}_compile(){const e=this.block;if(e instanceof Interleave)throw new Error("Nested interleave blocks are not supported.");return e.dfa||e._compile(),this.dfa=e.dfa.kleene(),this.dfa}_normalize(){const e=this.block;if(e._normalize(),e instanceof Optional||e instanceof Kleene)this.block=e.block;else if(e instanceof Plus)throw new Error("This does not make sense:"+this.toString())}toString(){return this.block.toString()+"*"}}Kleene.fromJSON=function(e){return new Kleene(_fromJSON(e.block))};class Plus{constructor(e){this.block=e}copy(){return new Plus(this.block.copy())}toJSON(){return{type:"+",block:this.block.toJSON()}}_compile(){const e=this.block;if(e instanceof Interleave)throw new Error("Nested interleave blocks are not supported.");return e.dfa||e._compile(),this.dfa=e.dfa.plus(),this.dfa}_normalize(){const e=this.block;if(e._normalize(),e instanceof Optional||e instanceof Kleene)throw new Error("This does not make sense:"+this.toString());e instanceof Plus&&(this.block=e.block)}toString(){return this.block.toString()+"+"}}function _fromJSON(e){switch(e.type){case",":return Sequence.fromJSON(e);case"~":return Interleave.fromJSON(e);case"|":return Choice.fromJSON(e);case"?":return Optional.fromJSON(e);case"+":return Plus.fromJSON(e);case"*":return Kleene.fromJSON(e);default:if(isString(e))return new Token(e);throw new Error("Unsupported data.")}}Plus.fromJSON=function(e){return new Plus(_fromJSON(e.block))};const{TEXT:TEXT$4}=DFA;function analyze(e){forEach(e,e=>{Object.assign(e,{children:{},parents:{},siblings:{},usedInlineBy:{},usedStructuredBy:{}})}),forEach(e,t=>{_analyzeElementSchema(t,e)})}function _analyzeElementSchema(e,t){const r=e.expr,n=e.name;if(!r)return;let s=[];r instanceof DFAExpr?r.dfa&&(s=r.dfa._tokensByPath()):r instanceof InterleaveExpr&&r.dfas.forEach(e=>{e&&(s=s.concat(e._tokensByPath()))}),0===s.length&&"implicit"===e.type&&(e.type="element");let o=!1,i=!1;s.forEach(r=>{let s=r.indexOf(TEXT$4)>=0,a=!s&&r.length>0;s&&(o=!0),a&&(i=!0),r.forEach(o=>{const i=t[o];i&&(i.parents[n]=!0,e.children[o]=!0,e.siblings[n]=r,a&&(i.usedStructuredBy[n]=!0),s&&(i.usedInlineBy[n]=!0))})}),i&&(e.isStructured=!0),o&&(e.isText=!0),"implicit"===e.type&&(e.type=o?"text":"element")}function checkSchema(e){const t=e.getTagNames();let r=[];for(let n=0;n<t.length;n++){const s=t[n],o=e.getElementSchema(s);switch(o.type){case"text":r=r.concat(_checkTextElement(o));break;case"element":case"container":r=r.concat(_checkElement(o));break;case"hybrid":r=r.concat(_checkHybridElement(o));break;case"annotation":r=r.concat(_checkAnnotation(o));break;case"inline-element":r=r.concat(_checkInlineElement(o));break;case"anchor":r=r.concat(_checkAnchor(o));break;case"external":case"not-implemented":break;default:throw new Error("Unsupported element classification.")}}return r}function _checkTextElement(e){const t=[];return _usedInline(e)&&t.push(`[1]: text element <${e.name}> is used inline by ${_usedInlineBy(e).join(",")}`),e.isText||t.push(`[4]: text element <${e.name}> does not allow text content`),e.isStructured&&t.push(`[5]: text element <${e.name}> must not allow structured content`),t}function _checkElement(e){const t=[];return _usedInline(e)&&t.push(`[2]: element <${e.name}> is used inline by ${_usedInlineBy(e).join(",")}`),e.isText&&t.push(`[6]: element <${e.name}> must not allow text content`),t}function _checkHybridElement(e){const t=[];return _usedInlineOnly(e)&&t.push(`[2.2]: hybrid element <${e.name}> is used inline by ${_usedInlineBy(e).join(",")}`),e.isText&&e.isStructured||t.push(`[7]: hybrid element <${e.name}> must allow text and structured content`),t}function _checkAnnotation(e){const t=[];return _usedInlineOnly(e)||t.push(`[3]: annotation <${e.name}> is used in structured content by ${_usedStructuredBy(e).join(",")}`),e.isText||t.push(`[8]: annotation <${e.name}> does not allow text content`),t}function _checkInlineElement(e){const t=[];return _usedInlineOnly(e)||t.push(`[3]: inline-element <${e.name}> is used in structured content by ${_usedStructuredBy(e).join(",")}`),t}function _checkAnchor(e){const t=[];return _usedInlineOnly(e)||t.push(`[3]: anchor <${e.name}> is used in structured content by ${_usedStructuredBy(e).join(",")}`),t}function _usedInline(e){let t=e.usedInlineBy||{};return Object.keys(t).length>0}function _usedInlineBy(e){let t=e.usedInlineBy||{};return Object.keys(t)}function _usedInlineOnly(e){return 0===_usedStructuredBy(e).length}function _usedStructuredBy(e){let t=e.usedInlineBy||{};return Object.keys(e.parents).filter(e=>!t[e])}function nameWithoutNS$1(e){const t=e.indexOf(":");return t>0?e.slice(t+1):e}const{TEXT:TEXT$5}=DFA;class XMLSchema{constructor(e,t){if(!e[t])throw new Error("startElement must be a valid element.");this._elementSchemas={},this.startElement=t,forEach(e,(e,t)=>{this._elementSchemas[t]=new ElementSchema(e.name,e.type,e.attributes,e.expr)})}getIdAttribute(){return"id"}getTagNames(){return Object.keys(this._elementSchemas)}getElementSchema(e){return this._elementSchemas[e]}getStartElement(){return this.startElement}toJSON(){let e={start:this.getStartElement(),elements:{}};return forEach(this._elementSchemas,(t,r)=>{e.elements[r]=t.toJSON()}),e}toMD(){let e=[],t=Object.keys(this._elementSchemas);return t.sort(),t.forEach(t=>{let r=this._elementSchemas[t];e.push(`# <${r.name}>`),e.push(""),e.push(`type: ${r.type}`),e.push("attributes: "+map(r.attributes,(e,t)=>t).join(", ")),e.push("children:"),e.push("  "+r.expr.toString()),e.push("")}),e.join("\n")}validateElement(e){let t=e.tagName;return _validateElement(this.getElementSchema(t),e)}}XMLSchema.fromJSON=function(e){let t={};return forEach(e.elements,e=>{let r=ElementSchema.fromJSON(e);t[r.name]=r}),new XMLSchema(t,e.start)};class ElementSchema{constructor(e,t,r,n){if(this.name=e,this.type=t,this.attributes=r,this.expr=n,!e)throw new Error("'name' is mandatory");if(!t)throw new Error("'type' is mandatory");if(!r)throw new Error("'attributes' is mandatory");if(!n)throw new Error("'expr' is mandatory")}toJSON(){return{name:this.name,type:this.type,attributes:this.attributes,elements:this.expr.toJSON()}}isAllowed(e){return this.expr.isAllowed(e)}isTextAllowed(){return this.expr.isAllowed(TEXT$5)}printStructure(){return`${this.name} ::= ${this.expr.toString()}`}findFirstValidPos(e,t){return this.expr._findInsertPos(e,t,"first")}findLastValidPos(e,t){return this.expr._findInsertPos(e,t,"last")}}function _validateElement(e,t){let r=[],n=!0;{const s=_checkAttributes(e,t);s.ok||(r=r.concat(s.errors),n=!1)}if("external"===e.type||"not-implemented"===e.type);else{let s;(s=t._isXMLTextElement?_checkChildren(e,t.toXML()):_checkChildren(e,t)).ok||(r=r.concat(s.errors),n=!1)}return{errors:r,ok:n}}function _checkAttributes(e,t){return{ok:!0}}function _checkChildren(e,t){if("external"===e.type||"not-implemented"===e.type)return!0;const r="text"===e.type,n=e.expr,s=n.getInitialState(),o=t.getChildNodeIterator();let i=!0;for(;i&&o.hasNext();){const e=o.next();let t;if(e.isTextNode()){if(_isTextNodeEmpty(e))continue;t=TEXT$5}else if(e.isElementNode())t=e.tagName;else{if("cdata"!==e.getNodeType())continue;t=TEXT$5}n.consume(s,t)||(i=!1)}s.errors.length>0&&s.errors.forEach(e=>{e.el=t});const a=n.isFinished(s);return!i||a||r||(s.errors.push({msg:`<${t.tagName}> is incomplete.\nSchema: ${n.toString()}`,el:t}),i=!1),i&&(s.ok=!0),s}function _lookupRNG(e,t,r){for(let n=0;n<t.length;n++){let s=t[n]+"/"+r;if(e.existsSync(s))return s}}function _expandIncludes(e,t,r){let n=r.findAll("include");return 0!==n.length&&(n.forEach(r=>{const n=r.parentNode,s=r.attr("href"),o=_lookupRNG(e,t,s);if(!o)throw new Error(`Could not find ${s}`);const i=e.readFileSync(o,"utf8"),a=DefaultDOMElement.parseXML(i,"full-doc").find("grammar");if(!a)throw new Error("No grammar element found");a.children.forEach(e=>{n.insertBefore(e,r)}),r.remove()}),!0)}function _loadRNG(e,t,r){isArray(t)||(t=[t]);let n=_lookupRNG(e,t,r),s=e.readFileSync(n,"utf8");const o=DefaultDOMElement.parseXML(s,"full-doc");for(;_expandIncludes(e,t,o););return o}ElementSchema.fromJSON=function(e){return new ElementSchema(e.name,e.type,e.attributes,Expression.fromJSON(e.elements))};const TEXT$6=DFA.TEXT;function compileRNG(e,t,r){let n,s=(n=1===arguments.length&&isString(arguments[0])?DefaultDOMElement.parseXML(arguments[0]):_loadRNG(e,t,r)).find("grammar");if(!s)throw new Error("<grammar> not found.");return _registerDefinitions(s),_compile(_transformRNG(s))}function _registerDefinitions(e){let t={};e.children.forEach(e=>{"define"===nameWithoutNS$1(e.tagName)&&_processDefine(e,t)}),e.defs=t}function _processDefine(e,t){const r=e.attr("name");"interleave"===e.attr("combine")?t[r]?t[r].append(e.children):t[r]=e:(t[r],t[r]=e)}function _transformRNG(e){const t=e.createElement.bind(e);e.findAll("removed").forEach(t=>{let r=t.attr("name");e.findAll(`element[name="${r}"]`).forEach(e=>{e.remove()}),e.findAll(`ref[name="${r}"]`).forEach(e=>{e.remove()})});const r={},n=e.defs,s=e.findAll("define > element"),o=DefaultDOMElement.createDocument("xml"),i=o.createElement("grammar"),a=e.findAll("not-implemented").reduce((e,t)=>{let r=t.attr("name");return r&&e.add(r),e},new Set);s.forEach(e=>{const s=e.attr("name");if(!s)throw new Error("'name' is mandatory.");let l;l=a.has(s)?t("element").attr("name",s).attr("type","not-implemented"):_transformElementDefinition(o,s,e,n),r[s]=l,i.appendChild(l)}),e.findAll("elementType").forEach(e=>{const t=e.attr("name");let n=e.attr("s:type")||e.attr("type");if(!t||!n)throw new Error("Attributes name and type are mandatory.");const s=r[t];if(!s)throw new Error(`Unknown element ${t}.`);s.attr("type",n)});const l=_extractStart(e);if(!l)throw new Error("<start> is mandatory.");return i.appendChild(o.createElement("start").attr("name",l)),i}function _transformElementDefinition(e,t,r,n){let s=e.createElement("element").attr("name",t);s.attr("type","implicit");let o=e.createElement("attributes"),i=e.createElement("children");for(r.children.forEach(t=>{_transformBlock(e,t,n,{}).forEach(e=>{e.find("attribute")||e.is("attribute")?o.appendChild(e):i.appendChild(e)})}),s.appendChild(o),s.appendChild(i);;){let e=i.find("choice > choice");if(!e)break;{let t=e.parentNode;e.children.forEach(r=>{t.insertBefore(r,e)}),t.removeChild(e)}}let a=i.findAll("choice");for(let e=0;e<a.length;e++){let t=a[e],r=t.children;1===r.length&&t.parentNode.replaceChild(t,r[0])}let l=i.findAll("optional > text, zeroOrMore > text");for(let e=0;e<l.length;e++){let t=l[e],r=t.parentNode;1===r.getChildCount()&&r.parentNode.replaceChild(r,t)}let c=i.findAll("optional, zeroOrMore, oneOrMore");for(let e=0;e<c.length;e++){let t=c[e];0===t.getChildCount()&&t.remove()}return s}function _transformBlock(e,t,r,n={}){switch(t.tagName){case"element":return[e.createElement("element").attr("name",t.attr("name"))];case"ref":return _expandRef(e,t,r,n);case"empty":case"notAllowed":return[];default:{let s=t.clone(!1);return t.children.forEach(t=>{s.append(_transformBlock(e,t,r,n))}),[s]}}}function _expandRef(e,t,r,n={}){const s=t.attr("name");if(n[s])throw new Error("Cyclic references are not supported.");n[s]=!0;const o=r[s];if(!o)throw new Error(`Unknown definition ${s}`);let i=[];return o.children.forEach(t=>{let s=_transformBlock(e,t,r,n);i=i.concat(s)}),delete n[s],i}function _extractStart(e){const t=e.find("start");if(!t)throw new Error("<grammar> must have a <start> element");const r=t.find("ref");if(!r)throw new Error("Expecting one <ref> inside of <start>.");return r.attr("name")}function _compile(e){const t={};e.children.filter(e=>"element"===e.tagName).forEach(r=>{const n=r.attr("name"),s=_collectAttributes(r.find("attributes")),o=r.find("children");let i={name:n,type:r.attr("type"),attributes:s,expr:createExpression(n,_processChildren(o,e))};t[n]=i}),analyze(t);const r=e.find("start");if(!r)throw new Error("<start> is mandatory");const n=r.attr("name");if(!n)throw new Error('<start> must have "name" set');return new XMLSchema(t,n)}function _processChildren(e,t){if(!e)return new Sequence([]);let r=_processBlocks(e.children,t);return 1===r.length?r[0]:new Sequence(r)}function _processBlocks(e,t){const r=[];for(var n=0;n<e.length;n++){const s=e[n];switch(s.tagName){case"attribute":case"empty":case"notAllowed":break;case"element":{const e=s.attr("name");r.push(new Token(e));break}case"text":r.push(new Token(TEXT$6));break;case"ref":{const e=_processReference(s,t);r.push(e);break}case"group":r.push(_processSequence(s,t));break;case"choice":{const e=_processChoice(s,t);r.push(e);break}case"optional":{const e=new Optional(_processChildren(s,t));r.push(e);break}case"oneOrMore":{const e=new Plus(_processChildren(s,t));r.push(e);break}case"zeroOrMore":{const e=new Kleene(_processChildren(s,t));r.push(e);break}case"interleave":{const e=new Interleave(_processBlocks(s.children,t));r.push(e);break}default:throw new Error("Not supported yet: "+s.tagName)}}return r}function _processSequence(e,t){if(e.expr)return e.expr.copy();const r=_processBlocks(e.children,t);return e.expr=new Sequence(r),e.expr}function _processChoice(e,t){if(e.expr)return e.expr.copy();let r=_processBlocks(e.children,t);return e.expr=new Choice(r),e.expr}function _processReference(e,t){const r=e.attr("name"),n=t.defs[r];if(!n)throw new Error(`Illegal ref: ${r} is not defined.`);if(n.expr)return n.expr.copy();if(t._visiting[r])throw new Error("Cyclic references are not supported yet");t._visiting[r]=!0;const s=_processChildren(n,t);return n.expr=s,delete t._visiting[r],n.expr}function _collectAttributes(e,t,r={}){if(!e)return{};let n=e.children;for(let e=0;e<n.length;e++){const s=n[e];switch(s.tagName){case"attribute":{const e=_transformAttribute(s);r[e.name]=e;break}case"group":case"choice":case"optional":case"oneOrMore":case"zeroOrMore":_collectAttributes(s,t,r)}}return r}function _transformAttribute(e){return{name:e.attr("name")}}class Adapter extends domUtils.DomUtils{isTag(){return!0}getChildren(e){return e.getChildren?e.getChildren():[]}getAttributeValue(e,t){if(e.getAttribute)return e.getAttribute(t)}getAttributes(e){return e.hasOwnProperty("attributes")?["id",e.id].concat(map(e.attributes,(e,t)=>[t,e])):["id",e.id]}hasAttrib(e,t){return"id"===t||!!e.hasOwnProperty("attributes")&&e.attributes.hasOwnProperty(t)}getName(e){return e.type}getNameWithoutNS(e){return nameWithoutNS$1(this.getName(e))}getText(e){return"text"===e._elementType?e.getText():""}}const cssSelectAdapter$1=new Adapter;function prettyPrintXML(e){let t;const r=[];let n=(t=isString(e)?DefaultDOMElement.parseXML(e):e).getChildNodes();if(t.isDocumentNode()){let e=t.empty().serialize();/<\?\s*xml/.exec(e)&&r.push(e)}return n.forEach(e=>{_prettyPrint(r,e,0)}),r.join("\n")}function _prettyPrint(e,t,r){let n=new Array(2*r).fill(" ").join("");if(t.isElementNode()){const s=_isMixed(t),o=_containsCDATA(t);if(s||o)e.push(n+t.outerHTML);else{let s=t.children;const o=t.tagName;let i=[`<${o}`];t.getAttributes().forEach((e,t)=>{i.push(`${t}="${e}"`)}),s.length>0?(e.push(n+i.join(" ")+">"),t.children.forEach(t=>{_prettyPrint(e,t,r+1)}),e.push(n+`</${o}>`)):e.push(n+i.join(" ")+" />")}}else 0===r&&t.isTextNode()||e.push(n+t.outerHTML)}function _isMixed(e){const t=e.childNodes;for(let e=0;e<t.length;e++){let r=t[e];if(r.isTextNode()&&!_isTextNodeEmpty(r))return!0}}function _containsCDATA(e){const t=e.childNodes;for(let e=0;e<t.length;e++){if("cdata"===t[e].getNodeType())return!0}}function appendChild(e,t){return insertAt$1(e,e._childNodes.length,t),e}function getChildPos(e,t){return e._childNodes.indexOf(t.id)}function removeChild(e,t){const r=getChildPos(e,t);if(!(r>=0))throw new Error(`Node ${t.id} is not a child of ${e.id}`);return removeAt$1(e,r),e}function replaceChild(e,t,r){const n=getChildPos(e,t);if(!(n>=0))throw new Error(`Node ${t.id} is not a child of ${e.id}`);return removeAt$1(e,n),insertAt$1(e,n,r),e}function insertBefore(e,t,r){if(r){let n=getChildPos(e,r);if(n<0)throw new Error(`Node ${t.id} is not a child of ${e.id}`);insertAt$1(e,n,t)}else appendChild(e,t);return e}function insertAt$1(e,t,r){const n=e._childNodes.length;if(!(t>=0&&t<=n))throw new Error("Index out of bounds.");e.getDocument().update([e.id,"_childNodes"],{type:"insert",pos:t,value:r.id});return e}function removeAt$1(e,t){const r=e._childNodes.length;if(!(t>=0&&t<r))throw new Error("Index out of bounds.");e.getDocument().update([e.id,"_childNodes"],{type:"delete",pos:t});return e}function getInnerXML(e){return e._childNodes?e.getChildNodes().map(e=>e.toXML().serialize()).join(""):e.isText()?e.toXML().getInnerXML():""}function getChildAt(e,t){let r=e._childNodes[t];if(r)return e.getDocument().get(r)}function node2element(e){return _node2element(DefaultDOMElement.createDocument("xml"),e)}function _node2element(e,t){let r;switch(t._elementType){case"text":r=_renderTextNode(e,t);break;case"element":case"inline-element":case"container":r=_renderElementNode(e,t);break;case"anchor":case"annotation":r=_createElement(e,t);break;case"external":r=DefaultDOMElement.parseSnippet(t.xml,"xml");break;default:throw new Error("Invalid element type.")}return r}function _createElement(e,t){let r=e.createElement(t.type);return r.attr("id",t.id),r.attr(t.attributes),r}function _renderElementNode(e,t){let r=_createElement(e,t);return r.append(t.getChildren().map(t=>_node2element(e,t))),r}function _renderTextNode(e,t){const r=t.getAnnotations(),n=t.getText();let s=_createElement(e,t);if(r&&r.length>0){new Fragmenter({onText:(e,t)=>{const r=e.node;(r.isText()||r.isAnnotation())&&e.el.append(t)},onEnter:t=>({el:_node2element(e,t.node),node:t.node}),onExit:(e,t,r)=>{r.el.append(t.el)}}).start({el:s,node:t},n,r)}else s.append(n);return s}class XMLDocumentNode extends DocumentNode{_initialize(e,t){t.attributes&&delete t.attributes.id,super._initialize(e,t)}toXML(){return node2element(this)}findChild(e){const t=this.getChildren();for(let r=0;r<t.length;r++){const n=t[r];if(n.type===e)return n}}find(e){return cssSelect.selectOne(e,this,{xmlMode:!0,adapter:cssSelectAdapter$1})}findAll(e){return cssSelect.selectAll(e,this,{xmlMode:!0,adapter:cssSelectAdapter$1})}isContainer(){return!1}isBlock(){const e=this.parentNode;return e&&e.isContainer()}get children(){return this.getChildren()}getChildren(){return this.getChildNodes()}getChildNodes(){return this._childNodes?getNodesForIds(this.getDocument(),this._childNodes):[]}getChildCount(){return this._childNodes?this._childNodes.length:0}getChildPosition(e){return e&&this._childNodes?this._childNodes.indexOf(e.id):-1}getChildNodeIterator(){return new ArrayIterator(this.getChildNodes())}getFirstChild(){if(this._childNodes)return this.getDocument().get(this._childNodes[0])}getLastChild(){if(this._childNodes)return this.getDocument().get(last$1(this._childNodes))}getParent(){return this.parentNode}setParent(e){this.parentNode=e}get tagName(){return this.type}get parent(){return this.parentNode}setAttribute(e,t){if("id"===e)throw new Error("'id' is read-only and can not be changed");return this.getDocument().set([this.id,"attributes",e],t),this}getAttribute(e){return"id"===e?this.id:this.attributes[e]}removeAttribute(e){return this.attributes.hasOwnProperty(e)&&(this.getDocument().set([this.id,"attributes",e],void 0),delete this.attributes[e]),this}getAttributes(){return clone(this.attributes)}getElementSchema(){return this.getDocument().getElementSchema(this.type)}serialize(){return this.toXML()}isTextNode(){return!1}isElementNode(){return!1}getInnerXML(){return getInnerXML(this)}get _isXMLNode(){return!0}}XMLDocumentNode.prototype.attr=DOMElement.prototype.attr,XMLDocumentNode.schema={attributes:{type:"object",default:{}}};class XMLTextElement extends(TextNodeMixin(XMLDocumentNode)){getPath(){return[this.id,"content"]}getText(){return this.content}getChildren(){const e=this.getAnnotations();return e.sort(_byStartOffset),e}getTextContent(){return this.getText()}setTextContent(e){return this.setText(e)}get textContent(){return this.getText()}set textContent(e){this.setText(e)}appendChild(e){throw new Error("This is not implemented yet.")}removeChild(e){throw new Error("This is not implemented yet.")}isElementNode(){return!0}text(){return DOMElement.prototype.text.apply(this,arguments)}get _isXMLTextElement(){return!0}get _elementType(){return"text"}static isText(){return!0}static isBlock(){return!0}}function _byStartOffset(e,t){return e.start.offset-t.start.offset}XMLTextElement.schema={type:"text",content:"text"};class XMLNodeConverter{constructor(e){this.type=e,this.tagName=nameWithoutNS$1(e),this.tagNameNS=e}matchElement(e){return e.tagName===this.tagNameNS}export(e,t){t.tagName=this.tagNameNS,t.attr(e.attributes)}}class XMLTextElementConverter extends XMLNodeConverter{import(e,t,r){t.content=r.annotatedText(e,[t.id,"content"],{preserveWhitespace:!0})}export(e,t,r){t.tagName=this.tagNameNS,t.attr(e.attributes),t.append(r.annotatedText([e.id,"content"]))}}class XMLElementNode extends XMLDocumentNode{appendChild(e){return appendChild(this,e)}removeChild(e){return removeChild(this,e)}insertBefore(e,t){return insertBefore(this,e,t)}insertAt(e,t){return insertAt$1(this,e,t)}removeAt(e){return removeAt$1(this,e)}getChildAt(e){return getChildAt(this,e)}isElementNode(){return!0}append(){return DOMElement.prototype.append.apply(this,arguments)}replaceChild(e,t){return replaceChild(this,e,t)}get _elementType(){return"element"}static isBlock(){return!0}}XMLElementNode.schema={type:"element",_childNodes:{type:["array","id"],default:[],owned:!0}};class ElementNodeConverter extends XMLNodeConverter{import(e,t,r){let n=r.getChildNodeIterator(e),s=[];for(;n.hasNext();){const e=n.next();if(e.isElementNode()){let t=r.convertElement(e);s.push(t.id)}}t._childNodes=s}export(e,t,r){t.tagName=this.tagNameNS,t.attr(e.attributes),e.getChildren().forEach(e=>{let n=r.convertNode(e);t.appendChild(n)})}}class XMLAnnotationNode extends(AnnotationMixin(XMLDocumentNode)){get parentNode(){const e=this.start.path;return this.getDocument().get(e[0])}static isPropertyAnnotation(){return!0}get _elementType(){return"annotation"}}XMLAnnotationNode.schema={type:"@annotation"};class XMLAnchorNode extends XMLDocumentNode{get parentNode(){const e=this.coor.start.path;return this.getDocument().get(e[0])}}XMLAnchorNode.prototype._elementType="anchor",XMLAnchorNode.type="anchor",XMLAnchorNode.schema={coor:{type:"coordinate",optional:!0}};class XMLInlineElementNode extends(AnnotationMixin(XMLDocumentNode)){get parentNode(){const e=this.start.path;if(e[0]){return this.getDocument().get(e[0])}return this._parentNode}set parentNode(e){if(this.start.path[0])throw new Error("parent of inline-element is implicitly given");this._parentNode=e}getChildAt(e){return getChildAt(this,e)}appendChild(e){return appendChild(this,e)}removeChild(e){return removeChild(this,e)}insertBefore(e,t){return insertBefore(this,e,t)}insertAt(e,t){return insertAt$1(this,e,t)}removeAt(e){return removeAt$1(this,e)}getInnerXML(){return this.getChildren().map(e=>e.toXML().outerHTML).join("")}static isInlineNode(){return!0}get _elementType(){return"inline-element"}get _isInlineNode(){return!0}}XMLInlineElementNode.schema={type:"inline-element",_childNodes:{type:["array","id"],default:[],owned:!0}};class XMLExternalNode extends XMLDocumentNode{get _elementType(){return"external"}static isBlock(){return!0}}XMLExternalNode.schema={type:"external",xml:{type:"string",default:""}};class ExternalNodeConverter extends XMLNodeConverter{import(e,t){t.xml=e.innerHTML}export(e,t){t.tagName=this.tagNameNS,t.setAttributes(e.attributes),t.innerHTML=e.xml}}class XMLContainerNode extends(ContainerMixin(XMLElementNode)){getContentPath(){return[this.id,"_childNodes"]}getContent(){return this._childNodes}isContainer(){return!0}appendChild(e){super.append(e.id)}get _elementType(){return"container"}static isBlock(){return!0}}XMLContainerNode.schema={type:"container"};const{TEXT:TEXT$7}=DFA;class ValidatingChildNodeIterator{constructor(e,t,r){this.el=e,this.it=t,this.expr=r,this.state=r.getInitialState(),this._oldStates=[]}hasNext(){return this.it.hasNext()}next(){const e=this.state,t=this.expr;let r,n=this.it.next(),s=cloneDeep(this.state);if(n.isTextNode()?r=t.consume(e,TEXT$7):n.isElementNode()&&(r=t.consume(e,n.tagName)),r)return this._oldStates.push(s),n;if(n.isTextNode())_isTextNodeEmpty(n)||console.error(`TEXT is invalid within <${t.name}>. Skipping.`,n.textContent);else if(n.isElementNode()){let t=last$1(e.errors);console.error(t.msg,this.el.getNativeElement())}return this.state=s,n.createComment(n.outerHTML)}back(){return this.it.back(),this.state=this._oldStates.pop(),this}peek(){return this.it.peek()}}function _mapParams(e){const t=e.schema,r=e.xmlSchema||t.xmlSchema;return{schema:t,xmlSchema:r,converters:e.converters,idAttribute:e.idAttribute||r.getIdAttribute()}}class XMLDocumentImporter extends DOMImporter{constructor(e,t){super(_mapParams(e,t),t),this.xmlSchema=e.xmlSchema||e.schema.xmlSchema}importDocument(e){this.reset();const t=this.state.doc;isString(e)&&(e=DefaultDOMElement.parseXML(e));const r=this.xmlSchema.getStartElement();let n;if(!(n=e.is(r)?e:e.find(r)))throw new Error(`Could not find <${r}> element.`);return t.root=this.convertElement(n),this.state.doc}_initialize(){const e=this.schema,t=e.getDefaultTextType(),r=this.converters;this._allConverters=[],this._propertyAnnotationConverters=[],this._blockConverters=[];for(let n=0;n<r.length;n++){let s;if("function"==typeof r[n]){s=new(0,r[n])}else s=r[n];if(!s.type)throw new Error("Converter must provide the type of the associated node.");if(!s.matchElement&&!s.tagName)throw new Error("Converter must provide a matchElement function or a tagName property.");s.matchElement||(s.matchElement=this._defaultElementMatcher.bind(s));const o=e.getNodeClass(s.type);if(!o)throw new Error("No node type defined for converter");this._defaultBlockConverter||t!==s.type||(this._defaultBlockConverter=s),o.isAnnotation()||o.isInlineNode()?this._propertyAnnotationConverters.push(s):this._blockConverters.push(s)}this._allConverters=this._blockConverters.concat(this._propertyAnnotationConverters)}_createNodeData(e,t){let r=super._createNodeData(e,t),n={};return e.getAttributes().forEach((e,t)=>{n[t]=e}),r.attributes=n,r}getChildNodeIterator(e){let t=this.xmlSchema.getElementSchema(e.tagName),r=e.getChildNodeIterator();return t?new ValidatingChildNodeIterator(e,r,t.expr):r}_convertPropertyAnnotation(){throw new Error("stand-alone annotations are not supported.")}_convertInlineNode(e,t,r){return r.import&&(t=r.import(e,t,this)||t),t.start={path:[],offset:0},t.end={offset:0},t}}function registerSchema(e,t,r,n={}){const s=t.getName();let o;t.getDefaultTextType&&(o=t.getDefaultTextType()),e.defineSchema({name:s,version:t.getVersion(),defaultTextType:o,DocumentClass:r,xmlSchema:t}),t.getTagNames().forEach(r=>{const o=t.getElementSchema(r),i=o.name;let a,l;switch(o.type){case"element":a=XMLElementNode,l=ElementNodeConverter;break;case"hybrid":throw new Error("Mixed element types are not supported yet.");case"text":a=XMLTextElement,l=XMLTextElementConverter;break;case"annotation":a=XMLAnnotationNode,l=XMLNodeConverter;break;case"anchor":a=XMLAnchorNode,l=XMLNodeConverter;break;case"inline-element":a=XMLInlineElementNode,l=ElementNodeConverter;break;case"external":case"not-implemented":a=XMLExternalNode,l=ExternalNodeConverter;break;case"container":a=XMLContainerNode,l=ElementNodeConverter;break;default:throw new Error("Illegal state")}class c extends a{}c.type=i,forEach(o.attributes,(e,t)=>{_defineAttribute(c,t,e)}),e.addNode(c);let d=new l(i);e.addConverter(s,d);let h=n.ImporterClass||XMLDocumentImporter;e.addImporter(s,h)})}const BUILTIN_ATTRS=["id","type","attributes","_childNodes","_content"];function _defineAttribute(e,t){let r=t.replace(":","_");r=camelCase(r),BUILTIN_ATTRS.indexOf(r)>=0||Object.defineProperty(e.prototype,r,{get(){return this.getAttribute(t)},set(e){return this.setAttribute(t,e),this}})}const DISABLED=Object.freeze({disabled:!0});class SchemaDrivenCommandManager extends DeprecatedCommandManager{_initialize(){const e=new Map,t=new Map,r=new Map,n=new Map;this.commands.forEach(s=>{const o=s.getName();s.isAnnotationCommand()?e.set(o,s):s.isInsertCommand()?t.set(o,s):s.isSwitchTypeCommand()?r.set(o,s):n.set(o,s)}),this.annotationCommands=e,this.insertCommands=t,this.switchTypeCommands=r,this.otherCommands=n}_getCommand(e){return this.annotationCommands.get(e)||this.insertCommands.get(e)||this.switchTypeCommands.get(e)||this.otherCommands.get(e)}_updateCommandStates(e){const t={},r=this.annotationCommands,n=this.insertCommands,s=this.switchTypeCommands,o=this._getCommandContext(),i=this._getCommandParams(),a=e.getDocument(),l=i.selectionState,c=i.selection,d=i.editorSession.isBlurred(),h=!c||c.isNull()||!c.isAttached();if(d||h||c.isCustomSelection())u(r),u(n),u(s);else{const e=c.start.path,t=a.get(e[0]);if(!t)throw new Error("FIXME: explain when this happens");const r=t.isText(),n=a.getXMLSchema();if(r&&c.isPropertySelection()&&!l.isInlineNodeSelection()){const e=n.getElementSchema(t.type);p(this.annotationCommands,e)}else u(this.annotationCommands);let s=t.parentNode;if(s&&s.isContainer()){const e=n.getElementSchema(s.type);p(this.insertCommands,e)}else u(this.insertCommands);if(s&&c.containerPath&&r&&s.isContainer()){const e=n.getElementSchema(s.type);p(this.switchTypeCommands,e)}else u(this.switchTypeCommands)}function u(e){e.forEach((e,r)=>{t[r]=DISABLED})}function p(e,r){e.forEach((e,n)=>{const s=e.getType();r.isAllowed(s)?t[n]=e.getCommandState(i,o):t[n]=DISABLED})}this.otherCommands.forEach((e,r)=>{t[r]=e.getCommandState(i,o)}),e.setCommandStates(t)}}function validateXML(e,t){let r=t.find(e.getStartElement());return r?validateElement(e,r):{errors:[{msg:"Start element is missing.",el:t}]}}function validateElement(e,t){let r=[],n=!0,s=[t];for(;s.length>0;){let t=s.shift(),o=e.validateElement(t);o.ok||(r=r.concat(o.errors),n=!1),t.isElementNode()&&(s=s.concat(t.getChildren()))}return{errors:r,ok:n}}class XMLParentNodeHook{constructor(e){this.doc=e,this.parents={},e.data.on("operation:applied",this._onOperationApplied,this)}_onOperationApplied(e){const t=this.doc,r=this.parents;let n=t.get(e.path[0]);switch(e.type){case"create":n._childNodes&&s(n,n._childNodes),function(e){let t=r[e.id];t&&(e.parentNode=t)}(n);break;case"update":{let t=e.diff;"_childNodes"===e.path[1]&&(t.isInsert()?s(n,t.getValue()):t.isDelete()&&s(null,t.getValue()));break}case"set":"_childNodes"===e.path[1]&&(s(null,e.getOldValue()),s(n,e.getValue()))}function s(e,n){function s(n){r[n]=e;let s=t.get(n);s&&(s.parentNode=e)}n&&(isArray(n)?n.forEach(s):s(n))}}static register(e){return new XMLParentNodeHook(e)}}class XMLEditingInterface extends EditingInterface{find(e){return this.getDocument().find(e)}findAll(e){return this.getDocument().findAll(e)}createElement(...e){return this.getDocument().createElement(...e)}}class XMLDocument extends Document{_initialize(){this.nodeFactory=new DocumentNodeFactory(this),this.data=new IncrementalData(this.schema,this.nodeFactory),this.addIndex("type",new PropertyIndex("type")),this.addIndex("annotations",new AnnotationIndex),XMLParentNodeHook.register(this)}toXML(){let e=DefaultDOMElement.createDocument("xml");e.setDoctype(...this.getDocTypeParams());let t=this.getRootNode().toXML();return e.append(t),e}getDocTypeParams(){throw new Error("This method is abstract")}getXMLSchema(){throw new Error("This method is abstract")}getRootNode(){throw new Error("This method is abstract")}getDocTypeAsString(){return new Error("This method is abstract")}createEditingInterface(){return new XMLEditingInterface(this)}find(e){return this.getRootNode().find(e)}findAll(e){return this.getRootNode().findAll(e)}createElement(e,t){return this.create(Object.assign({id:uuid(e),type:e},t))}getElementSchema(e){return this.getXMLSchema().getElementSchema(e)}_validateChange(e){let t={},r=[];e.ops.forEach(e=>{switch(e.type){case"delete":r.push(e.val.id);break;case"create":t[e.val.id]=!0;break;default:e.path&&(t[e.path[0]]=!0)}}),r.forEach(e=>delete t[e]);const n=this.getXMLSchema();let s=[];return Object.keys(t).forEach(e=>{let t=this.get(e);if(t&&t._isXMLNode){let e=n.validateElement(t);e.ok||(s=s.concat(e.errors))}}),{ok:0===s.length,errors:s}}_apply(e){if(!e.ops)return;let t={},r={},n={};const s=this;function o(e,t){let r=n[e];return r||(r=n[e]={ops:[]}),t&&r.ops.push(t),r}e.ops.forEach(e=>{switch(e.type){case"create":t[e.path[0]]=e.val;break;case"delete":{let t=this.get(e.path[0]);r[t.id]=t;break}case"update":case"set":n[e.path]=!0,o(this.get(e.path[0]).id,e);break}!function(e){switch(e.type){case"create":case"delete":{const t=e.val;if(t.hasOwnProperty("start")){n[t.start.path]=!0;let r=s.get(t.start.path[0]);r&&o(r.id,e)}if(t.hasOwnProperty("end")){n[t.end.path]=!0;let r=s.get(t.start.path[0]);r&&o(r.id,e)}break}case"update":case"set":{let t=s.get(e.path[0]);if(t)if(t.isPropertyAnnotation()){n[t.start.path]=!0;let r=s.get(t.start.path[0]);r&&o(r.id,e)}else t.isContainerAnnotation();break}}}(e),this._applyOp(e)}),Object.keys(r).forEach(e=>{delete n[e]}),e.created=t,e.updated=n,e.deleted=r,e._extracted=!0}}XMLDocument.prototype._isXMLDocument=!0;var ButtonPackage={name:"button",configure:function(e){e.addComponent("button",Button),e.addIcon("dropdown",{fontawesome:"fa-angle-down"})},Button:Button},ContextMenuPackage={name:"context-menu",configure:function(e){e.addComponent("context-menu",DeprecatedContextMenu)}};class Input extends Component{render(e){let t=this._getDocumentValue(),r=e("input").attr({value:t,type:this.props.type,placeholder:this.props.placeholder}).addClass("sc-input").val(t).on("keydown",this._onKeydown);return this.props.path&&r.on("change",this._onChange),this.props.centered&&r.addClass("sm-centered"),r}_onChange(){let e=this.context.editorSession,t=this.props.path,r=this.el.val(),n=this._getDocumentValue();r!==n&&(e.transaction(function(e){e.set(t,r)}),this.props.retainFocus&&this.el.getNativeElement().focus())}_getDocumentValue(){if(this.props.val)return this.props.val;{let e=this.context.editorSession,t=this.props.path;return e.getDocument().get(t)}}_onKeydown(e){e.keyCode===keys$1.ESCAPE&&(e.stopPropagation(),e.preventDefault(),this.el.val(this._getDocumentValue()))}}var InputPackage={name:"input",configure:function(e){e.addComponent("input",Input)},Input:Input};class Modal extends Component{render(e){let t=e("div").addClass("sc-modal");return t.on("click",this._closeModal),this.props.width&&t.addClass("sm-width-"+this.props.width),t.append(e("div").addClass("se-body").append(this.props.children)),t}_closeModal(e){e.target.classList.contains("sc-modal")&&this.send("closeModal")}}var ModalPackage={name:"modal",configure:function(e){e.addComponent("modal",Modal)},Modal:Modal},OverlayPackage={name:"overlay",configure:function(e){e.addComponent("overlay",DeprecatedOverlay)}},DropzonesPackage={name:"dropzones",configure:function(e){e.addComponent("dropzones",DeprecatedDropzones)},Dropzones:DeprecatedDropzones},ScrollbarPackage={name:"scrollbar",configure:function(e){e.addComponent("scrollbar",DeprecatedScrollbar)},Scrollbar:DeprecatedScrollbar},ScrollPanePackage={name:"scroll-pane",configure:function(e){e.addComponent("scroll-pane",DeprecatedScrollPane)},ScrollPane:DeprecatedScrollPane};class BodyScrollPane extends AbstractScrollPane{getChildContext(){return{scrollPane:this}}getName(){return"body"}render(e){let t=e("div");return"custom"===this.props.contextMenu&&t.on("contextmenu",this._onContextMenu),t.append(this.props.children),t}getHeight(){return platform.inBrowser?window.innerHeight:0}getContentHeight(){return platform.inBrowser?document.body.scrollHeight:0}getContentElement(){return platform.inBrowser?DefaultDOMElement.wrapNativeElement(window.document.body):null}getScrollableElement(){return platform.inBrowser?document.body:null}getScrollPosition(){return platform.inBrowser?document.body.scrollTop:0}setScrollPosition(e){platform.inBrowser&&(document.body.scrollTop=e)}getPanelOffsetForElement(e){console.warn("TODO: implement")}scrollTo(e,t){console.warn("TODO: implement")}}var BodyScrollPanePackage={name:"body-scroll-pane",configure:function(e){e.addComponent("body-scroll-pane",BodyScrollPane)},BodyScrollPane:BodyScrollPane},SplitPanePackage={name:"split-pane",configure:function(e){e.addComponent("split-pane",SplitPane)},SplitPane:SplitPane};class TabbedPane extends Component{render(e){let t=e("div").addClass("sc-tabbed-pane"),r=e("div").addClass("se-tabs");return forEach(this.props.tabs,function(t){let n=e("a").addClass("se-tab").attr({href:"#","data-id":t.id}).on("click",this.onTabClicked);t.id===this.props.activeTab&&n.addClass("sm-active"),n.append(e("span").addClass("label").append(t.name)),r.append(n)}.bind(this)),t.append(r),t.append(e("div").addClass("se-tab-content").ref("tabContent").append(this.props.children)),t}onTabClicked(e){e.preventDefault();let t=e.currentTarget.dataset.id;this.send("switchTab",t)}}var TabbedPanePackage={name:"tabbed-pane",configure:function(e){e.addComponent("tabbed-pane",TabbedPane)},TabbedPane:TabbedPane},FilePackage={name:"file",configure:function(e){e.addNode(FileNode)}},ToolPanelPackage={name:"tool-panel",configure(e){e.addComponent("tool-panel",DeprecatedToolPanel),e.addComponent("tool-dropdown",DeprecatedToolDropdown),e.addComponent("tool-group",DeprecatedToolGroup),e.addComponent("menu-group",DeprecatedMenuGroup),e.addComponent("tool-prompt",DeprecatedToolPrompt),e.addComponent("tool-separator",DeprecatedToolSeparator)}},BasePackage={name:"base",configure:function(e){e.import(FilePackage),e.import(ScrollPanePackage),e.import(BodyScrollPanePackage),e.import(SplitPanePackage),e.import(TabbedPanePackage),e.import(ScrollbarPackage),e.import(ModalPackage),e.import(InputPackage),e.import(ButtonPackage),e.import(ContextMenuPackage),e.import(OverlayPackage),e.import(DropzonesPackage),e.import(ToolPanelPackage),e.addCommand("undo",Undo,{commandGroup:"undo-redo"}),e.addCommand("redo",Redo,{commandGroup:"undo-redo"}),e.addCommand("select-all",SelectAll,{commandGroup:"selection"}),e.addIcon("insert",{fontawesome:"fa-plus"}),e.addIcon("undo",{fontawesome:"fa-undo"}),e.addIcon("redo",{fontawesome:"fa-repeat"}),e.addIcon("edit",{fontawesome:"fa-cog"}),e.addIcon("delete",{fontawesome:"fa-times"}),e.addIcon("expand",{fontawesome:"fa-arrows-h"}),e.addIcon("truncate",{fontawesome:"fa-arrows-h"}),e.addLabel("undo",{en:"Undo",de:"Rückgängig"}),e.addLabel("redo",{en:"Redo",de:"Wiederherstellen"}),e.addLabel("select-all",{en:"Select All",de:"Alles Auswählen"}),e.addLabel("text-types",{en:"Text Type",de:"Texttyp"}),e.addLabel("container-selection",{en:"Container",de:"Container"}),e.addLabel("@container",{en:"Container",de:"Container"}),e.addLabel("insert",{en:"Insert",de:"Einfügen"}),e.addLabel("insert-container",{en:"Insert Container",de:"Container einfügen"}),e.addComponent("text-property",TextPropertyComponent),e.addComponent("isolated-node",IsolatedNodeComponent),e.addComponent("inline-node",IsolatedInlineNodeComponent),e.addComponent("annotation",AnnotationComponent),e.addKeyboardShortcut("CommandOrControl+Z",{command:"undo"}),e.addKeyboardShortcut("CommandOrControl+Shift+Z",{command:"redo"}),e.addKeyboardShortcut("CommandOrControl+A",{command:"select-all"})},UndoCommand:Undo,RedoCommand:Redo,SelectAllCommand:SelectAll};class Blockquote extends TextBlock{}Blockquote.type="blockquote";class BlockquoteComponent extends TextBlockComponent{render(e){return super.render.call(this,e).addClass("sc-blockquote")}}var BlockquoteHTMLConverter={type:"blockquote",tagName:"blockquote",import:function(e,t,r){t.content=r.annotatedText(e,[t.id,"content"])},export:function(e,t,r){t.append(r.annotatedText([e.id,"content"]))}},BlockquotePackage={name:"blockquote",configure:function(e){e.addNode(Blockquote),e.addComponent(Blockquote.type,BlockquoteComponent),e.addConverter("html",BlockquoteHTMLConverter),e.addConverter("xml",BlockquoteHTMLConverter),e.addCommand("blockquote",SwitchTextTypeCommand,{spec:{type:"blockquote"},commandGroup:"text-types"}),e.addIcon("blockquote",{fontawesome:"fa-quote-right"}),e.addLabel("blockquote",{en:"Blockquote",de:"Blockzitat"}),e.addKeyboardShortcut("CommandOrControl+Alt+B",{command:"blockquote"})},Blockquote:Blockquote,BlockquoteComponent:BlockquoteComponent,BlockquoteHTMLConverter:BlockquoteHTMLConverter};class Code extends PropertyAnnotation{}Code.type="code";var CodeHTMLConverter={type:"code",tagName:"code"},CodePackage={name:"code",configure:function(e){e.addNode(Code),e.addConverter("html",CodeHTMLConverter),e.addConverter("xml",CodeHTMLConverter),e.addComponent("code",AnnotationComponent),e.addCommand("code",AnnotationCommand,{nodeType:Code.type,commandGroup:"annotations"}),e.addIcon("code",{fontawesome:"fa-code"}),e.addLabel("code",{en:"Code",de:"Code"})},Code:Code,CodeHTMLConverter:CodeHTMLConverter};class Codeblock extends TextBlock{}Codeblock.type="codeblock";class CodeblockComponent extends TextBlockComponent{render(e){return super.render.call(this,e).addClass("sc-codeblock")}}var CodeblockHTMLConverter={type:"codeblock",tagName:"pre",import:function(e,t,r){let n=e.find("code");n&&(t.content=r.annotatedText(n,[t.id,"content"],{preserveWhitespace:!0}))},export:function(e,t,r){let n=r.$$;t.append(n("code").append(r.annotatedText([e.id,"content"])))}},CodeblockPackage={name:"codeblock",configure:function(e){e.addNode(Codeblock),e.addComponent("codeblock",CodeblockComponent),e.addConverter("html",CodeblockHTMLConverter),e.addConverter("xml",CodeblockHTMLConverter),e.addCommand("codeblock",SwitchTextTypeCommand,{spec:{type:"codeblock"},commandGroup:"text-types"}),e.addIcon("codeblock",{fontawesome:"fa-quote-right"}),e.addLabel("codeblock",{en:"Codeblock",de:"Codeblock"}),e.addKeyboardShortcut("CommandOrControl+Alt+C",{command:"codeblock"})},Codeblock:Codeblock,CodeblockComponent:CodeblockComponent,CodeblockHTMLConverter:CodeblockHTMLConverter};class Emphasis extends PropertyAnnotation{}Emphasis.type="emphasis",Emphasis.fragmentation=Fragmenter.ANY;var EmphasisHTMLConverter={type:"emphasis",tagName:"em",matchElement:function(e){return e.is("em, i")}};class EmphasisComponent extends AnnotationComponent{getTagName(){return"em"}}var EmphasisPackage={name:"emphasis",configure:function(e){e.addNode(Emphasis),e.addConverter("html",EmphasisHTMLConverter),e.addConverter("xml",EmphasisHTMLConverter),e.addComponent("emphasis",EmphasisComponent),e.addCommand("emphasis",AnnotationCommand,{nodeType:Emphasis.type,commandGroup:"annotations"}),e.addIcon("emphasis",{fontawesome:"fa-italic"}),e.addLabel("emphasis",{en:"Emphasis",de:"Betonung"}),e.addKeyboardShortcut("CommandOrControl+I",{command:"emphasis"})},Emphasis:Emphasis,EmphasisComponent:EmphasisComponent,EmphasisHTMLConverter:EmphasisHTMLConverter};class FindAndReplaceCommand extends Command{getCommandState({editorSession:e}){let t=e.getManager("find-and-replace");if(t){return t.getCommandState()}return{disabled:!0}}execute(){}}class ToggleFindAndReplaceCommand extends Command{getCommandState({editorSession:e}){return e.getManager("find-and-replace")?{disabled:!1}:{disabled:!0}}execute({editorSession:e}){let t=e.getManager("find-and-replace");e.getFocusedSurface()&&t.enable()}}class CloseFindAndReplaceCommand extends Command{getCommandState({editorSession:e}){let t=e.getManager("find-and-replace");if(t){return{disabled:t.getCommandState().disabled}}return{disabled:!0}}execute({editorSession:e}){let t=e.getManager("find-and-replace");t.getCommandState().disabled||t.disable()}}class FindNextCommand extends ToggleFindAndReplaceCommand{execute({editorSession:e}){e.getManager("find-and-replace").findNext()}}class FindPreviousCommand extends FindAndReplaceCommand{execute({editorSession:e}){e.getManager("find-and-replace").findPrevious()}}class ReplaceNextCommand extends FindAndReplaceCommand{execute({editorSession:e}){e.getManager("find-and-replace").replaceNext()}}class ReplaceAllCommand extends FindAndReplaceCommand{execute({editorSession:e}){e.getManager("find-and-replace").replaceAll()}}class FindAndReplaceTool extends DeprecatedToggleTool{didMount(){this.context.editorSession.onPosition(this._onPosition,this)}dispose(){this.context.editorSession.off(this)}_onPosition(){let e=this.context.editorSession.getManager("find-and-replace");e._requestLookupMatch&&(this._scrollToSelectedMatch(),e._requestLookupMatch=!1),e._requestFocusSearchString&&setTimeout(()=>{this.refs.findString.el.focus(),this.refs.findString.el.select(),e._requestFocusSearchString=!1},0)}render(e){let t=this.props.commandState,r=e("div").addClass("sc-find-and-replace-tool");return r.append(this._renderStatusDescription(e),e("div").addClass("se-section").append(e("div").addClass("se-section-item se-find-input").addClass("sm-flex").append(e("input").ref("findString").attr("type","text").attr("placeholder","Find in body").attr("tabindex",500).val(t.findString).on("input",debounce(this._startFind,300)).on("keypress",this._triggerFindNext).on("focus",this._onFocus).on("blur",this._onBlur),this._renderStatusCounter(e)),e("div").addClass("se-section-item se-replace-input").append(e("button").append("Find").attr("tabindex",502).on("click",this._findNext)),e("div").addClass("se-section-item")),e("div").addClass("se-section").append(e("div").addClass("se-section-item").addClass("sm-flex").append(e("input").ref("replaceString").val(t.replaceString).attr("type","text").attr("tabindex",501).attr("placeholder","Replace in body").on("focus",this._onFocus).on("blur",this._onBlur).on("input",this._setReplaceString).on("keypress",this._triggerReplace)),e("div").addClass("se-section-item").append(e("button").append("Replace").attr("tabindex",503).on("click",this._replaceNext)),e("div").addClass("se-section-item").append(e("button").append("Replace All").attr("tabindex",504).on("click",this._replaceAll)))),r}_renderStatusDescription(e){let t=this.props.commandState,r=e("div").addClass("se-status").append(e("div").addClass("se-status-title").append(this.getLabel("find-and-replace-title")));return t.totalMatches>0?r.append(e("div").addClass("se-status-description").append(t.totalMatches," results found for ",'"'+t.findString+'"')):""!==t.findString?r.append(e("div").addClass("se-status-description").append("No results found for ",'"'+t.findString+'"')):r.append(e("div").addClass("se-status-description").append("Close this panel with ESC key")),r}_onFocus(){let e=this.context.editorSession;e.setBlurred(!0),e.startFlow()}_onBlur(){this.context.editorSession.setBlurred(!1)}_renderStatusCounter(e){let t,r=this.props.commandState;return r.totalMatches>0&&(t=e("span").addClass("se-status-counter").append([r.selectedMatch,r.totalMatches].join(" of "))),t}_findNext(){this.context.editorSession.getManager("find-and-replace").findNext()}_replaceNext(){this.context.editorSession.getManager("find-and-replace").replaceNext()}_replaceAll(){this.context.editorSession.getManager("find-and-replace").replaceAll()}findStringHasChanged(){let e=this.refs.findString.val(),t=this._previousFindString;return this._previousFindString=e,e!==t}_startFind(){let e=this.context.editorSession,t=this.refs.findString.val();e.getManager("find-and-replace").startFind(t)}_scrollToSelectedMatch(){this.context.editorSession.getFocusedSurface().context.scrollPane.scrollTo(".sc-selected-match","onlyIfNotVisible")}_triggerFindNext(e){13===e.keyCode&&this._findNext()}_triggerReplace(e){13===e.keyCode&&this._replaceNext()}_setReplaceString(){let e=this.refs.replaceString.val();this.context.editorSession.getManager("find-and-replace").setReplaceString(e)}}class FindAndReplaceManager{constructor(e){if(!e.editorSession)throw new Error("EditorSession required.");this.editorSession=e.editorSession,this.editorSession.onRender("document",this._onDocumentChanged,this),this.doc=this.editorSession.getDocument(),this.context=Object.assign({},e,{doc:this.doc}),this._state={disabled:!0,findString:"",replaceString:"",matches:[],selectedMatch:void 0},this._requestLookupMatch=!1,this._requestFocusSearchString=!1}dispose(){this.editorSession.off(this)}_resetState(){this._state.disabled=!0,this._state.matches=[],this._state.selectedMatch=void 0}getCommandState(){let e=this._state;return{disabled:e.disabled,findString:e.findString,replaceString:e.replaceString,totalMatches:e.matches.length,selectedMatch:e.selectedMatch+1}}enable(){this._state.disabled=!1,this._requestFocusSearchString=!0,this.startFind(this._state.findString)}disable(){this._state.disabled=!0,this._resetState(),this._propagateUpdate()}_onDocumentChanged(){this._state.disabled||(this._computeMatches(),this._state.selectedMatch=0,this._updateMarkers())}startFind(e){this._state.findString=e,this._computeMatches();let t=this._getClosestMatch();this._state.selectedMatch=t>0?t:0,this._requestLookupMatch=!0,this._setSelection(),this._propagateUpdate()}setReplaceString(e){this._state.replaceString=e}findNext(){let e=this._state.selectedMatch,t=this._state.matches.length;0!==t&&(this._state.selectedMatch=(e+1)%t,this._requestLookupMatch=!0,this._setSelection(),this._propagateUpdate())}findPrevious(){let e=this._state.selectedMatch,t=this._state.matches.length;0!==t&&(this._state.selectedMatch=e>0?e-1:t-1,this._requestLookupMatch=!0,this._setSelection(),this._propagateUpdate())}_setSelection(){let e=this._state.matches[this._state.selectedMatch];if(!e)return;let t=e.getSelection();this.editorSession.setSelection(t,"skipFlow")}replaceNext(){let e=this._state.selectedMatch,t=this._state.matches[e],r=this._state.matches.length;void 0!==t&&(this.editorSession.transaction((e,r)=>(e.setSelection(t.getSelection()),e.insertText(this._state.replaceString),r)),this._computeMatches(),e+1<r&&(this._state.selectedMatch=e),this._requestLookupMatch=!0,this._setSelection(),this._propagateUpdate())}replaceAll(){let e=this._state.matches.reverse();this.editorSession.transaction((t,r)=>(e.forEach(e=>{t.setSelection(e.getSelection()),t.insertText(this._state.replaceString)}),r)),this._computeMatches()}_getClosestMatch(){let e=this.editorSession.getDocument(),t=Object.keys(e.getNodes()),r=this.editorSession.getSelection(),n=0;if(!r.isNull()){let e=r.start.offset,s=r.start.path[0],o=t.indexOf(s);n=this._state.matches.findIndex(r=>{let n=r.getSelection(),s=n.start.offset,i=n.start.path[0],a=t.indexOf(i);return!(o>a)&&(o<a||e<=s)})}return n}_computeMatches(){let e=this._state.matches,t=void 0===e?0:e.length;this._state.matches=this._findAllMatches();let r=this._state.matches;r.length!==t&&(this._state.selectedMatch=r.length>0?0:void 0)}_findAllMatches(){let e=this._getAllAffectedTextPropertiesInOrder();const t=this._state.findString;let r=[];return t&&e.forEach(e=>{let n=this._findInTextProperty({path:e,findString:t});r=r.concat(n)}),r}_getAllAffectedTextPropertiesInOrder(){let e=[];const t=this.editorSession.getEditor();return e=(t.find(this.getRootElementSelector())||t).findAll(".sc-text-property").map(e=>e.props.path)}_findInTextProperty({path:e,findString:t}){const r=this.doc,n=r.get(e);let s,o=new RegExp(t,"ig"),i=[];for(;s=o.exec(n);){let t=new Marker(r,{type:"match",start:{path:e,offset:s.index},end:{offset:o.lastIndex}});i.push(t)}return i}_propagateUpdate(){this._updateMarkers(),this.editorSession._setDirty("commandStates"),this.editorSession.startFlow()}_updateMarkers(){const e=this._state,t=this.editorSession.markersManager;e.matches.forEach((t,r)=>{t.type=r===e.selectedMatch?"selected-match":"match"}),t.setMarkers("find-and-replace",e.matches)}getRootElementSelector(){return this.editorSession.getConfigurator().getFindAndReplaceConfig().rootElement}}var FindAndReplacePackage={name:"find-and-replace",configure:function(e,t){e.addCommand("find-and-replace",FindAndReplaceCommand,{commandGroup:"workflows"}),e.addCommand("toggle-find-and-replace",ToggleFindAndReplaceCommand,{commandGroup:"find-and-replace"}),e.addCommand("close-find-and-replace",CloseFindAndReplaceCommand,{commandGroup:"find-and-replace"}),e.addCommand("find-next",FindNextCommand,{commandGroup:"find-and-replace"}),e.addCommand("find-previous",FindPreviousCommand,{commandGroup:"find-and-replace"}),e.addCommand("replace-next",ReplaceNextCommand,{commandGroup:"find-and-replace"}),e.addCommand("replace-all",ReplaceAllCommand,{commandGroup:"find-and-replace"}),e.addTool("find-and-replace",FindAndReplaceTool),e.addKeyboardShortcut("CommandOrControl+F",{command:"toggle-find-and-replace"}),e.addKeyboardShortcut("CommandOrControl+Alt+F",{command:"toggle-find-and-replace"}),e.addKeyboardShortcut("CommandOrControl+G",{command:"find-next"}),e.addKeyboardShortcut("CommandOrControl+Shift+G",{command:"find-previous"}),e.addKeyboardShortcut("CommandOrControl+Alt+E",{command:"replace-next"}),e.addKeyboardShortcut("esc",{command:"close-find-and-replace"}),e.addManager("find-and-replace",FindAndReplaceManager),e.addLabel("find-and-replace-title",{en:"Find and replace",de:"Suchen und Ersetzen"}),e.setFindAndReplaceConfig(t)},FindAndReplaceCommand:FindAndReplaceCommand,ToggleFindAndReplaceCommand:ToggleFindAndReplaceCommand,FindNextCommand:FindNextCommand,FindPreviousCommand:FindPreviousCommand,ReplaceNextCommand:ReplaceNextCommand,ReplaceAllCommand:ReplaceAllCommand,FindAndReplaceTool:FindAndReplaceTool,FindAndReplaceManager:FindAndReplaceManager};class Heading extends TextBlock{isHeading(){return!0}getLevel(){return this.level}}Heading.schema={type:"heading",level:{type:"number",default:1}};class HeadingComponent extends TextBlockComponent{render(e){return super.render(e).addClass("sc-heading sm-level-"+this.props.node.level)}getTagName(){return"h"+this.props.node.level}}var HeadingMacro={appliesTo:["paragraph"],execute:function(e){if(-1===this.appliesTo.indexOf(e.node.type))return!1;if("type"!==e.action)return!1;let t=/^#\s/.exec(e.text);if(t){let r=e.editorSession,n=r.getSelection(),s=n.start.path,o=n.start.offset;return r.transaction(function(e){e.setSelection({type:"property",path:s,startOffset:0,endOffset:t[0].length}),e.deleteSelection();let r=e.switchTextType({type:"heading",level:1});e.setSelection({type:"property",path:r.getPath(),startOffset:o-t[0].length})}),!0}}},HeadingHTMLConverter={type:"heading",matchElement:function(e){return/^h\d$/.exec(e.tagName)},import:function(e,t,r){t.level=Number(e.tagName[1]);let n=e.attr("data-text-align");t.textAlign=n||"left",t.content=r.annotatedText(e,[t.id,"content"])},export:function(e,t,r){t.tagName="h"+e.level,"left"!==e.textAlign&&t.attr("data-text-align",e.textAlign),t.append(r.annotatedText([e.id,"content"]))}},HeadingPackage={name:"heading",configure:function(e){e.addNode(Heading),e.addComponent(Heading.type,HeadingComponent),e.addConverter("html",HeadingHTMLConverter),e.addConverter("xml",HeadingHTMLConverter),e.addCommand("heading1",SwitchTextTypeCommand,{spec:{type:"heading",level:1},commandGroup:"text-types"}),e.addCommand("heading2",SwitchTextTypeCommand,{spec:{type:"heading",level:2},commandGroup:"text-types"}),e.addCommand("heading3",SwitchTextTypeCommand,{spec:{type:"heading",level:3},commandGroup:"text-types"}),e.addKeyboardShortcut("CommandOrControl+Alt+1",{command:"heading1"}),e.addKeyboardShortcut("CommandOrControl+Alt+2",{command:"heading2"}),e.addKeyboardShortcut("CommandOrControl+Alt+3",{command:"heading3"}),e.addLabel("heading1",{en:"Heading 1",de:"Überschrift 1"}),e.addLabel("heading2",{en:"Heading 2",de:"Überschrift 2"}),e.addLabel("heading3",{en:"Heading 3",de:"Überschrift 3"}),e.addIcon("heading1",{fontawesome:"fa-header"}),e.addIcon("heading2",{fontawesome:"fa-header"}),e.addIcon("heading3",{fontawesome:"fa-header"})},Heading:Heading,HeadingComponent:HeadingComponent,HeadingHTMLConverter:HeadingHTMLConverter,HeadingMacro:HeadingMacro};class ImageNode extends DocumentNode{getImageFile(){if(this.imageFile)return this.document.get(this.imageFile)}getUrl(){let e=this.getImageFile();if(e)return e.getUrl()}}ImageNode.schema={type:"image",imageFile:{type:"file"}};class ImageComponent extends NodeComponent{didMount(){super.didMount.call(this),this.context.editorSession.onRender("document",this._onDocumentChange,this)}dispose(){super.dispose.call(this),this.context.editorSession.off(this)}_onDocumentChange(e){(e.hasUpdated(this.props.node.id)||e.hasUpdated(this.props.node.imageFile))&&this.rerender()}render(e){let t=super.render(e);return t.addClass("sc-image"),t.append(e("img").attr({src:this.props.node.getUrl()}).ref("image")),t}getDropzoneSpecs(){return[{component:this.refs.image,message:"Replace Image",dropParams:{action:"replace-image",nodeId:this.props.node.id}}]}handleDrop(e,t){let r=t.data.files[0];if(t.external){let t=e.create({type:"file",fileType:"image",mimeType:r.type,url:URL.createObjectURL(r)});e.set([this.props.node.id,"imageFile"],t.id)}else{let r=t.sourceSelection.nodeId,n=e.get(r);"image"===n.type&&e.set([this.props.node.id,"imageFile"],n.imageFile)}}}var ImageHTMLConverter={type:"image",tagName:"img",import:function(e,t,r){let n=r.getDocument().create({id:"file-"+t.id,type:"file",fileType:"image",url:e.attr("src")});t.imageFile=n.id},export:function(e,t){let r=e.document.get(e.imageFile);t.attr("src",r.getUrl())}};function insertImage(e,t){let r=e.create({type:"file",fileType:"image",mimeType:t.type,sourceFile:t});e.insertBlockNode({type:"image",imageFile:r.id})}class InsertImageCommand extends InsertNodeCommand{execute(e){e.editorSession.transaction(t=>{e.files.forEach(e=>{insertImage(t,e)})})}}class InsertImageTool extends DeprecatedToggleTool{getClassNames(){return"sc-insert-image-tool"}renderButton(e){return[super.renderButton(e),e("input").attr("type","file").ref("input").on("change",this.onFileSelect)]}onClick(){this.refs.input.click()}onFileSelect(e){let t=e.currentTarget.files;this.executeCommand({files:Array.prototype.slice.call(t)})}}var DropImage={type:"drop-asset",match(e){let t=0===e.file.type.indexOf("image/");return"file"===e.type&&t},drop(e,t){insertImage(e,t.file)}};class ImageProxy extends DefaultFileProxy{}ImageProxy.match=function(e){return"image"===e.fileType};var ImagePackage={name:"image",configure:function(e){e.addNode(ImageNode),e.addComponent("image",ImageComponent),e.addConverter("html",ImageHTMLConverter),e.addConverter("xml",ImageHTMLConverter),e.addCommand("insert-image",InsertImageCommand,{nodeType:"image",commandGroup:"insert"}),e.addTool("insert-image",InsertImageTool),e.addIcon("insert-image",{fontawesome:"fa-image"}),e.addLabel("image",{en:"Image",de:"Bild"}),e.addLabel("insert-image",{en:"Insert image",de:"Bild einfügen"}),e.addDropHandler(DropImage),e.addFileProxy(ImageProxy)},ImageNode:ImageNode,ImageComponent:ImageComponent,ImageHTMLConverter:ImageHTMLConverter,InsertImageCommand:InsertImageCommand,InsertImageTool:InsertImageTool,DropImage:DropImage};class Link extends PropertyAnnotation{static get fragmentation(){return Fragmenter.SHOULD_NOT_SPLIT}static get autoExpandRight(){return!1}}Link.schema={type:"link",title:{type:"string",optional:!0},url:{type:"string",default:""}};class LinkComponent extends AnnotationComponent{didMount(...e){super.didMount(...e);let t=this.props.node;this.context.editorSession.onRender("document",this.rerender,this,{path:[t.id,"url"]})}dispose(...e){super.dispose(...e),this.context.editorSession.off(this)}render(e){let t=super.render(e);t.tagName="a",t.attr("href",this.props.node.url);let r=[this.props.node.url];return this.props.node.title&&r.push(this.props.node.title),t.attr("title",r.join(" | "))}}class LinkCommand extends AnnotationCommand{canFuse(){return!1}executeCreate(e){let t=super.executeCreate(e);return this._getEditorSession(e).transaction(e=>{e.setSelection(e.selection.collapse())}),t}}var LinkHTMLConverter={type:"link",tagName:"a",import:function(e,t){t.url=e.attr("href"),t.title=e.attr("title")},export:function(e,t){t.attr({href:e.url,title:e.title})}};class EditLinkTool extends DeprecatedToggleTool{getUrlPath(){let e=this.constructor.urlPropertyPath;return[this.getNodeId()].concat(e)}getNodeId(){return this.props.commandState.nodeId}_openLink(){let e=this.context.editorSession.getDocument();window.open(e.get(this.getUrlPath()),"_blank")}render(e){let t=this.getComponent("input"),r=this.getComponent("button"),n=this.props.commandState,s=e("div").addClass("sc-edit-link-tool");if(n.disabled)return console.warn("Tried to render EditLinkTool while disabled."),s;let o=this.getUrlPath();return s.append(e(t,{type:"url",path:o,placeholder:"Paste or type a link url"}).ref("input"),e(r,{icon:"open-link",theme:this.props.theme}).attr("title",this.getLabel("open-link")).on("click",this._openLink),e(r,{icon:"delete",theme:this.props.theme}).attr("title",this.getLabel("delete-link")).on("click",this.onDelete)),s}onDelete(e){e.preventDefault();let t=this.getNodeId();this.context.surfaceManager.getFocusedSurface()?this.context.editorSession.transaction(function(e,r){return e.delete(t),r}):console.warn("No focused surface. Stopping command execution.")}}EditLinkTool.urlPropertyPath=["url"];var LinkPackage={name:"link",configure:function(e){e.addNode(Link),e.addComponent("link",LinkComponent),e.addConverter("html",LinkHTMLConverter),e.addConverter("xml",LinkHTMLConverter),e.addCommand("link",LinkCommand,{nodeType:"link",commandGroup:"annotations"}),e.addCommand("edit-link",EditAnnotationCommand,{nodeType:"link",commandGroup:"prompt"}),e.addTool("edit-link",EditLinkTool),e.addIcon("link",{fontawesome:"fa-link"}),e.addIcon("open-link",{fontawesome:"fa-external-link"}),e.addLabel("link",{en:"Link",de:"Link"}),e.addLabel("open-link",{en:"Open Link",de:"Link öffnen"}),e.addLabel("delete-link",{en:"Remove Link",de:"Link löschen"}),e.addKeyboardShortcut("CommandOrControl+K",{command:"link"})},Link:Link,LinkComponent:LinkComponent,LinkCommand:LinkCommand,LinkHTMLConverter:LinkHTMLConverter,EditLinkTool:EditLinkTool};class ListNode extends(ListMixin(DocumentNode)){createListItem(e){return this.getDocument().create({type:"list-item",content:e})}getItems(){const e=this.getDocument();return this.items.map(t=>e.get(t))}getItemsPath(){return[this.id,"items"]}insertItemAt(e,t){const r=this.getDocument(),n=t.id;r.update(this.getItemsPath(),{type:"insert",pos:e,value:n})}removeItemAt(e){this.getDocument().update(this.getItemsPath(),{type:"delete",pos:e})}getItemAt(e){return this.getDocument().get(this.items[e])}getItemPosition(e){const t=e.id;let r=this.items.indexOf(t);if(r<0)throw new Error("Item is not within this list: "+t);return r}getLength(){return this.items.length}getListTypeString(){return this.listType}setListTypeString(e){this.getDocument().set([this.id,"listType"],e)}}ListNode.type="list",ListNode.schema={items:{type:["array","id"],default:[],owned:!0},listType:{type:"string",default:"bullet"}};class ListItem extends TextNode{getLevel(){return this.level}setLevel(e){this.level!==e&&this.getDocument().set([this.id,"level"],e)}static isListItem(){return!0}}ListItem.schema={type:"list-item",level:{type:"number",default:1}};class ListItemComponent extends Component{render(e){const t=this.props.node,r=t.getPath();let n=e("li").addClass("sc-list-item");return n.append(e(TextPropertyComponent,{path:r,doc:t.getDocument()}).ref("text")),this.props.children&&n.append(this.props.children),n}}class ListComponent extends NodeComponent{render(e){let t=this.props.node,r=renderListNode(t,t=>isString(t)?e(t):"list-item"===t.type?e(ListItemComponent,{node:t}).ref(t.id):void 0);return r.addClass("sc-list").attr("data-id",t.id),r}get _isCustomNodeComponent(){return!0}}class ListHTMLConverter{get type(){return"list"}matchElement(e){return e.is("ul")||e.is("ol")}import(e,t,r){this._santizeNestedLists(e);let n=[],s=[];walk(e,(e,t)=>{e.isElementNode()&&(e.is("li")?n.push({el:e,level:t}):s[t]||(e.is("ul")?s[t]="bullet":e.is("ol")&&(s[t]="order")))}),this._createItems(r,t,n,s)}_createItems(e,t,r,n){t.items=r.map(t=>{let r=e.convertElement(t.el);return r.level=t.level,r.id}),t.listType=n.join(",")}export(e,t,r){let n=r.$$,s=renderListNode(e,function(e){if(isString(e))return n(e);{let t=e.getPath();return n("li").append(r.annotatedText(t))}});return t.tagName=s.tagName,t.attr(s.getAttributes()),t.append(s.getChildNodes()),t}_santizeNestedLists(e){e.findAll("ol,ul").forEach(e=>{for(;!e.parentNode.is("ol,ul");){let t=e.parentNode,r=t.parentNode,n=r.getChildIndex(t);r.insertAt(n+1,e)}})}}var ListItemHTMLConverter={type:"list-item",matchElement:function(e){return e.is("li")},import:function(e,t,r){t.content=r.annotatedText(e,[t.id,"content"])},export:function(e,t,r){t.append(r.annotatedText(e.getPath()))}};class ToggleListCommand extends Command{getCommandState(e){let t=e.editorSession,r=t.getDocument(),n=t.getSelection();if(n&&n.isPropertySelection()){let e=n.path,t=r.get(e[0]);if(t){if(t.isListItem()){let e=t.getLevel(),r=t.getParent(),n=r.getListType(e)===this.config.spec.listType;return{disabled:!1,active:n,action:n?"toggleList":"setListType",listId:r.id,level:e}}if(t.isText()&&t.isBlock())return{disabled:!1,action:"switchTextType"}}}return{disabled:!0}}execute(e){let t=e.commandState;const{disabled:r,action:n}=t;if(r)return;let s=e.editorSession;switch(n){case"toggleList":s.transaction(e=>{e.toggleList()},{action:"toggleList"});break;case"setListType":{const{listId:e,level:r}=t;s.transaction(t=>{t.get(e).setListType(r,this.config.spec.listType)},{action:"setListType"});break}case"switchTextType":s.transaction(e=>{e.toggleList({listType:this.config.spec.listType})},{action:"toggleList"})}}}class IndentListCommand extends Command{getCommandState(e){let t=e.editorSession,r=t.getDocument(),n=t.getSelection();if(n&&n.isPropertySelection()){let e=n.path,t=r.get(e[0]);if(t&&t.isListItem())return{disabled:!1}}return{disabled:!0}}execute(e){let t=e.commandState;const{disabled:r}=t;if(r)return;let n=e.editorSession;switch(this.config.spec.action){case"indent":n.transaction(e=>{e.indent()},{action:"indent"});break;case"dedent":n.transaction(e=>{e.dedent()},{action:"dedent"})}}}var ListPackage={name:"list",configure:function(e){e.addNode(ListNode),e.addNode(ListItem),e.addComponent("list",ListComponent),e.addComponent("list-item",ListItemComponent),e.addConverter("html",ListHTMLConverter),e.addConverter("html",ListItemHTMLConverter),e.addCommand("toggle-unordered-list",ToggleListCommand,{spec:{listType:"bullet"},commandGroup:"list"}),e.addLabel("toggle-unordered-list",{en:"Toggle list",de:"Liste entfernen"}),e.addIcon("toggle-unordered-list",{fontawesome:"fa-list-ul"}),e.addCommand("toggle-ordered-list",ToggleListCommand,{spec:{listType:"order"},commandGroup:"list"}),e.addLabel("toggle-ordered-list",{en:"Toggle list",de:"Aufzählung entfernen"}),e.addIcon("toggle-ordered-list",{fontawesome:"fa-list-ol"}),e.addCommand("indent-list",IndentListCommand,{spec:{action:"indent"},commandGroup:"list"}),e.addLabel("indent-list",{en:"Increase indentation",de:"Einrückung vergrößern"}),e.addIcon("indent-list",{fontawesome:"fa-indent"}),e.addCommand("dedent-list",IndentListCommand,{spec:{action:"dedent"},commandGroup:"list"}),e.addLabel("dedent-list",{en:"Decrease indentation",de:"Einrückung verringern"}),e.addIcon("dedent-list",{fontawesome:"fa-dedent"})},ListNode:ListNode,ListItemNode:ListItem,ListComponent:ListComponent,ListHTMLConverter:ListHTMLConverter,ListItemHTMLConverter:ListItemHTMLConverter,ToggleListCommand:ToggleListCommand,IndentListCommand:IndentListCommand};class MultiSelect extends Component{didMount(){this._recomputeOrder()}getInitialState(){return{options:this.props.options,selectedOptions:this.props.selectedOptions,collapsed:!0}}render(e){let t=this.state.options,r=this.props.maxItems,n=this.state.selectedOptions,s=this.state.collapsed,o=n.length>r?n.length:r,i=e("div").addClass("sc-multi-select"),a=t.map((t,r)=>{if(!s||r<=o-1){let r=e("div").addClass("se-select-option"),s=n.indexOf(t.id)>-1?"selected-option":"unselected-option";return r.append(this.renderIcon(e,s).addClass("se-option-icon"),e("span").addClass("se-option-label").append(t.label)).on("click",this._onToggleCheckbox.bind(this,t.id)),r}return""});i.append(a);let l=e("div").addClass("se-multi-collapse-label");if(t.length>o)if(s){let e=t.length-o;l.append(this.getLabel("expand-options")+" ("+e+")").on("click",this._onToggleExpand)}else l.append(this.getLabel("collapse-options")).on("click",this._onToggleExpand);return i.append(l),i}renderIcon(e,t){return this.context.iconProvider.renderIcon(e,t)}getSelectedOptions(){return this.state.selectedOptions}_recomputeOrder(){let e=this.state.options,t=this.state.selectedOptions,r=orderBy(e,e=>t.indexOf(e.id),"desc");this.extendState({options:r})}_onToggleCheckbox(e){let t=this.state.selectedOptions,r=t.indexOf(e);r>-1?t.splice(r,1):t.push(e),this.extendState({selectedOptions:t}),this.el.emit("change")}_onToggleExpand(){let e=this.state.collapsed;this._recomputeOrder(),this.extendState({collapsed:!e})}}var MultiSelectPackage={name:"multi-select",configure:function(e){e.addComponent("multi-select",MultiSelect),e.addIcon("selected-option",{fontawesome:"fa-check-square-o"}),e.addIcon("unselected-option",{fontawesome:"fa-square-o"}),e.addLabel("expand-options",{en:"Show more",de:"Zeig mehr"}),e.addLabel("collapse-options",{en:"Show less",de:"Zeige weniger"})}};class Paragraph extends TextBlock{}Paragraph.type="paragraph";class ParagraphComponent extends TextBlockComponent{render(e){return super.render(e).addClass("sc-paragraph")}getTagName(){return"p"}}var ParagraphHTMLConverter={type:"paragraph",tagName:"p",import:function(e,t,r){let n=e.attr("data-text-align");t.textAlign=n||"left",t.content=r.annotatedText(e,[t.id,"content"])},export:function(e,t,r){"left"!==e.textAlign&&t.attr("data-text-align",e.textAlign),t.append(r.annotatedText([e.id,"content"]))}},ParagraphPackage={name:"paragraph",configure:function(e){e.addNode(Paragraph),e.addComponent(Paragraph.type,ParagraphComponent),e.addConverter("html",ParagraphHTMLConverter),e.addConverter("xml",ParagraphHTMLConverter),e.addCommand("paragraph",SwitchTextTypeCommand,{spec:{type:"paragraph"},commandGroup:"text-types"}),e.addIcon("paragraph",{fontawesome:"fa-paragraph"}),e.addLabel("paragraph",{en:"Paragraph",de:"Paragraph"}),e.addKeyboardShortcut("CommandOrControl+Alt+0",{command:"paragraph"})},Paragraph:Paragraph,ParagraphComponent:ParagraphComponent,ParagraphHTMLConverter:ParagraphHTMLConverter};class SaveCommand extends Command{constructor(){super({name:"save"})}getCommandState(e){return{disabled:!e.editorSession.hasUnsavedChanges(),active:!1}}execute(e){return e.editorSession.save(),{status:"saving-process-started"}}}var PersistencePackage={name:"persistence",configure:function(e){e.addCommand("save",SaveCommand,{commandGroup:"persistence"}),e.addIcon("save",{fontawesome:"fa-save"}),e.addLabel("save",{en:"Save",de:"Speichern"}),e.addKeyboardShortcut("CommandOrControl+S",{command:"save"})},SaveCommand:SaveCommand};class Strong extends PropertyAnnotation{}Strong.type="strong",Strong.fragmentation=Fragmenter.ANY;var StrongHTMLConverter={type:"strong",tagName:"strong",matchElement:function(e){return e.is("strong, b")}};class StrongComponent extends AnnotationComponent{getTagName(){return"strong"}}var StrongPackage={name:"strong",configure:function(e){e.addNode(Strong),e.addConverter("html",StrongHTMLConverter),e.addConverter("xml",StrongHTMLConverter),e.addComponent("strong",StrongComponent),e.addCommand("strong",AnnotationCommand,{nodeType:"strong",commandGroup:"annotations"}),e.addIcon("strong",{fontawesome:"fa-bold"}),e.addLabel("strong",{en:"Strong",de:"Fett"}),e.addKeyboardShortcut("CommandOrControl+B",{command:"strong"})},Strong:Strong,StrongComponent:StrongComponent,StrongHTMLConverter:StrongHTMLConverter};class Subscript extends PropertyAnnotation{}Subscript.type="subscript",Subscript.fragmentation=Fragmenter.ANY;var SubscriptHTMLConverter={type:"subscript",tagName:"sub"},SubscriptPackage={name:"subscript",configure:function(e){e.addNode(Subscript),e.addConverter("html",SubscriptHTMLConverter),e.addConverter("xml",SubscriptHTMLConverter),e.addComponent("subscript",AnnotationComponent),e.addCommand("subscript",AnnotationCommand,{nodeType:"subscript",commandGroup:"annotations"}),e.addIcon("subscript",{fontawesome:"fa-subscript"}),e.addLabel("subscript",{en:"Subscript",de:"Tiefgestellt"})},Subscript:Subscript,SubscriptHTMLConverter:SubscriptHTMLConverter};class Superscript extends PropertyAnnotation{}Superscript.type="superscript",Superscript.fragmentation=Fragmenter.ANY;var SuperscriptHTMLConverter={type:"superscript",tagName:"sup"},SuperscriptPackage={name:"superscript",configure:function(e){e.addNode(Superscript),e.addConverter("html",SuperscriptHTMLConverter),e.addConverter("xml",SuperscriptHTMLConverter),e.addComponent("superscript",AnnotationComponent),e.addCommand("superscript",AnnotationCommand,{nodeType:"superscript",commandGroup:"annotations"}),e.addIcon("superscript",{fontawesome:"fa-superscript"}),e.addLabel("superscript",{en:"Superscript",de:"Hochgestellt"})},Superscript:Superscript,SuperscriptHTMLConverter:SuperscriptHTMLConverter};const LEFT_QUOTE="“",RIGHT_QUOTE="”";class InsertQuoteMarkCommand extends Command{getCommandState(e,t){return{disabled:!1}}execute(e,t){let r=e.editorSession,n=r.getSelection(),s=r.getDocument();if(n.isPropertySelection()){let e=n.start.getNodeId(),t=s.get(e);if(t.isText()){let e,s=t.getText(),o=n.start.offset;return e=0===o||/\s/.exec(s.slice(o-1,o))?LEFT_QUOTE:RIGHT_QUOTE,r.transaction(t=>{t.insertText(e)}),!0}}return!1}}var QuoteMarksPackage={name:"quote-marks",configure:function(e){e.addCommand("insert-quote-marks",InsertQuoteMarkCommand,{commandGroup:"text-macros"}),e.addKeyboardShortcut('"',{type:"textinput",command:"insert-quote-marks"})}};class Table extends BlockNode{getRowCount(){return this.cells.length}getColCount(){return this.cells.length>0?this.cells[0].length:0}getCellAt(e,t){let r=this.cells[e][t];if(r)return this.document.get(r)}}Table.schema={type:"table",cells:{type:["array","array","id"],default:[],owned:!0}};class TableCell extends TextNode{}TableCell.schema={type:"table-cell",rowspan:{type:"number",default:0},colspan:{type:"number",default:0}};class TableCellComponent extends Component{render(e){let t=this.props.node,r=e("td").addClass("sc-table-cell");return r.append(e(TextPropertyEditor,{path:t.getPath(),disabled:this.props.disabled}).ref("editor")),t.rowspan>0&&r.attr("rowspan",t.rowspan),t.colspan>0&&r.attr("colspan",t.colspan),r}grabFocus(){let e=this.props.node;this.context.editorSession.setSelection({type:"property",path:e.getPath(),startOffset:e.getLength(),surfaceId:this.refs.editor.id})}}TableCellComponent.prototype._isTableCellComponent=!0;class TableComponent extends Component{render(e){let t=e("table").addClass("sc-table"),r=this.props.node,n=this.props.node.getDocument(),s=this.props.node.cells,o=r.getRowCount(),i=r.getColCount();for(let r=0;r<o;r++){let o=e("tr");for(let t=0;t<i;t++){let i=s[r][t];if(i){let t=n.get(i),r=e(TableCellComponent,{node:t,disabled:this.props.disabled}).ref(t.id);o.append(r)}}t.append(o)}return t.on("click",this.onClick),t.on("dblclick",this.onDblClick),t}onClick(e){e.stopPropagation()}onDblClick(e){e.stopPropagation();let t=Component.unwrap(e.target);if(t){let e;t._isTableCellComponent?e=t:t._isTextPropertyEditor?e=t.getParent():t._isTextPropertyComponent?e=t.getParent().getParent():console.warn("TODO: find the right cell"),e&&e.grabFocus()}}grabFocus(){let e=this.props.node.cells[0][0];if(e){this.refs[e].grabFocus()}}}TableComponent.hasDropzones=!0;var TableHTMLConverter={type:"table",tagName:"table",import:function(e,t,r){let n=e.find("tbody").getChildren(),s=0,o=[],i=[];for(let e=0;e<n.length;e++){let t=n[e].getChildren(),a=[];s=Math.max(t.length,s);for(let e=0;e<t.length;e++){let n=t[e];i[e]>1&&(a.push(null),i[e]-=1);let s=r.convertElement(n);a.push(s.id),s.rowspan>1&&(i[e]=s.rowspan),s.colspan>1&&times$2(s.colspan-1,()=>{a.push(null)})}o.push(a)}t.cells=o},export:function(e,t,r){let n=r.$$,s=e.getRowCount(),o=e.getColCount();for(let i=0;i<s;i++){let s=n("tr");for(let t=0;t<o;t++){let n=e.cells[i][t];if(n){let e=r.convertNode(n);s.append(e)}}t.append(s)}return t}},TableCellHTMLConverter={type:"table-cell",tagName:"td",import:function(e,t,r){t.content=r.annotatedText(e,[t.id,"content"]);let n=e.attr("colspan"),s=e.attr("rowspan");n&&(t.colspan=Number(n)),s&&(t.rowspan=Number(s))},export:function(e,t,r){return t.append(r.annotatedText([e.id,"content"])),e.rowspan>0&&t.attr("rowspan",e.rowspan),e.colspan>0&&t.attr("colspan",e.colspan),t}};class InsertTableCommand extends InsertNodeCommand{createNodeData(e){let t=e.create({id:uuid("table-cell"),type:"table-cell",content:"A1"}),r=e.create({id:uuid("table-cell"),type:"table-cell",content:"B1"}),n=e.create({id:uuid("table-cell"),type:"table-cell",content:"A2"}),s=e.create({id:uuid("table-cell"),type:"table-cell",content:"B2"});return{id:uuid("table"),type:"table",cells:[[t.id,r.id],[n.id,s.id]]}}}var TablePackage={name:"table",configure:function(e){e.addNode(Table),e.addNode(TableCell),e.addComponent("table",TableComponent),e.addConverter("html",TableHTMLConverter),e.addConverter("html",TableCellHTMLConverter),e.addConverter("xml",TableHTMLConverter),e.addConverter("xml",TableCellHTMLConverter),e.addCommand("insert-table",InsertTableCommand,{nodeType:"table",commandGroup:"insert"}),e.addIcon("insert-table",{fontawesome:"fa-table"}),e.addLabel("insert-table",{en:"Table",de:"Tabelle"}),e.addLabel("table",{en:"Table",de:"Tabelle"}),e.addLabel("table-cell.content",{en:"Cell",de:"Zelle"})},Table:Table,TableCell:TableCell};class ProseArticle extends Document{_initialize(){super._initialize(),this.create({type:"@container",id:"body",nodes:[]})}}class ProseEditor extends DeprecatedAbstractEditor{render(e){let t=this.componentRegistry.get("split-pane"),r=e("div").addClass("sc-prose-editor"),n=this._renderToolbar(e),s=this._renderEditor(e),o=this.getConfigurator(),i=this.componentRegistry.get("scroll-pane"),a=this.componentRegistry.get("overlay"),l=this.componentRegistry.get("context-menu"),c=this.componentRegistry.get("dropzones"),d=e(i,{name:"contentPanel",contextMenu:this.props.contextMenu||"native",scrollbarPosition:"right",scrollbarType:this.props.scrollbarType}).append(s,e(a,{toolPanel:o.getToolPanel("main-overlay"),theme:"dark"}),e(l),e(c)).ref("contentPanel");return r.append(e(t,{splitType:"horizontal"}).append(n,e(t,{splitType:"horizontal",sizeB:"inherit"}).append(d,e(DeprecatedWorkflowPane,{toolPanel:o.getToolPanel("workflow")})))),r}_renderToolbar(e){let t=this.getConfigurator();return e("div").addClass("se-toolbar-wrapper").append(e(DeprecatedToolbar,{toolPanel:t.getToolPanel("toolbar")}).ref("toolbar"))}_renderEditor(e){let t=this.getConfigurator();return e(ContainerEditor,{disabled:this.props.disabled,editorSession:this.editorSession,node:this.doc.get("body"),commands:t.getSurfaceCommandNames()}).ref("body")}}class ProseArticleImporter extends HTMLImporter{convertDocument(e){let t=e.find("body");this.convertContainer(t.children,"body")}}var ProseEditorPackage={name:"prose-editor",configure:function(e){e.defineSchema({name:"prose-article",DocumentClass:ProseArticle,defaultTextType:"paragraph",version:"1.0"}),e.addImporter("html",ProseArticleImporter),e.import(BasePackage),e.import(BlockquotePackage),e.import(ParagraphPackage),e.import(HeadingPackage),e.import(CodeblockPackage),e.import(CodePackage),e.import(EmphasisPackage),e.import(FindAndReplacePackage,{targetSurfaces:["body"]}),e.import(StrongPackage),e.import(SubscriptPackage),e.import(SuperscriptPackage),e.import(LinkPackage),e.import(QuoteMarksPackage),e.import(ListPackage),e.import(TablePackage),e.addToolPanel("main-overlay",[{name:"prompt",type:"tool-group",commandGroups:["prompt"]}]),e.addToolPanel("workflow",[{name:"workflow",type:"tool-group",commandGroups:["workflows"]}]),e.addToolPanel("toolbar",[{name:"text-types",type:"tool-dropdown",showDisabled:!0,style:"descriptive",commandGroups:["text-types"]},{name:"annotations",type:"tool-group",showDisabled:!0,style:"minimal",commandGroups:["annotations"]},{name:"insert",type:"tool-dropdown",showDisabled:!0,style:"descriptive",commandGroups:["insert"]}])},ProseEditor:ProseEditor,ProseArticle:ProseArticle};class CorrectionTool extends DeprecatedToggleTool{render(e){let t=this.props.node,r=this.getComponent("button"),n=e("div").addClass("sc-correction-tool");return t&&t.suggestions.length>0?t.suggestions.forEach(t=>{n.append(e(r,{label:t,style:this.props.style}).attr("title",this.getLabel("open-link")).attr("data-correction",t).on("click",this._applyCorrection.bind(this,t)))}):n.append(e(r,{label:"No suggestions",style:this.props.style,disabled:!0})),n}_applyCorrection(e){let t=this.context.editorSession,r=this.props.node;t.transaction(t=>{let n=t.getSelection();t.setSelection({type:"property",path:r.start.path,startOffset:r.start.offset,endOffset:r.end.offset,containerPath:n.containerPath}),t.insertText(e)})}}class SpellCheckCommand extends Command{getCommandState(e){let t=e.selectionState.getMarkers();return 0===t.length?{disabled:!0}:(t=t.filter(function(e){return"spell-error"===e.type})).length>0?{disabled:!1,active:!1,mode:null,node:t[0]}:{disabled:!0}}}const DEFAULT_API_URL="http://localhost:4777/api/check";class SpellCheckManager{constructor(e,t){let r=(t=t||{}).wait||750;this.editorSession=e,this.apiURL=t.apiURL||DEFAULT_API_URL,this.textPropertyManager=e.markersManager,this.markersManager=e.markersManager,this._schedule={},this._scheduleCheck=debounce(this._runSpellCheck.bind(this),r),e.onFinalize("document",this._onDocumentChange,this)}dispose(){this.editorSession.off(this)}check(e){this._runSpellCheck(getKeyForPath(e))}runGlobalCheck(){Object.keys(this.textPropertyManager._textProperties).forEach(e=>{this._runSpellCheck(e)})}_onDocumentChange(e,t){if(t.spellcheck)return;const r=this.textPropertyManager._textProperties;Object.keys(e.updated).forEach(e=>{r[e]&&this._scheduleCheck(e)})}_runSpellCheck(e){let t=e.split("."),r=this.editorSession.getDocument().get(t),n=this.editorSession.getLanguage();r&&isString(r)&&sendRequest({method:"POST",url:this.apiURL,header:{"Content-Type":"application/json; charset=UTF-8"},data:{text:r,lang:n}}).then(e=>{e=JSON.parse(e),this._addSpellErrors(t,e)}).catch(function(e){console.error(e)})}_addSpellErrors(e,t){const r=this.editorSession,n=r.markersManager,s="spell-error:"+e.join("."),o=t.map(t=>({type:"spell-error",start:{path:e,offset:t.start},end:{offset:t.end},suggestions:t.suggestions}));n.setMarkers(s,o),r.startFlow()}}var SpellCheckPackage={name:"spell-check",configure:function(e){e.addCommand("correction",SpellCheckCommand,{commandGroup:"spell-check"}),e.addTool("correction",CorrectionTool)},SpellCheckManager:SpellCheckManager};const{UndoCommand:UndoCommand,RedoCommand:RedoCommand,SelectAllCommand:SelectAllCommand}=BasePackage;class TextInput extends DeprecatedAbstractEditor{constructor(e,t={}){super(e,_createEditorSession(t)),this.doc=this.editorSession.getDocument()}render(e){let t=e(this._getTagName()).addClass("sc-text-input");return t.append(e(TextInputEditor,{path:["input","content"]}).ref("input").on("enter",this._onEnter).on("escape",this._onEscape)),t}didMount(){this.refs.input.selectLast()}dispose(){super.dispose(),this.doc.dispose(),this.editorSession.dispose()}shouldRerender(){return!1}getContent(){return this.getDocument().getContent()}_getDocument(){return this.context.editorSession.getDocument()}_getTagName(){return this.props.tagName||"div"}_onEnter(e){e.stopPropagation(),this.el.emit("confirm")}_onEscape(e){e.stopPropagation(),this.el.emit("cancel")}}function _createEditorSession(e){let t=new DeprecatedConfigurator;t.addNode(TextNode),t.addCommand("undo",UndoCommand),t.addCommand("redo",RedoCommand),t.addCommand("select-all",SelectAllCommand),t.addKeyboardShortcut("CommandOrControl+Z",{command:"undo"}),t.addKeyboardShortcut("CommandOrControl+Shift+Z",{command:"redo"}),t.addKeyboardShortcut("CommandOrControl+A",{command:"select-all"}),t.defineSchema({name:"text-input",defaultTextType:"text",ArticleClass:TextInputDocument}),e.package&&t.import(e.package);let r=t.createArticle();return e.content&&r.set(["input","content"],e.content),{editorSession:new DeprecatedEditorSession(r,{configurator:t})}}class TextInputDocument extends Document{constructor(...e){super(...e),this.create({type:"text",id:"input",content:""})}getContentNode(){return this.get("input")}getContent(){return this.getContentNode().getText()}}class TextInputEditor extends TextPropertyEditor{onKeyDown(e){let t=!1;27===e.keyCode&&(t=!0,this.el.emit("escape")),t?(e.stopPropagation(),e.preventDefault()):super.onKeyDown(e)}selectLast(){const e=this.getDocument().getContentNode();this.editorSession.setSelection({type:"property",path:e.getPath(),startOffset:e.getLength(),surfaceId:this.id})}selectAll(){const e=this.getDocument().getContentNode();this.editorSession.setSelection({type:"property",path:e.getPath(),startOffset:0,endffset:e.getLength(),surfaceId:this.id})}_handleEnterKey(...e){super._handleEnterKey(...e),this.el.emit("enter")}}var TextInputPackage={name:"text-input",configure(e){e.addComponent("text-input",TextInput)},TextInput:TextInput},ToolbarPackage={name:"toolbar",configure(e){e.addComponent("toolbar",DeprecatedToolbar)},Toolbar:DeprecatedToolbar};class TextAlignCommand extends Command{getCommandState(e){let t=this._getSelection(e),r=e.editorSession.getSelectionState(),n=e.editorSession.getDocument(),s={disabled:!0};if(t.isPropertySelection()&&!r.isInlineNodeSelection){let e=t.getPath(),r=n.get(e[0]);r&&r.isText()&&r.isBlock()&&(s.nodeId=r.id,s.disabled=!1,r.textAlign===this.config.textAlign&&(s.active=!0),s.showInContext=0===t.start.offset&&0===t.end.offset)}return s}execute(e){let t=e.commandState.nodeId;e.editorSession.transaction(e=>{e.set([t,"textAlign"],this.config.textAlign)})}}var TextAlignPackage={name:"text-align",configure:function(e){e.addCommand("align-left",TextAlignCommand,{textAlign:"left",commandGroup:"text-align"}),e.addCommand("align-center",TextAlignCommand,{textAlign:"center",commandGroup:"text-align"}),e.addCommand("align-right",TextAlignCommand,{textAlign:"right",commandGroup:"text-align"}),e.addKeyboardShortcut("CommandOrControl+Shift+L",{command:"align-left"}),e.addKeyboardShortcut("CommandOrControl+Shift+E",{command:"align-center"}),e.addKeyboardShortcut("CommandOrControl+Shift+R",{command:"align-right"}),e.addIcon("align-left",{fontawesome:"fa-align-left"}),e.addIcon("align-center",{fontawesome:"fa-align-center"}),e.addIcon("align-right",{fontawesome:"fa-align-right"}),e.addLabel("align-left","Left"),e.addLabel("align-center","Center"),e.addLabel("align-right","Right"),e.addLabel("text-align","Text Align")}};export{cssSelect,domUtils as DomUtils,ChangeStore,CollabServer,DocumentClient,ServerRequest,WebSocketConnection,ClientConnection,CollabServerConfigurator,DocumentEngine,ServerResponse,computeSnapshot,CollabClient,CollabServerPackage,DocumentServer,SnapshotEngine,CollabEngine,CollabSession,Server,SnapshotStore,DOMElement,DOMEventListener,DefaultDOMElement,BrowserDOMElement,MemoryDOMElement,domHelpers,documentHelpers,operationHelpers,selectionHelpers,AbstractEditorSession,annotationHelpers,AnnotationIndex,AnnotationMixin,ArrayOperation,BlockNode,ChangeHistoryView,ChangeRecorder,ClipboardExporter,ClipboardImporter,Conflict,Container,ContainerAdapter,ContainerAnnotation,ContainerAnnotationIndex,ContainerMixin,ContainerSelection,Coordinate,CoordinateAdapter,CoordinateOperation,copySelection,createDocumentFactory,CustomSelection,Data,DefaultChangeCompressor,DefaultFileProxy,Document,DocumentChange,DocumentIndex,DocumentNode,DocumentNodeFactory,DocumentSchema,DocumentSession,DOMExporter,DOMImporter,Editing,EditingInterface,FileNode,FileProxy,Fragmenter,getChangeFromDocument,HTMLExporter,HTMLImporter,importNodeIntoDocument,IncrementalData,InlineNode,JSONConverter,ListMixin,Marker,Node,NodeIndex,NodeProperty,NodeRegistry,NodeSelection,ObjectOperation,OperationSerializer,ParentNodeHook,paste,PropertyAnnotation,PropertyIndex,PropertySelection,Range,Schema,Selection,TextBlock,TextNode,TextNodeMixin,TextOperation,Transaction,XMLExporter,XMLImporter,STRING,TEXT$1 as TEXT,PLAIN_TEXT,STRING_ARRAY,BOOLEAN,ENUM,MANY,ONE,CHILDREN,CHILD,CONTAINER,OPTIONAL,AbstractClipboard,AbstractIsolatedNodeComponent,AbstractScrollPane,AbstractGlobalEventHandler,AbstractKeyboardManager,AnnotatedTextComponent,AnnotationCommand,AnnotationComponent,BlockNodeComponent,Button,Clipboard,Command,Component,ComponentRegistry,ContainerEditor,CustomSurface,DefaultLabelProvider,DOMSelection,DragAndDropHandler,EditAnnotationCommand,EditInlineNodeCommand,FontAwesomeIcon,FontAwesomeIconProvider,HandlerParams,Highlights,InsertInlineNodeCommand,InsertNodeCommand,IsolatedNodeComponent,IsolatedInlineNodeComponent,NodeComponent,RenderingEngine,Router,SelectionFragmentComponent,Surface,SwitchTextTypeCommand,TextBlockComponent,TextPropertyComponent,TextPropertyEditor,Tooltip,UnsupportedNodeComponent,VirtualElement,SplitPane,Undo as UndoCommand,Redo as RedoCommand,SelectAll as SelectAllCommand,IsolatedInlineNodeComponent as InlineNodeComponent,findParentComponent,async,tableHelpers,ArrayIterator,ArrayTree,array2table,camelCase,capitalize,clone,cloneDeep,createCountingIdGenerator,debounce,deleteFromArray,diff,encodeXMLEntities,EventEmitter,extend,Factory,filter,find,findIndex$1 as findIndex,flatten$1 as flatten,flattenOften,forEach,getKeyForPath,getRangeFromMatrix$1 as getRangeFromMatrix,getRelativeBoundingRect,getRelativeMouseBounds,inBrowser,includes,isArray,isArrayEqual,isBoolean,isEqual,isFunction$1 as isFunction,isMatch,isNil,isNumber,isObject,isPlainObject,isString,keys$1 as keys,last$1 as last,levenshtein,array2table as makeMap,map,merge$1 as merge,parseKeyCombo,parseKeyEvent,PathObject,percentage,pick,platform,pluck,printStacktrace,request,renderListNode,sendRequest,startsWith,SubstanceError,substanceGlobals,times$2 as times,toUnixLineEndings,TreeIndex,uniq,uuid,without,orderBy,getDOMRangeFromEvent,getRelativeRect,getSelectionRect,isMouseInsideDOMSelection,getQueryStringParam,setDOMSelection,analyze as _analyzeElementSchemas,checkSchema,compileRNG,cssSelectAdapter$1 as cssSelectAdapter,_loadRNG as loadRNG,prettyPrintXML,registerSchema,SchemaDrivenCommandManager,validateXML as validateXMLSchema,ValidatingChildNodeIterator,XMLAnchorNode,XMLAnnotationNode,XMLContainerNode,XMLDocument,XMLDocumentImporter,XMLEditingInterface,XMLElementNode,ElementNodeConverter as XMLElementNodeConverter,XMLExternalNode,ExternalNodeConverter as XMLExternalNodeConverter,XMLInlineElementNode,XMLNodeConverter,XMLSchema,XMLTextElement,XMLTextElementConverter,BasePackage,BlockquotePackage,BodyScrollPanePackage,ButtonPackage,CodePackage,CodeblockPackage,ContextMenuPackage,DropzonesPackage,EmphasisPackage,FilePackage,FindAndReplacePackage,HeadingPackage,ImagePackage,InputPackage,LinkPackage,ListPackage,ModalPackage,MultiSelectPackage,OverlayPackage,ParagraphPackage,PersistencePackage,ProseEditorPackage,QuoteMarksPackage,ScrollPanePackage,ScrollbarPackage,SpellCheckPackage,SplitPanePackage,StrongPackage,SubscriptPackage,SuperscriptPackage,TabbedPanePackage,TablePackage,TextInputPackage,ToolbarPackage,ToolPanelPackage,TextAlignPackage,DeprecatedAbstractEditor as AbstractEditor,DeprecatedCommandManager as CommandManager,DeprecatedConfigurator as Configurator,DeprecatedContextMenu as ContextMenu,DeprecatedDragManager as DragManager,DeprecatedDropzones as Dropzones,DeprecatedEditorSession as EditorSession,DeprecatedFileManager as FileManager,DeprecatedGlobalEventHandler as GlobalEventHandler,DeprecatedKeyboardManager as KeyboardManager,DeprecatedMacroManager as MacroManager,DeprecatedMarkersManager as MarkersManager,DeprecatedMenu as Menu,DeprecatedMenuGroup as MenuGroup,DeprecatedMenuItem as MenuItem,DeprecatedOverlay as Overlay,DeprecatedRegistry as Registry,DeprecatedResourceManager as ResourceManager,DeprecatedResponsiveApplication as ResponsiveApplication,DeprecatedScrollbar as Scrollbar,DeprecatedScrollPane as ScrollPane,DeprecatedSelectionState as SelectionState,DeprecatedToggleTool as Tool,DeprecatedToggleTool as ToggleTool,DeprecatedToolbar as Toolbar,DeprecatedToolDropdown as ToolDropdown,DeprecatedToolGroup as ToolGroup,DeprecatedToolPanel as ToolPanel,DeprecatedToolPrompt as ToolPrompt,DeprecatedToolSeparator as ToolSeparator,DeprecatedWorkflowPane as WorkflowPane};
//# sourceMappingURL=./substance.es.min.js.map